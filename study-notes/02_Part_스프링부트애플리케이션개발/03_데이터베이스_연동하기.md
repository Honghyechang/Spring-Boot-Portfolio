# 03_ë°ì´í„°ë² ì´ìŠ¤_ì—°ë™í•˜ê¸°

<!--
# ì²« ì‘ì„± (3.1 JDBC)
docs: [Ch03] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ - JDBC ì¶”ê°€

# ë‹¤ìŒ ì—…ë°ì´íŠ¸ (3.2, 3.3 ì¶”ê°€)
docs: [Ch03] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ - Spring Data JDBC, MyBatis ì¶”ê°€

# ë§ˆì§€ë§‰ ì™„ë£Œ (3.4, 3.5 ì¶”ê°€)
docs: [Ch03] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ - JPA, MongoDB ì¶”ê°€ ë° ì™„ë£Œ

-->

## ğŸ“Œ í•™ìŠµ ëª©í‘œ
ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ì´í•´í•˜ê³ , ê° ë°©ì‹ì˜ íŠ¹ì§•ê³¼ ì‚¬ìš©ë²•ì„ ìµíŒë‹¤.

---

## ëª©ì°¨

- [3.1 JDBC](#31-jdbc)
- [3.2 Spring Data JDBC](#32-spring-data-jdbc) 
- [3.3 MyBatis](#33-mybatis) 
- [3.4 JPA](#34-jpa) 
- [3.5 MongoDB](#35-mongodb) 

---

## 3.1 JDBC

### 3.1.1 JDBCë€?

**JDBC (Java Database Connectivity)** ëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ **í‘œì¤€ API**ì…ë‹ˆë‹¤.

#### JDBCì˜ êµ¬ì„± ìš”ì†Œ

```
[Java ì• í”Œë¦¬ì¼€ì´ì…˜]
      â†“
[JDBC API] â† Javaê°€ ì œê³µí•˜ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤
      â†“
[JDBC Driver] â† ê° DB ë²¤ë”ê°€ ì œê³µí•˜ëŠ” êµ¬í˜„ì²´
      â†“
[ë°ì´í„°ë² ì´ìŠ¤ (MySQL, Oracle, PostgreSQL ë“±)]
```

| êµ¬ì„± ìš”ì†Œ | ì œê³µì | ì—­í•  |
|----------|-------|------|
| **JDBC API** | Java (Oracle) | ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ìœ„í•œ í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ |
| **JDBC Driver** | ê° DB ë²¤ë” (MySQL, Oracle ë“±) | JDBC APIì˜ ì‹¤ì œ êµ¬í˜„ì²´ |
| **ë°ì´í„°ë² ì´ìŠ¤** | DB ë²¤ë” | ì‹¤ì œ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ |

#### JDBC Driverì˜ ì—­í• 

**JDBC Driver**ëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ ê°„ì˜ **í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” ë¸Œë¦¬ì§€(ë‹¤ë¦¬)** ì—­í• ì„ í•©ë‹ˆë‹¤.

- MySQL JDBC Driver: `mysql-connector-j`
- PostgreSQL JDBC Driver: `postgresql`
- Oracle JDBC Driver: `ojdbc`

**ë¹„ìœ **:
```
JDBC API = USB ê·œê²© (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)
JDBC Driver = USB ì¼€ì´ë¸” (ì œì¡°ì‚¬ë³„ êµ¬í˜„)
ë°ì´í„°ë² ì´ìŠ¤ = USB ì¥ì¹˜
```

#### ì™œ JDBCê°€ í•„ìš”í•œê°€?

**ë¬¸ì œ ìƒí™©**:
- ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ í†µì‹  ë°©ì‹ì´ ë‹¤ë¦„
- MySQL, Oracle, PostgreSQL ë“± ê°ê° ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼

**JDBCì˜ í•´ê²°**:
- **í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ ì œê³µ**
- ê°œë°œìëŠ” JDBC APIë§Œ ì‚¬ìš©
- ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ ì‹œ Driverë§Œ êµì²´í•˜ë©´ ë¨

```java
// MySQLì´ë“  Oracleì´ë“  ì½”ë“œëŠ” ë™ì¼!
Connection conn = DriverManager.getConnection(url, user, password);
Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery("SELECT * FROM member");
```

---

### 3.1.2 ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸° ì„¤ì •

#### DBeaverë¥¼ í†µí•œ ë°ì´í„° ì´ˆê¸°í™”

**ì‹¤ìŠµ í™˜ê²½**:
- ë°ì´í„°ë² ì´ìŠ¤: MySQL 8.4
- ê´€ë¦¬ ë„êµ¬: DBeaver Community 25.2.2
- ë°ì´í„°ë² ì´ìŠ¤ëª…: `mydb`
- ì‚¬ìš©ì: `myuser` / ë¹„ë°€ë²ˆí˜¸: `mypass`

#### SQL ìŠ¤í¬ë¦½íŠ¸

```sql
-- ========================================
-- 1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
-- ========================================
-- mydbë¼ëŠ” ì´ë¦„ì˜ ë°ì´í„°ë² ì´ìŠ¤ ê³µê°„ì„ ìƒì„±í•©ë‹ˆë‹¤.
-- IF NOT EXISTS: ì´ë¯¸ ì¡´ì¬í•˜ë©´ ìƒëµ (ì—ëŸ¬ ë°©ì§€)
CREATE DATABASE IF NOT EXISTS mydb;

-- ========================================
-- 2. ì‚¬ìš©ì ìƒì„± ë° ì¸ì¦
-- ========================================
-- myuser ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.
-- @'%': ëª¨ë“  í˜¸ìŠ¤íŠ¸(IP)ì—ì„œ ì ‘ì† í—ˆìš©
-- IDENTIFIED BY 'mypass': ë¹„ë°€ë²ˆí˜¸ë¥¼ mypassë¡œ ì„¤ì •
CREATE USER IF NOT EXISTS 'myuser'@'%' IDENTIFIED BY 'mypass';

-- ========================================
-- 3. ê¶Œí•œ ë¶€ì—¬
-- ========================================
-- myuserê°€ mydb ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ê°ì²´(í…Œì´ë¸”, ë·° ë“±)ì— ëŒ€í•´
-- ëª¨ë“  ê¶Œí•œ(SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ë“±)ì„ ê°€ì§€ë„ë¡ ì„¤ì •
GRANT ALL ON mydb.* TO 'myuser'@'%';

-- ========================================
-- 4. ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
-- ========================================
USE mydb;

-- ========================================
-- 5. í…Œì´ë¸” ìƒì„±
-- ========================================
CREATE TABLE IF NOT EXISTS member(
    id INTEGER AUTO_INCREMENT PRIMARY KEY,  -- ìë™ ì¦ê°€ ê¸°ë³¸í‚¤
    name VARCHAR(128) NOT NULL,             -- ì´ë¦„ (í•„ìˆ˜)
    email VARCHAR(256) NOT NULL,            -- ì´ë©”ì¼ (í•„ìˆ˜)
    age INTEGER                             -- ë‚˜ì´ (ì„ íƒ)
);

-- ========================================
-- 6. ë°ì´í„° ì‚½ì…
-- ========================================
INSERT INTO member(name, email, age) VALUES ('ê¹€ìš°í˜„', 'kimwoo@spring.co.kr', 10);
INSERT INTO member(name, email, age) VALUES ('í™í˜œì°½', 'hyechang@spring.co.kr', 20);
INSERT INTO member(name, email, age) VALUES ('ìœ¤ì„œì¤€', 'Seojunyoon@spring.co.kr', 22);
INSERT INTO member(name, email, age) VALUES ('ê¹€ë¯¼ìˆ˜', 'minsusu@spring.co.kr', 30);

-- ========================================
-- 7. ë°ì´í„° ì¡°íšŒ (í™•ì¸)
-- ========================================
SELECT * FROM member;
```

#### SQL ëª…ë ¹ì–´ ì„¤ëª…

| ëª…ë ¹ì–´ | ì—­í•  | ì„¤ëª… |
|-------|------|------|
| `CREATE DATABASE` | ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± | ë°ì´í„°ë¥¼ ì €ì¥í•  ë…¼ë¦¬ì  ê³µê°„ ìƒì„± |
| `CREATE USER` | ì‚¬ìš©ì ê³„ì • ìƒì„± | ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ê³„ì • ìƒì„± |
| `GRANT` | ê¶Œí•œ ë¶€ì—¬ | íŠ¹ì • ì‚¬ìš©ìì—ê²Œ DB ì‘ì—… ê¶Œí•œ ë¶€ì—¬ |
| `USE` | ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ | ì‘ì—…í•  ë°ì´í„°ë² ì´ìŠ¤ ì§€ì • |
| `CREATE TABLE` | í…Œì´ë¸” ìƒì„± | ë°ì´í„°ë¥¼ ì €ì¥í•  í…Œì´ë¸” êµ¬ì¡° ì •ì˜ |
| `INSERT INTO` | ë°ì´í„° ì‚½ì… | í…Œì´ë¸”ì— ë ˆì½”ë“œ ì¶”ê°€ |
| `SELECT` | ë°ì´í„° ì¡°íšŒ | í…Œì´ë¸”ì˜ ë°ì´í„° ê²€ìƒ‰ |

#### ë°ì´í„° í™•ì¸

```
+----+----------+-------------------------+------+
| id | name     | email                   | age  |
+----+----------+-------------------------+------+
|  1 | ê¹€ìš°í˜„   | kimwoo@spring.co.kr     |   10 |
|  2 | í™í˜œì°½   | hyechang@spring.co.kr   |   20 |
|  3 | ìœ¤ì„œì¤€   | Seojunyoon@spring.co.kr |   22 |
|  4 | ê¹€ë¯¼ìˆ˜   | minsusu@spring.co.kr    |   30 |
+----+----------+-------------------------+------+
```

---

### 3.1.3 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€

**build.gradle**:
```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter'
    
    // MySQL JDBC Driver
    implementation 'com.mysql:mysql-connector-j:9.2.0'
    
    // Lombok (ì½”ë“œ ìë™ ìƒì„±)
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  |
|-------|------|
| `spring-boot-starter` | ìŠ¤í”„ë§ë¶€íŠ¸ ê¸°ë³¸ ê¸°ëŠ¥ |
| `mysql-connector-j:9.2.0` | **MySQL JDBC Driver** (í•µì‹¬!) |
| `lombok` | Getter, Setter ë“± ìë™ ìƒì„± |

> âš ï¸ **ì¤‘ìš”**: `mysql-connector-j`ë¥¼ ì¶”ê°€í•´ì•¼ MySQLê³¼ í†µì‹ í•  ìˆ˜ ìˆëŠ” JDBC Driverê°€ í”„ë¡œì íŠ¸ì— í¬í•¨ë©ë‹ˆë‹¤!

**JDBC Driver í¬í•¨ í™•ì¸**:
```
í”„ë¡œì íŠ¸ êµ¬ì¡°
â””â”€ External Libraries
   â””â”€ com.mysql:mysql-connector-j:9.2.0
      â””â”€ com.mysql.cj.jdbc.Driver â† JDBC Driver í´ë˜ìŠ¤
```

---

### 3.1.4 ì—”í‹°í‹° í´ë˜ìŠ¤ ì‘ì„±

**Member.java**:
```java
package kr.ac.hansung.cse.databasesample;

import lombok.*;

/**
 * Member ì—”í‹°í‹° í´ë˜ìŠ¤
 * - ë°ì´í„°ë² ì´ìŠ¤ì˜ member í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” Java ê°ì²´
 * - Lombokì„ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µ ì½”ë“œ ìµœì†Œí™”
 */
@AllArgsConstructor  // ëª¨ë“  í•„ë“œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ì ìë™ ìƒì„±
@ToString            // toString() ë©”ì„œë“œ ìë™ ìƒì„±
public class Member {
    private Long id;
    private String name;
    private String email;
    private Integer age;
}
```

#### Lombok ì• ë…¸í…Œì´ì…˜

| ì• ë…¸í…Œì´ì…˜ | ìƒì„± ì½”ë“œ |
|-----------|----------|
| `@AllArgsConstructor` | `public Member(Long id, String name, String email, Integer age) { ... }` |
| `@ToString` | `public String toString() { return "Member(id=1, name=ê¹€ìš°í˜„, ...)"; }` |

---

### 3.1.5 JDBCë¥¼ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™

#### ì „ì²´ ì½”ë“œ

**DatabaseSampleApplication.java**:
```java
package kr.ac.hansung.cse.databasesample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import java.sql.*;

@SpringBootApplication
public class DatabaseSampleApplication {

    public static void main(String[] args) throws ClassNotFoundException, SQLException {
        
        SpringApplication.run(DatabaseSampleApplication.class, args);

        // ========================================
        // 1. JDBC Driver ë¡œë”©
        // ========================================
        /*
         * Class.forName()ì˜ ì—­í• :
         * - JDBC Driver í´ë˜ìŠ¤ë¥¼ JVM ë©”ëª¨ë¦¬ì— ë¡œë“œ
         * - ë¡œë“œëœ DriverëŠ” DriverManagerì— ìë™ ë“±ë¡ë¨
         * - DriverManagerê°€ MySQL ì ‘ì† ë°©ë²•ì„ ì•Œê²Œ ë¨
         * 
         * "com.mysql.cj.jdbc.Driver":
         * - mysql-connector-j ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ëœ MySQL JDBC Driver í´ë˜ìŠ¤
         * - ì´ í´ë˜ìŠ¤ê°€ JDBC APIë¥¼ ì‹¤ì œë¡œ êµ¬í˜„í•¨
         * 
         * ì°¸ê³ : JDBC 4.0 ì´í›„ë¡œëŠ” ìë™ ë¡œë”©ë˜ì§€ë§Œ, ëª…ì‹œì  í‘œí˜„ì„ ìœ„í•´ ì‘ì„±
         */
        Class.forName("com.mysql.cj.jdbc.Driver");

        // ========================================
        // 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
        // ========================================
        /*
         * DriverManager.getConnection()ì˜ ì—­í• :
         * - ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°(Connection) ê°ì²´ ìƒì„±
         * 
         * ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ (JDBC URL):
         * "jdbc:mysql://localhost:3306/mydb"
         *  â”€â”€â”€â”€ â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€ â”€â”€â”€â”€
         *   â”‚     â”‚       â”‚       â”‚     â””â”€ ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„
         *   â”‚     â”‚       â”‚       â””â”€ í¬íŠ¸ ë²ˆí˜¸ (MySQL ê¸°ë³¸: 3306)
         *   â”‚     â”‚       â””â”€ ì„œë²„ ì£¼ì†Œ (localhost = ë‚´ ì»´í“¨í„°)
         *   â”‚     â””â”€ ë°ì´í„°ë² ì´ìŠ¤ ì¢…ë¥˜ (MySQL)
         *   â””â”€ JDBC í”„ë¡œí† ì½œ
         * 
         * ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜: ì‚¬ìš©ì ì´ë¦„ (myuser)
         * ì„¸ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜: ë¹„ë°€ë²ˆí˜¸ (mypass)
         */
        Connection connection = DriverManager.getConnection(
            "jdbc:mysql://localhost:3306/mydb",
            "myuser",
            "mypass"
        );

        // ========================================
        // 3. SQL ì¿¼ë¦¬ ì¤€ë¹„
        // ========================================
        /*
         * PreparedStatementì˜ ì—­í• :
         * - SQL ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë¯¸ë¦¬ ì „ì†¡
         * - ì‹¤í–‰ ê°€ëŠ¥í•œ ìƒíƒœë¡œ ì¤€ë¹„ (ì»´íŒŒì¼)
         * - SQL Injection ë°©ì§€ (ë§¤ê°œë³€ìˆ˜ ë°”ì¸ë”© ì‹œ)
         * 
         * "select * from member":
         * - member í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼(*), ëª¨ë“  í–‰ ì¡°íšŒ
         */
        PreparedStatement preparedStatement = connection.prepareStatement(
            "select * from member"
        );

        // ========================================
        // 4. ì¿¼ë¦¬ ì‹¤í–‰
        // ========================================
        /*
         * executeQuery()ì˜ ì—­í• :
         * - SELECT ì¿¼ë¦¬ ì‹¤í–‰ (ë°ì´í„° ì¡°íšŒ)
         * - ê²°ê³¼ë¥¼ ResultSet ê°ì²´ë¡œ ë°˜í™˜
         * 
         * ResultSet:
         * - ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´
         * - ì»¤ì„œ(cursor)ë¥¼ ì‚¬ìš©í•˜ì—¬ í•œ í–‰ì”© ì ‘ê·¼
         */
        ResultSet resultSet = preparedStatement.executeQuery();

        // ========================================
        // 5. ê²°ê³¼ ì²˜ë¦¬
        // ========================================
        /*
         * while (resultSet.next()):
         * - ë‹¤ìŒ í–‰ìœ¼ë¡œ ì»¤ì„œ ì´ë™
         * - ë” ì´ìƒ í–‰ì´ ì—†ìœ¼ë©´ false ë°˜í™˜ (ë°˜ë³µ ì¢…ë£Œ)
         * 
         * resultSet.getLong("id"):
         * - í˜„ì¬ í–‰ì˜ "id" ì»¬ëŸ¼ ê°’ì„ Long íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜´
         * 
         * resultSet.getString("name"):
         * - í˜„ì¬ í–‰ì˜ "name" ì»¬ëŸ¼ ê°’ì„ String íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜´
         * 
         * resultSet.getInt("age"):
         * - í˜„ì¬ í–‰ì˜ "age" ì»¬ëŸ¼ ê°’ì„ Integer íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜´
         */
        while (resultSet.next()) {
            Member member = new Member(
                resultSet.getLong("id"),
                resultSet.getString("name"),
                resultSet.getString("email"),
                resultSet.getInt("age")
            );
            System.out.println(member);
        }

        // ========================================
        // 6. ì—°ê²° ì¢…ë£Œ
        // ========================================
        /*
         * connection.close()ì˜ ì—­í• :
         * - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í•´ì œ
         * - ë¦¬ì†ŒìŠ¤(ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬) ë°˜í™˜
         * - ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼ í•¨ (ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ë°©ì§€)
         * 
         * ê¶Œì¥: try-with-resources ì‚¬ìš©
         */
        connection.close();
    }
}
```

#### ì‹¤í–‰ ê²°ê³¼

```
Member(id=1, name=ê¹€ìš°í˜„, email=kimwoo@spring.co.kr, age=10)
Member(id=2, name=í™í˜œì°½, email=hyechang@spring.co.kr, age=20)
Member(id=3, name=ìœ¤ì„œì¤€, email=Seojunyoon@spring.co.kr, age=22)
Member(id=4, name=ê¹€ë¯¼ìˆ˜, email=minsusu@spring.co.kr, age=30)
```

---

### 3.1.6 JDBC ë™ì‘ ê³¼ì • ìƒì„¸ ë¶„ì„

#### 1ë‹¨ê³„: Driver ë¡œë”©

```java
Class.forName("com.mysql.cj.jdbc.Driver");
```

**ë‚´ë¶€ ë™ì‘**:
```
1. JVMì´ "com.mysql.cj.jdbc.Driver" í´ë˜ìŠ¤ íŒŒì¼ ë¡œë“œ
2. Driver í´ë˜ìŠ¤ì˜ static ì´ˆê¸°í™” ë¸”ë¡ ì‹¤í–‰
3. Driver ê°ì²´ê°€ DriverManagerì— ìë™ ë“±ë¡
4. DriverManager: "MySQLê³¼ í†µì‹ í•˜ëŠ” ë°©ë²•ì„ ì•Œê²Œ ë˜ì—ˆë‹¤!"
```


#### 2ë‹¨ê³„: Connection ìƒì„±

```java
Connection connection = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/mydb",
    "myuser",
    "mypass"
);
```

**ë‚´ë¶€ ë™ì‘**:
```
1. DriverManagerê°€ ë“±ë¡ëœ Driverë“¤ì„ ìˆœíšŒ
2. URLì´ "jdbc:mysql"ë¡œ ì‹œì‘ â†’ MySQL Driver ì„ íƒ
3. MySQL Driverê°€ ì‹¤ì œ ì—°ê²° ì‹œë„
   - TCP ì†Œì¼“ ì—°ê²° (localhost:3306)
   - ì¸ì¦ í™•ì¸ (myuser/mypass)
   - mydb ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
4. Connection ê°ì²´ ë°˜í™˜
```

**Connection ê°ì²´ì˜ ì—­í• **:
- ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ **ì„¸ì…˜(Session)** ì„ ë‚˜íƒ€ëƒ„
- ì´ ì—°ê²°ì„ í†µí•´ SQLì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ë°›ìŒ

#### 3ë‹¨ê³„: Statement ìƒì„± ë° ì‹¤í–‰

```java
PreparedStatement preparedStatement = connection.prepareStatement(
    "select * from member"
);
ResultSet resultSet = preparedStatement.executeQuery();
```

**ë‚´ë¶€ ë™ì‘**:
```
1. SQL ë¬¸ìì—´ì„ MySQL ì„œë²„ë¡œ ì „ì†¡
2. MySQLì´ SQLì„ íŒŒì‹±(ë¶„ì„)í•˜ê³  ì‹¤í–‰ ê³„íš ìˆ˜ë¦½
3. ì¿¼ë¦¬ ì‹¤í–‰
4. ê²°ê³¼ë¥¼ ResultSetìœ¼ë¡œ ë°˜í™˜
   (ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ Java ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì „ì†¡)
```

#### 4ë‹¨ê³„: ê²°ê³¼ ì²˜ë¦¬

```java
while (resultSet.next()) {
    // ë°ì´í„° ì½ê¸°
}
```

**ResultSetì˜ êµ¬ì¡°**:
```
ì»¤ì„œ ìœ„ì¹˜ (ì²˜ìŒì—ëŠ” ì²« í–‰ ì´ì „)
    â†“
[Before First] â† resultSet.next() í˜¸ì¶œ ì „
[Row 1] id=1, name=ê¹€ìš°í˜„, ...  â† resultSet.next() â†’ true
[Row 2] id=2, name=í™í˜œì°½, ...  â† resultSet.next() â†’ true
[Row 3] id=3, name=ìœ¤ì„œì¤€, ...  â† resultSet.next() â†’ true
[Row 4] id=4, name=ê¹€ë¯¼ìˆ˜, ...  â† resultSet.next() â†’ true
[After Last] â† resultSet.next() â†’ false (ë°˜ë³µ ì¢…ë£Œ)
```

---

### 3.1.7 JDBCì˜ ë¬¸ì œì 

#### ë¬¸ì œ 1: ë°˜ë³µì ì¸ ì½”ë“œ

```java
// ë§¤ë²ˆ ì‘ì„±í•´ì•¼ í•˜ëŠ” ì½”ë“œ
Connection conn = DriverManager.getConnection(...);
PreparedStatement stmt = conn.prepareStatement(...);
ResultSet rs = stmt.executeQuery();
while (rs.next()) {
    // ë§¤í•‘ ì½”ë“œ
}
conn.close();
```

#### ë¬¸ì œ 2: ìˆ˜ë™ ë§¤í•‘

```java
// ì»¬ëŸ¼ê³¼ ê°ì²´ í•„ë“œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë§¤í•‘
Member member = new Member(
    rs.getLong("id"),
    rs.getString("name"),
    rs.getString("email"),
    rs.getInt("age")
);
```

#### ë¬¸ì œ 3: ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

```java
// close()ë¥¼ ê¹œë¹¡í•˜ë©´ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜!
connection.close();  // ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼ í•¨
```

#### ë¬¸ì œ 4: ì˜ˆì™¸ ì²˜ë¦¬

```java
// ì²´í¬ ì˜ˆì™¸(Checked Exception) ì²˜ë¦¬ í•„ìš”
throws ClassNotFoundException, SQLException
```

**ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ë“±ì¥í•œ ê²ƒì´:**
- Spring Data JDBC (3.2)
- MyBatis (3.3)
- JPA (3.4)

---


## 3.2 Spring Data JDBC

### 3.2.1 Spring Data JDBCë€?

**Spring Data JDBC**ëŠ” JDBCì˜ ë°˜ë³µì ì¸ ì½”ë“œë¥¼ ì œê±°í•˜ê³ , ê°œë°œìê°€ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ë§Œ ì§‘ì¤‘**í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì¶”ìƒí™” ë ˆì´ì–´ì…ë‹ˆë‹¤.

#### JDBCì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ëŠ” ë°©ë²•

| ë¬¸ì œì  | JDBC | Spring Data JDBC |
|-------|------|-----------------|
| Driver ë¡œë”© | `Class.forName()` í•„ìš” | ìë™ ì²˜ë¦¬ |
| Connection ê´€ë¦¬ | ë§¤ë²ˆ ìƒì„±/ì¢…ë£Œ | **ì»¤ë„¥ì…˜ í’€** ìë™ ê´€ë¦¬ |
| SQL ì‘ì„± | ì§ì ‘ ì‘ì„± | ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìë™ ìƒì„± |
| ê²°ê³¼ ë§¤í•‘ | `ResultSet` ìˆ˜ë™ ë§¤í•‘ | ê°ì²´ ìë™ ë§¤í•‘ |
| ì˜ˆì™¸ ì²˜ë¦¬ | Checked Exception | Runtime Exception |
| ë¦¬ì†ŒìŠ¤ ì •ë¦¬ | ìˆ˜ë™ `close()` | ìë™ ì •ë¦¬ |

> âš ï¸ **ì¤‘ìš”**: Spring Data JDBCëŠ” JDBC Driverë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤! MySQL Connector ê°™ì€ JDBC Driverë¥¼ **ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©**í•˜ë„ë¡ ê°ì‹¸ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

#### Spring Data JDBCì˜ í•µì‹¬ ê°œë…

```
[ê°œë°œì]
    â†“ (Repository ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜)
[Spring Data JDBC]
    â†“ (ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ìë™ ìƒì„±)
[JDBC Driver (mysql-connector-j)]
    â†“
[MySQL ë°ì´í„°ë² ì´ìŠ¤]
```

**ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ(Boilerplate Code)**: ë°˜ë³µì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•˜ëŠ” ì§€ë£¨í•œ ì½”ë“œ

---

### 3.2.2 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€

**build.gradle**:
```gradle
dependencies {
    // Spring Data JDBC (í•µì‹¬!)
    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
    
    // MySQL JDBC Driver (ì—¬ì „íˆ í•„ìš”!)
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  | í•„ìˆ˜ ì—¬ë¶€ |
|-------|------|----------|
| `spring-boot-starter-data-jdbc` | Spring Data JDBC ê¸°ëŠ¥ ì œê³µ | âœ… í•„ìˆ˜ |
| `mysql-connector-j` | MySQLê³¼ í†µì‹ í•˜ëŠ” JDBC Driver | âœ… í•„ìˆ˜ |
| `lombok` | ì½”ë“œ ê°„ì†Œí™” | ê¶Œì¥ |

> **í•µì‹¬**: `spring-boot-starter-data-jdbc`ëŠ” JDBCë¥¼ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, JDBCë¥¼ ë” ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤!

---

### 3.2.3 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •

#### application.properties

**src/main/resources/application.properties**:
```properties
spring.application.name=springdatajbc

# ========================================
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì • (DataSource)
# ========================================
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass

# ========================================
# JDBC ë¡œê·¸ ë ˆë²¨ ì„¤ì • (ë””ë²„ê¹…ìš©)
# ========================================
logging.level.org.springframework.jdbc=DEBUG
```

#### ì„¤ì • í•­ëª© ì„¤ëª…

| ì†ì„± | ì„¤ëª… | ì˜ˆì‹œ ê°’ |
|-----|------|---------|
| `spring.datasource.url` | ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° URL | `jdbc:mysql://localhost:3306/mydb` |
| `spring.datasource.username` | ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì´ë¦„ | `myuser` |
| `spring.datasource.password` | ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ | `mypass` |
| `logging.level.org.springframework.jdbc` | JDBC ì‹¤í–‰ ë¡œê·¸ ë ˆë²¨ | `DEBUG` (SQL ì¿¼ë¦¬ í™•ì¸ìš©) |

#### JDBC vs Spring Data JDBC ì„¤ì • ë¹„êµ

**JDBC (ì´ì „)**:
```java
// ë§¤ë²ˆ ì½”ë“œë¡œ ì‘ì„±
Class.forName("com.mysql.cj.jdbc.Driver");
Connection conn = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/mydb",
    "myuser",
    "mypass"
);
```

**Spring Data JDBC (í˜„ì¬)**:
```properties
# ì„¤ì • íŒŒì¼ì— í•œ ë²ˆë§Œ ì‘ì„±
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass
```

> **ì¥ì **: ì„¤ì • íŒŒì¼ë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì½”ë“œì— ìë™ ì ìš©! í™˜ê²½ë³„(ê°œë°œ/ìš´ì˜) ì„¤ì • íŒŒì¼ ë¶„ë¦¬ ê°€ëŠ¥!

---

### 3.2.4 ì—”í‹°í‹° í´ë˜ìŠ¤ ì‘ì„±

#### Member ì—”í‹°í‹°

**Member.java**:
```java
package com.example.springdatajbc;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.annotation.Id;
import org.springframework.data.relational.core.mapping.Table;

@Table
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Member {
    
    @Id
    private Long id;
    private String name;
    private String email;
    private Integer age;
}
```

#### ì• ë…¸í…Œì´ì…˜ ì„¤ëª…

##### @Table

**ì—­í• **: ì´ í´ë˜ìŠ¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘ë¨ì„ ì„ ì–¸

**ìë™ ë§¤í•‘ ê·œì¹™**:
- í´ë˜ìŠ¤ ì´ë¦„ â†’ í…Œì´ë¸” ì´ë¦„ (ì¹´ë©œ ì¼€ì´ìŠ¤ â†’ ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤)
- `Member` í´ë˜ìŠ¤ â†’ `member` í…Œì´ë¸”
- `HyechangMember` í´ë˜ìŠ¤ â†’ `hyechang_member` í…Œì´ë¸”

**ëª…ì‹œì  ì§€ì •**:
```java
@Table("custom_table_name")  // í…Œì´ë¸” ì´ë¦„ì´ ê·œì¹™ê³¼ ë‹¤ë¥¼ ë•Œ
public class Member { ... }
```

**í…Œì´ë¸” ë§¤í•‘ ê³¼ì •**:
```
[Java í´ë˜ìŠ¤]           [ë°ì´í„°ë² ì´ìŠ¤]
Member í´ë˜ìŠ¤     â†’     member í…Œì´ë¸”
â”œâ”€ id (Long)      â†’     id (BIGINT)
â”œâ”€ name (String)  â†’     name (VARCHAR)
â”œâ”€ email (String) â†’     email (VARCHAR)
â””â”€ age (Integer)  â†’     age (INT)
```

##### @Id

**ì—­í• **: Primary Key(ê¸°ë³¸ í‚¤) í•„ë“œ ì§€ì •

```java
@Id
private Long id;
```

- Spring Data JDBCê°€ ì´ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë ˆì½”ë“œ ì‹ë³„
- `save()` ì‹œ `id`ê°€ `null`ì´ë©´ INSERT, ê°’ì´ ìˆìœ¼ë©´ UPDATE
- ìë™ ìƒì„±(AUTO_INCREMENT)ëœ ê°’ì„ ìë™ìœ¼ë¡œ ë°›ì•„ì˜´

##### @Column (ì„ íƒ ì‚¬í•­)

**ì—­í• **: í•„ë“œëª…ê³¼ ì»¬ëŸ¼ëª…ì´ ë‹¤ë¥¼ ë•Œ ë§¤í•‘

```java
@Column("user_name")
private String name;  // name í•„ë“œ â†’ user_name ì»¬ëŸ¼
```

**ê¸°ë³¸ ë§¤í•‘ ê·œì¹™**:
- í•„ë“œëª…ê³¼ ì»¬ëŸ¼ëª…ì´ ê°™ìœ¼ë©´ ìƒëµ ê°€ëŠ¥
- ì¹´ë©œ ì¼€ì´ìŠ¤ â†’ ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ ìë™ ë³€í™˜
- `userName` â†’ `user_name`

##### Lombok ì• ë…¸í…Œì´ì…˜

| ì• ë…¸í…Œì´ì…˜ | ìƒì„± ì½”ë“œ |
|-----------|----------|
| `@Data` | `@Getter` + `@Setter` + `@ToString` + `@EqualsAndHashCode` + `@RequiredArgsConstructor` |
| `@Builder` | ë¹Œë” íŒ¨í„´ ì½”ë“œ ìƒì„± |
| `@AllArgsConstructor` | ëª¨ë“  í•„ë“œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ì |
| `@NoArgsConstructor` | ê¸°ë³¸ ìƒì„±ì (ë§¤ê°œë³€ìˆ˜ ì—†ìŒ) |

---

### 3.2.5 Repository ì¸í„°í˜ì´ìŠ¤ ì‘ì„±

#### MemberRepository ì¸í„°í˜ì´ìŠ¤

**MemberRepository.java**:
```java
package com.example.springdatajbc;

import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface MemberRepository extends CrudRepository<Member, Long> {
    
    // ë©”ì„œë“œ ì´ë¦„ ê¸°ë°˜ ì¿¼ë¦¬ (ìë™ ìƒì„±)
    List<Member> findByName(String name);
    List<Member> findByEmail(String email);
    List<Member> findByNameContaining(String name);
    
    // ì¡°ê±´ ê²°í•©
    List<Member> findByEmailAndName(String email, String name);
    List<Member> findByEmailOrName(String email, String name);
    
    // ë¹„êµ ì—°ì‚°
    List<Member> findByAgeGreaterThan(int age);
    List<Member> findByAgeLessThan(int age);
    List<Member> findByAgeBetween(int min, int max);
    
    // ì»¤ìŠ¤í…€ ì¿¼ë¦¬ (ì§ì ‘ ì‘ì„±)
    @Query("SELECT * FROM member WHERE name = :username AND age >= :max")
    List<Member> hyechangQuery(String username, int max);
}
```

---

### 3.2.6 Repository í•µì‹¬ ê°œë…

#### 1. @Repositoryì™€ ë¹ˆ ìƒì„±

**@Repositoryì˜ ì •ì²´**:
```java
@Repository
public interface MemberRepository extends CrudRepository<Member, Long> {
    // ì¸í„°í˜ì´ìŠ¤ì¸ë° ì–´ë–»ê²Œ ë¹ˆ ê°ì²´ê°€ ë˜ëŠ”ê°€?
}
```

**@Repository = @Componentì˜ íŠ¹ìˆ˜í•œ í˜•íƒœ**:

| ì• ë…¸í…Œì´ì…˜ | ì—­í•  | ê³„ì¸µ |
|-----------|------|------|
| `@Component` | ë²”ìš© ìŠ¤í”„ë§ ë¹ˆ | - |
| `@Repository` | ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ | Persistence Layer |
| `@Service` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ | Service Layer |
| `@Controller` | í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ | Presentation Layer |

> **í•µì‹¬**: ëª¨ë‘ `@Component`ì´ì§€ë§Œ, **ì—­í• ì„ ëª…í™•íˆ í•˜ê¸° ìœ„í•´** ì„¸ë¶„í™”ëœ ê²ƒì…ë‹ˆë‹¤!

#### 2. ì¸í„°í˜ì´ìŠ¤ê°€ ë¹ˆ ê°ì²´ê°€ ë˜ëŠ” ì›ë¦¬ (í”„ë¡ì‹œ íŒ¨í„´)

**ë¬¸ì œ**: ì¸í„°í˜ì´ìŠ¤ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ëŠ”ë°?

**í•´ê²°**: Springì´ **í”„ë¡ì‹œ ê°ì²´**ë¥¼ ìë™ ìƒì„±!

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ:

1. Springì´ @Repositoryë¥¼ ë°œê²¬
2. MemberRepository ì¸í„°í˜ì´ìŠ¤ ë¶„ì„
3. ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ëŸ°íƒ€ì„ì— ìë™ ìƒì„± (í”„ë¡ì‹œ)
4. í”„ë¡ì‹œ ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡
5. ë‹¤ë¥¸ ê³³ì—ì„œ ì£¼ì… ì‹œ í”„ë¡ì‹œ ê°ì²´ ì œê³µ
```

**í”„ë¡ì‹œ ê°ì²´ì˜ ì—­í• **:
```java
// Springì´ ëŸ°íƒ€ì„ì— ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ì½”ë“œ (ê°œë…ì  í‘œí˜„)
public class MemberRepositoryImpl implements MemberRepository {
    
    @Override
    public <S extends Member> S save(S entity) {
        // entity.getId()ê°€ nullì´ë©´ INSERT
        // entity.getId()ê°€ ìˆìœ¼ë©´ UPDATE
        // SQL ìë™ ìƒì„± ë° ì‹¤í–‰
    }
    
    @Override
    public Optional<Member> findById(Long id) {
        // SELECT * FROM member WHERE id = ? ì‹¤í–‰
        // ResultSet â†’ Member ê°ì²´ ìë™ ë§¤í•‘
    }
    
    // ê¸°íƒ€ ë©”ì„œë“œë“¤ë„ ìë™ êµ¬í˜„...
}
```

#### 3. CrudRepositoryì˜ ì œë„¤ë¦­

```java
public interface MemberRepository extends CrudRepository<Member, Long>
                                                        â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€
                                                        ì—”í‹°í‹°    PK íƒ€ì…
```

**ì œë„¤ë¦­ ì˜ë¯¸**:
- `<Member, Long>`: "Member ì—”í‹°í‹°ë¥¼ ë‹¤ë£¨ë©°, Primary KeyëŠ” Long íƒ€ì…"
- Springì´ ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ SQL ìë™ ìƒì„±

#### 4. CrudRepository ê¸°ë³¸ ë©”ì„œë“œ

**ìë™ìœ¼ë¡œ ì œê³µë˜ëŠ” ë©”ì„œë“œ**:

| ë©”ì„œë“œ | ì„¤ëª… | ìƒì„± SQL |
|-------|------|----------|
| `save(entity)` | ì €ì¥ ë˜ëŠ” ìˆ˜ì • | `INSERT` ë˜ëŠ” `UPDATE` |
| `findById(id)` | IDë¡œ ì¡°íšŒ | `SELECT * FROM member WHERE id = ?` |
| `findAll()` | ì „ì²´ ì¡°íšŒ | `SELECT * FROM member` |
| `existsById(id)` | ì¡´ì¬ ì—¬ë¶€ í™•ì¸ | `SELECT COUNT(*) FROM member WHERE id = ?` |
| `count()` | ì „ì²´ ê°œìˆ˜ | `SELECT COUNT(*) FROM member` |
| `deleteById(id)` | IDë¡œ ì‚­ì œ | `DELETE FROM member WHERE id = ?` |
| `delete(entity)` | ì—”í‹°í‹° ì‚­ì œ | `DELETE FROM member WHERE id = ?` |
| `deleteAll()` | ì „ì²´ ì‚­ì œ | `DELETE FROM member` |

**save()ì˜ ë™ì‘ ì›ë¦¬**:
```java
Member member = new Member();
member.setName("í™í˜œì°½");
memberRepository.save(member);  // idê°€ null â†’ INSERT

member.setAge(30);
memberRepository.save(member);  // idê°€ ìˆìŒ â†’ UPDATE
```

---

### 3.2.7 ì¿¼ë¦¬ ë©”ì„œë“œ (Query Method)

#### ë©”ì„œë“œ ì´ë¦„ ê¸°ë°˜ ì¿¼ë¦¬ ìƒì„±

Spring Data JDBCëŠ” **ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„**í•˜ì—¬ ìë™ìœ¼ë¡œ SQLì„ ìƒì„±í•©ë‹ˆë‹¤.

#### ê¸°ë³¸ êµ¬ì¡°

```
find...By... + ì¡°ê±´í•„ë“œ + ë¹„êµì—°ì‚°ì
 â”‚    â”‚        â”‚          â”‚
 â”‚    â”‚        â”‚          â””â”€ GreaterThan, LessThan ë“±
 â”‚    â”‚        â””â”€ Name, Email, Age ë“± (ì—”í‹°í‹° í•„ë“œëª…)
 â”‚    â””â”€ ì¡°ê±´ ì‹œì‘
 â””â”€ ì¡°íšŒ ì‘ì—… (find, get, read ëª¨ë‘ ë™ì¼)
```

#### ì£¼ìš” í‚¤ì›Œë“œ

##### 1. í•„ë“œ ì¼ì¹˜

```java
List<Member> findByName(String name);
// SQL: SELECT * FROM member WHERE name = ?

List<Member> findByEmail(String email);
// SQL: SELECT * FROM member WHERE email = ?
```

##### 2. ì¡°ê±´ ê²°í•© (AND, OR)

```java
// AND ì¡°ê±´ (ëª¨ë‘ ë§Œì¡±)
List<Member> findByEmailAndName(String email, String name);
// SQL: SELECT * FROM member WHERE email = ? AND name = ?

// OR ì¡°ê±´ (í•˜ë‚˜ë¼ë„ ë§Œì¡±)
List<Member> findByEmailOrName(String email, String name);
// SQL: SELECT * FROM member WHERE email = ? OR name = ?
```

##### 3. ë¬¸ìì—´ ê²€ìƒ‰

```java
// í¬í•¨ (LIKE '%...%')
List<Member> findByNameContaining(String name);
// SQL: SELECT * FROM member WHERE name LIKE %?%

// ì‹œì‘ (LIKE '...%')
List<Member> findByNameStartingWith(String name);
// SQL: SELECT * FROM member WHERE name LIKE ?%

// ë (LIKE '%...')
List<Member> findByNameEndingWith(String name);
// SQL: SELECT * FROM member WHERE name LIKE %?
```

##### 4. ë¹„êµ ì—°ì‚°

```java
// ë³´ë‹¤ í¼ (>)
List<Member> findByAgeGreaterThan(int age);
// SQL: SELECT * FROM member WHERE age > ?

// ë³´ë‹¤ ì‘ìŒ (<)
List<Member> findByAgeLessThan(int age);
// SQL: SELECT * FROM member WHERE age < ?

// ì´ìƒ (>=)
List<Member> findByAgeGreaterThanEqual(int age);
// SQL: SELECT * FROM member WHERE age >= ?

// ì´í•˜ (<=)
List<Member> findByAgeLessThanEqual(int age);
// SQL: SELECT * FROM member WHERE age <= ?

// ë²”ìœ„ (BETWEEN)
List<Member> findByAgeBetween(int min, int max);
// SQL: SELECT * FROM member WHERE age BETWEEN ? AND ?
```

##### 5. NULL ì²´í¬

```java
// NULLì¸ ê²½ìš°
List<Member> findByEmailIsNull();
// SQL: SELECT * FROM member WHERE email IS NULL

// NULLì´ ì•„ë‹Œ ê²½ìš°
List<Member> findByEmailIsNotNull();
// SQL: SELECT * FROM member WHERE email IS NOT NULL
```

##### 6. ì •ë ¬ (OrderBy)

```java
// ì˜¤ë¦„ì°¨ìˆœ
List<Member> findByNameOrderByAgeAsc(String name);
// SQL: SELECT * FROM member WHERE name = ? ORDER BY age ASC

// ë‚´ë¦¼ì°¨ìˆœ
List<Member> findByNameOrderByAgeDesc(String name);
// SQL: SELECT * FROM member WHERE name = ? ORDER BY age DESC
```

##### 7. ê°œìˆ˜ ì œí•œ

```java
// ì²« ë²ˆì§¸ ê²°ê³¼
Member findFirstByName(String name);
// SQL: SELECT * FROM member WHERE name = ? LIMIT 1

// ìƒìœ„ Nê°œ
List<Member> findTop3ByOrderByAgeDesc();
// SQL: SELECT * FROM member ORDER BY age DESC LIMIT 3
```

#### ì¿¼ë¦¬ ë©”ì„œë“œ í‚¤ì›Œë“œ ì •ë¦¬í‘œ

| í‚¤ì›Œë“œ | SQL | ì˜ˆì‹œ |
|-------|-----|------|
| `And` | `AND` | `findByNameAndEmail` |
| `Or` | `OR` | `findByNameOrEmail` |
| `Containing` | `LIKE %?%` | `findByNameContaining` |
| `StartingWith` | `LIKE ?%` | `findByNameStartingWith` |
| `EndingWith` | `LIKE %?` | `findByNameEndingWith` |
| `GreaterThan` | `>` | `findByAgeGreaterThan` |
| `LessThan` | `<` | `findByAgeLessThan` |
| `Between` | `BETWEEN` | `findByAgeBetween` |
| `IsNull` | `IS NULL` | `findByEmailIsNull` |
| `IsNotNull` | `IS NOT NULL` | `findByEmailIsNotNull` |
| `OrderBy...Asc` | `ORDER BY ... ASC` | `findByNameOrderByAgeAsc` |
| `OrderBy...Desc` | `ORDER BY ... DESC` | `findByNameOrderByAgeDesc` |
| `First` | `LIMIT 1` | `findFirstByName` |
| `Top3` | `LIMIT 3` | `findTop3ByOrderByAge` |

---

### 3.2.8 ì»¤ìŠ¤í…€ ì¿¼ë¦¬ (@Query)

#### @Query ì• ë…¸í…Œì´ì…˜

**ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ì§ì ‘ ì‘ì„±**:

```java
@Query("SELECT * FROM member WHERE name = :username AND age >= :max")
List<Member> hyechangQuery(String username, int max);
```

#### íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

**`:ë³€ìˆ˜ëª…` í˜•ì‹ìœ¼ë¡œ ë°”ì¸ë”©**:

```java
@Query("SELECT * FROM member WHERE name = :username AND age >= :max")
List<Member> hyechangQuery(String username, int max);
                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€
                                â”‚          â””â”€ :maxì™€ ë§¤í•‘
                                â””â”€ :usernameê³¼ ë§¤í•‘
```

#### @Query ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | ë©”ì„œë“œ ì´ë¦„ | @Query |
|-----|-----------|--------|
| ë‹¨ìˆœ ì¡°ê±´ | âœ… ê¶Œì¥ | âŒ ë¶ˆí•„ìš” |
| ë³µì¡í•œ JOIN | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìˆ˜ |
| ì§‘ê³„ í•¨ìˆ˜ (SUM, AVG) | âŒ ì œí•œì  | âœ… ê¶Œì¥ |
| ì„±ëŠ¥ ìµœì í™” í•„ìš” | âŒ ì œí•œì  | âœ… ê¶Œì¥ |

**ì˜ˆì‹œ**:
```java
// ì§‘ê³„ ì¿¼ë¦¬
@Query("SELECT AVG(age) FROM member")
Double getAverageAge();

// JOIN ì¿¼ë¦¬
@Query("SELECT m.* FROM member m JOIN orders o ON m.id = o.member_id WHERE o.status = :status")
List<Member> findMembersWithOrderStatus(String status);
```

---

### 3.2.9 ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì½”ë“œ

#### SpringJdbcApplication í´ë˜ìŠ¤

**SpringJdbcApplication.java**:
```java
package com.example.springdatajbc;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

import java.util.Iterator;
import java.util.List;
import java.util.Optional;

@Component
@Slf4j
@RequiredArgsConstructor
public class SpringJdbcApplication implements ApplicationRunner {

    private final MemberRepository memberRepository;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        // 1. ë°ì´í„° ìƒì„± (Builder íŒ¨í„´)
        Member member = Member.builder()
                              .name("hyechang")
                              .email("test@hyechang.ac.kr")
                              .age(25)
                              .build();
        
        // 2. ì €ì¥ (INSERT)
        memberRepository.save(member);

        // 3. ìˆ˜ì • (UPDATE)
        member.setAge(35);
        memberRepository.save(member);

        // 4. IDë¡œ ì¡°íšŒ
        Optional<Member> getm = memberRepository.findById(1L);
        if (getm.isPresent()) {
            log.info(getm.get().toString());
        }

        // 5. ì „ì²´ ì¡°íšŒ
        Iterable<Member> iterable = memberRepository.findAll();
        Iterator<Member> iterator = iterable.iterator();
        while (iterator.hasNext()) {
            log.info(iterator.next().toString());
        }

        // 6. ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ë©”ì„œë“œ
        List<Member> members = memberRepository.findByAgeGreaterThan(3);
        log.info("--- findByAgeGreaterThan(3) ê²°ê³¼ ì‹œì‘ (ì´ {}ê°œ) ---", members.size());
        for (Member m : members) {
            log.info(m.toString());
        }
        log.info("--- findByAgeGreaterThan(3) ê²°ê³¼ ì¢…ë£Œ ---");
    }
}
```

---

### 3.2.10 ì£¼ìš” ê°œë… ìƒì„¸ ë¶„ì„

#### 1. @RequiredArgsConstructor + final

**ì˜ì¡´ì„± ì£¼ì… ë°©ì‹**:

```java
@Component
@RequiredArgsConstructor
public class SpringJdbcApplication {
    
    private final MemberRepository memberRepository;
    // final = ë°˜ë“œì‹œ ì´ˆê¸°í™”ë˜ì–´ì•¼ í•¨
}
```

**ë‚´ë¶€ ë™ì‘**:
```java
// Lombokì´ ìë™ ìƒì„±í•˜ëŠ” ì½”ë“œ
public SpringJdbcApplication(MemberRepository memberRepository) {
    this.memberRepository = memberRepository;
}
```

**Springì˜ DI ê³¼ì •**:
```
1. @Component ìŠ¤ìº” â†’ SpringJdbcApplication í´ë˜ìŠ¤ ë°œê²¬
2. ìƒì„±ì ë°œê²¬ (MemberRepository í•„ìš”)
3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ MemberRepository ë¹ˆ ê²€ìƒ‰
4. ê²€ìƒ‰ëœ ë¹ˆ(í”„ë¡ì‹œ ê°ì²´)ì„ ìƒì„±ìì— ì£¼ì…
5. SpringJdbcApplication ë¹ˆ ìƒì„± ì™„ë£Œ
```

#### 2. ApplicationRunner ì¸í„°í˜ì´ìŠ¤

**ì—­í• **: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì§í›„ ìë™ ì‹¤í–‰

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ìˆœì„œ:

1. @SpringBootApplication ì‹¤í–‰
2. ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ë° ë¹ˆ ìƒì„±
3. ì˜ì¡´ì„± ì£¼ì…
4. ApplicationRunner êµ¬í˜„ì²´ì˜ run() ìë™ ì‹¤í–‰ â† ì—¬ê¸°!
5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ êµ¬ë™
```

**ì‚¬ìš© ëª©ì **:
- ì´ˆê¸° ë°ì´í„° ì‚½ì…
- ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‘ì—…
- í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±

#### 3. save()ì˜ ë™ì‘ ì›ë¦¬

```java
Member member = Member.builder().name("hyechang").age(25).build();
memberRepository.save(member);  // â‘  INSERT
// ì´ ì‹œì ì—ì„œ member.getId()ì— ìë™ ìƒì„±ëœ ID í• ë‹¹ë¨

member.setAge(35);
memberRepository.save(member);  // â‘¡ UPDATE
```

**ë‚´ë¶€ íŒë‹¨ ë¡œì§**:
```
save() í˜¸ì¶œ ì‹œ:

if (entity.getId() == null) {
    // INSERT
    INSERT INTO member (name, email, age) VALUES (?, ?, ?)
    // ìë™ ìƒì„±ëœ IDë¥¼ entity.setId()ë¡œ ì„¤ì •
} else {
    // UPDATE
    UPDATE member SET name=?, email=?, age=? WHERE id=?
}
```

#### 4. Optional ì²˜ë¦¬

```java
Optional<Member> getm = memberRepository.findById(1L);
if (getm.isPresent()) {
    log.info(getm.get().toString());
}
```

**Optionalì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ **:
- `null` ì²´í¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê°•ì œ
- `NullPointerException` ë°©ì§€

**ë” ë‚˜ì€ ë°©ì‹**:
```java
memberRepository.findById(1L)
                .ifPresent(member -> log.info(member.toString()));

// ë˜ëŠ”
Member member = memberRepository.findById(1L)
                                 .orElse(new Member());  // ì—†ìœ¼ë©´ ê¸°ë³¸ê°’

// ë˜ëŠ”
Member member = memberRepository.findById(1L)
                                 .orElseThrow(() -> new RuntimeException("íšŒì› ì—†ìŒ"));
```

---

### 3.2.11 ì»¤ë„¥ì…˜ í’€ (Connection Pool)

#### ì»¤ë„¥ì…˜ í’€ì´ë€?

**ë¬¸ì œ ìƒí™© (JDBC ì§ì ‘ ì‚¬ìš© ì‹œ)**:
```java
// ìš”ì²­ 1
Connection conn1 = DriverManager.getConnection(...);  // ì—°ê²° ìƒì„± (ëŠë¦¼!)
// ì¿¼ë¦¬ ì‹¤í–‰
conn1.close();  // ì—°ê²° ì¢…ë£Œ

// ìš”ì²­ 2
Connection conn2 = DriverManager.getConnection(...);  // ë˜ ì—°ê²° ìƒì„± (ëŠë¦¼!)
// ì¿¼ë¦¬ ì‹¤í–‰
conn2.close();  // ë˜ ì—°ê²° ì¢…ë£Œ
```

**ë¬¸ì œì **:
- ë§¤ë²ˆ DB ì—°ê²° ìƒì„±/ì¢…ë£Œ â†’ **ì‹œê°„ ì†Œìš”** (ë„¤íŠ¸ì›Œí¬ í†µì‹ , ì¸ì¦ ë“±)
- ë™ì‹œ ìš”ì²­ ë§ì„ ì‹œ â†’ **ì„±ëŠ¥ ì €í•˜**

**í•´ê²°ì±…: ì»¤ë„¥ì…˜ í’€**

```
[ì»¤ë„¥ì…˜ í’€]
â”œâ”€ Connection 1 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)
â”œâ”€ Connection 2 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)
â”œâ”€ Connection 3 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)
â””â”€ Connection 4 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)

ìš”ì²­ ì‹œ:
1. í’€ì—ì„œ ë¹Œë ¤ì˜´ (ë¹ ë¦„!)
2. ì¿¼ë¦¬ ì‹¤í–‰
3. í’€ì— ë°˜ë‚© (close()ê°€ ì•„ë‹˜!)
```

#### ì»¤ë„¥ì…˜ í’€ì˜ ë™ì‘ ì›ë¦¬

**1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ**:

```
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass
â†“
Spring Bootê°€ ì´ ì„¤ì •ì„ ì½ê³ 
â†“
HikariCP (ê¸°ë³¸ ì»¤ë„¥ì…˜ í’€) ì´ˆê¸°í™”
â†“
mydbì— Connection 10ê°œ ë¯¸ë¦¬ ìƒì„± (ê¸°ë³¸ê°’)
â†“
í’€ì— ì €ì¥í•˜ê³  ëŒ€ê¸°
```

**2. Repository ë©”ì„œë“œ í˜¸ì¶œ ì‹œ**:

```java
memberRepository.save(member);
â†“
Spring Data JDBCê°€ ë‚´ë¶€ì ìœ¼ë¡œ:
1. ì»¤ë„¥ì…˜ í’€ì—ì„œ Connection ë¹Œë ¤ì˜´ (ëŒ€ê¸° ì¤‘ì¸ ê²ƒ ì‚¬ìš©)
2. SQL ì‹¤í–‰: INSERT INTO member ...
3. Connectionì„ í’€ì— ë°˜ë‚© (close()ê°€ ì•„ë‹˜!)
```

**3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ**:

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œì‘
â†“
Springì´ ìë™ìœ¼ë¡œ ì»¤ë„¥ì…˜ í’€ ì¢…ë£Œ
â†“
í’€ì˜ ëª¨ë“  Connectionë“¤ì„ DBì— ë°˜í™˜
â†“
ì‹¤ì œ ì—°ê²° ì¢…ë£Œ
```

#### ì»¤ë„¥ì…˜ í’€ ì„¤ì •

**application.properties**:
```properties
# HikariCP ì»¤ë„¥ì…˜ í’€ ì„¤ì •
spring.datasource.hikari.maximum-pool-size=10      # ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜
spring.datasource.hikari.minimum-idle=5            # ìµœì†Œ ìœ ì§€ ì»¤ë„¥ì…˜ ìˆ˜
spring.datasource.hikari.connection-timeout=20000  # ì»¤ë„¥ì…˜ ëŒ€ê¸° ì‹œê°„ (ms)
spring.datasource.hikari.idle-timeout=300000       # ìœ íœ´ ì»¤ë„¥ì…˜ ìœ ì§€ ì‹œê°„ (ms)
```

| ì„¤ì • | ì„¤ëª… | ê¸°ë³¸ê°’ |
|-----|------|--------|
| `maximum-pool-size` | í’€ì´ ìœ ì§€í•  ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜ | 10 |
| `minimum-idle` | í•­ìƒ ìœ ì§€í•  ìµœì†Œ ì»¤ë„¥ì…˜ ìˆ˜ | `maximum-pool-size`ì™€ ë™ì¼ |
| `connection-timeout` | ì»¤ë„¥ì…˜ì„ ëª» ì–»ì„ ë•Œ ëŒ€ê¸° ì‹œê°„ | 30000ms (30ì´ˆ) |
| `idle-timeout` | ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì»¤ë„¥ì…˜ ì œê±° ì‹œê°„ | 600000ms (10ë¶„) |

#### ì»¤ë„¥ì…˜ í’€ ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ìƒí™©**

```
ì´ˆê¸° ìƒíƒœ: í’€ì— 10ê°œ ì»¤ë„¥ì…˜ ëŒ€ê¸° ì¤‘

ìš”ì²­ 1: save() í˜¸ì¶œ
  â”œâ”€ ì»¤ë„¥ì…˜ 1 ë¹Œë ¤ì˜´ (í’€: 9ê°œ ë‚¨ìŒ)
  â”œâ”€ INSERT ì‹¤í–‰
  â””â”€ ì»¤ë„¥ì…˜ 1 ë°˜ë‚© (í’€: 10ê°œ)

ìš”ì²­ 2: findAll() í˜¸ì¶œ
  â”œâ”€ ì»¤ë„¥ì…˜ 2 ë¹Œë ¤ì˜´ (í’€: 9ê°œ ë‚¨ìŒ)
  â”œâ”€ SELECT ì‹¤í–‰
  â””â”€ ì»¤ë„¥ì…˜ 2 ë°˜ë‚© (í’€: 10ê°œ)
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: ë™ì‹œ ìš”ì²­ ë§ì€ ê²½ìš°**

```
í’€: 10ê°œ ì»¤ë„¥ì…˜

ë™ì‹œì— 15ê°œ ìš”ì²­ ë°œìƒ
  â”œâ”€ 10ê°œ ìš”ì²­: ì¦‰ì‹œ ì»¤ë„¥ì…˜ í• ë‹¹ âœ…
  â””â”€ 5ê°œ ìš”ì²­: ëŒ€ê¸° â³
      â””â”€ connection-timeout(30ì´ˆ) ë‚´ì— ë°˜ë‚©ë˜ë©´ âœ…
      â””â”€ 30ì´ˆ ì´ˆê³¼ ì‹œ ì—ëŸ¬ ë°œìƒ âŒ
```

#### JDBC vs ì»¤ë„¥ì…˜ í’€ ë¹„êµ

| í•­ëª© | JDBC ì§ì ‘ ì‚¬ìš© | ì»¤ë„¥ì…˜ í’€ |
|-----|---------------|----------|
| ì—°ê²° ìƒì„± | ë§¤ë²ˆ ìƒì„± (ëŠë¦¼) | ë¯¸ë¦¬ ìƒì„± (ë¹ ë¦„) |
| ì—°ê²° ì¢…ë£Œ | ë§¤ë²ˆ ì¢…ë£Œ | í’€ì— ë°˜ë‚© (ì¬ì‚¬ìš©) |
| ì„±ëŠ¥ | ë‚˜ì¨ | ì¢‹ìŒ â­ |
| ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ | ìˆ˜ë™ | ìë™ â­ |
| ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ | ë¹„íš¨ìœ¨ì  | íš¨ìœ¨ì  â­ |

#### í•µì‹¬ ì •ë¦¬

**ì»¤ë„¥ì…˜ í’€ì˜ 3ê°€ì§€ í•µì‹¬**:

1. **ë¯¸ë¦¬ ìƒì„±**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ Connectionë“¤ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ 
2. **ì¬ì‚¬ìš©**: `close()`ê°€ ì‹¤ì œ ì¢…ë£Œê°€ ì•„ë‹ˆë¼ í’€ì— ë°˜ë‚© (ë‹¤ì‹œ ì‚¬ìš© ê°€ëŠ¥)
3. **ìë™ ê´€ë¦¬**: Springì´ ë¹Œë¦¬ê¸°/ë°˜ë‚© ëª¨ë‘ ìë™ ì²˜ë¦¬

**ê°œë°œìê°€ ì‹ ê²½ ì“¸ ê²ƒ**:
- âŒ Connection ìƒì„±/ì¢…ë£Œ: Springì´ ìë™ ì²˜ë¦¬
- âŒ ì»¤ë„¥ì…˜ í’€ ê´€ë¦¬: HikariCPê°€ ìë™ ì²˜ë¦¬
- âœ… ì ì ˆí•œ í’€ í¬ê¸° ì„¤ì •: íŠ¸ë˜í”½ì— ë§ê²Œ ì¡°ì •

**ì—°ê²° ëŒ€ìƒ**:
- í…Œì´ë¸”ì´ ì•„ë‹ˆë¼ **ë°ì´í„°ë² ì´ìŠ¤(`mydb`)** ì— ì—°ê²°
- í•˜ë‚˜ì˜ Connectionìœ¼ë¡œ ì—¬ëŸ¬ í…Œì´ë¸” ì‘ì—… ê°€ëŠ¥

---

### 3.2.12 ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜

**SpringdatajbcApplication.java**:
```java
package com.example.springdatajbc;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SpringdatajbcApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringdatajbcApplication.class, args);
    }
}
```

**ì‹¤í–‰ ìˆœì„œ**:
```
1. main() ë©”ì„œë“œ ì‹¤í–‰
2. @SpringBootApplication ì²˜ë¦¬
   â”œâ”€ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”
   â”œâ”€ ìë™ ì„¤ì •
   â””â”€ ë¹ˆ ìƒì„±
3. application.properties ì½ê¸°
   â””â”€ ì»¤ë„¥ì…˜ í’€ ì´ˆê¸°í™” (DB ì—°ê²° 10ê°œ ìƒì„±)
4. @Repository ì¸í„°í˜ì´ìŠ¤ ë°œê²¬
   â””â”€ í”„ë¡ì‹œ ê°ì²´ ìƒì„± ë° ë¹ˆ ë“±ë¡
5. @Component ë°œê²¬
   â””â”€ SpringJdbcApplication ë¹ˆ ìƒì„± ë° ì˜ì¡´ì„± ì£¼ì…
6. ApplicationRunner êµ¬í˜„ì²´ ì‹¤í–‰
   â””â”€ run() ë©”ì„œë“œ í˜¸ì¶œ
7. ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ ì™„ë£Œ
```

---



### 3.2.13 JDBC vs Spring Data JDBC ìµœì¢… ë¹„êµ

#### ì½”ë“œ ë¹„êµ

**JDBC (3.1)**:
```java
// 1. Driver ë¡œë”©
Class.forName("com.mysql.cj.jdbc.Driver");

// 2. Connection ìƒì„±
Connection conn = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/mydb", "myuser", "mypass"
);

// 3. Statement ìƒì„±
PreparedStatement stmt = conn.prepareStatement("SELECT * FROM member");

// 4. ì¿¼ë¦¬ ì‹¤í–‰
ResultSet rs = stmt.executeQuery();

// 5. ê²°ê³¼ ë§¤í•‘
while (rs.next()) {
    Member member = new Member(
        rs.getLong("id"),
        rs.getString("name"),
        rs.getString("email"),
        rs.getInt("age")
    );
    System.out.println(member);
}

// 6. ë¦¬ì†ŒìŠ¤ ì •ë¦¬
conn.close();
```

**Spring Data JDBC (3.2)**:
```java
// ì„¤ì • íŒŒì¼ (í•œ ë²ˆë§Œ)
// spring.datasource.url=jdbc:mysql://localhost:3306/mydb

// Repository ì¸í„°í˜ì´ìŠ¤ (ì„ ì–¸ë§Œ)
public interface MemberRepository extends CrudRepository<Member, Long> {
    List<Member> findByAgeGreaterThan(int age);
}

// ì‚¬ìš©
List<Member> members = memberRepository.findAll();
members.forEach(System.out::println);
```

**ì½”ë“œ ë¼ì¸ ìˆ˜**: 25ì¤„ â†’ 3ì¤„ (ì•½ 88% ê°ì†Œ!)

#### ì¥ë‹¨ì  ë¹„êµ

| íŠ¹ì§• | JDBC | Spring Data JDBC |
|-----|------|-----------------|
| **ì½”ë“œ ì–‘** | ë§ìŒ âŒ | ì ìŒ âœ… |
| **ë°˜ë³µ ì½”ë“œ** | ë§ìŒ âŒ | ì—†ìŒ âœ… |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ âœ… | ì¤‘ê°„ |
| **ìœ ì—°ì„±** | ë†’ìŒ âœ… | ì¤‘ê°„ |
| **ì„±ëŠ¥ ìµœì í™”** | ì‰¬ì›€ âœ… | ì œí•œì  |
| **ìƒì‚°ì„±** | ë‚®ìŒ âŒ | ë†’ìŒ âœ… |
| **ì»¤ë„¥ì…˜ ê´€ë¦¬** | ìˆ˜ë™ âŒ | ìë™ âœ… |
| **SQL ê°€ì‹œì„±** | ëª…í™• âœ… | ìˆ¨ê²¨ì§ (ë¡œê·¸ë¡œ í™•ì¸) |

---

### 3.2.14 Spring Data JDBCì˜ í•œê³„

#### í•œê³„ 1: ë³µì¡í•œ ì—°ê´€ê´€ê³„

**ë¬¸ì œ**:
```java
// Member - Order ê´€ê³„ (1:N)
// Spring Data JDBCì—ì„œëŠ” ë³µì¡í•¨
@Table
public class Member {
    @Id
    private Long id;
    private String name;
    
    // @ManyToOne ê°™ì€ ì• ë…¸í…Œì´ì…˜ì´ ì œí•œì 
}
```
í…Œì´ë¸”ê³¼ì˜ ì—°ê´€ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.

**í•´ê²°**: JPA ì‚¬ìš© (3.4ì—ì„œ í•™ìŠµ) @Entity ì™€ @ManyToOne , @ManyToMany ë“±ë“± ì‚¬ìš©ì´ ê°€ëŠ¥

#### í•œê³„ 2: DDL ìë™ ìƒì„±
DDL ìë™ ìƒì„± ë¯¸ì§€ì›
Spring Data JDBCëŠ” JPAì˜ í•µì‹¬ í¸ì˜ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì¸ DDL(Data Definition Language) ìë™ ìƒì„± ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ


| ëª…ë ¹ì–´ | ì—­í•  | 
|-----|------|
| **CREATE TABLE** |í…Œì´ë¸” ìƒì„± |
| **ALTER TABLE** | í…Œì´ë¸” ìˆ˜ì •|
| **DROP TABLE** | í…Œì´ë¸” ì‚­ì œ |
| **TRUNCATE TABLE** | í…Œì´ë¸” ë°ì´í„° ì‚­ì œ |


ğŸ“Œ ë¬¸ì œ ìƒí™© (ìˆ˜ë™ ì‘ì—… í•„ìš”)
ìë°” ì—”í‹°í‹°ì— ìƒˆë¡œìš´ í•„ë“œë¥¼ ì¶”ê°€í•˜ë”ë¼ë„, ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì—ëŠ” ìˆ˜ë™ìœ¼ë¡œ SQLì„ ì‘ì„±í•˜ì—¬ ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

```java


// Java ì—”í‹°í‹°ì— í•„ë“œ ì¶”ê°€
@Table
public class Member {
    @Id
    private Long id;
    private String name;
    // ...
    private String phone;  // ğŸ‘ˆ ìƒˆë¡œ ì¶”ê°€!
}

```
SQL

- âŒ Spring Data JDBCëŠ” ì´ ë¶€ë¶„ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ!
- í…Œì´ë¸”ì— ì»¬ëŸ¼ì„ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•´ì•¼ í•¨!
ALTER TABLE member ADD COLUMN phone VARCHAR(255);
ê²°ê³¼: ì—”í‹°í‹° ìˆ˜ì • ì‹œ SQLì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ë¯€ë¡œ í…Œì´ë¸”ê³¼ ì—”í‹°í‹° ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ê³  ê°œë°œ ì†ë„ê°€ ì €í•˜!

**í•´ê²°**: JPA ì‚¬ìš© (3.4ì—ì„œ í•™ìŠµ) : JPAëŠ” ì„¤ì • íŒŒì¼ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì—”í‹°í‹°ë¥¼ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ DDLì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
```
application.properties
spring.jpa.hibernate.ddl-auto=update
```


## 3.3 MyBatis

### 3.3.1 MyBatisë€?

**MyBatis**ëŠ” SQL ì¤‘ì‹¬ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ í”„ë ˆì„ì›Œí¬ë¡œ, **ê°œë°œìê°€ ì‘ì„±í•œ SQLê³¼ Java ê°ì²´ë¥¼ ë§¤í•‘**í•˜ëŠ” ë° íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

#### í•µì‹¬ ê°œë…

```
[ê°œë°œì]
    â†“ (SQL ì§ì ‘ ì‘ì„±)
[MyBatis]
    â†“ (JDBC ì½”ë“œ ìë™ ìƒì„± ë° ê²°ê³¼ ë§¤í•‘)
[JDBC Driver]
    â†“
[ë°ì´í„°ë² ì´ìŠ¤]
```

**MyBatisì˜ ì—­í• **:
- ê°œë°œì: SQLë§Œ ì‘ì„±
- MyBatis: Connection, PreparedStatement, ResultSet ë“± **JDBC ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ìë™ ì²˜ë¦¬**
- ê²°ê³¼ë¥¼ Java ê°ì²´ë¡œ ìë™ ë§¤í•‘

---

### 3.3.2 Spring Data JDBC vs MyBatis

#### ê·¼ë³¸ì ì¸ ì°¨ì´

| íŠ¹ì§• | Spring Data JDBC | MyBatis |
|-----|-----------------|---------|
| **ì² í•™** | ë„ë©”ì¸(ê°ì²´) ì¤‘ì‹¬ | **SQL ì¤‘ì‹¬** â­ |
| **SQL ì‘ì„±** | ë©”ì„œë“œ ì´ë¦„ ìë™ ìƒì„± + @Query | **í•­ìƒ ì§ì ‘ ì‘ì„±** (XML ë˜ëŠ” ì• ë…¸í…Œì´ì…˜) |
| **SQL ìœ„ì¹˜** | ì¸ë¼ì¸(@Query ë‚´ë¶€) | **ë³„ë„ XML íŒŒì¼** (ë¶„ë¦¬) |
| **ë™ì  SQL** | ì œí•œì  | **ê°•ë ¥í•œ ì§€ì›** â­ |
| **ë³µì¡í•œ ì¿¼ë¦¬** | ì–´ë ¤ì›€ | **ë§¤ìš° ìœ ë¦¬** â­ |
| **ì„±ëŠ¥ ìµœì í™”** | ì œí•œì  | **ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥** â­ |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ | ì¤‘ê°„ |
| **ì½”ë“œ ì–‘** | ì ìŒ | ì¤‘ê°„ (XML ì‘ì„±) |

#### ì™œ MyBatisë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

**Spring Data JDBC + @Queryì˜ í•œê³„**:

```java
// Spring Data JDBC
@Query("SELECT * FROM member WHERE " +
       "(:name IS NULL OR name LIKE %:name%) AND " +
       "(:minAge IS NULL OR age >= :minAge) AND " +
       "(:maxAge IS NULL OR age <= :maxAge)")
List<Member> search(@Param("name") String name, 
                    @Param("minAge") Integer minAge,
                    @Param("maxAge") Integer maxAge);
```

**ë¬¸ì œì **:
- âŒ SQLì´ Java ë¬¸ìì—´ ì•ˆì— ìˆì–´ ê°€ë…ì„± ì €í•˜
- âŒ ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ ì‘ì„± ì–´ë ¤ì›€
- âŒ SQL ë¬¸ë²• ê²€ì¦ ë¶ˆê°€ (ì»´íŒŒì¼ ì‹œì )
- âŒ SQLì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

**MyBatisì˜ í•´ê²°**:

```xml
<!-- XML íŒŒì¼ì— SQL ë¶„ë¦¬ -->
<select id="search" resultType="Member">
    SELECT * FROM member
    <where>
        <if test="name != null">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="minAge != null">
            AND age >= #{minAge}
        </if>
        <if test="maxAge != null">
            AND age <= #{maxAge}
        </if>
    </where>
</select>
```

**ì¥ì **:
- âœ… SQLì´ ë…ë¦½ëœ íŒŒì¼ë¡œ ë¶„ë¦¬ (ê°€ë…ì„± í–¥ìƒ)
- âœ… **ë™ì  SQL** ì‘ì„± ìš©ì´ (`<if>`, `<choose>`, `<foreach>` ë“±)
- âœ… SQL ì¬ì‚¬ìš© ê°€ëŠ¥ (`<include>`)
- âœ… ì¡°ê±´ì— ë”°ë¼ ì¿¼ë¦¬ ìì²´ê°€ ë³€ê²½ ê°€ëŠ¥
- âœ… ë³µì¡í•œ JOIN, ì„œë¸Œì¿¼ë¦¬ì— ê°•í•¨

---

### 3.3.3 MyBatis vs Spring Data JDBC ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

#### Spring Data JDBC ì í•©í•œ ê²½ìš°

```
âœ… ë‹¨ìˆœí•œ CRUD ì‘ì—…
âœ… ë‹¨ì¼ í…Œì´ë¸” ì¡°íšŒ/ìˆ˜ì •
âœ… ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìë™ ìƒì„± ê°€ëŠ¥í•œ ì¿¼ë¦¬
âœ… ê°„ë‹¨í•œ ì¡°ê±´ ê²€ìƒ‰

ì˜ˆ: findByName(), findByAgeGreaterThan()
```

#### MyBatis ì í•©í•œ ê²½ìš°

```
âœ… ë³µì¡í•œ JOIN (3ê°œ ì´ìƒ í…Œì´ë¸”)
âœ… ë™ì  SQL (ì¡°ê±´ì— ë”°ë¼ ì¿¼ë¦¬ ë³€ê²½)
âœ… ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬ (GROUP BY, HAVING)
âœ… ì„±ëŠ¥ ìµœì í™”ê°€ ì¤‘ìš”í•œ ì¿¼ë¦¬
âœ… SQLì— ìµìˆ™í•œ íŒ€
âœ… ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸

ì˜ˆ: ê²€ìƒ‰ ê¸°ëŠ¥, í†µê³„ ë¦¬í¬íŠ¸, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```

#### ì‹¤ì „ ì˜ˆì‹œ

**ìš”êµ¬ì‚¬í•­**: íšŒì› ê²€ìƒ‰ (ì´ë¦„, ë‚˜ì´ ë²”ìœ„, ì •ë ¬ ìˆœì„œ - ëª¨ë‘ ì„ íƒ ì‚¬í•­)

**Spring Data JDBC (ë³µì¡í•¨)**:
```java
// ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì•¼ í•¨
List<Member> findByName(String name);
List<Member> findByAgeBetween(int min, int max);
List<Member> findByNameAndAgeBetween(String name, int min, int max);
// ... ì¡°í•©ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ë©”ì„œë“œ í­ë°œ!
```

**MyBatis (ê°„ë‹¨í•¨)**:
```xml
<select id="search">
    SELECT * FROM member
    <where>
        <!--    <>íƒœê·¸ ì•ˆì—ì„œëŠ” #{} ì´ ì•„ë‹Œ ë°”ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.     -->
        <if test="name != null">AND name LIKE #{name}</if>
        <if test="minAge != null">AND age >= #{minAge}</if>
        <if test="maxAge != null">AND age <= #{maxAge}</if>
    </where>
    <if test="orderBy != null">
        ORDER BY ${orderBy} ${direction}
    </if>
</select>
```

---

### 3.3.4 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€

**build.gradle**:
```gradle
dependencies {
    // MyBatis Spring Boot Starter
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.5'
    
    // H2 Database (ë‚´ì¥ DB, í…ŒìŠ¤íŠ¸ìš©)
    runtimeOnly 'com.h2database:h2'
    
    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter-test:3.0.5'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  |
|-------|------|
| `mybatis-spring-boot-starter` | MyBatisë¥¼ Spring Bootì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ í†µí•© |
| `h2` | ë‚´ì¥í˜• ë°ì´í„°ë² ì´ìŠ¤ (ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”) |

**H2 Databaseì˜ íŠ¹ì§•**:
- ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ë‚´ì¥**ë˜ì–´ ì‹¤í–‰
- **ë©”ëª¨ë¦¬ ê¸°ë°˜** (ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì´ˆê¸°í™”)
- **í…ŒìŠ¤íŠ¸ ë° ê°œë°œ í™˜ê²½**ì— ì í•©
- ë³„ë„ DB ì„œë²„ ì„¤ì¹˜ ë¶ˆí•„ìš”
- H2ë„ ë°ì´í„°ë² ì´ìŠ¤ì´ë¯€ë¡œ **JDBC Driver í•„ìš”** (h2 ì˜ì¡´ì„±ì´ Driver í¬í•¨)

---

### 3.3.5 ì„¤ì • íŒŒì¼

**application.properties**:
```properties
spring.application.name=mybatisSample

# ========================================
# MyBatis ì„¤ì •
# ========================================
# SQLì´ ì‘ì„±ëœ XML íŒŒì¼ ìœ„ì¹˜
mybatis.mapper-locations=classpath:mapper/**/*.xml

# ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ â†’ ì¹´ë©œ ì¼€ì´ìŠ¤ ìë™ ë³€í™˜
mybatis.configuration.map-underscore-to-camel-case=true

# ========================================
# H2 Database ì´ˆê¸°í™”
# ========================================
# schema.sql, data.sql ìë™ ì‹¤í–‰
spring.sql.init.mode=always
spring.sql.init.encoding=utf-8
```

#### ì„¤ì • ì„¤ëª…

| ì†ì„± | ì„¤ëª… |
|-----|------|
| `mybatis.mapper-locations` | SQL Mapper XML íŒŒì¼ ê²½ë¡œ (`src/main/resources/mapper/` í•˜ìœ„ ëª¨ë“  XML) |
| `map-underscore-to-camel-case` | DB ì»¬ëŸ¼ `user_name` â†’ Java í•„ë“œ `userName` ìë™ ë§¤í•‘ |
| `spring.sql.init.mode` | ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (H2 í…ŒìŠ¤íŠ¸ìš©) |

---

### 3.3.6 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/example/mybatisSample/
â”œâ”€ mapper/              # Mapper ì¸í„°í˜ì´ìŠ¤
â”‚  â”œâ”€ MemberMapper.java
â”‚  â””â”€ ArticleMapper.java
â”œâ”€ model/               # ë„ë©”ì¸ ëª¨ë¸ (Entity)
â”‚  â”œâ”€ Member.java
â”‚  â””â”€ Article.java
â””â”€ MyBatisApplication.java

src/main/resources/
â”œâ”€ mapper/              # SQL Mapper XML
â”‚  â””â”€ MemberMapper.xml
â”œâ”€ schema.sql           # í…Œì´ë¸” ìƒì„± SQL
â”œâ”€ data.sql             # ì´ˆê¸° ë°ì´í„° SQL
â””â”€ application.properties
```

---

### 3.3.7 ëª¨ë¸ í´ë˜ìŠ¤ (Model)

#### Member í´ë˜ìŠ¤

**Member.java**:
```java
package com.example.mybatisSample.model;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class Member {
    private Long id;
    private String name;
    private String email;
    private Integer age;
}
```

#### Article í´ë˜ìŠ¤

**Article.java**:
```java
package com.example.mybatisSample.model;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.Date;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Article {
    private Long id;
    private String title;
    private String description;
    private Date created;
    private Date updated;
    private Long memberId;
}
```

#### Spring Data JDBCì™€ì˜ ì°¨ì´
#### í´ë˜ìŠ¤ì˜ ì •ì²´ì„±

| í”„ë ˆì„ì›Œí¬ | í´ë˜ìŠ¤ ì—­í•  | ë¹„ìœ  |
|----------|-----------|------|
| **Spring Data JDBC** | **í…Œì´ë¸” + ê·¸ë¦‡** | ì„¤ê³„ë„ = ê±´ë¬¼ |
| **MyBatis** | **ê·¸ë¦‡ë§Œ** | ì°½ê³ ì—ì„œ ë¬¼ê±´ êº¼ë‚´ì„œ ìƒìì— ë‹´ê¸° |

---

#### Spring Data JDBC - "í´ë˜ìŠ¤ = í…Œì´ë¸”"

```java
@Table  // â‘  í…Œì´ë¸” ì„ ì–¸ + â‘¡ ê²°ê³¼ ë‹´ëŠ” ê·¸ë¦‡ (ì´ì¤‘ ì—­í• !)
public class Member {
    @Id
    private Long id;
    private String name;
}
```

**íŠ¹ì§•**:
```
í´ë˜ìŠ¤ â†â†’ í…Œì´ë¸” (ì™„ì „íˆ ë™ì¼ì‹œ)

- í´ë˜ìŠ¤ êµ¬ì¡° = í…Œì´ë¸” êµ¬ì¡°
- í´ë˜ìŠ¤ ë³€ê²½ â†’ í…Œì´ë¸” ë³€ê²½ í•„ìš”
- í…Œì´ë¸” ë³€ê²½ â†’ í´ë˜ìŠ¤ ë³€ê²½ í•„ìš”
```

**ë¬¸ì œ ë°œìƒ**:
- âŒ **ì—°ê´€ê´€ê³„ í‘œí˜„ ì œí•œ**: `@ManyToOne`, `@OneToMany` ë¶€ì¡±
- âŒ **ë™ê¸°í™” í•„ìš”**: í…Œì´ë¸” â†” í´ë˜ìŠ¤ í•­ìƒ ì¼ì¹˜í•´ì•¼ í•¨
---

#### MyBatis - "í´ë˜ìŠ¤ = SQL ê²°ê³¼ ë‹´ëŠ” ê·¸ë¦‡"

```java
// ì• ë…¸í…Œì´ì…˜ ì—†ìŒ! ìˆœìˆ˜ ê·¸ë¦‡!
public class Member {
    private Long id;
    private String name;
}
```

```xml
<select id="selectAll" resultType="Member">
    SELECT id, name FROM member
</select>
```

**íŠ¹ì§•**:
```
SQL ì‹¤í–‰ â†’ ResultSet â†’ í´ë˜ìŠ¤(ê·¸ë¦‡)

- í…Œì´ë¸”ê³¼ í´ë˜ìŠ¤ ë…ë¦½ì 
- SQLì´ í…Œì´ë¸” ê²°ì •
- í´ë˜ìŠ¤ëŠ” ê²°ê³¼ë§Œ ë‹´ìŒ
```

**ë¬¸ì œ í•´ê²°**:
- âœ… **ì—°ê´€ê´€ê³„ ììœ **: SQLë¡œ JOIN ë§ˆìŒëŒ€ë¡œ
- âœ… **ë™ê¸°í™” ë¶ˆí•„ìš”**: í…Œì´ë¸” â†” í´ë˜ìŠ¤ ë…ë¦½ì 
- âœ… **í•„ìš”í•œ ì»¬ëŸ¼ë§Œ**: SELECT id, nameë§Œ ê°€ëŠ¥

---

#### ë¹„êµí‘œ

| í•­ëª© | Spring Data JDBC | MyBatis |
|-----|-----------------|---------|
| **í´ë˜ìŠ¤ ì •ì²´ì„±** | í…Œì´ë¸” ê·¸ ìì²´ | SQL ê²°ê³¼ ê·¸ë¦‡ |
| **í…Œì´ë¸” ë§¤í•‘** | `@Table` í•„ìˆ˜ | ì• ë…¸í…Œì´ì…˜ ë¶ˆí•„ìš” |
| **í…Œì´ë¸”-í´ë˜ìŠ¤ ê´€ê³„** | ì™„ì „íˆ ë™ì¼í•´ì•¼ í•¨ | ë…ë¦½ì  |
| **ì—°ê´€ê´€ê³„** | âŒ ì œí•œì  | âœ… SQLë¡œ ììœ ë¡­ê²Œ |
| **í…Œì´ë¸” ë³€ê²½ ì‹œ** | âŒ í´ë˜ìŠ¤ë„ ë³€ê²½ | âœ… SQLë§Œ ë³€ê²½ |
| **í´ë˜ìŠ¤ ë³€ê²½ ì‹œ** | âŒ í…Œì´ë¸”ë„ ë³€ê²½ | âœ… ì˜í–¥ ì—†ìŒ |
| **ë™ê¸°í™” ë¬¸ì œ** | âŒ í•­ìƒ ë°œìƒ | âœ… ì—†ìŒ |

---

#### ì‹¤ì „ ì˜ˆì‹œ

##### ì‹œë‚˜ë¦¬ì˜¤: í…Œì´ë¸”ì— phone ì»¬ëŸ¼ ì¶”ê°€

**ë°ì´í„°ë² ì´ìŠ¤**:
```sql
ALTER TABLE member ADD COLUMN phone VARCHAR(20);
```

**Spring Data JDBC**:
```java
@Table
public class Member {
    @Id private Long id;
    private String name;
    private String phone;  // âŒ í•„ìˆ˜ ì¶”ê°€! (ì•ˆ í•˜ë©´ ë¬¸ì œ)
}
```

**MyBatis**:
```java
// âœ… í´ë˜ìŠ¤ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥!
public class Member {
    private Long id;
    private String name;
    // phone ì—†ì–´ë„ ë¨!
}
```

```xml
<!-- âœ… í•„ìš”í•  ë•Œë§Œ SELECT -->
<select id="selectAll" resultType="Member">
    SELECT id, name FROM member  <!-- phone ì•ˆ ê°€ì ¸ì™€ë„ OK -->
</select>

<!-- phone í•„ìš”í•œ ê²½ìš°ë§Œ ë³„ë„ ì¿¼ë¦¬ -->
<select id="selectWithPhone" resultType="MemberWithPhone">
    SELECT id, name, phone FROM member
</select>
```

---

##### ì‹œë‚˜ë¦¬ì˜¤: Member-Order ì—°ê´€ê´€ê³„

**Spring Data JDBC**:
```java
@Table
public class Member {
    @Id private Long id;
    private String name;
    
    // âŒ ì—°ê´€ê´€ê³„ í‘œí˜„ì´ ì œí•œì 
    // private List<Order> orders;
}
```

**MyBatis**:
```java
// ê·¸ëƒ¥ ê·¸ë¦‡!
public class Member {
    private Long id;
    private String name;
}

public class MemberWithOrders {
    private Long id;
    private String name;
    private List<Order> orders;  // âœ… ììœ ë¡­ê²Œ êµ¬ì„±
}
```

```xml
<!-- âœ… SQLë¡œ ììœ ë¡­ê²Œ JOIN -->
<select id="selectMemberWithOrders" resultType="MemberWithOrders">
    SELECT 
        m.id, m.name,
        o.id as order_id, o.product_name
    FROM member m
    LEFT JOIN orders o ON m.id = o.member_id
    WHERE m.id = #{id}
</select>
```

---

#### í•µì‹¬ ìš”ì•½

**Spring Data JDBC**:
```
@Table = "ë‚˜ëŠ” member í…Œì´ë¸”ì´ë©´ì„œ ë™ì‹œì— ê·¸ë¦‡ì´ì•¼!"

ì¥ì : ê°„ë‹¨í•œ CRUD ìë™í™”
ë‹¨ì : í…Œì´ë¸” = í´ë˜ìŠ¤ (ê°•ì œ), ì—°ê´€ê´€ê³„ ì•½í•¨, ë™ê¸°í™” í•„ìš”
```

**MyBatis**:
```
í´ë˜ìŠ¤ = "ë‚˜ëŠ” ê·¸ëƒ¥ ê·¸ë¦‡ì´ì•¼! í…Œì´ë¸”ì€ SQLì´ ê²°ì •í•´!"

ì¥ì : í…Œì´ë¸”-í´ë˜ìŠ¤ ë…ë¦½, ì—°ê´€ê´€ê³„ ììœ , ë³µì¡í•œ ì¿¼ë¦¬ ê°•ë ¥
ë‹¨ì : SQL ì§ì ‘ ì‘ì„± í•„ìš”
```

**ê²°ë¡ **:
- Spring Data JDBCì˜ **í•œê³„ (ì—°ê´€ê´€ê³„, ë™ê¸°í™”)**ëŠ” MyBatisì—ì„œ **ì• ì´ˆì— ë°œìƒí•˜ì§€ ì•ŠìŒ**
- í•˜ì§€ë§Œ MyBatisëŠ” ëª¨ë“  SQLì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ ì¡´ì¬


### 3.3.8 Mapper ì¸í„°í˜ì´ìŠ¤

#### @Mapper ì• ë…¸í…Œì´ì…˜

**ì—­í• **: ì´ ì¸í„°í˜ì´ìŠ¤ê°€ MyBatisì˜ SQL ë§¤í•‘ ì¸í„°í˜ì´ìŠ¤ì„ì„ ì„ ì–¸

```java
@Mapper  // MyBatisê°€ ì¸ì‹
public interface MemberMapper {
    List<Member> selectAll();
}
```

**Springì˜ ì²˜ë¦¬**:
```
1. @Mapper ìŠ¤ìº”
2. í”„ë¡ì‹œ ê°ì²´ ìë™ ìƒì„± (êµ¬í˜„ì²´)
3. ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
4. ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ ì£¼ì… ê°€ëŠ¥
```

**Spring Data JDBCì™€ ë¹„êµ**:

| í”„ë ˆì„ì›Œí¬ | ì• ë…¸í…Œì´ì…˜ | ì—­í•  |
|----------|-----------|------|
| Spring Data JDBC | `@Repository` | ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ |
| MyBatis | `@Mapper` | SQL ë§¤í•‘ ì¸í„°í˜ì´ìŠ¤ |

> **ê³µí†µì **: ë‘˜ ë‹¤ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´ Springì´ êµ¬í˜„ì²´ë¥¼ ìë™ ìƒì„±!

---

### 3.3.9 XML ê¸°ë°˜ SQL ë§¤í•‘

#### MemberMapper ì¸í„°í˜ì´ìŠ¤

**MemberMapper.java**:
```java
package com.example.mybatisSample.mapper;

import com.example.mybatisSample.model.Member;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;
import java.util.Optional;

@Mapper
public interface MemberMapper {
    List<Member> selectAll();
    Optional<Member> selectById(@Param("id") Long id);
    Optional<Member> selectByEmail(@Param("email") String email);
    List<Member> selectAllOrderByAgeAsc();
    List<Member> selectAllOrderBy(@Param("order") String order, @Param("dir") String dir);
    List<Member> selectByNameLike(@Param("name") String name);
    int selectCount();
    int insert(@Param("member") Member member);
    int update(@Param("member") Member member);
    int delete(@Param("member") Member member);
    int deleteById(@Param("id") Long id);
    int deleteAll();
}
```

#### @Param ì• ë…¸í…Œì´ì…˜

**ì—­í• **: ë©”ì„œë“œ ë§¤ê°œë³€ìˆ˜ì— ì´ë¦„ì„ ë¶€ì—¬í•˜ì—¬ XML/ì• ë…¸í…Œì´ì…˜ SQLì—ì„œ ì°¸ì¡°

```java
Optional<Member> selectByEmail(@Param("email") String email);
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                     â†“
                               XMLì—ì„œ #{email}ë¡œ ì°¸ì¡°
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```java
// ë‹¨ì¼ íŒŒë¼ë¯¸í„°
selectById(@Param("id") Long id)
// XML: #{id}

// ê°ì²´ íŒŒë¼ë¯¸í„°
insert(@Param("member") Member member)
// XML: #{member.name}, #{member.email}

// ë³µìˆ˜ íŒŒë¼ë¯¸í„°
selectAllOrderBy(@Param("order") String order, @Param("dir") String dir)
// XML: #{order}, #{dir}
```

---

### 3.3.10 MemberMapper.xml

**src/main/resources/mapper/MemberMapper.xml**:
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mybatisSample.mapper.MemberMapper">

    <!-- ì „ì²´ ì¡°íšŒ -->
    <select id="selectAll" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member
    </select>

    <!-- IDë¡œ ì¡°íšŒ -->
    <select id="selectById" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member WHERE id = #{id}
    </select>

    <!-- ì´ë©”ì¼ë¡œ ì¡°íšŒ -->
    <select id="selectByEmail" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member WHERE email = #{email}
    </select>

    <!-- ë‚˜ì´ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ -->
    <select id="selectAllOrderByAgeAsc" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member ORDER BY age ASC
    </select>

    <!-- ë™ì  ì •ë ¬ -->
    <select id="selectAllOrderBy" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member ORDER BY ${order} ${dir}
    </select>

    <!-- ì´ë¦„ LIKE ê²€ìƒ‰ -->
    <select id="selectByNameLike" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member WHERE name LIKE #{name}
    </select>

    <!-- ê°œìˆ˜ ì¡°íšŒ -->
    <select id="selectCount" resultType="int">
        SELECT COUNT(*) FROM member
    </select>

    <!-- ì‚½ì… (ìë™ ìƒì„± í‚¤ ë°˜í™˜) -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="member.id" keyColumn="id">
        INSERT INTO member(name, email, age) 
        VALUES (#{member.name}, #{member.email}, #{member.age})
    </insert>

    <!-- ìˆ˜ì • -->
    <update id="update">
        UPDATE member 
        SET name = #{member.name}, email = #{member.email}, age = #{member.age} 
        WHERE id = #{member.id}
    </update>

    <!-- ì‚­ì œ (ê°ì²´) -->
    <delete id="delete">
        DELETE FROM member WHERE id = #{member.id}
    </delete>

    <!-- ì‚­ì œ (ID) -->
    <delete id="deleteById">
        DELETE FROM member WHERE id = #{id}
    </delete>

    <!-- ì „ì²´ ì‚­ì œ -->
    <delete id="deleteAll">
        DELETE FROM member
    </delete>

</mapper>
```

---

### 3.3.11 XML íƒœê·¸ ìƒì„¸ ì„¤ëª…

#### ê¸°ë³¸ êµ¬ì¡°

| íƒœê·¸ | ì—­í•  | í•„ìˆ˜ ì†ì„± |
|-----|------|----------|
| `<mapper>` | ë£¨íŠ¸ íƒœê·¸ | `namespace` |
| `<select>` | SELECT ì¿¼ë¦¬ | `id`, `resultType` |
| `<insert>` | INSERT ì¿¼ë¦¬ | `id` |
| `<update>` | UPDATE ì¿¼ë¦¬ | `id` |
| `<delete>` | DELETE ì¿¼ë¦¬ | `id` |

#### namespace

```xml
<mapper namespace="com.example.mybatisSample.mapper.MemberMapper">
```

**ì—­í• **: ì´ XMLì´ ì–´ë–¤ Mapper ì¸í„°í˜ì´ìŠ¤ì™€ ì—°ê²°ë ì§€ ì§€ì •

**ë§¤í•‘ ê³¼ì •**:
```
1. MyBatisê°€ @Mapper ì¸í„°í˜ì´ìŠ¤ ìŠ¤ìº”
2. namespaceì™€ ì¸í„°í˜ì´ìŠ¤ ê²½ë¡œ ë¹„êµ
3. ì¼ì¹˜í•˜ë©´ XMLê³¼ ì¸í„°í˜ì´ìŠ¤ ì—°ê²°
4. ë©”ì„œë“œ í˜¸ì¶œ ì‹œ idì™€ ì¼ì¹˜í•˜ëŠ” SQL ì‹¤í–‰
```

#### id ì†ì„±

```xml
<select id="selectAll">
```

**ì—­í• **: Mapper ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œ ì´ë¦„ê³¼ **ì •í™•íˆ ì¼ì¹˜**í•´ì•¼ í•¨

```java
// ì¸í„°í˜ì´ìŠ¤
List<Member> selectAll();

// XML
<select id="selectAll">  // ë©”ì„œë“œëª…ê³¼ ë™ì¼!
```

#### resultType

```xml
<select id="selectAll" resultType="com.example.mybatisSample.model.Member">
```

**ì—­í• **: SQL ì‹¤í–‰ ê²°ê³¼ë¥¼ ì–´ë–¤ Java íƒ€ì…ìœ¼ë¡œ ë§¤í•‘í• ì§€ ì§€ì •

**íƒ€ì…ë³„ ì‚¬ìš©**:
```xml
<!-- ë‹¨ì¼ ê°ì²´ -->
<select resultType="com.example.mybatisSample.model.Member">

<!-- ë¦¬ìŠ¤íŠ¸ (ìš”ì†Œ íƒ€ì… ì§€ì •) -->
<select resultType="com.example.mybatisSample.model.Member">

<!-- ê¸°ë³¸ íƒ€ì… -->
<select resultType="int">
<select resultType="String">
<select resultType="Long">
```

---

### 3.3.12 íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

#### #{} vs ${}

| ë¬¸ë²• | ì„¤ëª… | SQL ë³€í™˜ | ì‚¬ìš© |
|-----|------|---------|------|
| `#{íŒŒë¼ë¯¸í„°}` | **PreparedStatement** (ê¶Œì¥) | `?`ë¡œ ì¹˜í™˜ | ê°’ ë°”ì¸ë”© |
| `${íŒŒë¼ë¯¸í„°}` | **Statement** (ì£¼ì˜) | ë¬¸ìì—´ ì§ì ‘ ì‚½ì… | í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª… |

#### #{} (ê¶Œì¥) â­

```xml
<select id="selectById">
    SELECT * FROM member WHERE id = #{id}
</select>
```

**ë³€í™˜ ê³¼ì •**:
```
1. SQL: SELECT * FROM member WHERE id = ?
2. PreparedStatement ì‚¬ìš©
3. id ê°’ì„ ì•ˆì „í•˜ê²Œ ë°”ì¸ë”©
```

**ì¥ì **:
- âœ… **SQL Injection ë°©ì§€**
- âœ… ìë™ íƒ€ì… ë³€í™˜
- âœ… null ì²˜ë¦¬ ì•ˆì „

#### ${} (ì£¼ì˜!)

```xml
<select id="selectAllOrderBy">
    SELECT * FROM member ORDER BY ${order} ${dir}
</select>
```

**ë³€í™˜ ê³¼ì •**:
```
1. order = "name", dir = "ASC"
2. SQL: SELECT * FROM member ORDER BY name ASC
3. ë¬¸ìì—´ ì§ì ‘ ì¹˜í™˜
```

**ì£¼ì˜ì‚¬í•­**:
- âŒ **SQL Injection ìœ„í—˜**
- âŒ ì‚¬ìš©ì ì…ë ¥ê°’ì— ì‚¬ìš© ê¸ˆì§€
- âœ… í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª…, ORDER BY ì ˆì—ë§Œ ì‚¬ìš©

**ì•ˆì „í•œ ì‚¬ìš© ì˜ˆì‹œ**:
```java
// ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê°’ ê²€ì¦
String order = "name";  // í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦
if (!List.of("name", "age", "email").contains(order)) {
    throw new IllegalArgumentException("ì˜ëª»ëœ ì •ë ¬ ê¸°ì¤€");
}
```

---

### 3.3.13 ìë™ ìƒì„± í‚¤ ì²˜ë¦¬

#### useGeneratedKeys

```xml
<insert id="insert" useGeneratedKeys="true" keyProperty="member.id" keyColumn="id">
    INSERT INTO member(name, email, age) 
    VALUES (#{member.name}, #{member.email}, #{member.age})
</insert>
```

#### ì†ì„± ì„¤ëª…

| ì†ì„± | ì—­í•  |
|-----|------|
| `useGeneratedKeys="true"` | DBê°€ ìë™ ìƒì„±í•œ í‚¤(AUTO_INCREMENT)ë¥¼ ê°€ì ¸ì˜´ |
| `keyColumn="id"` | DB í…Œì´ë¸”ì˜ ìë™ ìƒì„± í‚¤ ì»¬ëŸ¼ëª… |
| `keyProperty="member.id"` | ìƒì„±ëœ í‚¤ ê°’ì„ ì €ì¥í•  Java ê°ì²´ í•„ë“œ |

#### ë™ì‘ ê³¼ì •

```java
Member member = Member.builder()
                      .name("í™í˜œì°½")
                      .email("test@example.com")
                      .age(25)
                      .build();

System.out.println(member.getId());  // null

memberMapper.insert(member);  // INSERT ì‹¤í–‰

System.out.println(member.getId());  // 5 (DBì—ì„œ ìƒì„±ëœ ID)
```

**ë‚´ë¶€ ë™ì‘**:
```
1. INSERT SQL ì‹¤í–‰
2. DBê°€ id = 5 ìë™ ìƒì„±
3. MyBatisê°€ ìƒì„±ëœ 5ë¥¼ ê°€ì ¸ì˜´
4. member.setId(5) ìë™ í˜¸ì¶œ
5. member ê°ì²´ ì¬ì‚¬ìš© ê°€ëŠ¥
```

#### useGeneratedKeys ìƒëµ ì‹œ

```xml
<!-- useGeneratedKeys ì—†ìŒ -->
<insert id="insert">
    INSERT INTO member(name, email, age) VALUES (#{member.name}, #{member.email}, #{member.age})
</insert>
```

```java
Member member = Member.builder().name("í™í˜œì°½").build();
memberMapper.insert(member);

System.out.println(member.getId());  // null (IDê°€ ì±„ì›Œì§€ì§€ ì•ŠìŒ)
```

**ê²°ê³¼**:
- DBì—ëŠ” ë ˆì½”ë“œ ì •ìƒ ìƒì„± (AUTO_INCREMENT ì‘ë™)
- Java ê°ì²´ì—ëŠ” IDê°€ ì±„ì›Œì§€ì§€ ì•ŠìŒ

#### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | useGeneratedKeys ì„¤ì • | ì´ìœ  |
|-----|---------------------|------|
| **ID ì¬ì‚¬ìš© í•„ìš”** | âœ… í•„ìˆ˜ | ìƒì„±ëœ IDë¡œ í›„ì† ì‘ì—… í•„ìš” |
| **ID ì¬ì‚¬ìš© ë¶ˆí•„ìš”** | âŒ ìƒëµ ê°€ëŠ¥ | ë‹¨ìˆœ INSERTë§Œ ìˆ˜í–‰ |

**ì˜ˆì‹œ**:
```java
// ì‹œë‚˜ë¦¬ì˜¤: íšŒì› ê°€ì… í›„ í™˜ì˜ ì´ë©”ì¼ ë°œì†¡
Member member = new Member("í™í˜œì°½", "test@example.com", 25);
memberMapper.insert(member);  // useGeneratedKeys="true"

// ìƒì„±ëœ IDë¡œ í™˜ì˜ ì´ë©”ì¼ ë°œì†¡
emailService.sendWelcome(member.getId(), member.getEmail());
```

---

### 3.3.14 ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ SQL ë§¤í•‘

#### ArticleMapper ì¸í„°í˜ì´ìŠ¤

**ArticleMapper.java**:
```java
package com.example.mybatisSample.mapper;

import com.example.mybatisSample.model.Article;
import org.apache.ibatis.annotations.*;

import java.util.List;
import java.util.Optional;

@Mapper
public interface ArticleMapper {
    
    @Select("SELECT * FROM article")
    List<Article> selectAll();
    
    @Select("SELECT * FROM article WHERE id = #{id}")
    Optional<Article> selectById(@Param("id") Long id);
    
    @Insert("INSERT INTO article(title, description, created, updated, member_id) " +
            "VALUES (#{article.title}, #{article.description}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, #{article.memberId})")
    @Options(useGeneratedKeys = true, keyColumn = "id", keyProperty = "article.id")
    int insert(@Param("article") Article article);
    
    @Update("UPDATE article SET title = #{title}, description = #{description}, updated = CURRENT_TIMESTAMP WHERE id = #{id}")
    int update(@Param("id") Long id, @Param("title") String title, @Param("description") String description);
    
    @Delete("DELETE FROM article WHERE id = #{id}")
    int deleteById(@Param("id") Long id);
}
```

#### ì• ë…¸í…Œì´ì…˜ ì¢…ë¥˜

| ì• ë…¸í…Œì´ì…˜ | ì—­í•  | SQL ì¢…ë¥˜ |
|-----------|------|----------|
| `@Select` | SELECT ì¿¼ë¦¬ | ì¡°íšŒ |
| `@Insert` | INSERT ì¿¼ë¦¬ | ì‚½ì… |
| `@Update` | UPDATE ì¿¼ë¦¬ | ìˆ˜ì • |
| `@Delete` | DELETE ì¿¼ë¦¬ | ì‚­ì œ |
| `@Options` | ì¶”ê°€ ì˜µì…˜ (ìë™ ìƒì„± í‚¤ ë“±) | INSERT |

#### XML vs ì• ë…¸í…Œì´ì…˜ ë¹„êµ

**XML ë°©ì‹**:
```xml
<!-- MemberMapper.xml -->
<select id="selectAll" resultType="Member">
    SELECT * FROM member
</select>
```

**ì• ë…¸í…Œì´ì…˜ ë°©ì‹**:
```java
// ArticleMapper.java
@Select("SELECT * FROM article")
List<Article> selectAll();
```

#### ì–¸ì œ ì–´ë–¤ ë°©ì‹ì„ ì‚¬ìš©í• ê¹Œ?

| ìƒí™© | XML | ì• ë…¸í…Œì´ì…˜ |
|-----|-----|-----------|
| **ë‹¨ìˆœí•œ ì¿¼ë¦¬** | âŒ | âœ… ê¶Œì¥ |
| **ë³µì¡í•œ ì¿¼ë¦¬** | âœ… ê¶Œì¥ | âŒ |
| **ë™ì  SQL** | âœ… ê¶Œì¥ | âŒ |
| **SQL ì¬ì‚¬ìš©** | âœ… ê¶Œì¥ | âŒ |
| **ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘** | âŒ | âœ… ê¶Œì¥ |

**ì‹¤ë¬´ ê¶Œì¥**:
- ë³µì¡í•œ ì¿¼ë¦¬, ë™ì  SQL â†’ **XML**
- ë‹¨ìˆœí•œ CRUD â†’ **ì• ë…¸í…Œì´ì…˜**

---

### 3.3.15 ì»¬ëŸ¼ëª…ê³¼ í•„ë“œëª… ë¶ˆì¼ì¹˜ í•´ê²°

#### ë¬¸ì œ ìƒí™©

**ë°ì´í„°ë² ì´ìŠ¤**:
```sql
CREATE TABLE article (
    id BIGINT,
    title VARCHAR(255),
    content VARCHAR(1000),  -- Java í•„ë“œëŠ” 'description'
    member_id BIGINT
);
```

**Java í´ë˜ìŠ¤**:
```java
public class Article {
    private Long id;
    private String title;
    private String description;  // DB ì»¬ëŸ¼ì€ 'content'
    private Long memberId;
}
```

#### í•´ê²° ë°©ë²•

##### ë°©ë²• 1: application.properties ì„¤ì • (ê¶Œì¥) â­

```properties
mybatis.configuration.map-underscore-to-camel-case=true
```

**ìë™ ë³€í™˜**:
```
DB: member_id  â†’ Java: memberId
DB: created_at â†’ Java: createdAt
DB: user_name  â†’ Java: userName
```

**ì¥ì **:
- âœ… ì „ì—­ ì„¤ì • (í•œ ë²ˆë§Œ ì‘ì„±)
- âœ… ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ â†” ì¹´ë©œ ì¼€ì´ìŠ¤ ìë™ ë³€í™˜
- âœ… ëŒ€ë¶€ë¶„ì˜ ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°

**í•œê³„**:
- âŒ `content` â†” `description` ê°™ì€ ì™„ì „íˆ ë‹¤ë¥¸ ì´ë¦„ì€ í•´ê²° ëª» í•¨

##### ë°©ë²• 2: SQL AS í‚¤ì›Œë“œ (ì„ íƒì )

```sql
SELECT id, title, content AS description, member_id 
FROM article
```

**ì ìš©**:
```java
@Select("SELECT id, title, content AS description, member_id FROM article")
List<Article> selectAll();
```

**ì¥ì **:
- âœ… ê°„ë‹¨í•œ ê²½ìš° ë¹ ë¥´ê²Œ í•´ê²°

**ë‹¨ì **:
- âŒ ëª¨ë“  SELECT ë¬¸ì— ë°˜ë³µ ì‘ì„±
- âŒ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

##### ë°©ë²• 3: `<resultMap>` (ì™„ì „í•œ ì œì–´) â­

**XML**:
```xml
<resultMap id="articleResult" type="com.example.mybatisSample.model.Article">
    <result column="content" property="description"/>
    <result column="member_id" property="memberId"/>
</resultMap>

<select id="selectAll" resultMap="articleResult">
    SELECT * FROM article
</select>

<select id="selectById" resultMap="articleResult">
    SELECT * FROM article WHERE id = #{id}
</select>
```

**ì¬ì‚¬ìš© ê°€ëŠ¥**:
- í•œ ë²ˆ ì •ì˜í•˜ë©´ ì—¬ëŸ¬ ì¿¼ë¦¬ì—ì„œ `resultMap="articleResult"` ì°¸ì¡°

**ì• ë…¸í…Œì´ì…˜**:
```java
@Results(id = "articleResult", value = {
    @Result(column = "content", property = "description"),
    @Result(column = "member_id", property = "memberId")
})
@Select("SELECT * FROM article")
List<Article> selectAll();

@ResultMap("articleResult")  // ì¬ì‚¬ìš©
@Select("SELECT * FROM article WHERE id = #{id}")
Optional<Article> selectById(@Param("id") Long id);
```

**ì‚¬ìš© ì‹œì **:
- ì²« ë²ˆì§¸ ì¿¼ë¦¬: `@Results`ë¡œ ì •ì˜
- ì´í›„ ì¿¼ë¦¬: `@ResultMap`ìœ¼ë¡œ ì¬ì‚¬ìš©

**ì¥ì **:
- âœ… ì™„ì „í•œ ì»¤ìŠ¤í…€ ë§¤í•‘ ê°€ëŠ¥
- âœ… ì¬ì‚¬ìš© ê°€ëŠ¥
- âœ… ë³µì¡í•œ ë§¤í•‘ ì²˜ë¦¬ ê°€ëŠ¥

**ë‹¨ì **:
- âŒ ì½”ë“œê°€ ê¸¸ì–´ì§

#### ê¶Œì¥ ìˆœì„œ

```
1. map-underscore-to-camel-case=true (ëŒ€ë¶€ë¶„ í•´ê²°)
   â†“
2. ì•ˆ ë˜ë©´ AS í‚¤ì›Œë“œ (ê°„ë‹¨í•œ ê²½ìš°)
   â†“
3. ì—¬ì „íˆ ì•ˆ ë˜ë©´ <resultMap> (ë³µì¡í•œ ê²½ìš°)
```

---

### 3.3.16 ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

#### MyBatisApplication í´ë˜ìŠ¤

**MyBatisApplication.java**:
```java
package com.example.mybatisSample;

import com.example.mybatisSample.mapper.ArticleMapper;
import com.example.mybatisSample.mapper.MemberMapper;
import com.example.mybatisSample.model.Article;
import com.example.mybatisSample.model.Member;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

@Slf4j
@RequiredArgsConstructor
@Component
public class MyBatisApplication implements ApplicationRunner {
    
    private final ArticleMapper articleMapper;
    private final MemberMapper memberMapper;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        
        // 1. íšŒì› ìˆ˜ ì¡°íšŒ
        int count = memberMapper.selectCount();
        log.info("count: {}", count);

        // 2. ì´ë©”ì¼ë¡œ íšŒì› ì¡°íšŒ
        Member member = memberMapper.selectByEmail("hyechang@spring.ac.kr")
                                     .orElseThrow();
        log.info("member: {}", member);

        // 3. ê²Œì‹œê¸€ ì‘ì„±
        Article article = Article.builder()
                                 .title("ì œëª©ì…ë‹ˆë‹¤.")
                                 .description("ë‚´ìš©ì…ë‹ˆë‹¤.")
                                 .memberId(member.getId())
                                 .build();
        
        int insert = articleMapper.insert(article);
        log.info("insert: {}", insert);
        log.info("ìƒì„±ëœ ê²Œì‹œê¸€ ID: {}", article.getId());  // ìë™ ìƒì„±ëœ ID ì¶œë ¥
    }
}
```

#### ë©”ì¸ í´ë˜ìŠ¤

**MybatisSampleApplication.java**:
```java
package com.example.mybatisSample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class MybatisSampleApplication {

    public static void main(String[] args) {
        SpringApplication.run(MybatisSampleApplication.class, args);
    }
}
```

---

### 3.3.17 ì‹¤í–‰ ê²°ê³¼ ë° ë¡œê·¸

#### ì‹¤í–‰ ê²°ê³¼ ë¡œê·¸ ì¶œë ¥

```
 :: Spring Boot ::                (v3.5.6)

2025-10-15T12:56:13.692+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.m.MybatisSampleApplication           : Starting MybatisSampleApplication using Java 21.0.8 with PID 32404 (C:\Users\ghddm\Desktop\SpringBoot\mybatisSample\build\classes\java\main started by ghddm in C:\Users\ghddm\Desktop\SpringBoot\mybatisSample)
2025-10-15T12:56:13.698+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.m.MybatisSampleApplication           : No active profile set, falling back to 1 default profile: "default"
2025-10-15T12:56:15.404+09:00  INFO 32404 --- [mybatisSample] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-10-15T12:56:15.834+09:00  INFO 32404 --- [mybatisSample] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:daa4c2b0-93b6-4052-8dca-ecd1ca6e5774 user=SA
2025-10-15T12:56:15.839+09:00  INFO 32404 --- [mybatisSample] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-10-15T12:56:16.510+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.m.MybatisSampleApplication           : Started MybatisSampleApplication in 4.122 seconds (process running for 5.349)
2025-10-15T12:56:16.571+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.mybatisSample.MyBatisApplication     : count: 4
2025-10-15T12:56:16.581+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.mybatisSample.MyBatisApplication     : member: Member(id=1, name=í™í˜œì°½, email=hyechang@spring.ac.kr, age=10)
2025-10-15T12:56:16.589+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.mybatisSample.MyBatisApplication     : insert: 1
2025-10-15T12:56:16.599+09:00  INFO 32404 --- [mybatisSample] [ionShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-10-15T12:56:16.603+09:00  INFO 32404 --- [mybatisSample] [ionShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
```

---

### 3.3.18 Spring Data JDBC vs MyBatis ìµœì¢… ë¹„êµ

#### ì½”ë“œ ë¹„êµ

**Spring Data JDBC**:
```java
// Repository ì¸í„°í˜ì´ìŠ¤
public interface MemberRepository extends CrudRepository<Member, Long> {
    List<Member> findByEmail(String email);  // ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìë™ ìƒì„±
    
    @Query("SELECT * FROM member WHERE name LIKE :name")  // ë³µì¡í•œ ì¿¼ë¦¬ëŠ” @Query
    List<Member> searchByName(@Param("name") String name);
}
```

**MyBatis**:
```java
// Mapper ì¸í„°í˜ì´ìŠ¤
@Mapper
public interface MemberMapper {
    Optional<Member> selectByEmail(@Param("email") String email);
    List<Member> searchByName(@Param("name") String name);
}
```

```xml
<!-- SQLì€ XMLì— ë¶„ë¦¬ -->
<select id="selectByEmail">
    SELECT * FROM member WHERE email = #{email}
</select>

<select id="searchByName">
    SELECT * FROM member WHERE name LIKE #{name}
</select>
```

#### íŠ¹ì§• ë¹„êµ

| íŠ¹ì§• | Spring Data JDBC | MyBatis |
|-----|-----------------|---------|
| **SQL ìë™ ìƒì„±** | âœ… ë©”ì„œë“œ ì´ë¦„ ê·œì¹™ | âŒ í•­ìƒ ì§ì ‘ ì‘ì„± |
| **SQL ìœ„ì¹˜** | Java ì½”ë“œ ë‚´ë¶€ | **XML íŒŒì¼ ë¶„ë¦¬** â­ |
| **ë™ì  SQL** | ì œí•œì  | **ê°•ë ¥í•œ ì§€ì›** â­ |
| **ë³µì¡í•œ ì¿¼ë¦¬** | ì–´ë ¤ì›€ | **ë§¤ìš° ìœ ë¦¬** â­ |
| **ì½”ë“œ ì–‘** | ì ìŒ | ì¤‘ê°„ (XML) |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ | ì¤‘ê°„ |
| **SQL ì œì–´** | ì œí•œì  | **ì™„ì „í•œ ì œì–´** â­ |
| **ê°€ë…ì„±** | ì¤‘ê°„ | **ë†’ìŒ** (SQL ë¶„ë¦¬) â­ |
| **í…ŒìŠ¤íŠ¸** | ì‰¬ì›€ | ì¤‘ê°„ |

---

### 3.3.19 MyBatisì˜ ì¥ë‹¨ì 

#### ì¥ì 

**1. SQLì— ëŒ€í•œ ì™„ì „í•œ ì œì–´** â­
```xml
<!-- ë³µì¡í•œ JOINë„ ììœ ë¡­ê²Œ -->
<select id="selectWithMember">
    SELECT a.*, m.name as member_name
    FROM article a
    INNER JOIN member m ON a.member_id = m.id
    WHERE a.created > #{startDate}
    ORDER BY a.created DESC
</select>
```

**2. ë™ì  SQL ê°•ë ¥** â­
```xml
<select id="search">
    SELECT * FROM member
    <where>
        <if test="name != null">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="minAge != null">
            AND age >= #{minAge}
        </if>
        <if test="maxAge != null">
            AND age <= #{maxAge}
        </if>
    </where>
    <if test="orderBy != null">
        ORDER BY ${orderBy} ${direction}
    </if>
</select>
```

**3. SQL ë¶„ë¦¬ë¡œ ê°€ë…ì„± í–¥ìƒ** â­
```
Java ì½”ë“œ: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ
XML íŒŒì¼: SQLë§Œ

â†’ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ (Separation of Concerns)
```

**4. ì„±ëŠ¥ ìµœì í™” ìš©ì´**
- í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ ê°€ëŠ¥
- ë³µì¡í•œ ì„œë¸Œì¿¼ë¦¬, WITHì ˆ ììœ ë¡­ê²Œ ì‚¬ìš©
- ì¸ë±ìŠ¤ íŒíŠ¸ ë“± DB íŠ¹í™” ê¸°ëŠ¥ í™œìš©

**5. SQLì— ìµìˆ™í•œ íŒ€ì— ì í•©**
- DBAê°€ ì‘ì„±í•œ ìµœì í™”ëœ SQL ê·¸ëŒ€ë¡œ ì‚¬ìš©
- ê¸°ì¡´ SQL ìì‚° ì¬í™œìš© ê°€ëŠ¥

#### ë‹¨ì 

**1. ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì¦ê°€**
```java
// ë©”ì„œë“œë§ˆë‹¤ SQL ì‘ì„± í•„ìš”
@Select("SELECT * FROM member")
List<Member> selectAll();

@Select("SELECT * FROM member WHERE id = #{id}")
Optional<Member> selectById(@Param("id") Long id);
```

**2. ë‹¨ìˆœ CRUDë„ ì§ì ‘ ì‘ì„±**
```xml
<!-- Spring Data JDBCëŠ” ìë™ì¸ë°... -->
<select id="findById">SELECT * FROM member WHERE id = #{id}</select>
<insert id="insert">INSERT INTO member(...) VALUES(...)</insert>
<update id="update">UPDATE member SET ... WHERE id = #{id}</update>
<delete id="delete">DELETE FROM member WHERE id = #{id}</delete>
```

**3. XML íŒŒì¼ ê´€ë¦¬ ë¶€ë‹´**
- ì¸í„°í˜ì´ìŠ¤ì™€ XML íŒŒì¼ ë™ê¸°í™” í•„ìš”
- ë©”ì„œë“œëª… ì˜¤íƒ€ ì‹œ ëŸ°íƒ€ì„ ì—ëŸ¬

**4. íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±**
```xml
<!-- ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ ë°œê²¬ ëª» í•¨ -->
<select id="selectById">
    SELECT * FROM member WHERE id = #{idx}  <!-- idê°€ ì•„ë‹ˆë¼ idx? -->
</select>
```

---

### 3.3.20 í•µì‹¬ ì •ë¦¬

#### MyBatisì˜ 3ê°€ì§€ í•µì‹¬

**1. SQL ì¤‘ì‹¬ ì ‘ê·¼**
```
ê°œë°œì: SQL ì‘ì„±ì— ì§‘ì¤‘
MyBatis: JDBC ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì œê±°
```

**2. XML ë¶„ë¦¬**
```
Java: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
XML: SQL
â†’ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
```

**3. ë™ì  SQL**
```
<if>, <choose>, <foreach> ë“±ìœ¼ë¡œ
ì¡°ê±´ì— ë”°ë¼ SQL ë™ì  ìƒì„±
```



## 3.4 JPA - Part 1: ê¸°ë³¸ ê°œë…, ì—”í‹°í‹° ë§¤í•‘, ë¦¬í¬ì§€í† ë¦¬

### 3.4.1 JPA (Java Persistence API)ë€?

**JPA**ëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ **ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ë§¤í•‘**í•˜ê³  ê´€ë¦¬í•˜ëŠ” **í‘œì¤€ ì¸í„°í˜ì´ìŠ¤**ì…ë‹ˆë‹¤.

#### ORM (Object-Relational Mapping) - í•µì‹¬ ê°œë…

ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë°©ì‹ë“¤ê³¼ JPAì˜ ê·¼ë³¸ì ì¸ ì°¨ì´ëŠ” **ê¸°ì¤€ì´ ë¬´ì—‡ì¸ê°€**ì…ë‹ˆë‹¤.

| ë°©ì‹ | ê¸°ì¤€ | ì ‘ê·¼ ë°©ë²• |
|-----|------|----------|
| **JDBC** | í…Œì´ë¸” ì¤‘ì‹¬ | í…Œì´ë¸” êµ¬ì¡° â†’ SQL ì‘ì„± â†’ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë³€í™˜ |
| **Spring Data JDBC** | í…Œì´ë¸” ì¤‘ì‹¬ | í…Œì´ë¸”ê³¼ ê°ì²´ ë™ê¸°í™” í•„ìˆ˜ |
| **MyBatis** | SQL ì¤‘ì‹¬ | ìµœì í™”ëœ SQL ì‘ì„± â†’ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë§¤í•‘ |
| **JPA** | **ê°ì²´ ì¤‘ì‹¬** | ê°ì²´ ì„¤ê³„ â†’ ë§¤í•‘ ì •ì˜ â†’ SQL ìë™ ìƒì„± |

**ORMì˜ ì² í•™**:
```
ê°œë°œì: ê°ì²´(Object)ë¥¼ ì„¤ê³„í•˜ê³  ê´€ë¦¬
    â†“
JPA: ê°ì²´ì™€ í…Œì´ë¸”ì˜ ê´€ê³„(Relational) ì •ì˜
    â†“
Hibernate: ë§¤í•‘(Mapping) ê¸°ë°˜ SQL ìë™ ìƒì„± ë° ì‹¤í–‰
    â†“
Database: í…Œì´ë¸”ì—ì„œ ë°ì´í„° ì €ì¥/ì¡°íšŒ
```

**í•µì‹¬**: í…Œì´ë¸”ì„ ìƒê°í•˜ì§€ ì•Šê³  **ê°ì²´ë§Œ ìƒê°**í•˜ë©´ ëœë‹¤!

---

#### JPA, Hibernate, Spring Data JPAì˜ ê´€ê³„

**ë¬¸ì œ**: JPAëŠ” ì¸í„°í˜ì´ìŠ¤ì¼ ë¿ êµ¬í˜„ì²´ê°€ ì•„ë‹™ë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**:

| ê³„ì¸µ | ì—­í•  | ì œê³µì |
|-----|------|--------|
| **JPA (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)** | ORMì˜ í‘œì¤€ ëª…ì„¸ ì •ì˜ | Oracle (Java í‘œì¤€) |
| **Hibernate** | JPAì˜ ì‹¤ì œ êµ¬í˜„ì²´ | ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ |
| **Spring Data JPA** | Hibernateë¥¼ Springì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ í†µí•© | Spring |

**êµ¬ì¡°**:
```
ê°œë°œì
  â†“
Spring Data JPA (í¸ì˜ ê³„ì¸µ)
  â†“
Hibernate (êµ¬í˜„ì²´)
  â†“
JPA (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)
  â†“
JDBC Driver
  â†“
Database
```

---

### 3.4.2 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± (build.gradle)

```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

**ì£¼ìš” ì˜ì¡´ì„±**:
- `spring-boot-starter-data-jpa`: Spring Data JPA + Hibernate í†µí•©
- `mysql-connector-j`: MySQL JDBC Driver (JPAëŠ” JDBCë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘)

---

#### ì„¤ì • íŒŒì¼ (application.properties)

```properties
spring.application.name=jpaHibernateSample

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° (MySQL)
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass

# DDL ê´€ë¦¬ ì „ëµ
spring.jpa.hibernate.ddl-auto=create

# SQL ë¡œê¹… í™œì„±í™” (ê°œë°œìš©)
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.highlight_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
```

#### ì„¤ì • íŒŒì¼ ìƒì„¸ ì„¤ëª…

##### `spring.jpa.hibernate.ddl-auto` - DDL ê´€ë¦¬ ì „ëµ

ì´ ì†ì„±ì€ **Hibernate**ì˜ ê¸°ëŠ¥ìœ¼ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì—”í‹°í‹° ì •ì˜ì™€ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ **ì–´ë–»ê²Œ ë™ê¸°í™”**í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.

| ì „ëµ | ë™ì‘ | ìš©ë„ |
|-----|------|------|
| **`create`** | ì‹œì‘ ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ(`DROP`) â†’ ì—”í‹°í‹° ê¸°ë°˜ ìƒˆë¡œ ìƒì„±(`CREATE`) | ê°œë°œ ì´ˆê¸°, í…ŒìŠ¤íŠ¸ í™˜ê²½ |
| **`create-drop`** | `create`ì™€ ë™ì¼í•˜ê²Œ ìƒì„± í›„, ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ ì¢…ë£Œ ì‹œ í…Œì´ë¸” ì‚­ì œ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸ |
| **`update`** | ê¸°ì¡´ í…Œì´ë¸” ìœ ì§€í•˜ë©° ì—”í‹°í‹°ì™€ì˜ ì°¨ì´ì ë§Œ ë°˜ì˜ (ì»¬ëŸ¼ ì¶”ê°€ëŠ” í•¨, ì‚­ì œëŠ” ì•ˆ í•¨) | ê°œë°œ í™˜ê²½ (ë°ì´í„° ìœ ì§€) |
| **`validate`** | ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ ì—”í‹°í‹° ê²€ì¦ë§Œ ìˆ˜í–‰, DDL ì‘ì—… ì—†ìŒ | ìŠ¤í…Œì´ì§•, ìš´ì˜ í™˜ê²½ |
| **`none`** | DDL ì‘ì—… ì™„ì „íˆ ìˆ˜í–‰ ì•ˆ í•¨ | ìš´ì˜ í™˜ê²½ |

**ìš´ì˜ í™˜ê²½ì—ì„œ `validate` ë˜ëŠ” `none` ì‚¬ìš© ì´ìœ **:
```
ìš´ì˜ ì¤‘ì¸ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê³ ê° ë°ì´í„°, ê±°ë˜ ê¸°ë¡ ë“± ë§¤ìš° ì¤‘ìš”í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
ìë™ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
í…Œì´ë¸” êµ¬ì¡°ë¥¼ ê°œë°œìê°€ Migration íˆ´ë¡œ ìˆ˜ë™ ê´€ë¦¬í•©ë‹ˆë‹¤.
```

---

##### SQL ë¡œê¹… ì„¤ì •

```properties
spring.jpa.show-sql=true                          # SQL ì¶œë ¥ í™œì„±í™”
spring.jpa.properties.hibernate.format_sql=true   # SQL ì¤„ë°”ê¿ˆ ë° ë“¤ì—¬ì“°ê¸°
spring.jpa.properties.hibernate.highlight_sql=true # ìƒ‰ìƒ ê°•ì¡° (IDE ì§€ì› ì‹œ)
spring.jpa.properties.hibernate.use_sql_comments=true # ì¿¼ë¦¬ ì£¼ì„ ì¶”ê°€
```

**ëª©ì **: ìƒì„±ëœ SQLì„ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥í•˜ì—¬ **ë””ë²„ê¹… ë° í…ŒìŠ¤íŠ¸ íš¨ìœ¨ì„± í–¥ìƒ**

---

### 3.4.3 ì—”í‹°í‹° í´ë˜ìŠ¤ (Entity) - ê°€ì¥ ì¤‘ìš”!

#### Member ì—”í‹°í‹°

```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(
    name = "vip_table",
    indexes = {
        @Index(name = "idx_name", columnList = "display_name, age"),
        @Index(name = "idx_email", columnList = "primary_contact")
    }
)
@Builder
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Member {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "display_name", length = 2048, nullable = false, unique = true)
    private String name;
    
    @Column(name = "primary_contact")
    private String email;
    
    private Integer age;
    
    @Transient
    private String address;
}
```

---

#### í•µì‹¬ ì–´ë…¸í…Œì´ì…˜ ìƒì„¸ ì„¤ëª…

##### `@Entity` - í…Œì´ë¸” ë§¤í•‘ ì„ ì–¸

```java
@Entity
public class Member { ... }
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì—­í• ** | ì´ Java í´ë˜ìŠ¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” **ì—”í‹°í‹°(Entity)**ì„ì„ JPAì— ì„ ì–¸ |
| **ì˜ë¯¸** | í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ = í…Œì´ë¸”ì˜ í•œ ë ˆì½”ë“œ(í–‰) |
| **ìë™ ì²˜ë¦¬** | Hibernateê°€ ì´ í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í…Œì´ë¸” ìë™ ìƒì„± (DDL ì„¤ì •ì— ë”°ë¼) |

**Spring Data JDBCì™€ì˜ ë¹„êµ**:

| í•­ëª© | Spring Data JDBC | JPA |
|-----|-----------------|-----|
| **ë§¤í•‘ ì„ ì–¸** | `@Table` | `@Entity` |
| **í…Œì´ë¸” ìƒì„±** | ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± ë¯¸ì§€ì› | **DDL ìë™ ìƒì„±** â­ |
| **í…Œì´ë¸”-í´ë˜ìŠ¤ ë™ê¸°í™”** | ìˆ˜ë™ (ë§¤ë²ˆ ì¼ì¹˜ì‹œì¼œì•¼ í•¨) | **ìë™** (ì—”í‹°í‹° ê¸°ì¤€) |
| **ì—°ê´€ê´€ê³„ í‘œí˜„** | ì œí•œì  | **ê°•ë ¥í•œ ì§€ì›** â­ |

---

##### `@Table` - í…Œì´ë¸” ìƒì„¸ ë§¤í•‘

```java
@Table(
    name = "vip_table",
    indexes = {
        @Index(name = "idx_name", columnList = "display_name, age")
    }
)
```

| ì†ì„± | ì—­í•  |
|-----|------|
| **`name`** | ì—”í‹°í‹°ê°€ ë§¤í•‘ë  í…Œì´ë¸”ì˜ ì‹¤ì œ ì´ë¦„ (ìƒëµ ì‹œ í´ë˜ìŠ¤ ì´ë¦„ ì‚¬ìš©) |
| **`indexes`** | í…Œì´ë¸”ì— ìƒì„±í•  ì¸ë±ìŠ¤ ëª©ë¡ |

##### `@Index` - ì¸ë±ìŠ¤ ì •ì˜

```java
@Index(name = "idx_name", columnList = "display_name, age")
```

| ì†ì„± | ê°’ | ì˜ë¯¸ |
|-----|-----|------|
| **`name`** | `"idx_name"` | DBì— ìƒì„±ë  ì¸ë±ìŠ¤ì˜ ì´ë¦„ (ê´€ë¦¬ ëª©ì ) |
| **`columnList`** | `"display_name, age"` | ì¸ë±ìŠ¤ë¥¼ êµ¬ì„±í•  **DB ì»¬ëŸ¼ëª…** (Java í•„ë“œëª… ì•„ë‹˜!) |

**âš ï¸ ì£¼ì˜**: columnListì—ëŠ” **ë°˜ë“œì‹œ `@Column(name="...")ì— ì§€ì •í•œ DB ì»¬ëŸ¼ëª…**ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**ì˜ëª»ëœ ì˜ˆ**:
```java
@Index(name = "idx_name", columnList = "name, age")  // âŒ Java í•„ë“œëª… ì‚¬ìš©
```

**ì˜¬ë°”ë¥¸ ì˜ˆ**:
```java
@Index(name = "idx_name", columnList = "display_name, age")  // âœ… DB ì»¬ëŸ¼ëª… ì‚¬ìš©
```

---

##### `@Id` - ê¸°ë³¸ í‚¤ ì§€ì •

```java
@Id
private Long id;
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì—­í• ** | í•´ë‹¹ í•„ë“œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ **ê¸°ë³¸ í‚¤(Primary Key)**ë¡œ ì§€ì • |
| **ì˜ë¯¸** | ê° ë ˆì½”ë“œë¥¼ ìœ ì¼í•˜ê²Œ ì‹ë³„í•˜ëŠ” í•„ë“œ |
| **í•„ìˆ˜** | ëª¨ë“  `@Entity`ëŠ” ë°˜ë“œì‹œ í•˜ë‚˜ì˜ `@Id`ë¥¼ ê°€ì ¸ì•¼ í•¨ |

---

##### `@GeneratedValue` - ID ìƒì„± ì „ëµ

```java
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
```

**ì—­í• **: ê¸°ë³¸ í‚¤ ê°’ì´ **ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë°©ì‹**ì„ ì§€ì •í•©ë‹ˆë‹¤.

| ì „ëµ | `GenerationType` | ID ìƒì„± ì£¼ì²´ | ë™ì‘ ìˆœì„œ |
|-----|-----------------|-----------|---------|
| **IDENTITY** | `IDENTITY` | ë°ì´í„°ë² ì´ìŠ¤ | 1. INSERT ì‹¤í–‰ 2. DBê°€ ID ìƒì„± 3. IDë¥¼ ê°ì²´ì— ë°˜ì˜ |
| **SEQUENCE** | `SEQUENCE` | ë°ì´í„°ë² ì´ìŠ¤ | 1. ID ë¯¸ë¦¬ ìš”ì²­ 2. IDë¥¼ ê°ì²´ì— ë°˜ì˜ 3. INSERT ì‹¤í–‰ |
| **TABLE** | `TABLE` | JPA/ì• í”Œë¦¬ì¼€ì´ì…˜ | 1. ê´€ë¦¬ í…Œì´ë¸” ì¡°íšŒ 2. ID ìƒì„± 3. INSERT ì‹¤í–‰ |
| **AUTO** | `AUTO` | JPA (DBì— ë§ì¶° ì„ íƒ) | DB ì¢…ë¥˜ì— ë”°ë¼ `IDENTITY` ë˜ëŠ” `SEQUENCE` ìë™ ì„ íƒ |

**ê° ì „ëµì˜ íŠ¹ì§•**:

- **IDENTITY**: MySQL, PostgreSQLì—ì„œ ì£¼ë¡œ ì‚¬ìš©. ê°„ë‹¨í•˜ì§€ë§Œ ID ì¦‰ì‹œ í™•ë³´ ë¶ˆê°€
- **SEQUENCE**: Oracle, PostgreSQLì—ì„œ ì£¼ë¡œ ì‚¬ìš©. ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™” ê°€ëŠ¥
- **AUTO** (ê¶Œì¥): ê°œë°œìê°€ DB ì¢…ë¥˜ë¥¼ ì‹ ê²½ ì“¸ í•„ìš” ì—†ìŒ

**save() í˜¸ì¶œ í›„ ID ìë™ ë°˜ì˜ ì˜ˆì‹œ**:

```java
Member member = Member.builder()
                      .name("í˜œì°½")
                      .email("hyechang@spring.ac.kr")
                      .age(20)
                      .build();

System.out.println(member.getId());  // null (ì•„ì§ ì €ì¥ ì•ˆ ë¨)

memberRepository.save(member);       // INSERT ì‹¤í–‰, ID ìë™ ìƒì„± ë° ë°˜ì˜

System.out.println(member.getId());  // 1 (DBê°€ ìë™ ìƒì„±í•œ ID í¬í•¨)
```

---

##### `@Column` - ì»¬ëŸ¼ ìƒì„¸ ë§¤í•‘

```java
@Column(name = "display_name", length = 2048, nullable = false, unique = true)
private String name;
```

| ì†ì„± | ê°’ | ì—­í•  |
|-----|-----|------|
| **`name`** | `"display_name"` | Java í•„ë“œëª…ê³¼ DB ì»¬ëŸ¼ëª…ì„ ë‹¤ë¥´ê²Œ ì§€ì • (Java: `name` â†’ DB: `display_name`) |
| **`length`** | `2048` | VARCHAR ì»¬ëŸ¼ì˜ ìµœëŒ€ ê¸¸ì´ (ìƒëµ ì‹œ ê¸°ë³¸ê°’ 255) |
| **`nullable`** | `false` | `NOT NULL` ì œì•½ì¡°ê±´ (NULL ê°’ í—ˆìš© ì•ˆ í•¨) |
| **`unique`** | `true` | `UNIQUE` ì œì•½ì¡°ê±´ (ì¤‘ë³µ ê°’ í—ˆìš© ì•ˆ í•¨) |

**ìƒëµ ì‹œ ê¸°ë³¸ ë™ì‘**:
```java
private String email;  // @Column ìƒëµ

// ê¸°ë³¸ ë§¤í•‘:
// - DB ì»¬ëŸ¼ëª…: email (í•„ë“œëª…ê³¼ ë™ì¼)
// - nullable: true (NULL í—ˆìš©)
// - length: 255 (VARCHAR ê¸°ë³¸ê°’)
```

---

##### `@Transient` - ë°ì´í„°ë² ì´ìŠ¤ ë§¤í•‘ ì œì™¸

```java
@Transient
private String address;
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì—­í• ** | í•´ë‹¹ í•„ë“œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ ë§¤í•‘ì—ì„œ ì œì™¸ |
| **ì˜ë¯¸** | DB í…Œì´ë¸”ì— ì»¬ëŸ¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ |
| **ìš©ë„** | ì„ì‹œ ê°’, ê³„ì‚°ëœ ê°’, ì„¸ì…˜ ì •ë³´ ë“± **ë©”ëª¨ë¦¬ì—ë§Œ í•„ìš”í•œ ë°ì´í„°** |

**ë™ì‘**:
```java
member.setAddress("ì„œìš¸ì‹œ ê°•ë‚¨êµ¬");  // ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë¨
memberRepository.save(member);      // addressëŠ” INSERTì— í¬í•¨ë˜ì§€ ì•ŠìŒ

Member loaded = memberRepository.findById(1L).orElse(null);
System.out.println(loaded.getAddress());  // null (DBì—ì„œ ë¡œë“œí•œ ê²ƒì´ë¯€ë¡œ)
```

---

#### ìƒì„±ë˜ëŠ” DDL (SQL)

ìœ„ Member ì—”í‹°í‹°ë¡œë¶€í„° ìë™ ìƒì„±ë˜ëŠ” í…Œì´ë¸”:

```sql
CREATE TABLE vip_table (
    age INTEGER,
    id BIGINT NOT NULL AUTO_INCREMENT,
    display_name VARCHAR(2048) NOT NULL,
    primary_contact VARCHAR(255),
    PRIMARY KEY (id),
    UNIQUE KEY (display_name),
    INDEX idx_name (display_name, age),
    INDEX idx_email (primary_contact)
) ENGINE=InnoDB;
```

---

### 3.4.4 JPA Auditing (ë¦¬ìŠ¤ë„ˆ) - ìë™ ì‹œê°„ ê¸°ë¡

#### ê°œë…

**ë¦¬ìŠ¤ë„ˆ(Listener)**ëŠ” íŠ¹ì • **ì´ë²¤íŠ¸(Event)**ê°€ ë°œìƒí•˜ë©´ ë¯¸ë¦¬ ì •ì˜ëœ **ì•¡ì…˜(Action)**ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

**ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸**:

| ì´ë²¤íŠ¸ | ì‹œì  | ì˜ˆì‹œ |
|-------|------|------|
| **Persist** | ê°ì²´ê°€ ì²˜ìŒ ì €ì¥ë  ë•Œ | `save()` í˜¸ì¶œ |
| **Update** | ê°ì²´ê°€ ë³€ê²½ë  ë•Œ | `save()` ì¬í˜¸ì¶œ |
| **Remove** | ê°ì²´ê°€ ì‚­ì œë  ë•Œ | `delete()` í˜¸ì¶œ |

**JPA Auditing**: `Persist`ì™€ `Update` ì´ë²¤íŠ¸ì— ë°˜ì‘í•˜ì—¬ **ìƒì„± ì‹œê°„, ìˆ˜ì • ì‹œê°„ì„ ìë™ ê¸°ë¡**

---

#### ë‹¨ê³„ 1: Auditing í™œì„±í™” (ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜)

```java
package com.example.jpaHibernateSample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

@SpringBootApplication
@EnableJpaAuditing
public class JpaHibernateSampleApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(JpaHibernateSampleApplication.class, args);
    }
}
```

**`@EnableJpaAuditing`ì˜ ì—­í• **: ìŠ¤í”„ë§ì—ê²Œ "ì—”í‹°í‹° ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ë¥¼ ê°ì‹œí•˜ê² ë‹¤"ëŠ” ì„ ì–¸

---

#### ë‹¨ê³„ 2: ì—”í‹°í‹°ì— ë¦¬ìŠ¤ë„ˆ ë¶€ì°©

```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;
import java.time.LocalDateTime;

@Entity
@EntityListeners(AuditingEntityListener.class)
public class Article {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String title;
    private String content;
    
    @CreatedDate
    private LocalDateTime created;
    
    @LastModifiedDate
    private LocalDateTime updated;
}
```

| ì–´ë…¸í…Œì´ì…˜ | ì—­í•  |
|-----------|------|
| **`@EntityListeners`** | "ì´ ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ë¥¼ `AuditingEntityListener`ì—ê²Œ ì „ë‹¬í•˜ë¼" |
| **`@CreatedDate`** | Persist ì´ë²¤íŠ¸ ì‹œ **í˜„ì¬ ì‹œê°**ì„ ìë™ ê¸°ë¡ (ì´í›„ ë³€ê²½ ì•ˆ í•¨) |
| **`@LastModifiedDate`** | Persist ì´ë²¤íŠ¸ì™€ Update ì´ë²¤íŠ¸ ì‹œ **í˜„ì¬ ì‹œê°**ì„ ìë™ ê¸°ë¡ (ë§¤ë²ˆ ê°±ì‹ ) |

---

#### Auditing ë™ì‘ ì›ë¦¬

```
1. @EnableJpaAuditing í™œì„±í™”
   â†“
2. @EntityListeners(AuditingEntityListener.class) ê°ì‹œ ì‹œì‘
   â†“
3. articleRepository.save(newArticle) í˜¸ì¶œ (Persist ì´ë²¤íŠ¸)
   â†“
4. AuditingEntityListenerê°€ ì´ë²¤íŠ¸ ê°ì§€
   â†“
5. @CreatedDate í•„ë“œì— í˜„ì¬ ì‹œê° ì£¼ì…
5. @LastModifiedDate í•„ë“œì— í˜„ì¬ ì‹œê° ì£¼ì…
   â†“
6. INSERT SQL ì‹¤í–‰ (ì‹œê°„ ì •ë³´ í¬í•¨)
   â†“
7. ë‚˜ì¤‘ì— article.setTitle("ë³€ê²½") í›„ save() í˜¸ì¶œ (Update ì´ë²¤íŠ¸)
   â†“
8. @LastModifiedDateë§Œ ê°±ì‹ , @CreatedDateëŠ” ìœ ì§€
   â†“
9. UPDATE SQL ì‹¤í–‰
```

**ì˜ˆì‹œ**:

```java
Article article = Article.builder()
                         .title("ì²« ê¸€")
                         .content("ë‚´ìš©")
                         .build();

articleRepository.save(article);
// created: 2025-01-15 10:30:45
// updated: 2025-01-15 10:30:45

// ì¼ì£¼ì¼ í›„...
article.setTitle("ì œëª© ìˆ˜ì •");
articleRepository.save(article);
// created: 2025-01-15 10:30:45 (ë³€ê²½ ì•ˆ ë¨)
// updated: 2025-01-22 14:15:20 (ê°±ì‹ ë¨)
```

---

### 3.4.5 Repository ì¸í„°í˜ì´ìŠ¤

#### MemberRepository

```java
package com.example.jpaHibernateSample.repository;

import com.example.jpaHibernateSample.Member;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    // ê¸°ë³¸ CRUD ë©”ì„œë“œëŠ” JpaRepositoryê°€ ì œê³µ
    // í•„ìš”ì— ë”°ë¼ ì»¤ìŠ¤í…€ ë©”ì„œë“œ ì¶”ê°€
}
```

#### Spring Data JPAê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ë©”ì„œë“œ

| ë©”ì„œë“œ | ë°˜í™˜ íƒ€ì… | ì—­í•  |
|-------|---------|------|
| `save(entity)` | `T` | INSERT ë˜ëŠ” UPDATE |
| `findById(id)` | `Optional<T>` | IDë¡œ ì¡°íšŒ |
| `findAll()` | `List<T>` | ì „ì²´ ì¡°íšŒ |
| `existsById(id)` | `boolean` | ì¡´ì¬ ì—¬ë¶€ í™•ì¸ |
| `count()` | `long` | ì „ì²´ ê°œìˆ˜ |
| `deleteById(id)` | `void` | IDë¡œ ì‚­ì œ |
| `delete(entity)` | `void` | ì—”í‹°í‹° ì‚­ì œ |
| `deleteAll()` | `void` | ì „ì²´ ì‚­ì œ |

**ì½”ë“œ ì‘ì„± ì—†ì´ ëª¨ë‘ ìë™ êµ¬í˜„!**

---

#### MySQL vs H2 - ì½”ë“œ ë³€ê²½ í•„ìš” ì—†ìŒ!

**H2 ì‚¬ìš© ì‹œ**:
```gradle
runtimeOnly 'com.h2database:h2'
```

```properties
# spring.datasource.url ì„¤ì • ë¶ˆí•„ìš” (ìë™ ìƒì„±)
# ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ DB ì‚¬ìš©
spring.jpa.hibernate.ddl-auto=create-drop
```

**MySQL ì‚¬ìš© ì‹œ**:
```gradle
runtimeOnly 'com.mysql:mysql-connector-j'
```

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass
spring.jpa.hibernate.ddl-auto=create
```

**ì¤‘ìš”**: ì„¤ì • íŒŒì¼ê³¼ ì˜ì¡´ì„±ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤! **ì—”í‹°í‹° ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ!**

---

### 3.4.6 ê¸°ë³¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

```java
package com.example.jpaHibernateSample;

import com.example.jpaHibernateSample.repository.MemberRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

@Component
@RequiredArgsConstructor
@Slf4j
public class JpaApplication implements ApplicationRunner {
    
    private final MemberRepository memberRepository;
    
    @Override
    public void run(ApplicationArguments args) throws Exception {
        memberRepository.save(
            Member.builder()
                  .name("hyechang")
                  .email("hyechang@spring.ac.kr")
                  .age(20)
                  .build()
        );
        
        memberRepository.save(
            Member.builder()
                  .name("woohyun")
                  .email("woohyun@spring.ac.kr")
                  .age(25)
                  .build()
        );
    }
}
```

**ê²°ê³¼** (DBeaverì—ì„œ í™•ì¸):
```
id | display_name | primary_contact          | age
1  | hyechang     | hyechang@spring.ac.kr    | 20
2  | woohyun      | woohyun@spring.ac.kr     | 25
```

**í•µì‹¬**: **SQLì„ í•œ ì¤„ë„ ì‘ì„±í•˜ì§€ ì•Šì•˜ëŠ”ë° ë°ì´í„°ê°€ ì €ì¥ë¨!** ì´ê²ƒì´ JPAì˜ ê°€ì¥ í° ì¥ì ì…ë‹ˆë‹¤.

---

### 3.4.7 ì¿¼ë¦¬ ë©”ì„œë“œ (Query Method)

Spring Data JPAëŠ” **ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„**í•˜ì—¬ ìë™ìœ¼ë¡œ JPQLì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤. (Spring Data JDBCì™€ ê·œì¹™ì´ ë™ì¼í•©ë‹ˆë‹¤)

#### ê¸°ë³¸ ê·œì¹™

| íŒ¨í„´ | ì˜ˆì‹œ | ìƒì„±ë˜ëŠ” JPQL |
|-----|------|-------------|
| `findBy<í•„ë“œ>` | `findByName(String name)` | `select m from Member m where m.name = :name` |
| `findBy<í•„ë“œ>And<í•„ë“œ>` | `findByNameAndAge(String name, int age)` | `where m.name = :name and m.age = :age` |
| `findBy<í•„ë“œ>Or<í•„ë“œ>` | `findByNameOrEmail(String name, String email)` | `where m.name = :name or m.email = :email` |
| `findBy<í•„ë“œ>GreaterThan` | `findByAgeGreaterThan(int age)` | `where m.age > :age` |
| `findBy<í•„ë“œ>LessThan` | `findByAgeLessThan(int age)` | `where m.age < :age` |
| `findBy<í•„ë“œ>Between` | `findByAgeBetween(int min, int max)` | `where m.age between :min and :max` |
| `findBy<í•„ë“œ>Containing` | `findByNameContaining(String part)` | `where m.name like %:part%` |
| `findBy<í•„ë“œ>StartingWith` | `findByNameStartingWith(String prefix)` | `where m.name like :prefix%` |
| `findBy<í•„ë“œ>IsNull` | `findByEmailIsNull()` | `where m.email is null` |
| `findBy<í•„ë“œ>OrderBy<í•„ë“œ>Asc` | `findByAgeGreaterThanOrderByNameAsc(int age)` | `where m.age > :age order by m.name asc` |

#### MemberRepository ì˜ˆì‹œ

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    List<Member> findByName(String name);
    
    List<Member> findByNameAndAge(String name, int age);
    
    List<Member> findByAgeGreaterThan(int age);
    
    List<Member> findByNameContaining(String name);
    
    List<Member> findByAgeBetween(int min, int max);
    
    Member findFirstByOrderByIdDesc();
}
```

---

### 3.4.8 ì •ë ¬ (Sort)

#### ë¬¸ì œ: ë©”ì„œë“œ ì´ë¦„ì— ì •ë ¬ ì¡°ê±´ì„ í•˜ë“œì½”ë”©?

```java
// ì´ëŸ° ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜?
List<Member> findByAgeGreaterThanOrderByNameAsc(int age);
List<Member> findByAgeGreaterThanOrderByNameDesc(int age);
List<Member> findByAgeGreaterThanOrderByAgeAsc(int age);
// ... ëª¨ë“  ì¡°í•©ì„ ë§Œë“¤ì–´ì•¼ í•¨ âŒ
```

#### í•´ê²°: Sort ê°ì²´ë¡œ ë™ì  ì •ë ¬

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    List<Member> findByAgeGreaterThan(int age, Sort sort);
    
    List<Member> findByNameContaining(String name, Sort sort);
}
```

#### Sort ê°ì²´ ìƒì„± ë° ì‚¬ìš©

**ë°©ë²• 1: Sort.Order ë°°ì—´ (ë‹¤ì¤‘ ì •ë ¬ ê¸°ì¤€, ëª…ì‹œì )**

```java
Sort sort = Sort.by(
    Sort.Order.asc("name"),   // 1ì°¨: name ì˜¤ë¦„ì°¨ìˆœ
    Sort.Order.desc("age")    // 2ì°¨: age ë‚´ë¦¼ì°¨ìˆœ
);

List<Member> members = memberRepository.findByAgeGreaterThan(20, sort);
```

**ë°©ë²• 2: Sort.Directionê³¼ properties (ë‹¨ì¼ ë°©í–¥)**

```java
Sort sort = Sort.by(
    Sort.Direction.DESC,  // ëª¨ë“  í•„ë“œë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ
    "age", "name"         // age â†’ name ìˆœì„œë¡œ ì •ë ¬
);

List<Member> members = memberRepository.findByNameContaining("hyechang", sort);
```

**Sort ìƒì„± ìš”ì•½**:
```java
// ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ Sort.by()ë¥¼ ì‚¬ìš©
Sort sort = Sort.by(Sort.Order... orders);

// Sort.Order ìƒì„±
Sort.Order.asc("fieldName");    // ì˜¤ë¦„ì°¨ìˆœ
Sort.Order.desc("fieldName");   // ë‚´ë¦¼ì°¨ìˆœ
```

---

### 3.4.9 í˜ì´ì§€ë„¤ì´ì…˜ (Pageable)

#### ë¬¸ì œ: ì „ì²´ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì¡°íšŒ?

í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ìˆ˜ë°±ë§Œ ê°œì˜ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë³´ì—¬ì¤„ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. **í˜ì´ì§€ ë‹¨ìœ„**ë¡œ ë‚˜ëˆ„ì–´ ì „ë‹¬í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.

#### í•´ê²°: Pageable ê°ì²´

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    Page<Member> findByNameContaining(String name, Pageable pageable);
}
```

#### Pageable ê°ì²´ ìƒì„±

```java
// PageRequest.of(í˜ì´ì§€ë²ˆí˜¸, í˜ì´ì§€í¬ê¸°, ì •ë ¬ì •ë³´)
Pageable pageable = PageRequest.of(0, 20, Sort.by(Sort.Direction.DESC, "id"));

Page<Member> page = memberRepository.findByNameContaining("hyechang", pageable);
```

#### Page ê°ì²´ê°€ ì œê³µí•˜ëŠ” ì •ë³´

```java
page.getContent();          // List<Member> - í˜„ì¬ í˜ì´ì§€ì˜ ì‹¤ì œ ë°ì´í„°
page.getTotalElements();    // long - ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì „ì²´ ë°ì´í„° ê°œìˆ˜
page.getTotalPages();       // int - ì „ì²´ í˜ì´ì§€ ìˆ˜
page.getNumber();           // int - í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)
page.getSize();             // int - í˜ì´ì§€ë‹¹ ë°ì´í„° ê°œìˆ˜
page.hasNext();             // boolean - ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
page.hasPrevious();         // boolean - ì´ì „ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
page.isFirst();             // boolean - ì²« í˜ì´ì§€ì¸ì§€ ì—¬ë¶€
page.isLast();              // boolean - ë§ˆì§€ë§‰ í˜ì´ì§€ì¸ì§€ ì—¬ë¶€
```

**ì‚¬ìš© ì˜ˆì‹œ**:

```java
Pageable pageable = PageRequest.of(0, 10);  // ì²« ë²ˆì§¸ í˜ì´ì§€, 10ê°œ í•­ëª©
Page<Member> page = memberRepository.findAll(pageable);

System.out.println("ì „ì²´ ë°ì´í„°: " + page.getTotalElements());
System.out.println("ì „ì²´ í˜ì´ì§€: " + page.getTotalPages());
System.out.println("í˜„ì¬ í˜ì´ì§€: " + page.getNumber());
System.out.println("ë°ì´í„° ê°œìˆ˜: " + page.getContent().size());

page.getContent().forEach(member -> System.out.println(member));
```

---

### 3.4.10 ë™ì  ì¿¼ë¦¬ (Example)

#### ë¬¸ì œ: ëª¨ë“  ê²€ìƒ‰ ì¡°ê±´ ì¡°í•©ì˜ ë©”ì„œë“œ í•„ìš”?

```java
// ì´ë¦„ë§Œ ê²€ìƒ‰
List<Member> findByName(String name);

// ë‚˜ì´ë§Œ ê²€ìƒ‰
List<Member> findByAge(int age);

// ì´ë¦„ê³¼ ë‚˜ì´
List<Member> findByNameAndAge(String name, int age);

// ì´ë¦„, ë‚˜ì´, ì´ë©”ì¼
List<Member> findByNameAndAgeAndEmail(String name, int age, String email);

// ... ëª¨ë“  ì¡°í•©ì„ ì‘ì„±í•´ì•¼ í•¨ âŒ
```

#### í•´ê²°: Example ê°ì²´ (ë™ì  ì¡°ê±´)

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    // Exampleì„ ë°›ëŠ” ê¸°ë³¸ ë©”ì„œë“œëŠ” JpaRepositoryê°€ ì œê³µí•¨
    <S extends Member> List<S> findAll(Example<Member> example);
}
```

#### Example ì‚¬ìš© ë°©ë²•

```java
// 1ë‹¨ê³„: ê²€ìƒ‰ ì¡°ê±´ì´ ë‹´ê¸´ ì—”í‹°í‹° ê°ì²´ ìƒì„± (probe)
Member probe = Member.builder()
                     .name("hyechang")
                     .age(20)
                     .build();

// 2ë‹¨ê³„: ë§¤ì¹­ ë°©ì‹ ì •ì˜
ExampleMatcher matcher = ExampleMatcher.matchingAll();  // AND ì¡°ê±´

// 3ë‹¨ê³„: Example ìƒì„±
Example<Member> example = Example.of(probe, matcher);

// 4ë‹¨ê³„: ì¿¼ë¦¬ ì‹¤í–‰
List<Member> results = memberRepository.findAll(example);
```

#### ExampleMatcher ì˜µì…˜

| ë©”ì„œë“œ | ì¡°ê±´ | ì„¤ëª… |
|-------|------|------|
| `matchingAll()` | AND | probeì˜ ëª¨ë“  í•„ë“œê°€ ì¼ì¹˜í•´ì•¼ í•¨ (ê¸°ë³¸ê°’) |
| `matchingAny()` | OR | probeì˜ í•„ë“œ ì¤‘ í•˜ë‚˜ë¼ë„ ì¼ì¹˜í•˜ë©´ ë¨ |

**ì˜ˆì‹œ**:

```java
// AND ì¡°ê±´: nameì´ "hyechang" AND ageê°€ 20
Member probe = Member.builder().name("hyechang").age(20).build();
ExampleMatcher matcher = ExampleMatcher.matchingAll();
List<Member> results = memberRepository.findAll(Example.of(probe, matcher));

// OR ì¡°ê±´: nameì´ "hyechang" OR ageê°€ 20
ExampleMatcher matcher = ExampleMatcher.matchingAny();
List<Member> results = memberRepository.findAll(Example.of(probe, matcher));
```

#### Exampleì˜ í•œê³„

**ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥**:
- í¬ê¸° ë¹„êµ (`>`, `<`, `>=`, `<=`)
- LIKE íŒ¨í„´ (ê¸°ë³¸ LIKEëŠ” ì§€ì›, ìƒì„¸í•œ íŒ¨í„´ ì„¤ì •ì€ ì œí•œì )

**ë³µì¡í•œ ì¡°ê±´ì´ í•„ìš”í•˜ë©´ JPQL ì‚¬ìš©**

---

### 3.4.11 JPQL (Java Persistence Query Language) - ê°€ì¥ ì¤‘ìš”!

#### JPQLì´ë€?

**JPQL**ì€ SQLê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, **ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì•„ë‹Œ Java ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒ**ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬ ì–¸ì–´ì…ë‹ˆë‹¤.

| í•­ëª© | SQL | JPQL |
|-----|-----|------|
| **ëŒ€ìƒ** | í…Œì´ë¸”, ì»¬ëŸ¼ | ì—”í‹°í‹° í´ë˜ìŠ¤, í•„ë“œ |
| **ì¿¼ë¦¬ ì˜ˆ** | `SELECT * FROM member WHERE name = ?` | `SELECT m FROM Member m WHERE m.name = :name` |
| **DB ì˜ì¡´ì„±** | ë†’ìŒ (DB ë°©ì–¸ì´ ë‹¤ë¥´ë©´ ìˆ˜ì • í•„ìš”) | ë‚®ìŒ (JPQLì€ ë™ì¼, Hibernateê°€ DBë³„ SQLë¡œ ë³€í™˜) |

**í•µì‹¬**: í…Œì´ë¸”ì„ ìƒê°í•˜ì§€ ë§ê³  **ì—”í‹°í‹° ê°ì²´**ë¥¼ ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤!

---

#### JPQL ë¬¸ë²• ê¸°ë³¸ ê·œì¹™

##### 1. ì—”í‹°í‹° ì´ë¦„ê³¼ ë³„ì¹­

```java
// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹
@Query("SELECT m FROM Member m WHERE m.name = :name")
Member findByName(@Param("name") String name);

// âŒ ì˜ëª»ëœ ë°©ì‹ (í…Œì´ë¸” ì´ë¦„ ì‚¬ìš©)
@Query("SELECT * FROM member WHERE name = :name")

// âŒ ì˜ëª»ëœ ë°©ì‹ (ë³„ì¹­ ì—†ìŒ)
@Query("SELECT Member FROM Member WHERE Member.name = :name")
```

**ê·œì¹™**:
- ì—”í‹°í‹° ì´ë¦„ì€ **ëŒ€ì†Œë¬¸ì êµ¬ë¶„** (`Member` â‰  `member`)
- **ë°˜ë“œì‹œ ë³„ì¹­ ì‚¬ìš©** (ì˜ˆ: `Member m`) - ASëŠ” ìƒëµ ê°€ëŠ¥ (`Member as m`)

##### 2. í•„ë“œ ì°¸ì¡°

```java
@Query("SELECT m.name, m.email FROM Member m")  // í•„ë“œ ì‚¬ìš©
@Query("SELECT m FROM Member m")                 // ì—”í‹°í‹° ì „ì²´ ì‚¬ìš©
```

---

#### JPQL ë°˜í™˜ íƒ€ì… ê·œì¹™ (ê°€ì¥ í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„!)

JPQLì˜ SELECT ì ˆì— **ë¬´ì—‡ì„ ì„ íƒí•˜ëŠëƒ**ì— ë”°ë¼ ë°˜í™˜ íƒ€ì…ì´ ê²°ì •ë©ë‹ˆë‹¤.

##### íŒ¨í„´ 1: ì—”í‹°í‹° ì „ì²´ ë°˜í™˜

```java
@Query("SELECT m FROM Member m WHERE m.id = :id")
Member findByIdJpql(@Param("id") Long id);

@Query("SELECT m FROM Member m")
List<Member> findAllJpql();
```

**ë™ì‘**:
```
SELECT m    â†’ Member ì—”í‹°í‹° ì „ì²´ ì„ íƒ
ê²°ê³¼: Member ê°ì²´ ë˜ëŠ” List<Member>
```

---

##### íŒ¨í„´ 2: í•„ë“œ ëª©ë¡ ë°˜í™˜ (Object[] ë°°ì—´)

```java
@Query("SELECT m.name, m.email, m.age FROM Member m")
List<Object[]> findMemberInfo();
```

**ë™ì‘**:
```
SELECT m.name, m.email, m.age
       â†“       â†“        â†“
     [0]     [1]     [2]

ê²°ê³¼: List<Object[]>
ê° ìš”ì†Œ: Object[] = {ì´ë¦„, ì´ë©”ì¼, ë‚˜ì´}

ì‚¬ìš©:
List<Object[]> results = findMemberInfo();
for (Object[] row : results) {
    String name = (String) row[0];
    String email = (String) row[1];
    int age = (int) row[2];
}
```

---

##### íŒ¨í„´ 3: DTO ê°ì²´ë¡œ ì§ì ‘ ë³€í™˜ (NEW ì—°ì‚°ì)

```java
// DTO í´ë˜ìŠ¤ ì •ì˜ (ë°˜ë“œì‹œ ìƒì„±ì í•„ìš”)
public class MemberDto {
    public MemberDto(String name, String email, int age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }
}

// JPQL - NEW ì—°ì‚°ì ì‚¬ìš©
@Query("SELECT new com.example.jpaHibernateSample.MemberDto(m.name, m.email, m.age) FROM Member m")
List<MemberDto> findMemberDtos();
```

**ê·œì¹™**:
- DTO í´ë˜ìŠ¤ëŠ” **ìƒì„±ìì˜ íŒŒë¼ë¯¸í„° ìˆœì„œ**ì™€ **JPQL SELECT í•­ëª© ìˆœì„œ**ê°€ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨
- íŒ¨í‚¤ì§€ëª….í´ë˜ìŠ¤ëª… **ì „ì²´ ê²½ë¡œ** ì‚¬ìš©

**ì‚¬ìš©**:
```java
List<MemberDto> results = findMemberDtos();
for (MemberDto dto : results) {
    System.out.println(dto.getName());
    System.out.println(dto.getEmail());
}
```

---

#### JPQL íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

```java
// `:ì´ë¦„` ë°©ì‹ (ê¶Œì¥)
@Query("SELECT m FROM Member m WHERE m.name = :name AND m.age = :age")
List<Member> findByNameAndAge(@Param("name") String name, @Param("age") int age);

// `?1, ?2` ìœ„ì¹˜ ë°©ì‹ (ë¹„ê¶Œì¥)
@Query("SELECT m FROM Member m WHERE m.name = ?1 AND m.age = ?2")
List<Member> findByNameAndAgePos(String name, int age);
```

**ê¶Œì¥ ì´ìœ **: `:name` ë°©ì‹ì´ ê°€ë…ì„±ì´ ì¢‹ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•©ë‹ˆë‹¤.

---

#### ë³µì¡í•œ JPQL ë¶„ì„ (LEFT JOIN, GROUP BY)

```java
@Query("SELECT m.name, m.email, COUNT(a.id) as articleCount " +
       "FROM Member m " +
       "LEFT JOIN Article a ON a.member = m " +
       "GROUP BY m " +
       "ORDER BY articleCount DESC")
List<Object[]> getMembersWithArticleCount();
```

**ìƒì„¸ ë¶„ì„**:

| ë¶€ë¶„ | ì„¤ëª… |
|-----|------|
| **`LEFT JOIN Article a ON a.member = m`** | Member ì—”í‹°í‹°(m)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Article ì—”í‹°í‹°(a)ì™€ LEFT JOIN. ì¡°ê±´: Articleì˜ member í•„ë“œê°€ í˜„ì¬ Memberë¥¼ ê°€ë¦¬í‚´ |
| **`GROUP BY m`** | Memberì˜ ëª¨ë“  í•„ë“œ(ê¸°ë³¸í‚¤ í¬í•¨)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”. (SQLì˜ `GROUP BY m.id`ì™€ ë™ì¼ ì˜ë¯¸) |
| **`COUNT(a.id)`** | ê° ê·¸ë£¹ì˜ Article ê°œìˆ˜ë¥¼ ì§‘ê³„í•¨ìˆ˜ë¡œ ê³„ì‚° |
| **`ORDER BY articleCount DESC`** | ê²Œì‹œê¸€ ë§ì€ ìˆœì„œëŒ€ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ |

**ë°˜í™˜ ë°ì´í„° êµ¬ì¡°**:
```
Object[0] = "hyechang"      (m.name)
Object[1] = "hyechang@..."  (m.email)
Object[2] = 5               (COUNT(a.id) = ê²Œì‹œê¸€ 5ê°œ)

List<Object[]> = [
    {"hyechang", "hyechang@...", 5},
    {"woohyun", "woohyun@...", 3},
    {"other", "other@...", 1}
]

ì‚¬ìš©:
for (Object[] row : getMembersWithArticleCount()) {
    String name = (String) row[0];
    String email = (String) row[1];
    long count = (long) row[2];
}
```

---

#### SELECT ì ˆì˜ ê·œì¹™ (GROUP BY ì‚¬ìš© ì‹œ)

JPQLë„ SQLê³¼ ë™ì¼í•œ ê·œì¹™ì„ ë”°ë¦…ë‹ˆë‹¤:

**SELECTì— ì˜¬ ìˆ˜ ìˆëŠ” í•­ëª©**:
- GROUP BY ê¸°ì¤€ì´ ë˜ëŠ” í•„ë“œ: `m.name`, `m.email` (ê·¸ë£¹ ê¸°ì¤€ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥)
- ì§‘ê³„í•¨ìˆ˜: `COUNT()`, `SUM()`, `AVG()`, `MAX()`, `MIN()` (í•„ìˆ˜ ì‚¬ìš©)

**SELECTì— ì˜¬ ìˆ˜ ì—†ëŠ” í•­ëª©**:
- GROUP BY ê¸°ì¤€ì´ ì•„ë‹Œ í•„ë“œ (ì˜ˆ: `a.id` - ì§‘ê³„í•¨ìˆ˜ ì—†ì´ ì‚¬ìš© ë¶ˆê°€)

---

### 3.4.12 JPQLì„ í†µí•œ ë°ì´í„° ë³€ê²½ (UPDATE, DELETE)

#### UPDATE

```java
@Modifying
@Transactional
@Query("UPDATE Member m SET m.age = :age WHERE m.id = :id")
int updateMemberAge(@Param("age") int age, @Param("id") Long id);
```

| ì–´ë…¸í…Œì´ì…˜ | ì—­í•  |
|-----------|------|
| **`@Modifying`** | ì´ ì¿¼ë¦¬ê°€ SELECTê°€ ì•„ë‹Œ ë°ì´í„° ë³€ê²½ ì¿¼ë¦¬(UPDATE/DELETE)ì„ì„ ì„ ì–¸ |
| **`@Transactional`** | ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ í•„ìˆ˜ |

**ì†ì„±** (ê°„ë‹¨íˆ ì•Œê¸°):
- `clearAutomatically = true`: ì¿¼ë¦¬ ì‹¤í–‰ í›„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
- `flushAutomatically = true`: ì¿¼ë¦¬ ì‹¤í–‰ ì „ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë™ê¸°í™”

---

#### DELETE

```java
@Modifying
@Transactional
@Query("DELETE FROM Member m WHERE m.age < :age")
int deleteYoungMembers(@Param("age") int age);
```

**ë°˜í™˜ê°’**: ì˜í–¥ë°›ì€ í–‰ì˜ ê°œìˆ˜ (int)

```java
int deleted = deleteYoungMembers(18);
System.out.println("ì‚­ì œëœ íšŒì›: " + deleted + "ëª…");
```

---

### 3.4.13 Native SQL (ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬)

#### í•„ìš”í•œ ê²½ìš°

JPQLë¡œëŠ” í‘œí˜„ ë¶ˆê°€ëŠ¥í•œ ë°ì´í„°ë² ì´ìŠ¤ íŠ¹í™” ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œ:
- MySQLì˜ `RAND()`, `GROUP_CONCAT()`
- Oracleì˜ `ROWNUM`
- ë³µì¡í•œ ìœˆë„ìš° í•¨ìˆ˜
- ì„±ëŠ¥ ìµœì í™”ëœ íŠ¹í™” SQL

#### ì‚¬ìš© ë°©ë²•

```java
@Query(
    value = "SELECT * FROM member ORDER BY RAND() LIMIT :limit",
    nativeQuery = true
)
List<Member> findRandomMembers(@Param("limit") int limit);
```

| ì†ì„± | ê°’ | ì˜ë¯¸ |
|-----|-----|------|
| **`value`** | SQL ë¬¸ìì—´ | í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª… ì‚¬ìš© (ì—”í‹°í‹° ì•„ë‹˜) |
| **`nativeQuery`** | `true` | ì´ ì¿¼ë¦¬ë¥¼ JPQLì´ ì•„ë‹Œ **ë„¤ì´í‹°ë¸Œ SQL**ë¡œ ì²˜ë¦¬ |

---

#### Native SQLê³¼ JPQL ë¹„êµ

| í•­ëª© | JPQL | Native SQL |
|-----|------|-----------|
| **ëŒ€ìƒ** | ì—”í‹°í‹°, í•„ë“œ | í…Œì´ë¸”, ì»¬ëŸ¼ |
| **ì¿¼ë¦¬ ì˜ˆ** | `SELECT m FROM Member m` | `SELECT * FROM member` |
| **DB ì˜ì¡´ì„±** | ë‚®ìŒ | ë†’ìŒ (DB ë°©ì–¸ì— ë”°ë¼ ìˆ˜ì • í•„ìš”) |
| **ê°€ë…ì„±** | ë†’ìŒ | ë‚®ìŒ |
| **ì„±ëŠ¥ ìµœì í™”** | ì œí•œì  | ê°•ë ¥ |
| **íŠ¹í™” ê¸°ëŠ¥** | ë¶ˆê°€ëŠ¥ | ê°€ëŠ¥ |

**ê¶Œì¥ì‚¬í•­**:
- ëŒ€ë¶€ë¶„ì˜ ì¿¼ë¦¬ëŠ” **JPQL ì‚¬ìš©**
- ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê±°ë‚˜ DB íŠ¹í™” ê¸°ëŠ¥ í•„ìš” ì‹œë§Œ **Native SQL ì‚¬ìš©**

---

### 3.4.14 ì™„ì „í•œ Repository ì˜ˆì‹œ

```java
package com.example.jpaHibernateSample.repository;

import com.example.jpaHibernateSample.Member;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;

@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    // 1. ì¿¼ë¦¬ ë©”ì„œë“œ
    List<Member> findByName(String name);
    
    List<Member> findByNameAndAge(String name, int age);
    
    List<Member> findByAgeGreaterThan(int age);
    
    List<Member> findByNameContaining(String namePart);
    
    // 2. ì •ë ¬ ì‚¬ìš©
    List<Member> findByAgeGreaterThan(int age, org.springframework.data.domain.Sort sort);
    
    // 3. í˜ì´ì§€ë„¤ì´ì…˜
    Page<Member> findByNameContaining(String namePart, Pageable pageable);
    
    // 4. JPQL - ì¡°íšŒ
    @Query("SELECT m FROM Member m WHERE m.name = :name")
    Optional<Member> findByNameJpql(@Param("name") String name);
    
    // 5. JPQL - ë³µì¡í•œ ì¿¼ë¦¬
    @Query("SELECT m.name, COUNT(m.id) FROM Member m GROUP BY m.name")
    List<Object[]> countMembersByName();
    
    // 6. JPQL - UPDATE
    @Modifying
    @Transactional
    @Query("UPDATE Member m SET m.age = :age WHERE m.id = :id")
    int updateAge(@Param("age") int age, @Param("id") Long id);
    
    // 7. Native SQL
    @Query(value = "SELECT * FROM vip_table WHERE age > :age", nativeQuery = true)
    List<Member> findOlderMembers(@Param("age") int age);
}
```

---

### 3.4.15 ì¿¼ë¦¬ ë©”ì„œë“œ vs JPQL vs Native SQL ì„ íƒ ê¸°ì¤€

| ìƒí™© | ì¶”ì²œ ë°©ë²• | ì´ìœ  |
|-----|---------|------|
| ë‹¨ìˆœí•œ CRUD (findBy, save, delete) | ì¿¼ë¦¬ ë©”ì„œë“œ | ì½”ë“œ ì‘ì„± ë¶ˆí•„ìš”, ê°€ë…ì„± ì¢‹ìŒ |
| ë‹¨ìˆœí•œ ê²€ìƒ‰ ì¡°ê±´ ì¡°í•© | ì¿¼ë¦¬ ë©”ì„œë“œ | ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¶©ë¶„ |
| ë³µì¡í•œ ì¡°ê±´ (JOIN, GROUP BY, ì§‘ê³„) | JPQL | DB ì˜ì¡´ì„± ë‚®ìŒ, ê°ì²´ ì¤‘ì‹¬ |
| ì„±ëŠ¥ ìµœì í™” í•„ìš” | Native SQL | ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥ |
| DB íŠ¹í™” í•¨ìˆ˜ í•„ìš” | Native SQL | ë¶ˆê°€í”¼í•œ ì„ íƒ |

---

### 3.4.16 ìš”ì•½: JPAì˜ í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… |
|-----|------|
| **@Entity** | ì—”í‹°í‹° í´ë˜ìŠ¤ ì„ ì–¸, DDL ìë™ ìƒì„± |
| **@Table** | í…Œì´ë¸” ë§¤í•‘, ì´ë¦„, ì¸ë±ìŠ¤ ì •ì˜ |
| **@Column** | ì»¬ëŸ¼ ë§¤í•‘, ì œì•½ì¡°ê±´ ì •ì˜ |
| **@Id + @GeneratedValue** | ê¸°ë³¸ í‚¤ ìë™ ìƒì„± |
| **@Transient** | DB ë§¤í•‘ ì œì™¸ |
| **JpaRepository** | ê¸°ë³¸ CRUD ìë™ ì œê³µ |
| **ì¿¼ë¦¬ ë©”ì„œë“œ** | ë©”ì„œë“œ ì´ë¦„ ê¸°ë°˜ ì¿¼ë¦¬ ìë™ ìƒì„± |
| **Sort + Pageable** | ë™ì  ì •ë ¬, í˜ì´ì§€ë„¤ì´ì…˜ |
| **@Query + JPQL** | ë³µì¡í•œ ì¿¼ë¦¬, ê°ì²´ ì¤‘ì‹¬ |
| **Native SQL** | DB íŠ¹í™” SQL, ì„±ëŠ¥ ìµœì í™” |
| **@EnableJpaAuditing** | ìë™ ì‹œê°„ ê¸°ë¡ (ìƒì„±, ìˆ˜ì •) |

---

