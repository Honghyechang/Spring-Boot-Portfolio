# 03_ë°ì´í„°ë² ì´ìŠ¤_ì—°ë™í•˜ê¸°

<!--
# ì²« ì‘ì„± (3.1 JDBC)
docs: [Ch03] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ - JDBC ì¶”ê°€

# ë‹¤ìŒ ì—…ë°ì´íŠ¸ (3.2, 3.3 ì¶”ê°€)
docs: [Ch03] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ - Spring Data JDBC, MyBatis ì¶”ê°€

# ë§ˆì§€ë§‰ ì™„ë£Œ (3.4, 3.5 ì¶”ê°€)
docs: [Ch03] ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ - JPA, MongoDB ì¶”ê°€ ë° ì™„ë£Œ

-->

## ğŸ“Œ í•™ìŠµ ëª©í‘œ
ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ì´í•´í•˜ê³ , ê° ë°©ì‹ì˜ íŠ¹ì§•ê³¼ ì‚¬ìš©ë²•ì„ ìµíŒë‹¤.

---

## ëª©ì°¨

- [3.1 JDBC](#31-jdbc)
- [3.2 Spring Data JDBC](#32-spring-data-jdbc) 
- [3.3 MyBatis](#33-mybatis) 
- [3.4 JPA](#34-jpa) 
- [3.5 MongoDB](#35-mongodb) 

---

## 3.1 JDBC

### 3.1.1 JDBCë€?

**JDBC (Java Database Connectivity)** ëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ **í‘œì¤€ API**ì…ë‹ˆë‹¤.

#### JDBCì˜ êµ¬ì„± ìš”ì†Œ

```
[Java ì• í”Œë¦¬ì¼€ì´ì…˜]
      â†“
[JDBC API] â† Javaê°€ ì œê³µí•˜ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤
      â†“
[JDBC Driver] â† ê° DB ë²¤ë”ê°€ ì œê³µí•˜ëŠ” êµ¬í˜„ì²´
      â†“
[ë°ì´í„°ë² ì´ìŠ¤ (MySQL, Oracle, PostgreSQL ë“±)]
```

| êµ¬ì„± ìš”ì†Œ | ì œê³µì | ì—­í•  |
|----------|-------|------|
| **JDBC API** | Java (Oracle) | ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ìœ„í•œ í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ |
| **JDBC Driver** | ê° DB ë²¤ë” (MySQL, Oracle ë“±) | JDBC APIì˜ ì‹¤ì œ êµ¬í˜„ì²´ |
| **ë°ì´í„°ë² ì´ìŠ¤** | DB ë²¤ë” | ì‹¤ì œ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ |

#### JDBC Driverì˜ ì—­í• 

**JDBC Driver**ëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ ê°„ì˜ **í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” ë¸Œë¦¬ì§€(ë‹¤ë¦¬)** ì—­í• ì„ í•©ë‹ˆë‹¤.

- MySQL JDBC Driver: `mysql-connector-j`
- PostgreSQL JDBC Driver: `postgresql`
- Oracle JDBC Driver: `ojdbc`

**ë¹„ìœ **:
```
JDBC API = USB ê·œê²© (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)
JDBC Driver = USB ì¼€ì´ë¸” (ì œì¡°ì‚¬ë³„ êµ¬í˜„)
ë°ì´í„°ë² ì´ìŠ¤ = USB ì¥ì¹˜
```

#### ì™œ JDBCê°€ í•„ìš”í•œê°€?

**ë¬¸ì œ ìƒí™©**:
- ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ í†µì‹  ë°©ì‹ì´ ë‹¤ë¦„
- MySQL, Oracle, PostgreSQL ë“± ê°ê° ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼

**JDBCì˜ í•´ê²°**:
- **í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ ì œê³µ**
- ê°œë°œìëŠ” JDBC APIë§Œ ì‚¬ìš©
- ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ ì‹œ Driverë§Œ êµì²´í•˜ë©´ ë¨

```java
// MySQLì´ë“  Oracleì´ë“  ì½”ë“œëŠ” ë™ì¼!
Connection conn = DriverManager.getConnection(url, user, password);
Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery("SELECT * FROM member");
```

---

### 3.1.2 ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸° ì„¤ì •

#### DBeaverë¥¼ í†µí•œ ë°ì´í„° ì´ˆê¸°í™”

**ì‹¤ìŠµ í™˜ê²½**:
- ë°ì´í„°ë² ì´ìŠ¤: MySQL 8.4
- ê´€ë¦¬ ë„êµ¬: DBeaver Community 25.2.2
- ë°ì´í„°ë² ì´ìŠ¤ëª…: `mydb`
- ì‚¬ìš©ì: `myuser` / ë¹„ë°€ë²ˆí˜¸: `mypass`

#### SQL ìŠ¤í¬ë¦½íŠ¸

```sql
-- ========================================
-- 1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
-- ========================================
-- mydbë¼ëŠ” ì´ë¦„ì˜ ë°ì´í„°ë² ì´ìŠ¤ ê³µê°„ì„ ìƒì„±í•©ë‹ˆë‹¤.
-- IF NOT EXISTS: ì´ë¯¸ ì¡´ì¬í•˜ë©´ ìƒëµ (ì—ëŸ¬ ë°©ì§€)
CREATE DATABASE IF NOT EXISTS mydb;

-- ========================================
-- 2. ì‚¬ìš©ì ìƒì„± ë° ì¸ì¦
-- ========================================
-- myuser ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.
-- @'%': ëª¨ë“  í˜¸ìŠ¤íŠ¸(IP)ì—ì„œ ì ‘ì† í—ˆìš©
-- IDENTIFIED BY 'mypass': ë¹„ë°€ë²ˆí˜¸ë¥¼ mypassë¡œ ì„¤ì •
CREATE USER IF NOT EXISTS 'myuser'@'%' IDENTIFIED BY 'mypass';

-- ========================================
-- 3. ê¶Œí•œ ë¶€ì—¬
-- ========================================
-- myuserê°€ mydb ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ê°ì²´(í…Œì´ë¸”, ë·° ë“±)ì— ëŒ€í•´
-- ëª¨ë“  ê¶Œí•œ(SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ë“±)ì„ ê°€ì§€ë„ë¡ ì„¤ì •
GRANT ALL ON mydb.* TO 'myuser'@'%';

-- ========================================
-- 4. ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
-- ========================================
USE mydb;

-- ========================================
-- 5. í…Œì´ë¸” ìƒì„±
-- ========================================
CREATE TABLE IF NOT EXISTS member(
    id INTEGER AUTO_INCREMENT PRIMARY KEY,  -- ìë™ ì¦ê°€ ê¸°ë³¸í‚¤
    name VARCHAR(128) NOT NULL,             -- ì´ë¦„ (í•„ìˆ˜)
    email VARCHAR(256) NOT NULL,            -- ì´ë©”ì¼ (í•„ìˆ˜)
    age INTEGER                             -- ë‚˜ì´ (ì„ íƒ)
);

-- ========================================
-- 6. ë°ì´í„° ì‚½ì…
-- ========================================
INSERT INTO member(name, email, age) VALUES ('ê¹€ìš°í˜„', 'kimwoo@spring.co.kr', 10);
INSERT INTO member(name, email, age) VALUES ('í™í˜œì°½', 'hyechang@spring.co.kr', 20);
INSERT INTO member(name, email, age) VALUES ('ìœ¤ì„œì¤€', 'Seojunyoon@spring.co.kr', 22);
INSERT INTO member(name, email, age) VALUES ('ê¹€ë¯¼ìˆ˜', 'minsusu@spring.co.kr', 30);

-- ========================================
-- 7. ë°ì´í„° ì¡°íšŒ (í™•ì¸)
-- ========================================
SELECT * FROM member;
```

#### SQL ëª…ë ¹ì–´ ì„¤ëª…

| ëª…ë ¹ì–´ | ì—­í•  | ì„¤ëª… |
|-------|------|------|
| `CREATE DATABASE` | ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± | ë°ì´í„°ë¥¼ ì €ì¥í•  ë…¼ë¦¬ì  ê³µê°„ ìƒì„± |
| `CREATE USER` | ì‚¬ìš©ì ê³„ì • ìƒì„± | ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ê³„ì • ìƒì„± |
| `GRANT` | ê¶Œí•œ ë¶€ì—¬ | íŠ¹ì • ì‚¬ìš©ìì—ê²Œ DB ì‘ì—… ê¶Œí•œ ë¶€ì—¬ |
| `USE` | ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ | ì‘ì—…í•  ë°ì´í„°ë² ì´ìŠ¤ ì§€ì • |
| `CREATE TABLE` | í…Œì´ë¸” ìƒì„± | ë°ì´í„°ë¥¼ ì €ì¥í•  í…Œì´ë¸” êµ¬ì¡° ì •ì˜ |
| `INSERT INTO` | ë°ì´í„° ì‚½ì… | í…Œì´ë¸”ì— ë ˆì½”ë“œ ì¶”ê°€ |
| `SELECT` | ë°ì´í„° ì¡°íšŒ | í…Œì´ë¸”ì˜ ë°ì´í„° ê²€ìƒ‰ |

#### ë°ì´í„° í™•ì¸

```
+----+----------+-------------------------+------+
| id | name     | email                   | age  |
+----+----------+-------------------------+------+
|  1 | ê¹€ìš°í˜„   | kimwoo@spring.co.kr     |   10 |
|  2 | í™í˜œì°½   | hyechang@spring.co.kr   |   20 |
|  3 | ìœ¤ì„œì¤€   | Seojunyoon@spring.co.kr |   22 |
|  4 | ê¹€ë¯¼ìˆ˜   | minsusu@spring.co.kr    |   30 |
+----+----------+-------------------------+------+
```

---

### 3.1.3 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€

**build.gradle**:
```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter'
    
    // MySQL JDBC Driver
    implementation 'com.mysql:mysql-connector-j:9.2.0'
    
    // Lombok (ì½”ë“œ ìë™ ìƒì„±)
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  |
|-------|------|
| `spring-boot-starter` | ìŠ¤í”„ë§ë¶€íŠ¸ ê¸°ë³¸ ê¸°ëŠ¥ |
| `mysql-connector-j:9.2.0` | **MySQL JDBC Driver** (í•µì‹¬!) |
| `lombok` | Getter, Setter ë“± ìë™ ìƒì„± |

> âš ï¸ **ì¤‘ìš”**: `mysql-connector-j`ë¥¼ ì¶”ê°€í•´ì•¼ MySQLê³¼ í†µì‹ í•  ìˆ˜ ìˆëŠ” JDBC Driverê°€ í”„ë¡œì íŠ¸ì— í¬í•¨ë©ë‹ˆë‹¤!

**JDBC Driver í¬í•¨ í™•ì¸**:
```
í”„ë¡œì íŠ¸ êµ¬ì¡°
â””â”€ External Libraries
   â””â”€ com.mysql:mysql-connector-j:9.2.0
      â””â”€ com.mysql.cj.jdbc.Driver â† JDBC Driver í´ë˜ìŠ¤
```

---

### 3.1.4 ì—”í‹°í‹° í´ë˜ìŠ¤ ì‘ì„±

**Member.java**:
```java
package kr.ac.hansung.cse.databasesample;

import lombok.*;

/**
 * Member ì—”í‹°í‹° í´ë˜ìŠ¤
 * - ë°ì´í„°ë² ì´ìŠ¤ì˜ member í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” Java ê°ì²´
 * - Lombokì„ ì‚¬ìš©í•˜ì—¬ ë°˜ë³µ ì½”ë“œ ìµœì†Œí™”
 */
@AllArgsConstructor  // ëª¨ë“  í•„ë“œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ì ìë™ ìƒì„±
@ToString            // toString() ë©”ì„œë“œ ìë™ ìƒì„±
public class Member {
    private Long id;
    private String name;
    private String email;
    private Integer age;
}
```

#### Lombok ì• ë…¸í…Œì´ì…˜

| ì• ë…¸í…Œì´ì…˜ | ìƒì„± ì½”ë“œ |
|-----------|----------|
| `@AllArgsConstructor` | `public Member(Long id, String name, String email, Integer age) { ... }` |
| `@ToString` | `public String toString() { return "Member(id=1, name=ê¹€ìš°í˜„, ...)"; }` |

---

### 3.1.5 JDBCë¥¼ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™

#### ì „ì²´ ì½”ë“œ

**DatabaseSampleApplication.java**:
```java
package kr.ac.hansung.cse.databasesample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import java.sql.*;

@SpringBootApplication
public class DatabaseSampleApplication {

    public static void main(String[] args) throws ClassNotFoundException, SQLException {
        
        SpringApplication.run(DatabaseSampleApplication.class, args);

        // ========================================
        // 1. JDBC Driver ë¡œë”©
        // ========================================
        /*
         * Class.forName()ì˜ ì—­í• :
         * - JDBC Driver í´ë˜ìŠ¤ë¥¼ JVM ë©”ëª¨ë¦¬ì— ë¡œë“œ
         * - ë¡œë“œëœ DriverëŠ” DriverManagerì— ìë™ ë“±ë¡ë¨
         * - DriverManagerê°€ MySQL ì ‘ì† ë°©ë²•ì„ ì•Œê²Œ ë¨
         * 
         * "com.mysql.cj.jdbc.Driver":
         * - mysql-connector-j ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ëœ MySQL JDBC Driver í´ë˜ìŠ¤
         * - ì´ í´ë˜ìŠ¤ê°€ JDBC APIë¥¼ ì‹¤ì œë¡œ êµ¬í˜„í•¨
         * 
         * ì°¸ê³ : JDBC 4.0 ì´í›„ë¡œëŠ” ìë™ ë¡œë”©ë˜ì§€ë§Œ, ëª…ì‹œì  í‘œí˜„ì„ ìœ„í•´ ì‘ì„±
         */
        Class.forName("com.mysql.cj.jdbc.Driver");

        // ========================================
        // 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
        // ========================================
        /*
         * DriverManager.getConnection()ì˜ ì—­í• :
         * - ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°(Connection) ê°ì²´ ìƒì„±
         * 
         * ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ (JDBC URL):
         * "jdbc:mysql://localhost:3306/mydb"
         *  â”€â”€â”€â”€ â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€ â”€â”€â”€â”€
         *   â”‚     â”‚       â”‚       â”‚     â””â”€ ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„
         *   â”‚     â”‚       â”‚       â””â”€ í¬íŠ¸ ë²ˆí˜¸ (MySQL ê¸°ë³¸: 3306)
         *   â”‚     â”‚       â””â”€ ì„œë²„ ì£¼ì†Œ (localhost = ë‚´ ì»´í“¨í„°)
         *   â”‚     â””â”€ ë°ì´í„°ë² ì´ìŠ¤ ì¢…ë¥˜ (MySQL)
         *   â””â”€ JDBC í”„ë¡œí† ì½œ
         * 
         * ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜: ì‚¬ìš©ì ì´ë¦„ (myuser)
         * ì„¸ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜: ë¹„ë°€ë²ˆí˜¸ (mypass)
         */
        Connection connection = DriverManager.getConnection(
            "jdbc:mysql://localhost:3306/mydb",
            "myuser",
            "mypass"
        );

        // ========================================
        // 3. SQL ì¿¼ë¦¬ ì¤€ë¹„
        // ========================================
        /*
         * PreparedStatementì˜ ì—­í• :
         * - SQL ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë¯¸ë¦¬ ì „ì†¡
         * - ì‹¤í–‰ ê°€ëŠ¥í•œ ìƒíƒœë¡œ ì¤€ë¹„ (ì»´íŒŒì¼)
         * - SQL Injection ë°©ì§€ (ë§¤ê°œë³€ìˆ˜ ë°”ì¸ë”© ì‹œ)
         * 
         * "select * from member":
         * - member í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼(*), ëª¨ë“  í–‰ ì¡°íšŒ
         */
        PreparedStatement preparedStatement = connection.prepareStatement(
            "select * from member"
        );

        // ========================================
        // 4. ì¿¼ë¦¬ ì‹¤í–‰
        // ========================================
        /*
         * executeQuery()ì˜ ì—­í• :
         * - SELECT ì¿¼ë¦¬ ì‹¤í–‰ (ë°ì´í„° ì¡°íšŒ)
         * - ê²°ê³¼ë¥¼ ResultSet ê°ì²´ë¡œ ë°˜í™˜
         * 
         * ResultSet:
         * - ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´
         * - ì»¤ì„œ(cursor)ë¥¼ ì‚¬ìš©í•˜ì—¬ í•œ í–‰ì”© ì ‘ê·¼
         */
        ResultSet resultSet = preparedStatement.executeQuery();

        // ========================================
        // 5. ê²°ê³¼ ì²˜ë¦¬
        // ========================================
        /*
         * while (resultSet.next()):
         * - ë‹¤ìŒ í–‰ìœ¼ë¡œ ì»¤ì„œ ì´ë™
         * - ë” ì´ìƒ í–‰ì´ ì—†ìœ¼ë©´ false ë°˜í™˜ (ë°˜ë³µ ì¢…ë£Œ)
         * 
         * resultSet.getLong("id"):
         * - í˜„ì¬ í–‰ì˜ "id" ì»¬ëŸ¼ ê°’ì„ Long íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜´
         * 
         * resultSet.getString("name"):
         * - í˜„ì¬ í–‰ì˜ "name" ì»¬ëŸ¼ ê°’ì„ String íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜´
         * 
         * resultSet.getInt("age"):
         * - í˜„ì¬ í–‰ì˜ "age" ì»¬ëŸ¼ ê°’ì„ Integer íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜´
         */
        while (resultSet.next()) {
            Member member = new Member(
                resultSet.getLong("id"),
                resultSet.getString("name"),
                resultSet.getString("email"),
                resultSet.getInt("age")
            );
            System.out.println(member);
        }

        // ========================================
        // 6. ì—°ê²° ì¢…ë£Œ
        // ========================================
        /*
         * connection.close()ì˜ ì—­í• :
         * - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í•´ì œ
         * - ë¦¬ì†ŒìŠ¤(ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬) ë°˜í™˜
         * - ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼ í•¨ (ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ë°©ì§€)
         * 
         * ê¶Œì¥: try-with-resources ì‚¬ìš©
         */
        connection.close();
    }
}
```

#### ì‹¤í–‰ ê²°ê³¼

```
Member(id=1, name=ê¹€ìš°í˜„, email=kimwoo@spring.co.kr, age=10)
Member(id=2, name=í™í˜œì°½, email=hyechang@spring.co.kr, age=20)
Member(id=3, name=ìœ¤ì„œì¤€, email=Seojunyoon@spring.co.kr, age=22)
Member(id=4, name=ê¹€ë¯¼ìˆ˜, email=minsusu@spring.co.kr, age=30)
```

---

### 3.1.6 JDBC ë™ì‘ ê³¼ì • ìƒì„¸ ë¶„ì„

#### 1ë‹¨ê³„: Driver ë¡œë”©

```java
Class.forName("com.mysql.cj.jdbc.Driver");
```

**ë‚´ë¶€ ë™ì‘**:
```
1. JVMì´ "com.mysql.cj.jdbc.Driver" í´ë˜ìŠ¤ íŒŒì¼ ë¡œë“œ
2. Driver í´ë˜ìŠ¤ì˜ static ì´ˆê¸°í™” ë¸”ë¡ ì‹¤í–‰
3. Driver ê°ì²´ê°€ DriverManagerì— ìë™ ë“±ë¡
4. DriverManager: "MySQLê³¼ í†µì‹ í•˜ëŠ” ë°©ë²•ì„ ì•Œê²Œ ë˜ì—ˆë‹¤!"
```


#### 2ë‹¨ê³„: Connection ìƒì„±

```java
Connection connection = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/mydb",
    "myuser",
    "mypass"
);
```

**ë‚´ë¶€ ë™ì‘**:
```
1. DriverManagerê°€ ë“±ë¡ëœ Driverë“¤ì„ ìˆœíšŒ
2. URLì´ "jdbc:mysql"ë¡œ ì‹œì‘ â†’ MySQL Driver ì„ íƒ
3. MySQL Driverê°€ ì‹¤ì œ ì—°ê²° ì‹œë„
   - TCP ì†Œì¼“ ì—°ê²° (localhost:3306)
   - ì¸ì¦ í™•ì¸ (myuser/mypass)
   - mydb ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
4. Connection ê°ì²´ ë°˜í™˜
```

**Connection ê°ì²´ì˜ ì—­í• **:
- ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ **ì„¸ì…˜(Session)** ì„ ë‚˜íƒ€ëƒ„
- ì´ ì—°ê²°ì„ í†µí•´ SQLì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ë°›ìŒ

#### 3ë‹¨ê³„: Statement ìƒì„± ë° ì‹¤í–‰

```java
PreparedStatement preparedStatement = connection.prepareStatement(
    "select * from member"
);
ResultSet resultSet = preparedStatement.executeQuery();
```

**ë‚´ë¶€ ë™ì‘**:
```
1. SQL ë¬¸ìì—´ì„ MySQL ì„œë²„ë¡œ ì „ì†¡
2. MySQLì´ SQLì„ íŒŒì‹±(ë¶„ì„)í•˜ê³  ì‹¤í–‰ ê³„íš ìˆ˜ë¦½
3. ì¿¼ë¦¬ ì‹¤í–‰
4. ê²°ê³¼ë¥¼ ResultSetìœ¼ë¡œ ë°˜í™˜
   (ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ Java ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì „ì†¡)
```

#### 4ë‹¨ê³„: ê²°ê³¼ ì²˜ë¦¬

```java
while (resultSet.next()) {
    // ë°ì´í„° ì½ê¸°
}
```

**ResultSetì˜ êµ¬ì¡°**:
```
ì»¤ì„œ ìœ„ì¹˜ (ì²˜ìŒì—ëŠ” ì²« í–‰ ì´ì „)
    â†“
[Before First] â† resultSet.next() í˜¸ì¶œ ì „
[Row 1] id=1, name=ê¹€ìš°í˜„, ...  â† resultSet.next() â†’ true
[Row 2] id=2, name=í™í˜œì°½, ...  â† resultSet.next() â†’ true
[Row 3] id=3, name=ìœ¤ì„œì¤€, ...  â† resultSet.next() â†’ true
[Row 4] id=4, name=ê¹€ë¯¼ìˆ˜, ...  â† resultSet.next() â†’ true
[After Last] â† resultSet.next() â†’ false (ë°˜ë³µ ì¢…ë£Œ)
```

---

### 3.1.7 JDBCì˜ ë¬¸ì œì 

#### ë¬¸ì œ 1: ë°˜ë³µì ì¸ ì½”ë“œ

```java
// ë§¤ë²ˆ ì‘ì„±í•´ì•¼ í•˜ëŠ” ì½”ë“œ
Connection conn = DriverManager.getConnection(...);
PreparedStatement stmt = conn.prepareStatement(...);
ResultSet rs = stmt.executeQuery();
while (rs.next()) {
    // ë§¤í•‘ ì½”ë“œ
}
conn.close();
```

#### ë¬¸ì œ 2: ìˆ˜ë™ ë§¤í•‘

```java
// ì»¬ëŸ¼ê³¼ ê°ì²´ í•„ë“œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë§¤í•‘
Member member = new Member(
    rs.getLong("id"),
    rs.getString("name"),
    rs.getString("email"),
    rs.getInt("age")
);
```

#### ë¬¸ì œ 3: ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

```java
// close()ë¥¼ ê¹œë¹¡í•˜ë©´ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜!
connection.close();  // ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼ í•¨
```

#### ë¬¸ì œ 4: ì˜ˆì™¸ ì²˜ë¦¬

```java
// ì²´í¬ ì˜ˆì™¸(Checked Exception) ì²˜ë¦¬ í•„ìš”
throws ClassNotFoundException, SQLException
```

**ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ë“±ì¥í•œ ê²ƒì´:**
- Spring Data JDBC (3.2)
- MyBatis (3.3)
- JPA (3.4)

---


## 3.2 Spring Data JDBC

### 3.2.1 Spring Data JDBCë€?

**Spring Data JDBC**ëŠ” JDBCì˜ ë°˜ë³µì ì¸ ì½”ë“œë¥¼ ì œê±°í•˜ê³ , ê°œë°œìê°€ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ë§Œ ì§‘ì¤‘**í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì¶”ìƒí™” ë ˆì´ì–´ì…ë‹ˆë‹¤.

#### JDBCì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ëŠ” ë°©ë²•

| ë¬¸ì œì  | JDBC | Spring Data JDBC |
|-------|------|-----------------|
| Driver ë¡œë”© | `Class.forName()` í•„ìš” | ìë™ ì²˜ë¦¬ |
| Connection ê´€ë¦¬ | ë§¤ë²ˆ ìƒì„±/ì¢…ë£Œ | **ì»¤ë„¥ì…˜ í’€** ìë™ ê´€ë¦¬ |
| SQL ì‘ì„± | ì§ì ‘ ì‘ì„± | ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìë™ ìƒì„± |
| ê²°ê³¼ ë§¤í•‘ | `ResultSet` ìˆ˜ë™ ë§¤í•‘ | ê°ì²´ ìë™ ë§¤í•‘ |
| ì˜ˆì™¸ ì²˜ë¦¬ | Checked Exception | Runtime Exception |
| ë¦¬ì†ŒìŠ¤ ì •ë¦¬ | ìˆ˜ë™ `close()` | ìë™ ì •ë¦¬ |

> âš ï¸ **ì¤‘ìš”**: Spring Data JDBCëŠ” JDBC Driverë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤! MySQL Connector ê°™ì€ JDBC Driverë¥¼ **ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©**í•˜ë„ë¡ ê°ì‹¸ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

#### Spring Data JDBCì˜ í•µì‹¬ ê°œë…

```
[ê°œë°œì]
    â†“ (Repository ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜)
[Spring Data JDBC]
    â†“ (ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ìë™ ìƒì„±)
[JDBC Driver (mysql-connector-j)]
    â†“
[MySQL ë°ì´í„°ë² ì´ìŠ¤]
```

**ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ(Boilerplate Code)**: ë°˜ë³µì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•˜ëŠ” ì§€ë£¨í•œ ì½”ë“œ

---

### 3.2.2 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€

**build.gradle**:
```gradle
dependencies {
    // Spring Data JDBC (í•µì‹¬!)
    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
    
    // MySQL JDBC Driver (ì—¬ì „íˆ í•„ìš”!)
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  | í•„ìˆ˜ ì—¬ë¶€ |
|-------|------|----------|
| `spring-boot-starter-data-jdbc` | Spring Data JDBC ê¸°ëŠ¥ ì œê³µ | âœ… í•„ìˆ˜ |
| `mysql-connector-j` | MySQLê³¼ í†µì‹ í•˜ëŠ” JDBC Driver | âœ… í•„ìˆ˜ |
| `lombok` | ì½”ë“œ ê°„ì†Œí™” | ê¶Œì¥ |

> **í•µì‹¬**: `spring-boot-starter-data-jdbc`ëŠ” JDBCë¥¼ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, JDBCë¥¼ ë” ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤!

---

### 3.2.3 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •

#### application.properties

**src/main/resources/application.properties**:
```properties
spring.application.name=springdatajbc

# ========================================
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì • (DataSource)
# ========================================
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass

# ========================================
# JDBC ë¡œê·¸ ë ˆë²¨ ì„¤ì • (ë””ë²„ê¹…ìš©)
# ========================================
logging.level.org.springframework.jdbc=DEBUG
```

#### ì„¤ì • í•­ëª© ì„¤ëª…

| ì†ì„± | ì„¤ëª… | ì˜ˆì‹œ ê°’ |
|-----|------|---------|
| `spring.datasource.url` | ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° URL | `jdbc:mysql://localhost:3306/mydb` |
| `spring.datasource.username` | ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì´ë¦„ | `myuser` |
| `spring.datasource.password` | ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ | `mypass` |
| `logging.level.org.springframework.jdbc` | JDBC ì‹¤í–‰ ë¡œê·¸ ë ˆë²¨ | `DEBUG` (SQL ì¿¼ë¦¬ í™•ì¸ìš©) |

#### JDBC vs Spring Data JDBC ì„¤ì • ë¹„êµ

**JDBC (ì´ì „)**:
```java
// ë§¤ë²ˆ ì½”ë“œë¡œ ì‘ì„±
Class.forName("com.mysql.cj.jdbc.Driver");
Connection conn = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/mydb",
    "myuser",
    "mypass"
);
```

**Spring Data JDBC (í˜„ì¬)**:
```properties
# ì„¤ì • íŒŒì¼ì— í•œ ë²ˆë§Œ ì‘ì„±
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass
```

> **ì¥ì **: ì„¤ì • íŒŒì¼ë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì½”ë“œì— ìë™ ì ìš©! í™˜ê²½ë³„(ê°œë°œ/ìš´ì˜) ì„¤ì • íŒŒì¼ ë¶„ë¦¬ ê°€ëŠ¥!

---

### 3.2.4 ì—”í‹°í‹° í´ë˜ìŠ¤ ì‘ì„±

#### Member ì—”í‹°í‹°

**Member.java**:
```java
package com.example.springdatajbc;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.annotation.Id;
import org.springframework.data.relational.core.mapping.Table;

@Table
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Member {
    
    @Id
    private Long id;
    private String name;
    private String email;
    private Integer age;
}
```

#### ì• ë…¸í…Œì´ì…˜ ì„¤ëª…

##### @Table

**ì—­í• **: ì´ í´ë˜ìŠ¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘ë¨ì„ ì„ ì–¸

**ìë™ ë§¤í•‘ ê·œì¹™**:
- í´ë˜ìŠ¤ ì´ë¦„ â†’ í…Œì´ë¸” ì´ë¦„ (ì¹´ë©œ ì¼€ì´ìŠ¤ â†’ ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤)
- `Member` í´ë˜ìŠ¤ â†’ `member` í…Œì´ë¸”
- `HyechangMember` í´ë˜ìŠ¤ â†’ `hyechang_member` í…Œì´ë¸”

**ëª…ì‹œì  ì§€ì •**:
```java
@Table("custom_table_name")  // í…Œì´ë¸” ì´ë¦„ì´ ê·œì¹™ê³¼ ë‹¤ë¥¼ ë•Œ
public class Member { ... }
```

**í…Œì´ë¸” ë§¤í•‘ ê³¼ì •**:
```
[Java í´ë˜ìŠ¤]           [ë°ì´í„°ë² ì´ìŠ¤]
Member í´ë˜ìŠ¤     â†’     member í…Œì´ë¸”
â”œâ”€ id (Long)      â†’     id (BIGINT)
â”œâ”€ name (String)  â†’     name (VARCHAR)
â”œâ”€ email (String) â†’     email (VARCHAR)
â””â”€ age (Integer)  â†’     age (INT)
```

##### @Id

**ì—­í• **: Primary Key(ê¸°ë³¸ í‚¤) í•„ë“œ ì§€ì •

```java
@Id
private Long id;
```

- Spring Data JDBCê°€ ì´ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë ˆì½”ë“œ ì‹ë³„
- `save()` ì‹œ `id`ê°€ `null`ì´ë©´ INSERT, ê°’ì´ ìˆìœ¼ë©´ UPDATE
- ìë™ ìƒì„±(AUTO_INCREMENT)ëœ ê°’ì„ ìë™ìœ¼ë¡œ ë°›ì•„ì˜´

##### @Column (ì„ íƒ ì‚¬í•­)

**ì—­í• **: í•„ë“œëª…ê³¼ ì»¬ëŸ¼ëª…ì´ ë‹¤ë¥¼ ë•Œ ë§¤í•‘

```java
@Column("user_name")
private String name;  // name í•„ë“œ â†’ user_name ì»¬ëŸ¼
```

**ê¸°ë³¸ ë§¤í•‘ ê·œì¹™**:
- í•„ë“œëª…ê³¼ ì»¬ëŸ¼ëª…ì´ ê°™ìœ¼ë©´ ìƒëµ ê°€ëŠ¥
- ì¹´ë©œ ì¼€ì´ìŠ¤ â†’ ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ ìë™ ë³€í™˜
- `userName` â†’ `user_name`

##### Lombok ì• ë…¸í…Œì´ì…˜

| ì• ë…¸í…Œì´ì…˜ | ìƒì„± ì½”ë“œ |
|-----------|----------|
| `@Data` | `@Getter` + `@Setter` + `@ToString` + `@EqualsAndHashCode` + `@RequiredArgsConstructor` |
| `@Builder` | ë¹Œë” íŒ¨í„´ ì½”ë“œ ìƒì„± |
| `@AllArgsConstructor` | ëª¨ë“  í•„ë“œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ì |
| `@NoArgsConstructor` | ê¸°ë³¸ ìƒì„±ì (ë§¤ê°œë³€ìˆ˜ ì—†ìŒ) |

---

### 3.2.5 Repository ì¸í„°í˜ì´ìŠ¤ ì‘ì„±

#### MemberRepository ì¸í„°í˜ì´ìŠ¤

**MemberRepository.java**:
```java
package com.example.springdatajbc;

import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface MemberRepository extends CrudRepository<Member, Long> {
    
    // ë©”ì„œë“œ ì´ë¦„ ê¸°ë°˜ ì¿¼ë¦¬ (ìë™ ìƒì„±)
    List<Member> findByName(String name);
    List<Member> findByEmail(String email);
    List<Member> findByNameContaining(String name);
    
    // ì¡°ê±´ ê²°í•©
    List<Member> findByEmailAndName(String email, String name);
    List<Member> findByEmailOrName(String email, String name);
    
    // ë¹„êµ ì—°ì‚°
    List<Member> findByAgeGreaterThan(int age);
    List<Member> findByAgeLessThan(int age);
    List<Member> findByAgeBetween(int min, int max);
    
    // ì»¤ìŠ¤í…€ ì¿¼ë¦¬ (ì§ì ‘ ì‘ì„±)
    @Query("SELECT * FROM member WHERE name = :username AND age >= :max")
    List<Member> hyechangQuery(String username, int max);
}
```

---

### 3.2.6 Repository í•µì‹¬ ê°œë…

#### 1. @Repositoryì™€ ë¹ˆ ìƒì„±

**@Repositoryì˜ ì •ì²´**:
```java
@Repository
public interface MemberRepository extends CrudRepository<Member, Long> {
    // ì¸í„°í˜ì´ìŠ¤ì¸ë° ì–´ë–»ê²Œ ë¹ˆ ê°ì²´ê°€ ë˜ëŠ”ê°€?
}
```

**@Repository = @Componentì˜ íŠ¹ìˆ˜í•œ í˜•íƒœ**:

| ì• ë…¸í…Œì´ì…˜ | ì—­í•  | ê³„ì¸µ |
|-----------|------|------|
| `@Component` | ë²”ìš© ìŠ¤í”„ë§ ë¹ˆ | - |
| `@Repository` | ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ | Persistence Layer |
| `@Service` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ | Service Layer |
| `@Controller` | í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ | Presentation Layer |

> **í•µì‹¬**: ëª¨ë‘ `@Component`ì´ì§€ë§Œ, **ì—­í• ì„ ëª…í™•íˆ í•˜ê¸° ìœ„í•´** ì„¸ë¶„í™”ëœ ê²ƒì…ë‹ˆë‹¤!

#### 2. ì¸í„°í˜ì´ìŠ¤ê°€ ë¹ˆ ê°ì²´ê°€ ë˜ëŠ” ì›ë¦¬ (í”„ë¡ì‹œ íŒ¨í„´)

**ë¬¸ì œ**: ì¸í„°í˜ì´ìŠ¤ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ëŠ”ë°?

**í•´ê²°**: Springì´ **í”„ë¡ì‹œ ê°ì²´**ë¥¼ ìë™ ìƒì„±!

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ:

1. Springì´ @Repositoryë¥¼ ë°œê²¬
2. MemberRepository ì¸í„°í˜ì´ìŠ¤ ë¶„ì„
3. ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ëŸ°íƒ€ì„ì— ìë™ ìƒì„± (í”„ë¡ì‹œ)
4. í”„ë¡ì‹œ ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡
5. ë‹¤ë¥¸ ê³³ì—ì„œ ì£¼ì… ì‹œ í”„ë¡ì‹œ ê°ì²´ ì œê³µ
```

**í”„ë¡ì‹œ ê°ì²´ì˜ ì—­í• **:
```java
// Springì´ ëŸ°íƒ€ì„ì— ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ì½”ë“œ (ê°œë…ì  í‘œí˜„)
public class MemberRepositoryImpl implements MemberRepository {
    
    @Override
    public <S extends Member> S save(S entity) {
        // entity.getId()ê°€ nullì´ë©´ INSERT
        // entity.getId()ê°€ ìˆìœ¼ë©´ UPDATE
        // SQL ìë™ ìƒì„± ë° ì‹¤í–‰
    }
    
    @Override
    public Optional<Member> findById(Long id) {
        // SELECT * FROM member WHERE id = ? ì‹¤í–‰
        // ResultSet â†’ Member ê°ì²´ ìë™ ë§¤í•‘
    }
    
    // ê¸°íƒ€ ë©”ì„œë“œë“¤ë„ ìë™ êµ¬í˜„...
}
```

#### 3. CrudRepositoryì˜ ì œë„¤ë¦­

```java
public interface MemberRepository extends CrudRepository<Member, Long>
                                                        â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€
                                                        ì—”í‹°í‹°    PK íƒ€ì…
```

**ì œë„¤ë¦­ ì˜ë¯¸**:
- `<Member, Long>`: "Member ì—”í‹°í‹°ë¥¼ ë‹¤ë£¨ë©°, Primary KeyëŠ” Long íƒ€ì…"
- Springì´ ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ SQL ìë™ ìƒì„±

#### 4. CrudRepository ê¸°ë³¸ ë©”ì„œë“œ

**ìë™ìœ¼ë¡œ ì œê³µë˜ëŠ” ë©”ì„œë“œ**:

| ë©”ì„œë“œ | ì„¤ëª… | ìƒì„± SQL |
|-------|------|----------|
| `save(entity)` | ì €ì¥ ë˜ëŠ” ìˆ˜ì • | `INSERT` ë˜ëŠ” `UPDATE` |
| `findById(id)` | IDë¡œ ì¡°íšŒ | `SELECT * FROM member WHERE id = ?` |
| `findAll()` | ì „ì²´ ì¡°íšŒ | `SELECT * FROM member` |
| `existsById(id)` | ì¡´ì¬ ì—¬ë¶€ í™•ì¸ | `SELECT COUNT(*) FROM member WHERE id = ?` |
| `count()` | ì „ì²´ ê°œìˆ˜ | `SELECT COUNT(*) FROM member` |
| `deleteById(id)` | IDë¡œ ì‚­ì œ | `DELETE FROM member WHERE id = ?` |
| `delete(entity)` | ì—”í‹°í‹° ì‚­ì œ | `DELETE FROM member WHERE id = ?` |
| `deleteAll()` | ì „ì²´ ì‚­ì œ | `DELETE FROM member` |

**save()ì˜ ë™ì‘ ì›ë¦¬**:
```java
Member member = new Member();
member.setName("í™í˜œì°½");
memberRepository.save(member);  // idê°€ null â†’ INSERT

member.setAge(30);
memberRepository.save(member);  // idê°€ ìˆìŒ â†’ UPDATE
```

---

### 3.2.7 ì¿¼ë¦¬ ë©”ì„œë“œ (Query Method)

#### ë©”ì„œë“œ ì´ë¦„ ê¸°ë°˜ ì¿¼ë¦¬ ìƒì„±

Spring Data JDBCëŠ” **ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„**í•˜ì—¬ ìë™ìœ¼ë¡œ SQLì„ ìƒì„±í•©ë‹ˆë‹¤.

#### ê¸°ë³¸ êµ¬ì¡°

```
find...By... + ì¡°ê±´í•„ë“œ + ë¹„êµì—°ì‚°ì
 â”‚    â”‚        â”‚          â”‚
 â”‚    â”‚        â”‚          â””â”€ GreaterThan, LessThan ë“±
 â”‚    â”‚        â””â”€ Name, Email, Age ë“± (ì—”í‹°í‹° í•„ë“œëª…)
 â”‚    â””â”€ ì¡°ê±´ ì‹œì‘
 â””â”€ ì¡°íšŒ ì‘ì—… (find, get, read ëª¨ë‘ ë™ì¼)
```

#### ì£¼ìš” í‚¤ì›Œë“œ

##### 1. í•„ë“œ ì¼ì¹˜

```java
List<Member> findByName(String name);
// SQL: SELECT * FROM member WHERE name = ?

List<Member> findByEmail(String email);
// SQL: SELECT * FROM member WHERE email = ?
```

##### 2. ì¡°ê±´ ê²°í•© (AND, OR)

```java
// AND ì¡°ê±´ (ëª¨ë‘ ë§Œì¡±)
List<Member> findByEmailAndName(String email, String name);
// SQL: SELECT * FROM member WHERE email = ? AND name = ?

// OR ì¡°ê±´ (í•˜ë‚˜ë¼ë„ ë§Œì¡±)
List<Member> findByEmailOrName(String email, String name);
// SQL: SELECT * FROM member WHERE email = ? OR name = ?
```

##### 3. ë¬¸ìì—´ ê²€ìƒ‰

```java
// í¬í•¨ (LIKE '%...%')
List<Member> findByNameContaining(String name);
// SQL: SELECT * FROM member WHERE name LIKE %?%

// ì‹œì‘ (LIKE '...%')
List<Member> findByNameStartingWith(String name);
// SQL: SELECT * FROM member WHERE name LIKE ?%

// ë (LIKE '%...')
List<Member> findByNameEndingWith(String name);
// SQL: SELECT * FROM member WHERE name LIKE %?
```

##### 4. ë¹„êµ ì—°ì‚°

```java
// ë³´ë‹¤ í¼ (>)
List<Member> findByAgeGreaterThan(int age);
// SQL: SELECT * FROM member WHERE age > ?

// ë³´ë‹¤ ì‘ìŒ (<)
List<Member> findByAgeLessThan(int age);
// SQL: SELECT * FROM member WHERE age < ?

// ì´ìƒ (>=)
List<Member> findByAgeGreaterThanEqual(int age);
// SQL: SELECT * FROM member WHERE age >= ?

// ì´í•˜ (<=)
List<Member> findByAgeLessThanEqual(int age);
// SQL: SELECT * FROM member WHERE age <= ?

// ë²”ìœ„ (BETWEEN)
List<Member> findByAgeBetween(int min, int max);
// SQL: SELECT * FROM member WHERE age BETWEEN ? AND ?
```

##### 5. NULL ì²´í¬

```java
// NULLì¸ ê²½ìš°
List<Member> findByEmailIsNull();
// SQL: SELECT * FROM member WHERE email IS NULL

// NULLì´ ì•„ë‹Œ ê²½ìš°
List<Member> findByEmailIsNotNull();
// SQL: SELECT * FROM member WHERE email IS NOT NULL
```

##### 6. ì •ë ¬ (OrderBy)

```java
// ì˜¤ë¦„ì°¨ìˆœ
List<Member> findByNameOrderByAgeAsc(String name);
// SQL: SELECT * FROM member WHERE name = ? ORDER BY age ASC

// ë‚´ë¦¼ì°¨ìˆœ
List<Member> findByNameOrderByAgeDesc(String name);
// SQL: SELECT * FROM member WHERE name = ? ORDER BY age DESC
```

##### 7. ê°œìˆ˜ ì œí•œ

```java
// ì²« ë²ˆì§¸ ê²°ê³¼
Member findFirstByName(String name);
// SQL: SELECT * FROM member WHERE name = ? LIMIT 1

// ìƒìœ„ Nê°œ
List<Member> findTop3ByOrderByAgeDesc();
// SQL: SELECT * FROM member ORDER BY age DESC LIMIT 3
```

#### ì¿¼ë¦¬ ë©”ì„œë“œ í‚¤ì›Œë“œ ì •ë¦¬í‘œ

| í‚¤ì›Œë“œ | SQL | ì˜ˆì‹œ |
|-------|-----|------|
| `And` | `AND` | `findByNameAndEmail` |
| `Or` | `OR` | `findByNameOrEmail` |
| `Containing` | `LIKE %?%` | `findByNameContaining` |
| `StartingWith` | `LIKE ?%` | `findByNameStartingWith` |
| `EndingWith` | `LIKE %?` | `findByNameEndingWith` |
| `GreaterThan` | `>` | `findByAgeGreaterThan` |
| `LessThan` | `<` | `findByAgeLessThan` |
| `Between` | `BETWEEN` | `findByAgeBetween` |
| `IsNull` | `IS NULL` | `findByEmailIsNull` |
| `IsNotNull` | `IS NOT NULL` | `findByEmailIsNotNull` |
| `OrderBy...Asc` | `ORDER BY ... ASC` | `findByNameOrderByAgeAsc` |
| `OrderBy...Desc` | `ORDER BY ... DESC` | `findByNameOrderByAgeDesc` |
| `First` | `LIMIT 1` | `findFirstByName` |
| `Top3` | `LIMIT 3` | `findTop3ByOrderByAge` |

---

### 3.2.8 ì»¤ìŠ¤í…€ ì¿¼ë¦¬ (@Query)

#### @Query ì• ë…¸í…Œì´ì…˜

**ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ì§ì ‘ ì‘ì„±**:

```java
@Query("SELECT * FROM member WHERE name = :username AND age >= :max")
List<Member> hyechangQuery(String username, int max);
```

#### íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

**`:ë³€ìˆ˜ëª…` í˜•ì‹ìœ¼ë¡œ ë°”ì¸ë”©**:

```java
@Query("SELECT * FROM member WHERE name = :username AND age >= :max")
List<Member> hyechangQuery(String username, int max);
                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€
                                â”‚          â””â”€ :maxì™€ ë§¤í•‘
                                â””â”€ :usernameê³¼ ë§¤í•‘
```

#### @Query ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | ë©”ì„œë“œ ì´ë¦„ | @Query |
|-----|-----------|--------|
| ë‹¨ìˆœ ì¡°ê±´ | âœ… ê¶Œì¥ | âŒ ë¶ˆí•„ìš” |
| ë³µì¡í•œ JOIN | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìˆ˜ |
| ì§‘ê³„ í•¨ìˆ˜ (SUM, AVG) | âŒ ì œí•œì  | âœ… ê¶Œì¥ |
| ì„±ëŠ¥ ìµœì í™” í•„ìš” | âŒ ì œí•œì  | âœ… ê¶Œì¥ |

**ì˜ˆì‹œ**:
```java
// ì§‘ê³„ ì¿¼ë¦¬
@Query("SELECT AVG(age) FROM member")
Double getAverageAge();

// JOIN ì¿¼ë¦¬
@Query("SELECT m.* FROM member m JOIN orders o ON m.id = o.member_id WHERE o.status = :status")
List<Member> findMembersWithOrderStatus(String status);
```

---

### 3.2.9 ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì½”ë“œ

#### SpringJdbcApplication í´ë˜ìŠ¤

**SpringJdbcApplication.java**:
```java
package com.example.springdatajbc;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

import java.util.Iterator;
import java.util.List;
import java.util.Optional;

@Component
@Slf4j
@RequiredArgsConstructor
public class SpringJdbcApplication implements ApplicationRunner {

    private final MemberRepository memberRepository;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        // 1. ë°ì´í„° ìƒì„± (Builder íŒ¨í„´)
        Member member = Member.builder()
                              .name("hyechang")
                              .email("test@hyechang.ac.kr")
                              .age(25)
                              .build();
        
        // 2. ì €ì¥ (INSERT)
        memberRepository.save(member);

        // 3. ìˆ˜ì • (UPDATE)
        member.setAge(35);
        memberRepository.save(member);

        // 4. IDë¡œ ì¡°íšŒ
        Optional<Member> getm = memberRepository.findById(1L);
        if (getm.isPresent()) {
            log.info(getm.get().toString());
        }

        // 5. ì „ì²´ ì¡°íšŒ
        Iterable<Member> iterable = memberRepository.findAll();
        Iterator<Member> iterator = iterable.iterator();
        while (iterator.hasNext()) {
            log.info(iterator.next().toString());
        }

        // 6. ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ë©”ì„œë“œ
        List<Member> members = memberRepository.findByAgeGreaterThan(3);
        log.info("--- findByAgeGreaterThan(3) ê²°ê³¼ ì‹œì‘ (ì´ {}ê°œ) ---", members.size());
        for (Member m : members) {
            log.info(m.toString());
        }
        log.info("--- findByAgeGreaterThan(3) ê²°ê³¼ ì¢…ë£Œ ---");
    }
}
```

---

### 3.2.10 ì£¼ìš” ê°œë… ìƒì„¸ ë¶„ì„

#### 1. @RequiredArgsConstructor + final

**ì˜ì¡´ì„± ì£¼ì… ë°©ì‹**:

```java
@Component
@RequiredArgsConstructor
public class SpringJdbcApplication {
    
    private final MemberRepository memberRepository;
    // final = ë°˜ë“œì‹œ ì´ˆê¸°í™”ë˜ì–´ì•¼ í•¨
}
```

**ë‚´ë¶€ ë™ì‘**:
```java
// Lombokì´ ìë™ ìƒì„±í•˜ëŠ” ì½”ë“œ
public SpringJdbcApplication(MemberRepository memberRepository) {
    this.memberRepository = memberRepository;
}
```

**Springì˜ DI ê³¼ì •**:
```
1. @Component ìŠ¤ìº” â†’ SpringJdbcApplication í´ë˜ìŠ¤ ë°œê²¬
2. ìƒì„±ì ë°œê²¬ (MemberRepository í•„ìš”)
3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ MemberRepository ë¹ˆ ê²€ìƒ‰
4. ê²€ìƒ‰ëœ ë¹ˆ(í”„ë¡ì‹œ ê°ì²´)ì„ ìƒì„±ìì— ì£¼ì…
5. SpringJdbcApplication ë¹ˆ ìƒì„± ì™„ë£Œ
```

#### 2. ApplicationRunner ì¸í„°í˜ì´ìŠ¤

**ì—­í• **: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì§í›„ ìë™ ì‹¤í–‰

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ìˆœì„œ:

1. @SpringBootApplication ì‹¤í–‰
2. ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ë° ë¹ˆ ìƒì„±
3. ì˜ì¡´ì„± ì£¼ì…
4. ApplicationRunner êµ¬í˜„ì²´ì˜ run() ìë™ ì‹¤í–‰ â† ì—¬ê¸°!
5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ êµ¬ë™
```

**ì‚¬ìš© ëª©ì **:
- ì´ˆê¸° ë°ì´í„° ì‚½ì…
- ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‘ì—…
- í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±

#### 3. save()ì˜ ë™ì‘ ì›ë¦¬

```java
Member member = Member.builder().name("hyechang").age(25).build();
memberRepository.save(member);  // â‘  INSERT
// ì´ ì‹œì ì—ì„œ member.getId()ì— ìë™ ìƒì„±ëœ ID í• ë‹¹ë¨

member.setAge(35);
memberRepository.save(member);  // â‘¡ UPDATE
```

**ë‚´ë¶€ íŒë‹¨ ë¡œì§**:
```
save() í˜¸ì¶œ ì‹œ:

if (entity.getId() == null) {
    // INSERT
    INSERT INTO member (name, email, age) VALUES (?, ?, ?)
    // ìë™ ìƒì„±ëœ IDë¥¼ entity.setId()ë¡œ ì„¤ì •
} else {
    // UPDATE
    UPDATE member SET name=?, email=?, age=? WHERE id=?
}
```

#### 4. Optional ì²˜ë¦¬

```java
Optional<Member> getm = memberRepository.findById(1L);
if (getm.isPresent()) {
    log.info(getm.get().toString());
}
```

**Optionalì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ **:
- `null` ì²´í¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê°•ì œ
- `NullPointerException` ë°©ì§€

**ë” ë‚˜ì€ ë°©ì‹**:
```java
memberRepository.findById(1L)
                .ifPresent(member -> log.info(member.toString()));

// ë˜ëŠ”
Member member = memberRepository.findById(1L)
                                 .orElse(new Member());  // ì—†ìœ¼ë©´ ê¸°ë³¸ê°’

// ë˜ëŠ”
Member member = memberRepository.findById(1L)
                                 .orElseThrow(() -> new RuntimeException("íšŒì› ì—†ìŒ"));
```

---

### 3.2.11 ì»¤ë„¥ì…˜ í’€ (Connection Pool)

#### ì»¤ë„¥ì…˜ í’€ì´ë€?

**ë¬¸ì œ ìƒí™© (JDBC ì§ì ‘ ì‚¬ìš© ì‹œ)**:
```java
// ìš”ì²­ 1
Connection conn1 = DriverManager.getConnection(...);  // ì—°ê²° ìƒì„± (ëŠë¦¼!)
// ì¿¼ë¦¬ ì‹¤í–‰
conn1.close();  // ì—°ê²° ì¢…ë£Œ

// ìš”ì²­ 2
Connection conn2 = DriverManager.getConnection(...);  // ë˜ ì—°ê²° ìƒì„± (ëŠë¦¼!)
// ì¿¼ë¦¬ ì‹¤í–‰
conn2.close();  // ë˜ ì—°ê²° ì¢…ë£Œ
```

**ë¬¸ì œì **:
- ë§¤ë²ˆ DB ì—°ê²° ìƒì„±/ì¢…ë£Œ â†’ **ì‹œê°„ ì†Œìš”** (ë„¤íŠ¸ì›Œí¬ í†µì‹ , ì¸ì¦ ë“±)
- ë™ì‹œ ìš”ì²­ ë§ì„ ì‹œ â†’ **ì„±ëŠ¥ ì €í•˜**

**í•´ê²°ì±…: ì»¤ë„¥ì…˜ í’€**

```
[ì»¤ë„¥ì…˜ í’€]
â”œâ”€ Connection 1 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)
â”œâ”€ Connection 2 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)
â”œâ”€ Connection 3 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)
â””â”€ Connection 4 (ë¯¸ë¦¬ ìƒì„±, ëŒ€ê¸° ì¤‘)

ìš”ì²­ ì‹œ:
1. í’€ì—ì„œ ë¹Œë ¤ì˜´ (ë¹ ë¦„!)
2. ì¿¼ë¦¬ ì‹¤í–‰
3. í’€ì— ë°˜ë‚© (close()ê°€ ì•„ë‹˜!)
```

#### ì»¤ë„¥ì…˜ í’€ì˜ ë™ì‘ ì›ë¦¬

**1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ**:

```
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass
â†“
Spring Bootê°€ ì´ ì„¤ì •ì„ ì½ê³ 
â†“
HikariCP (ê¸°ë³¸ ì»¤ë„¥ì…˜ í’€) ì´ˆê¸°í™”
â†“
mydbì— Connection 10ê°œ ë¯¸ë¦¬ ìƒì„± (ê¸°ë³¸ê°’)
â†“
í’€ì— ì €ì¥í•˜ê³  ëŒ€ê¸°
```

**2. Repository ë©”ì„œë“œ í˜¸ì¶œ ì‹œ**:

```java
memberRepository.save(member);
â†“
Spring Data JDBCê°€ ë‚´ë¶€ì ìœ¼ë¡œ:
1. ì»¤ë„¥ì…˜ í’€ì—ì„œ Connection ë¹Œë ¤ì˜´ (ëŒ€ê¸° ì¤‘ì¸ ê²ƒ ì‚¬ìš©)
2. SQL ì‹¤í–‰: INSERT INTO member ...
3. Connectionì„ í’€ì— ë°˜ë‚© (close()ê°€ ì•„ë‹˜!)
```

**3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ**:

```
ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œì‘
â†“
Springì´ ìë™ìœ¼ë¡œ ì»¤ë„¥ì…˜ í’€ ì¢…ë£Œ
â†“
í’€ì˜ ëª¨ë“  Connectionë“¤ì„ DBì— ë°˜í™˜
â†“
ì‹¤ì œ ì—°ê²° ì¢…ë£Œ
```

#### ì»¤ë„¥ì…˜ í’€ ì„¤ì •

**application.properties**:
```properties
# HikariCP ì»¤ë„¥ì…˜ í’€ ì„¤ì •
spring.datasource.hikari.maximum-pool-size=10      # ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜
spring.datasource.hikari.minimum-idle=5            # ìµœì†Œ ìœ ì§€ ì»¤ë„¥ì…˜ ìˆ˜
spring.datasource.hikari.connection-timeout=20000  # ì»¤ë„¥ì…˜ ëŒ€ê¸° ì‹œê°„ (ms)
spring.datasource.hikari.idle-timeout=300000       # ìœ íœ´ ì»¤ë„¥ì…˜ ìœ ì§€ ì‹œê°„ (ms)
```

| ì„¤ì • | ì„¤ëª… | ê¸°ë³¸ê°’ |
|-----|------|--------|
| `maximum-pool-size` | í’€ì´ ìœ ì§€í•  ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜ | 10 |
| `minimum-idle` | í•­ìƒ ìœ ì§€í•  ìµœì†Œ ì»¤ë„¥ì…˜ ìˆ˜ | `maximum-pool-size`ì™€ ë™ì¼ |
| `connection-timeout` | ì»¤ë„¥ì…˜ì„ ëª» ì–»ì„ ë•Œ ëŒ€ê¸° ì‹œê°„ | 30000ms (30ì´ˆ) |
| `idle-timeout` | ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì»¤ë„¥ì…˜ ì œê±° ì‹œê°„ | 600000ms (10ë¶„) |

#### ì»¤ë„¥ì…˜ í’€ ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ìƒí™©**

```
ì´ˆê¸° ìƒíƒœ: í’€ì— 10ê°œ ì»¤ë„¥ì…˜ ëŒ€ê¸° ì¤‘

ìš”ì²­ 1: save() í˜¸ì¶œ
  â”œâ”€ ì»¤ë„¥ì…˜ 1 ë¹Œë ¤ì˜´ (í’€: 9ê°œ ë‚¨ìŒ)
  â”œâ”€ INSERT ì‹¤í–‰
  â””â”€ ì»¤ë„¥ì…˜ 1 ë°˜ë‚© (í’€: 10ê°œ)

ìš”ì²­ 2: findAll() í˜¸ì¶œ
  â”œâ”€ ì»¤ë„¥ì…˜ 2 ë¹Œë ¤ì˜´ (í’€: 9ê°œ ë‚¨ìŒ)
  â”œâ”€ SELECT ì‹¤í–‰
  â””â”€ ì»¤ë„¥ì…˜ 2 ë°˜ë‚© (í’€: 10ê°œ)
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: ë™ì‹œ ìš”ì²­ ë§ì€ ê²½ìš°**

```
í’€: 10ê°œ ì»¤ë„¥ì…˜

ë™ì‹œì— 15ê°œ ìš”ì²­ ë°œìƒ
  â”œâ”€ 10ê°œ ìš”ì²­: ì¦‰ì‹œ ì»¤ë„¥ì…˜ í• ë‹¹ âœ…
  â””â”€ 5ê°œ ìš”ì²­: ëŒ€ê¸° â³
      â””â”€ connection-timeout(30ì´ˆ) ë‚´ì— ë°˜ë‚©ë˜ë©´ âœ…
      â””â”€ 30ì´ˆ ì´ˆê³¼ ì‹œ ì—ëŸ¬ ë°œìƒ âŒ
```

#### JDBC vs ì»¤ë„¥ì…˜ í’€ ë¹„êµ

| í•­ëª© | JDBC ì§ì ‘ ì‚¬ìš© | ì»¤ë„¥ì…˜ í’€ |
|-----|---------------|----------|
| ì—°ê²° ìƒì„± | ë§¤ë²ˆ ìƒì„± (ëŠë¦¼) | ë¯¸ë¦¬ ìƒì„± (ë¹ ë¦„) |
| ì—°ê²° ì¢…ë£Œ | ë§¤ë²ˆ ì¢…ë£Œ | í’€ì— ë°˜ë‚© (ì¬ì‚¬ìš©) |
| ì„±ëŠ¥ | ë‚˜ì¨ | ì¢‹ìŒ â­ |
| ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ | ìˆ˜ë™ | ìë™ â­ |
| ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ | ë¹„íš¨ìœ¨ì  | íš¨ìœ¨ì  â­ |

#### í•µì‹¬ ì •ë¦¬

**ì»¤ë„¥ì…˜ í’€ì˜ 3ê°€ì§€ í•µì‹¬**:

1. **ë¯¸ë¦¬ ìƒì„±**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ Connectionë“¤ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ 
2. **ì¬ì‚¬ìš©**: `close()`ê°€ ì‹¤ì œ ì¢…ë£Œê°€ ì•„ë‹ˆë¼ í’€ì— ë°˜ë‚© (ë‹¤ì‹œ ì‚¬ìš© ê°€ëŠ¥)
3. **ìë™ ê´€ë¦¬**: Springì´ ë¹Œë¦¬ê¸°/ë°˜ë‚© ëª¨ë‘ ìë™ ì²˜ë¦¬

**ê°œë°œìê°€ ì‹ ê²½ ì“¸ ê²ƒ**:
- âŒ Connection ìƒì„±/ì¢…ë£Œ: Springì´ ìë™ ì²˜ë¦¬
- âŒ ì»¤ë„¥ì…˜ í’€ ê´€ë¦¬: HikariCPê°€ ìë™ ì²˜ë¦¬
- âœ… ì ì ˆí•œ í’€ í¬ê¸° ì„¤ì •: íŠ¸ë˜í”½ì— ë§ê²Œ ì¡°ì •

**ì—°ê²° ëŒ€ìƒ**:
- í…Œì´ë¸”ì´ ì•„ë‹ˆë¼ **ë°ì´í„°ë² ì´ìŠ¤(`mydb`)** ì— ì—°ê²°
- í•˜ë‚˜ì˜ Connectionìœ¼ë¡œ ì—¬ëŸ¬ í…Œì´ë¸” ì‘ì—… ê°€ëŠ¥

---

### 3.2.12 ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜

**SpringdatajbcApplication.java**:
```java
package com.example.springdatajbc;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SpringdatajbcApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringdatajbcApplication.class, args);
    }
}
```

**ì‹¤í–‰ ìˆœì„œ**:
```
1. main() ë©”ì„œë“œ ì‹¤í–‰
2. @SpringBootApplication ì²˜ë¦¬
   â”œâ”€ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”
   â”œâ”€ ìë™ ì„¤ì •
   â””â”€ ë¹ˆ ìƒì„±
3. application.properties ì½ê¸°
   â””â”€ ì»¤ë„¥ì…˜ í’€ ì´ˆê¸°í™” (DB ì—°ê²° 10ê°œ ìƒì„±)
4. @Repository ì¸í„°í˜ì´ìŠ¤ ë°œê²¬
   â””â”€ í”„ë¡ì‹œ ê°ì²´ ìƒì„± ë° ë¹ˆ ë“±ë¡
5. @Component ë°œê²¬
   â””â”€ SpringJdbcApplication ë¹ˆ ìƒì„± ë° ì˜ì¡´ì„± ì£¼ì…
6. ApplicationRunner êµ¬í˜„ì²´ ì‹¤í–‰
   â””â”€ run() ë©”ì„œë“œ í˜¸ì¶œ
7. ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ ì™„ë£Œ
```

---



### 3.2.13 JDBC vs Spring Data JDBC ìµœì¢… ë¹„êµ

#### ì½”ë“œ ë¹„êµ

**JDBC (3.1)**:
```java
// 1. Driver ë¡œë”©
Class.forName("com.mysql.cj.jdbc.Driver");

// 2. Connection ìƒì„±
Connection conn = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/mydb", "myuser", "mypass"
);

// 3. Statement ìƒì„±
PreparedStatement stmt = conn.prepareStatement("SELECT * FROM member");

// 4. ì¿¼ë¦¬ ì‹¤í–‰
ResultSet rs = stmt.executeQuery();

// 5. ê²°ê³¼ ë§¤í•‘
while (rs.next()) {
    Member member = new Member(
        rs.getLong("id"),
        rs.getString("name"),
        rs.getString("email"),
        rs.getInt("age")
    );
    System.out.println(member);
}

// 6. ë¦¬ì†ŒìŠ¤ ì •ë¦¬
conn.close();
```

**Spring Data JDBC (3.2)**:
```java
// ì„¤ì • íŒŒì¼ (í•œ ë²ˆë§Œ)
// spring.datasource.url=jdbc:mysql://localhost:3306/mydb

// Repository ì¸í„°í˜ì´ìŠ¤ (ì„ ì–¸ë§Œ)
public interface MemberRepository extends CrudRepository<Member, Long> {
    List<Member> findByAgeGreaterThan(int age);
}

// ì‚¬ìš©
List<Member> members = memberRepository.findAll();
members.forEach(System.out::println);
```

**ì½”ë“œ ë¼ì¸ ìˆ˜**: 25ì¤„ â†’ 3ì¤„ (ì•½ 88% ê°ì†Œ!)

#### ì¥ë‹¨ì  ë¹„êµ

| íŠ¹ì§• | JDBC | Spring Data JDBC |
|-----|------|-----------------|
| **ì½”ë“œ ì–‘** | ë§ìŒ âŒ | ì ìŒ âœ… |
| **ë°˜ë³µ ì½”ë“œ** | ë§ìŒ âŒ | ì—†ìŒ âœ… |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ âœ… | ì¤‘ê°„ |
| **ìœ ì—°ì„±** | ë†’ìŒ âœ… | ì¤‘ê°„ |
| **ì„±ëŠ¥ ìµœì í™”** | ì‰¬ì›€ âœ… | ì œí•œì  |
| **ìƒì‚°ì„±** | ë‚®ìŒ âŒ | ë†’ìŒ âœ… |
| **ì»¤ë„¥ì…˜ ê´€ë¦¬** | ìˆ˜ë™ âŒ | ìë™ âœ… |
| **SQL ê°€ì‹œì„±** | ëª…í™• âœ… | ìˆ¨ê²¨ì§ (ë¡œê·¸ë¡œ í™•ì¸) |

---

### 3.2.14 Spring Data JDBCì˜ í•œê³„

#### í•œê³„ 1: ë³µì¡í•œ ì—°ê´€ê´€ê³„

**ë¬¸ì œ**:
```java
// Member - Order ê´€ê³„ (1:N)
// Spring Data JDBCì—ì„œëŠ” ë³µì¡í•¨
@Table
public class Member {
    @Id
    private Long id;
    private String name;
    
    // @ManyToOne ê°™ì€ ì• ë…¸í…Œì´ì…˜ì´ ì œí•œì 
}
```
í…Œì´ë¸”ê³¼ì˜ ì—°ê´€ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.

**í•´ê²°**: JPA ì‚¬ìš© (3.4ì—ì„œ í•™ìŠµ) @Entity ì™€ @ManyToOne , @ManyToMany ë“±ë“± ì‚¬ìš©ì´ ê°€ëŠ¥

#### í•œê³„ 2: DDL ìë™ ìƒì„±
DDL ìë™ ìƒì„± ë¯¸ì§€ì›
Spring Data JDBCëŠ” JPAì˜ í•µì‹¬ í¸ì˜ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì¸ DDL(Data Definition Language) ìë™ ìƒì„± ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ


| ëª…ë ¹ì–´ | ì—­í•  | 
|-----|------|
| **CREATE TABLE** |í…Œì´ë¸” ìƒì„± |
| **ALTER TABLE** | í…Œì´ë¸” ìˆ˜ì •|
| **DROP TABLE** | í…Œì´ë¸” ì‚­ì œ |
| **TRUNCATE TABLE** | í…Œì´ë¸” ë°ì´í„° ì‚­ì œ |


ğŸ“Œ ë¬¸ì œ ìƒí™© (ìˆ˜ë™ ì‘ì—… í•„ìš”)
ìë°” ì—”í‹°í‹°ì— ìƒˆë¡œìš´ í•„ë“œë¥¼ ì¶”ê°€í•˜ë”ë¼ë„, ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì—ëŠ” ìˆ˜ë™ìœ¼ë¡œ SQLì„ ì‘ì„±í•˜ì—¬ ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

```java


// Java ì—”í‹°í‹°ì— í•„ë“œ ì¶”ê°€
@Table
public class Member {
    @Id
    private Long id;
    private String name;
    // ...
    private String phone;  // ğŸ‘ˆ ìƒˆë¡œ ì¶”ê°€!
}

```
SQL

- âŒ Spring Data JDBCëŠ” ì´ ë¶€ë¶„ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ!
- í…Œì´ë¸”ì— ì»¬ëŸ¼ì„ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•´ì•¼ í•¨!
ALTER TABLE member ADD COLUMN phone VARCHAR(255);
ê²°ê³¼: ì—”í‹°í‹° ìˆ˜ì • ì‹œ SQLì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ë¯€ë¡œ í…Œì´ë¸”ê³¼ ì—”í‹°í‹° ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ê³  ê°œë°œ ì†ë„ê°€ ì €í•˜!

**í•´ê²°**: JPA ì‚¬ìš© (3.4ì—ì„œ í•™ìŠµ) : JPAëŠ” ì„¤ì • íŒŒì¼ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì—”í‹°í‹°ë¥¼ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ DDLì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
```
application.properties
spring.jpa.hibernate.ddl-auto=update
```


## 3.3 MyBatis

### 3.3.1 MyBatisë€?

**MyBatis**ëŠ” SQL ì¤‘ì‹¬ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ í”„ë ˆì„ì›Œí¬ë¡œ, **ê°œë°œìê°€ ì‘ì„±í•œ SQLê³¼ Java ê°ì²´ë¥¼ ë§¤í•‘**í•˜ëŠ” ë° íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

#### í•µì‹¬ ê°œë…

```
[ê°œë°œì]
    â†“ (SQL ì§ì ‘ ì‘ì„±)
[MyBatis]
    â†“ (JDBC ì½”ë“œ ìë™ ìƒì„± ë° ê²°ê³¼ ë§¤í•‘)
[JDBC Driver]
    â†“
[ë°ì´í„°ë² ì´ìŠ¤]
```

**MyBatisì˜ ì—­í• **:
- ê°œë°œì: SQLë§Œ ì‘ì„±
- MyBatis: Connection, PreparedStatement, ResultSet ë“± **JDBC ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ìë™ ì²˜ë¦¬**
- ê²°ê³¼ë¥¼ Java ê°ì²´ë¡œ ìë™ ë§¤í•‘

---

### 3.3.2 Spring Data JDBC vs MyBatis

#### ê·¼ë³¸ì ì¸ ì°¨ì´

| íŠ¹ì§• | Spring Data JDBC | MyBatis |
|-----|-----------------|---------|
| **ì² í•™** | ë„ë©”ì¸(ê°ì²´) ì¤‘ì‹¬ | **SQL ì¤‘ì‹¬** â­ |
| **SQL ì‘ì„±** | ë©”ì„œë“œ ì´ë¦„ ìë™ ìƒì„± + @Query | **í•­ìƒ ì§ì ‘ ì‘ì„±** (XML ë˜ëŠ” ì• ë…¸í…Œì´ì…˜) |
| **SQL ìœ„ì¹˜** | ì¸ë¼ì¸(@Query ë‚´ë¶€) | **ë³„ë„ XML íŒŒì¼** (ë¶„ë¦¬) |
| **ë™ì  SQL** | ì œí•œì  | **ê°•ë ¥í•œ ì§€ì›** â­ |
| **ë³µì¡í•œ ì¿¼ë¦¬** | ì–´ë ¤ì›€ | **ë§¤ìš° ìœ ë¦¬** â­ |
| **ì„±ëŠ¥ ìµœì í™”** | ì œí•œì  | **ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥** â­ |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ | ì¤‘ê°„ |
| **ì½”ë“œ ì–‘** | ì ìŒ | ì¤‘ê°„ (XML ì‘ì„±) |

#### ì™œ MyBatisë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

**Spring Data JDBC + @Queryì˜ í•œê³„**:

```java
// Spring Data JDBC
@Query("SELECT * FROM member WHERE " +
       "(:name IS NULL OR name LIKE %:name%) AND " +
       "(:minAge IS NULL OR age >= :minAge) AND " +
       "(:maxAge IS NULL OR age <= :maxAge)")
List<Member> search(@Param("name") String name, 
                    @Param("minAge") Integer minAge,
                    @Param("maxAge") Integer maxAge);
```

**ë¬¸ì œì **:
- âŒ SQLì´ Java ë¬¸ìì—´ ì•ˆì— ìˆì–´ ê°€ë…ì„± ì €í•˜
- âŒ ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ ì‘ì„± ì–´ë ¤ì›€
- âŒ SQL ë¬¸ë²• ê²€ì¦ ë¶ˆê°€ (ì»´íŒŒì¼ ì‹œì )
- âŒ SQLì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

**MyBatisì˜ í•´ê²°**:

```xml
<!-- XML íŒŒì¼ì— SQL ë¶„ë¦¬ -->
<select id="search" resultType="Member">
    SELECT * FROM member
    <where>
        <if test="name != null">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="minAge != null">
            AND age >= #{minAge}
        </if>
        <if test="maxAge != null">
            AND age <= #{maxAge}
        </if>
    </where>
</select>
```

**ì¥ì **:
- âœ… SQLì´ ë…ë¦½ëœ íŒŒì¼ë¡œ ë¶„ë¦¬ (ê°€ë…ì„± í–¥ìƒ)
- âœ… **ë™ì  SQL** ì‘ì„± ìš©ì´ (`<if>`, `<choose>`, `<foreach>` ë“±)
- âœ… SQL ì¬ì‚¬ìš© ê°€ëŠ¥ (`<include>`)
- âœ… ì¡°ê±´ì— ë”°ë¼ ì¿¼ë¦¬ ìì²´ê°€ ë³€ê²½ ê°€ëŠ¥
- âœ… ë³µì¡í•œ JOIN, ì„œë¸Œì¿¼ë¦¬ì— ê°•í•¨

---

### 3.3.3 MyBatis vs Spring Data JDBC ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

#### Spring Data JDBC ì í•©í•œ ê²½ìš°

```
âœ… ë‹¨ìˆœí•œ CRUD ì‘ì—…
âœ… ë‹¨ì¼ í…Œì´ë¸” ì¡°íšŒ/ìˆ˜ì •
âœ… ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìë™ ìƒì„± ê°€ëŠ¥í•œ ì¿¼ë¦¬
âœ… ê°„ë‹¨í•œ ì¡°ê±´ ê²€ìƒ‰

ì˜ˆ: findByName(), findByAgeGreaterThan()
```

#### MyBatis ì í•©í•œ ê²½ìš°

```
âœ… ë³µì¡í•œ JOIN (3ê°œ ì´ìƒ í…Œì´ë¸”)
âœ… ë™ì  SQL (ì¡°ê±´ì— ë”°ë¼ ì¿¼ë¦¬ ë³€ê²½)
âœ… ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬ (GROUP BY, HAVING)
âœ… ì„±ëŠ¥ ìµœì í™”ê°€ ì¤‘ìš”í•œ ì¿¼ë¦¬
âœ… SQLì— ìµìˆ™í•œ íŒ€
âœ… ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸

ì˜ˆ: ê²€ìƒ‰ ê¸°ëŠ¥, í†µê³„ ë¦¬í¬íŠ¸, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```

#### ì‹¤ì „ ì˜ˆì‹œ

**ìš”êµ¬ì‚¬í•­**: íšŒì› ê²€ìƒ‰ (ì´ë¦„, ë‚˜ì´ ë²”ìœ„, ì •ë ¬ ìˆœì„œ - ëª¨ë‘ ì„ íƒ ì‚¬í•­)

**Spring Data JDBC (ë³µì¡í•¨)**:
```java
// ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì•¼ í•¨
List<Member> findByName(String name);
List<Member> findByAgeBetween(int min, int max);
List<Member> findByNameAndAgeBetween(String name, int min, int max);
// ... ì¡°í•©ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ë©”ì„œë“œ í­ë°œ!
```

**MyBatis (ê°„ë‹¨í•¨)**:
```xml
<select id="search">
    SELECT * FROM member
    <where>
        <!--    <>íƒœê·¸ ì•ˆì—ì„œëŠ” #{} ì´ ì•„ë‹Œ ë°”ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.     -->
        <if test="name != null">AND name LIKE #{name}</if>
        <if test="minAge != null">AND age >= #{minAge}</if>
        <if test="maxAge != null">AND age <= #{maxAge}</if>
    </where>
    <if test="orderBy != null">
        ORDER BY ${orderBy} ${direction}
    </if>
</select>
```

---

### 3.3.4 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€

**build.gradle**:
```gradle
dependencies {
    // MyBatis Spring Boot Starter
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.5'
    
    // H2 Database (ë‚´ì¥ DB, í…ŒìŠ¤íŠ¸ìš©)
    runtimeOnly 'com.h2database:h2'
    
    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter-test:3.0.5'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  |
|-------|------|
| `mybatis-spring-boot-starter` | MyBatisë¥¼ Spring Bootì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ í†µí•© |
| `h2` | ë‚´ì¥í˜• ë°ì´í„°ë² ì´ìŠ¤ (ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”) |

**H2 Databaseì˜ íŠ¹ì§•**:
- ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ë‚´ì¥**ë˜ì–´ ì‹¤í–‰
- **ë©”ëª¨ë¦¬ ê¸°ë°˜** (ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì´ˆê¸°í™”)
- **í…ŒìŠ¤íŠ¸ ë° ê°œë°œ í™˜ê²½**ì— ì í•©
- ë³„ë„ DB ì„œë²„ ì„¤ì¹˜ ë¶ˆí•„ìš”
- H2ë„ ë°ì´í„°ë² ì´ìŠ¤ì´ë¯€ë¡œ **JDBC Driver í•„ìš”** (h2 ì˜ì¡´ì„±ì´ Driver í¬í•¨)

---

### 3.3.5 ì„¤ì • íŒŒì¼

**application.properties**:
```properties
spring.application.name=mybatisSample

# ========================================
# MyBatis ì„¤ì •
# ========================================
# SQLì´ ì‘ì„±ëœ XML íŒŒì¼ ìœ„ì¹˜
mybatis.mapper-locations=classpath:mapper/**/*.xml

# ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ â†’ ì¹´ë©œ ì¼€ì´ìŠ¤ ìë™ ë³€í™˜
mybatis.configuration.map-underscore-to-camel-case=true

# ========================================
# H2 Database ì´ˆê¸°í™”
# ========================================
# schema.sql, data.sql ìë™ ì‹¤í–‰
spring.sql.init.mode=always
spring.sql.init.encoding=utf-8
```

#### ì„¤ì • ì„¤ëª…

| ì†ì„± | ì„¤ëª… |
|-----|------|
| `mybatis.mapper-locations` | SQL Mapper XML íŒŒì¼ ê²½ë¡œ (`src/main/resources/mapper/` í•˜ìœ„ ëª¨ë“  XML) |
| `map-underscore-to-camel-case` | DB ì»¬ëŸ¼ `user_name` â†’ Java í•„ë“œ `userName` ìë™ ë§¤í•‘ |
| `spring.sql.init.mode` | ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (H2 í…ŒìŠ¤íŠ¸ìš©) |

---

### 3.3.6 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/example/mybatisSample/
â”œâ”€ mapper/              # Mapper ì¸í„°í˜ì´ìŠ¤
â”‚  â”œâ”€ MemberMapper.java
â”‚  â””â”€ ArticleMapper.java
â”œâ”€ model/               # ë„ë©”ì¸ ëª¨ë¸ (Entity)
â”‚  â”œâ”€ Member.java
â”‚  â””â”€ Article.java
â””â”€ MyBatisApplication.java

src/main/resources/
â”œâ”€ mapper/              # SQL Mapper XML
â”‚  â””â”€ MemberMapper.xml
â”œâ”€ schema.sql           # í…Œì´ë¸” ìƒì„± SQL
â”œâ”€ data.sql             # ì´ˆê¸° ë°ì´í„° SQL
â””â”€ application.properties
```

---

### 3.3.7 ëª¨ë¸ í´ë˜ìŠ¤ (Model)

#### Member í´ë˜ìŠ¤

**Member.java**:
```java
package com.example.mybatisSample.model;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class Member {
    private Long id;
    private String name;
    private String email;
    private Integer age;
}
```

#### Article í´ë˜ìŠ¤

**Article.java**:
```java
package com.example.mybatisSample.model;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.Date;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Article {
    private Long id;
    private String title;
    private String description;
    private Date created;
    private Date updated;
    private Long memberId;
}
```

#### Spring Data JDBCì™€ì˜ ì°¨ì´
#### í´ë˜ìŠ¤ì˜ ì •ì²´ì„±

| í”„ë ˆì„ì›Œí¬ | í´ë˜ìŠ¤ ì—­í•  | ë¹„ìœ  |
|----------|-----------|------|
| **Spring Data JDBC** | **í…Œì´ë¸” + ê·¸ë¦‡** | ì„¤ê³„ë„ = ê±´ë¬¼ |
| **MyBatis** | **ê·¸ë¦‡ë§Œ** | ì°½ê³ ì—ì„œ ë¬¼ê±´ êº¼ë‚´ì„œ ìƒìì— ë‹´ê¸° |

---

#### Spring Data JDBC - "í´ë˜ìŠ¤ = í…Œì´ë¸”"

```java
@Table  // â‘  í…Œì´ë¸” ì„ ì–¸ + â‘¡ ê²°ê³¼ ë‹´ëŠ” ê·¸ë¦‡ (ì´ì¤‘ ì—­í• !)
public class Member {
    @Id
    private Long id;
    private String name;
}
```

**íŠ¹ì§•**:
```
í´ë˜ìŠ¤ â†â†’ í…Œì´ë¸” (ì™„ì „íˆ ë™ì¼ì‹œ)

- í´ë˜ìŠ¤ êµ¬ì¡° = í…Œì´ë¸” êµ¬ì¡°
- í´ë˜ìŠ¤ ë³€ê²½ â†’ í…Œì´ë¸” ë³€ê²½ í•„ìš”
- í…Œì´ë¸” ë³€ê²½ â†’ í´ë˜ìŠ¤ ë³€ê²½ í•„ìš”
```

**ë¬¸ì œ ë°œìƒ**:
- âŒ **ì—°ê´€ê´€ê³„ í‘œí˜„ ì œí•œ**: `@ManyToOne`, `@OneToMany` ë¶€ì¡±
- âŒ **ë™ê¸°í™” í•„ìš”**: í…Œì´ë¸” â†” í´ë˜ìŠ¤ í•­ìƒ ì¼ì¹˜í•´ì•¼ í•¨
---

#### MyBatis - "í´ë˜ìŠ¤ = SQL ê²°ê³¼ ë‹´ëŠ” ê·¸ë¦‡"

```java
// ì• ë…¸í…Œì´ì…˜ ì—†ìŒ! ìˆœìˆ˜ ê·¸ë¦‡!
public class Member {
    private Long id;
    private String name;
}
```

```xml
<select id="selectAll" resultType="Member">
    SELECT id, name FROM member
</select>
```

**íŠ¹ì§•**:
```
SQL ì‹¤í–‰ â†’ ResultSet â†’ í´ë˜ìŠ¤(ê·¸ë¦‡)

- í…Œì´ë¸”ê³¼ í´ë˜ìŠ¤ ë…ë¦½ì 
- SQLì´ í…Œì´ë¸” ê²°ì •
- í´ë˜ìŠ¤ëŠ” ê²°ê³¼ë§Œ ë‹´ìŒ
```

**ë¬¸ì œ í•´ê²°**:
- âœ… **ì—°ê´€ê´€ê³„ ììœ **: SQLë¡œ JOIN ë§ˆìŒëŒ€ë¡œ
- âœ… **ë™ê¸°í™” ë¶ˆí•„ìš”**: í…Œì´ë¸” â†” í´ë˜ìŠ¤ ë…ë¦½ì 
- âœ… **í•„ìš”í•œ ì»¬ëŸ¼ë§Œ**: SELECT id, nameë§Œ ê°€ëŠ¥

---

#### ë¹„êµí‘œ

| í•­ëª© | Spring Data JDBC | MyBatis |
|-----|-----------------|---------|
| **í´ë˜ìŠ¤ ì •ì²´ì„±** | í…Œì´ë¸” ê·¸ ìì²´ | SQL ê²°ê³¼ ê·¸ë¦‡ |
| **í…Œì´ë¸” ë§¤í•‘** | `@Table` í•„ìˆ˜ | ì• ë…¸í…Œì´ì…˜ ë¶ˆí•„ìš” |
| **í…Œì´ë¸”-í´ë˜ìŠ¤ ê´€ê³„** | ì™„ì „íˆ ë™ì¼í•´ì•¼ í•¨ | ë…ë¦½ì  |
| **ì—°ê´€ê´€ê³„** | âŒ ì œí•œì  | âœ… SQLë¡œ ììœ ë¡­ê²Œ |
| **í…Œì´ë¸” ë³€ê²½ ì‹œ** | âŒ í´ë˜ìŠ¤ë„ ë³€ê²½ | âœ… SQLë§Œ ë³€ê²½ |
| **í´ë˜ìŠ¤ ë³€ê²½ ì‹œ** | âŒ í…Œì´ë¸”ë„ ë³€ê²½ | âœ… ì˜í–¥ ì—†ìŒ |
| **ë™ê¸°í™” ë¬¸ì œ** | âŒ í•­ìƒ ë°œìƒ | âœ… ì—†ìŒ |

---

#### ì‹¤ì „ ì˜ˆì‹œ

##### ì‹œë‚˜ë¦¬ì˜¤: í…Œì´ë¸”ì— phone ì»¬ëŸ¼ ì¶”ê°€

**ë°ì´í„°ë² ì´ìŠ¤**:
```sql
ALTER TABLE member ADD COLUMN phone VARCHAR(20);
```

**Spring Data JDBC**:
```java
@Table
public class Member {
    @Id private Long id;
    private String name;
    private String phone;  // âŒ í•„ìˆ˜ ì¶”ê°€! (ì•ˆ í•˜ë©´ ë¬¸ì œ)
}
```

**MyBatis**:
```java
// âœ… í´ë˜ìŠ¤ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥!
public class Member {
    private Long id;
    private String name;
    // phone ì—†ì–´ë„ ë¨!
}
```

```xml
<!-- âœ… í•„ìš”í•  ë•Œë§Œ SELECT -->
<select id="selectAll" resultType="Member">
    SELECT id, name FROM member  <!-- phone ì•ˆ ê°€ì ¸ì™€ë„ OK -->
</select>

<!-- phone í•„ìš”í•œ ê²½ìš°ë§Œ ë³„ë„ ì¿¼ë¦¬ -->
<select id="selectWithPhone" resultType="MemberWithPhone">
    SELECT id, name, phone FROM member
</select>
```

---

##### ì‹œë‚˜ë¦¬ì˜¤: Member-Order ì—°ê´€ê´€ê³„

**Spring Data JDBC**:
```java
@Table
public class Member {
    @Id private Long id;
    private String name;
    
    // âŒ ì—°ê´€ê´€ê³„ í‘œí˜„ì´ ì œí•œì 
    // private List<Order> orders;
}
```

**MyBatis**:
```java
// ê·¸ëƒ¥ ê·¸ë¦‡!
public class Member {
    private Long id;
    private String name;
}

public class MemberWithOrders {
    private Long id;
    private String name;
    private List<Order> orders;  // âœ… ììœ ë¡­ê²Œ êµ¬ì„±
}
```

```xml
<!-- âœ… SQLë¡œ ììœ ë¡­ê²Œ JOIN -->
<select id="selectMemberWithOrders" resultType="MemberWithOrders">
    SELECT 
        m.id, m.name,
        o.id as order_id, o.product_name
    FROM member m
    LEFT JOIN orders o ON m.id = o.member_id
    WHERE m.id = #{id}
</select>
```

---

#### í•µì‹¬ ìš”ì•½

**Spring Data JDBC**:
```
@Table = "ë‚˜ëŠ” member í…Œì´ë¸”ì´ë©´ì„œ ë™ì‹œì— ê·¸ë¦‡ì´ì•¼!"

ì¥ì : ê°„ë‹¨í•œ CRUD ìë™í™”
ë‹¨ì : í…Œì´ë¸” = í´ë˜ìŠ¤ (ê°•ì œ), ì—°ê´€ê´€ê³„ ì•½í•¨, ë™ê¸°í™” í•„ìš”
```

**MyBatis**:
```
í´ë˜ìŠ¤ = "ë‚˜ëŠ” ê·¸ëƒ¥ ê·¸ë¦‡ì´ì•¼! í…Œì´ë¸”ì€ SQLì´ ê²°ì •í•´!"

ì¥ì : í…Œì´ë¸”-í´ë˜ìŠ¤ ë…ë¦½, ì—°ê´€ê´€ê³„ ììœ , ë³µì¡í•œ ì¿¼ë¦¬ ê°•ë ¥
ë‹¨ì : SQL ì§ì ‘ ì‘ì„± í•„ìš”
```

**ê²°ë¡ **:
- Spring Data JDBCì˜ **í•œê³„ (ì—°ê´€ê´€ê³„, ë™ê¸°í™”)**ëŠ” MyBatisì—ì„œ **ì• ì´ˆì— ë°œìƒí•˜ì§€ ì•ŠìŒ**
- í•˜ì§€ë§Œ MyBatisëŠ” ëª¨ë“  SQLì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ ì¡´ì¬


### 3.3.8 Mapper ì¸í„°í˜ì´ìŠ¤

#### @Mapper ì• ë…¸í…Œì´ì…˜

**ì—­í• **: ì´ ì¸í„°í˜ì´ìŠ¤ê°€ MyBatisì˜ SQL ë§¤í•‘ ì¸í„°í˜ì´ìŠ¤ì„ì„ ì„ ì–¸

```java
@Mapper  // MyBatisê°€ ì¸ì‹
public interface MemberMapper {
    List<Member> selectAll();
}
```

**Springì˜ ì²˜ë¦¬**:
```
1. @Mapper ìŠ¤ìº”
2. í”„ë¡ì‹œ ê°ì²´ ìë™ ìƒì„± (êµ¬í˜„ì²´)
3. ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
4. ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ ì£¼ì… ê°€ëŠ¥
```

**Spring Data JDBCì™€ ë¹„êµ**:

| í”„ë ˆì„ì›Œí¬ | ì• ë…¸í…Œì´ì…˜ | ì—­í•  |
|----------|-----------|------|
| Spring Data JDBC | `@Repository` | ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ |
| MyBatis | `@Mapper` | SQL ë§¤í•‘ ì¸í„°í˜ì´ìŠ¤ |

> **ê³µí†µì **: ë‘˜ ë‹¤ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´ Springì´ êµ¬í˜„ì²´ë¥¼ ìë™ ìƒì„±!

---

### 3.3.9 XML ê¸°ë°˜ SQL ë§¤í•‘

#### MemberMapper ì¸í„°í˜ì´ìŠ¤

**MemberMapper.java**:
```java
package com.example.mybatisSample.mapper;

import com.example.mybatisSample.model.Member;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;
import java.util.Optional;

@Mapper
public interface MemberMapper {
    List<Member> selectAll();
    Optional<Member> selectById(@Param("id") Long id);
    Optional<Member> selectByEmail(@Param("email") String email);
    List<Member> selectAllOrderByAgeAsc();
    List<Member> selectAllOrderBy(@Param("order") String order, @Param("dir") String dir);
    List<Member> selectByNameLike(@Param("name") String name);
    int selectCount();
    int insert(@Param("member") Member member);
    int update(@Param("member") Member member);
    int delete(@Param("member") Member member);
    int deleteById(@Param("id") Long id);
    int deleteAll();
}
```

#### @Param ì• ë…¸í…Œì´ì…˜

**ì—­í• **: ë©”ì„œë“œ ë§¤ê°œë³€ìˆ˜ì— ì´ë¦„ì„ ë¶€ì—¬í•˜ì—¬ XML/ì• ë…¸í…Œì´ì…˜ SQLì—ì„œ ì°¸ì¡°

```java
Optional<Member> selectByEmail(@Param("email") String email);
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                     â†“
                               XMLì—ì„œ #{email}ë¡œ ì°¸ì¡°
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```java
// ë‹¨ì¼ íŒŒë¼ë¯¸í„°
selectById(@Param("id") Long id)
// XML: #{id}

// ê°ì²´ íŒŒë¼ë¯¸í„°
insert(@Param("member") Member member)
// XML: #{member.name}, #{member.email}

// ë³µìˆ˜ íŒŒë¼ë¯¸í„°
selectAllOrderBy(@Param("order") String order, @Param("dir") String dir)
// XML: #{order}, #{dir}
```

---

### 3.3.10 MemberMapper.xml

**src/main/resources/mapper/MemberMapper.xml**:
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mybatisSample.mapper.MemberMapper">

    <!-- ì „ì²´ ì¡°íšŒ -->
    <select id="selectAll" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member
    </select>

    <!-- IDë¡œ ì¡°íšŒ -->
    <select id="selectById" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member WHERE id = #{id}
    </select>

    <!-- ì´ë©”ì¼ë¡œ ì¡°íšŒ -->
    <select id="selectByEmail" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member WHERE email = #{email}
    </select>

    <!-- ë‚˜ì´ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ -->
    <select id="selectAllOrderByAgeAsc" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member ORDER BY age ASC
    </select>

    <!-- ë™ì  ì •ë ¬ -->
    <select id="selectAllOrderBy" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member ORDER BY ${order} ${dir}
    </select>

    <!-- ì´ë¦„ LIKE ê²€ìƒ‰ -->
    <select id="selectByNameLike" resultType="com.example.mybatisSample.model.Member">
        SELECT * FROM member WHERE name LIKE #{name}
    </select>

    <!-- ê°œìˆ˜ ì¡°íšŒ -->
    <select id="selectCount" resultType="int">
        SELECT COUNT(*) FROM member
    </select>

    <!-- ì‚½ì… (ìë™ ìƒì„± í‚¤ ë°˜í™˜) -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="member.id" keyColumn="id">
        INSERT INTO member(name, email, age) 
        VALUES (#{member.name}, #{member.email}, #{member.age})
    </insert>

    <!-- ìˆ˜ì • -->
    <update id="update">
        UPDATE member 
        SET name = #{member.name}, email = #{member.email}, age = #{member.age} 
        WHERE id = #{member.id}
    </update>

    <!-- ì‚­ì œ (ê°ì²´) -->
    <delete id="delete">
        DELETE FROM member WHERE id = #{member.id}
    </delete>

    <!-- ì‚­ì œ (ID) -->
    <delete id="deleteById">
        DELETE FROM member WHERE id = #{id}
    </delete>

    <!-- ì „ì²´ ì‚­ì œ -->
    <delete id="deleteAll">
        DELETE FROM member
    </delete>

</mapper>
```

---

### 3.3.11 XML íƒœê·¸ ìƒì„¸ ì„¤ëª…

#### ê¸°ë³¸ êµ¬ì¡°

| íƒœê·¸ | ì—­í•  | í•„ìˆ˜ ì†ì„± |
|-----|------|----------|
| `<mapper>` | ë£¨íŠ¸ íƒœê·¸ | `namespace` |
| `<select>` | SELECT ì¿¼ë¦¬ | `id`, `resultType` |
| `<insert>` | INSERT ì¿¼ë¦¬ | `id` |
| `<update>` | UPDATE ì¿¼ë¦¬ | `id` |
| `<delete>` | DELETE ì¿¼ë¦¬ | `id` |

#### namespace

```xml
<mapper namespace="com.example.mybatisSample.mapper.MemberMapper">
```

**ì—­í• **: ì´ XMLì´ ì–´ë–¤ Mapper ì¸í„°í˜ì´ìŠ¤ì™€ ì—°ê²°ë ì§€ ì§€ì •

**ë§¤í•‘ ê³¼ì •**:
```
1. MyBatisê°€ @Mapper ì¸í„°í˜ì´ìŠ¤ ìŠ¤ìº”
2. namespaceì™€ ì¸í„°í˜ì´ìŠ¤ ê²½ë¡œ ë¹„êµ
3. ì¼ì¹˜í•˜ë©´ XMLê³¼ ì¸í„°í˜ì´ìŠ¤ ì—°ê²°
4. ë©”ì„œë“œ í˜¸ì¶œ ì‹œ idì™€ ì¼ì¹˜í•˜ëŠ” SQL ì‹¤í–‰
```

#### id ì†ì„±

```xml
<select id="selectAll">
```

**ì—­í• **: Mapper ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œ ì´ë¦„ê³¼ **ì •í™•íˆ ì¼ì¹˜**í•´ì•¼ í•¨

```java
// ì¸í„°í˜ì´ìŠ¤
List<Member> selectAll();

// XML
<select id="selectAll">  // ë©”ì„œë“œëª…ê³¼ ë™ì¼!
```

#### resultType

```xml
<select id="selectAll" resultType="com.example.mybatisSample.model.Member">
```

**ì—­í• **: SQL ì‹¤í–‰ ê²°ê³¼ë¥¼ ì–´ë–¤ Java íƒ€ì…ìœ¼ë¡œ ë§¤í•‘í• ì§€ ì§€ì •

**íƒ€ì…ë³„ ì‚¬ìš©**:
```xml
<!-- ë‹¨ì¼ ê°ì²´ -->
<select resultType="com.example.mybatisSample.model.Member">

<!-- ë¦¬ìŠ¤íŠ¸ (ìš”ì†Œ íƒ€ì… ì§€ì •) -->
<select resultType="com.example.mybatisSample.model.Member">

<!-- ê¸°ë³¸ íƒ€ì… -->
<select resultType="int">
<select resultType="String">
<select resultType="Long">
```

---

### 3.3.12 íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

#### #{} vs ${}

| ë¬¸ë²• | ì„¤ëª… | SQL ë³€í™˜ | ì‚¬ìš© |
|-----|------|---------|------|
| `#{íŒŒë¼ë¯¸í„°}` | **PreparedStatement** (ê¶Œì¥) | `?`ë¡œ ì¹˜í™˜ | ê°’ ë°”ì¸ë”© |
| `${íŒŒë¼ë¯¸í„°}` | **Statement** (ì£¼ì˜) | ë¬¸ìì—´ ì§ì ‘ ì‚½ì… | í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª… |

#### #{} (ê¶Œì¥) â­

```xml
<select id="selectById">
    SELECT * FROM member WHERE id = #{id}
</select>
```

**ë³€í™˜ ê³¼ì •**:
```
1. SQL: SELECT * FROM member WHERE id = ?
2. PreparedStatement ì‚¬ìš©
3. id ê°’ì„ ì•ˆì „í•˜ê²Œ ë°”ì¸ë”©
```

**ì¥ì **:
- âœ… **SQL Injection ë°©ì§€**
- âœ… ìë™ íƒ€ì… ë³€í™˜
- âœ… null ì²˜ë¦¬ ì•ˆì „

#### ${} (ì£¼ì˜!)

```xml
<select id="selectAllOrderBy">
    SELECT * FROM member ORDER BY ${order} ${dir}
</select>
```

**ë³€í™˜ ê³¼ì •**:
```
1. order = "name", dir = "ASC"
2. SQL: SELECT * FROM member ORDER BY name ASC
3. ë¬¸ìì—´ ì§ì ‘ ì¹˜í™˜
```

**ì£¼ì˜ì‚¬í•­**:
- âŒ **SQL Injection ìœ„í—˜**
- âŒ ì‚¬ìš©ì ì…ë ¥ê°’ì— ì‚¬ìš© ê¸ˆì§€
- âœ… í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª…, ORDER BY ì ˆì—ë§Œ ì‚¬ìš©

**ì•ˆì „í•œ ì‚¬ìš© ì˜ˆì‹œ**:
```java
// ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê°’ ê²€ì¦
String order = "name";  // í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦
if (!List.of("name", "age", "email").contains(order)) {
    throw new IllegalArgumentException("ì˜ëª»ëœ ì •ë ¬ ê¸°ì¤€");
}
```

---

### 3.3.13 ìë™ ìƒì„± í‚¤ ì²˜ë¦¬

#### useGeneratedKeys

```xml
<insert id="insert" useGeneratedKeys="true" keyProperty="member.id" keyColumn="id">
    INSERT INTO member(name, email, age) 
    VALUES (#{member.name}, #{member.email}, #{member.age})
</insert>
```

#### ì†ì„± ì„¤ëª…

| ì†ì„± | ì—­í•  |
|-----|------|
| `useGeneratedKeys="true"` | DBê°€ ìë™ ìƒì„±í•œ í‚¤(AUTO_INCREMENT)ë¥¼ ê°€ì ¸ì˜´ |
| `keyColumn="id"` | DB í…Œì´ë¸”ì˜ ìë™ ìƒì„± í‚¤ ì»¬ëŸ¼ëª… |
| `keyProperty="member.id"` | ìƒì„±ëœ í‚¤ ê°’ì„ ì €ì¥í•  Java ê°ì²´ í•„ë“œ |

#### ë™ì‘ ê³¼ì •

```java
Member member = Member.builder()
                      .name("í™í˜œì°½")
                      .email("test@example.com")
                      .age(25)
                      .build();

System.out.println(member.getId());  // null

memberMapper.insert(member);  // INSERT ì‹¤í–‰

System.out.println(member.getId());  // 5 (DBì—ì„œ ìƒì„±ëœ ID)
```

**ë‚´ë¶€ ë™ì‘**:
```
1. INSERT SQL ì‹¤í–‰
2. DBê°€ id = 5 ìë™ ìƒì„±
3. MyBatisê°€ ìƒì„±ëœ 5ë¥¼ ê°€ì ¸ì˜´
4. member.setId(5) ìë™ í˜¸ì¶œ
5. member ê°ì²´ ì¬ì‚¬ìš© ê°€ëŠ¥
```

#### useGeneratedKeys ìƒëµ ì‹œ

```xml
<!-- useGeneratedKeys ì—†ìŒ -->
<insert id="insert">
    INSERT INTO member(name, email, age) VALUES (#{member.name}, #{member.email}, #{member.age})
</insert>
```

```java
Member member = Member.builder().name("í™í˜œì°½").build();
memberMapper.insert(member);

System.out.println(member.getId());  // null (IDê°€ ì±„ì›Œì§€ì§€ ì•ŠìŒ)
```

**ê²°ê³¼**:
- DBì—ëŠ” ë ˆì½”ë“œ ì •ìƒ ìƒì„± (AUTO_INCREMENT ì‘ë™)
- Java ê°ì²´ì—ëŠ” IDê°€ ì±„ì›Œì§€ì§€ ì•ŠìŒ

#### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | useGeneratedKeys ì„¤ì • | ì´ìœ  |
|-----|---------------------|------|
| **ID ì¬ì‚¬ìš© í•„ìš”** | âœ… í•„ìˆ˜ | ìƒì„±ëœ IDë¡œ í›„ì† ì‘ì—… í•„ìš” |
| **ID ì¬ì‚¬ìš© ë¶ˆí•„ìš”** | âŒ ìƒëµ ê°€ëŠ¥ | ë‹¨ìˆœ INSERTë§Œ ìˆ˜í–‰ |

**ì˜ˆì‹œ**:
```java
// ì‹œë‚˜ë¦¬ì˜¤: íšŒì› ê°€ì… í›„ í™˜ì˜ ì´ë©”ì¼ ë°œì†¡
Member member = new Member("í™í˜œì°½", "test@example.com", 25);
memberMapper.insert(member);  // useGeneratedKeys="true"

// ìƒì„±ëœ IDë¡œ í™˜ì˜ ì´ë©”ì¼ ë°œì†¡
emailService.sendWelcome(member.getId(), member.getEmail());
```

---

### 3.3.14 ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ SQL ë§¤í•‘

#### ArticleMapper ì¸í„°í˜ì´ìŠ¤

**ArticleMapper.java**:
```java
package com.example.mybatisSample.mapper;

import com.example.mybatisSample.model.Article;
import org.apache.ibatis.annotations.*;

import java.util.List;
import java.util.Optional;

@Mapper
public interface ArticleMapper {
    
    @Select("SELECT * FROM article")
    List<Article> selectAll();
    
    @Select("SELECT * FROM article WHERE id = #{id}")
    Optional<Article> selectById(@Param("id") Long id);
    
    @Insert("INSERT INTO article(title, description, created, updated, member_id) " +
            "VALUES (#{article.title}, #{article.description}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, #{article.memberId})")
    @Options(useGeneratedKeys = true, keyColumn = "id", keyProperty = "article.id")
    int insert(@Param("article") Article article);
    
    @Update("UPDATE article SET title = #{title}, description = #{description}, updated = CURRENT_TIMESTAMP WHERE id = #{id}")
    int update(@Param("id") Long id, @Param("title") String title, @Param("description") String description);
    
    @Delete("DELETE FROM article WHERE id = #{id}")
    int deleteById(@Param("id") Long id);
}
```

#### ì• ë…¸í…Œì´ì…˜ ì¢…ë¥˜

| ì• ë…¸í…Œì´ì…˜ | ì—­í•  | SQL ì¢…ë¥˜ |
|-----------|------|----------|
| `@Select` | SELECT ì¿¼ë¦¬ | ì¡°íšŒ |
| `@Insert` | INSERT ì¿¼ë¦¬ | ì‚½ì… |
| `@Update` | UPDATE ì¿¼ë¦¬ | ìˆ˜ì • |
| `@Delete` | DELETE ì¿¼ë¦¬ | ì‚­ì œ |
| `@Options` | ì¶”ê°€ ì˜µì…˜ (ìë™ ìƒì„± í‚¤ ë“±) | INSERT |

#### XML vs ì• ë…¸í…Œì´ì…˜ ë¹„êµ

**XML ë°©ì‹**:
```xml
<!-- MemberMapper.xml -->
<select id="selectAll" resultType="Member">
    SELECT * FROM member
</select>
```

**ì• ë…¸í…Œì´ì…˜ ë°©ì‹**:
```java
// ArticleMapper.java
@Select("SELECT * FROM article")
List<Article> selectAll();
```

#### ì–¸ì œ ì–´ë–¤ ë°©ì‹ì„ ì‚¬ìš©í• ê¹Œ?

| ìƒí™© | XML | ì• ë…¸í…Œì´ì…˜ |
|-----|-----|-----------|
| **ë‹¨ìˆœí•œ ì¿¼ë¦¬** | âŒ | âœ… ê¶Œì¥ |
| **ë³µì¡í•œ ì¿¼ë¦¬** | âœ… ê¶Œì¥ | âŒ |
| **ë™ì  SQL** | âœ… ê¶Œì¥ | âŒ |
| **SQL ì¬ì‚¬ìš©** | âœ… ê¶Œì¥ | âŒ |
| **ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘** | âŒ | âœ… ê¶Œì¥ |

**ì‹¤ë¬´ ê¶Œì¥**:
- ë³µì¡í•œ ì¿¼ë¦¬, ë™ì  SQL â†’ **XML**
- ë‹¨ìˆœí•œ CRUD â†’ **ì• ë…¸í…Œì´ì…˜**

---

### 3.3.15 ì»¬ëŸ¼ëª…ê³¼ í•„ë“œëª… ë¶ˆì¼ì¹˜ í•´ê²°

#### ë¬¸ì œ ìƒí™©

**ë°ì´í„°ë² ì´ìŠ¤**:
```sql
CREATE TABLE article (
    id BIGINT,
    title VARCHAR(255),
    content VARCHAR(1000),  -- Java í•„ë“œëŠ” 'description'
    member_id BIGINT
);
```

**Java í´ë˜ìŠ¤**:
```java
public class Article {
    private Long id;
    private String title;
    private String description;  // DB ì»¬ëŸ¼ì€ 'content'
    private Long memberId;
}
```

#### í•´ê²° ë°©ë²•

##### ë°©ë²• 1: application.properties ì„¤ì • (ê¶Œì¥) â­

```properties
mybatis.configuration.map-underscore-to-camel-case=true
```

**ìë™ ë³€í™˜**:
```
DB: member_id  â†’ Java: memberId
DB: created_at â†’ Java: createdAt
DB: user_name  â†’ Java: userName
```

**ì¥ì **:
- âœ… ì „ì—­ ì„¤ì • (í•œ ë²ˆë§Œ ì‘ì„±)
- âœ… ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ â†” ì¹´ë©œ ì¼€ì´ìŠ¤ ìë™ ë³€í™˜
- âœ… ëŒ€ë¶€ë¶„ì˜ ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°

**í•œê³„**:
- âŒ `content` â†” `description` ê°™ì€ ì™„ì „íˆ ë‹¤ë¥¸ ì´ë¦„ì€ í•´ê²° ëª» í•¨

##### ë°©ë²• 2: SQL AS í‚¤ì›Œë“œ (ì„ íƒì )

```sql
SELECT id, title, content AS description, member_id 
FROM article
```

**ì ìš©**:
```java
@Select("SELECT id, title, content AS description, member_id FROM article")
List<Article> selectAll();
```

**ì¥ì **:
- âœ… ê°„ë‹¨í•œ ê²½ìš° ë¹ ë¥´ê²Œ í•´ê²°

**ë‹¨ì **:
- âŒ ëª¨ë“  SELECT ë¬¸ì— ë°˜ë³µ ì‘ì„±
- âŒ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

##### ë°©ë²• 3: `<resultMap>` (ì™„ì „í•œ ì œì–´) â­

**XML**:
```xml
<resultMap id="articleResult" type="com.example.mybatisSample.model.Article">
    <result column="content" property="description"/>
    <result column="member_id" property="memberId"/>
</resultMap>

<select id="selectAll" resultMap="articleResult">
    SELECT * FROM article
</select>

<select id="selectById" resultMap="articleResult">
    SELECT * FROM article WHERE id = #{id}
</select>
```

**ì¬ì‚¬ìš© ê°€ëŠ¥**:
- í•œ ë²ˆ ì •ì˜í•˜ë©´ ì—¬ëŸ¬ ì¿¼ë¦¬ì—ì„œ `resultMap="articleResult"` ì°¸ì¡°

**ì• ë…¸í…Œì´ì…˜**:
```java
@Results(id = "articleResult", value = {
    @Result(column = "content", property = "description"),
    @Result(column = "member_id", property = "memberId")
})
@Select("SELECT * FROM article")
List<Article> selectAll();

@ResultMap("articleResult")  // ì¬ì‚¬ìš©
@Select("SELECT * FROM article WHERE id = #{id}")
Optional<Article> selectById(@Param("id") Long id);
```

**ì‚¬ìš© ì‹œì **:
- ì²« ë²ˆì§¸ ì¿¼ë¦¬: `@Results`ë¡œ ì •ì˜
- ì´í›„ ì¿¼ë¦¬: `@ResultMap`ìœ¼ë¡œ ì¬ì‚¬ìš©

**ì¥ì **:
- âœ… ì™„ì „í•œ ì»¤ìŠ¤í…€ ë§¤í•‘ ê°€ëŠ¥
- âœ… ì¬ì‚¬ìš© ê°€ëŠ¥
- âœ… ë³µì¡í•œ ë§¤í•‘ ì²˜ë¦¬ ê°€ëŠ¥

**ë‹¨ì **:
- âŒ ì½”ë“œê°€ ê¸¸ì–´ì§

#### ê¶Œì¥ ìˆœì„œ

```
1. map-underscore-to-camel-case=true (ëŒ€ë¶€ë¶„ í•´ê²°)
   â†“
2. ì•ˆ ë˜ë©´ AS í‚¤ì›Œë“œ (ê°„ë‹¨í•œ ê²½ìš°)
   â†“
3. ì—¬ì „íˆ ì•ˆ ë˜ë©´ <resultMap> (ë³µì¡í•œ ê²½ìš°)
```

---

### 3.3.16 ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

#### MyBatisApplication í´ë˜ìŠ¤

**MyBatisApplication.java**:
```java
package com.example.mybatisSample;

import com.example.mybatisSample.mapper.ArticleMapper;
import com.example.mybatisSample.mapper.MemberMapper;
import com.example.mybatisSample.model.Article;
import com.example.mybatisSample.model.Member;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

@Slf4j
@RequiredArgsConstructor
@Component
public class MyBatisApplication implements ApplicationRunner {
    
    private final ArticleMapper articleMapper;
    private final MemberMapper memberMapper;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        
        // 1. íšŒì› ìˆ˜ ì¡°íšŒ
        int count = memberMapper.selectCount();
        log.info("count: {}", count);

        // 2. ì´ë©”ì¼ë¡œ íšŒì› ì¡°íšŒ
        Member member = memberMapper.selectByEmail("hyechang@spring.ac.kr")
                                     .orElseThrow();
        log.info("member: {}", member);

        // 3. ê²Œì‹œê¸€ ì‘ì„±
        Article article = Article.builder()
                                 .title("ì œëª©ì…ë‹ˆë‹¤.")
                                 .description("ë‚´ìš©ì…ë‹ˆë‹¤.")
                                 .memberId(member.getId())
                                 .build();
        
        int insert = articleMapper.insert(article);
        log.info("insert: {}", insert);
        log.info("ìƒì„±ëœ ê²Œì‹œê¸€ ID: {}", article.getId());  // ìë™ ìƒì„±ëœ ID ì¶œë ¥
    }
}
```

#### ë©”ì¸ í´ë˜ìŠ¤

**MybatisSampleApplication.java**:
```java
package com.example.mybatisSample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class MybatisSampleApplication {

    public static void main(String[] args) {
        SpringApplication.run(MybatisSampleApplication.class, args);
    }
}
```

---

### 3.3.17 ì‹¤í–‰ ê²°ê³¼ ë° ë¡œê·¸

#### ì‹¤í–‰ ê²°ê³¼ ë¡œê·¸ ì¶œë ¥

```
 :: Spring Boot ::                (v3.5.6)

2025-10-15T12:56:13.692+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.m.MybatisSampleApplication           : Starting MybatisSampleApplication using Java 21.0.8 with PID 32404 (C:\Users\ghddm\Desktop\SpringBoot\mybatisSample\build\classes\java\main started by ghddm in C:\Users\ghddm\Desktop\SpringBoot\mybatisSample)
2025-10-15T12:56:13.698+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.m.MybatisSampleApplication           : No active profile set, falling back to 1 default profile: "default"
2025-10-15T12:56:15.404+09:00  INFO 32404 --- [mybatisSample] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-10-15T12:56:15.834+09:00  INFO 32404 --- [mybatisSample] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:daa4c2b0-93b6-4052-8dca-ecd1ca6e5774 user=SA
2025-10-15T12:56:15.839+09:00  INFO 32404 --- [mybatisSample] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-10-15T12:56:16.510+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.m.MybatisSampleApplication           : Started MybatisSampleApplication in 4.122 seconds (process running for 5.349)
2025-10-15T12:56:16.571+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.mybatisSample.MyBatisApplication     : count: 4
2025-10-15T12:56:16.581+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.mybatisSample.MyBatisApplication     : member: Member(id=1, name=í™í˜œì°½, email=hyechang@spring.ac.kr, age=10)
2025-10-15T12:56:16.589+09:00  INFO 32404 --- [mybatisSample] [           main] c.e.mybatisSample.MyBatisApplication     : insert: 1
2025-10-15T12:56:16.599+09:00  INFO 32404 --- [mybatisSample] [ionShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-10-15T12:56:16.603+09:00  INFO 32404 --- [mybatisSample] [ionShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
```

---

### 3.3.18 Spring Data JDBC vs MyBatis ìµœì¢… ë¹„êµ

#### ì½”ë“œ ë¹„êµ

**Spring Data JDBC**:
```java
// Repository ì¸í„°í˜ì´ìŠ¤
public interface MemberRepository extends CrudRepository<Member, Long> {
    List<Member> findByEmail(String email);  // ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìë™ ìƒì„±
    
    @Query("SELECT * FROM member WHERE name LIKE :name")  // ë³µì¡í•œ ì¿¼ë¦¬ëŠ” @Query
    List<Member> searchByName(@Param("name") String name);
}
```

**MyBatis**:
```java
// Mapper ì¸í„°í˜ì´ìŠ¤
@Mapper
public interface MemberMapper {
    Optional<Member> selectByEmail(@Param("email") String email);
    List<Member> searchByName(@Param("name") String name);
}
```

```xml
<!-- SQLì€ XMLì— ë¶„ë¦¬ -->
<select id="selectByEmail">
    SELECT * FROM member WHERE email = #{email}
</select>

<select id="searchByName">
    SELECT * FROM member WHERE name LIKE #{name}
</select>
```

#### íŠ¹ì§• ë¹„êµ

| íŠ¹ì§• | Spring Data JDBC | MyBatis |
|-----|-----------------|---------|
| **SQL ìë™ ìƒì„±** | âœ… ë©”ì„œë“œ ì´ë¦„ ê·œì¹™ | âŒ í•­ìƒ ì§ì ‘ ì‘ì„± |
| **SQL ìœ„ì¹˜** | Java ì½”ë“œ ë‚´ë¶€ | **XML íŒŒì¼ ë¶„ë¦¬** â­ |
| **ë™ì  SQL** | ì œí•œì  | **ê°•ë ¥í•œ ì§€ì›** â­ |
| **ë³µì¡í•œ ì¿¼ë¦¬** | ì–´ë ¤ì›€ | **ë§¤ìš° ìœ ë¦¬** â­ |
| **ì½”ë“œ ì–‘** | ì ìŒ | ì¤‘ê°„ (XML) |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ | ì¤‘ê°„ |
| **SQL ì œì–´** | ì œí•œì  | **ì™„ì „í•œ ì œì–´** â­ |
| **ê°€ë…ì„±** | ì¤‘ê°„ | **ë†’ìŒ** (SQL ë¶„ë¦¬) â­ |
| **í…ŒìŠ¤íŠ¸** | ì‰¬ì›€ | ì¤‘ê°„ |

---

### 3.3.19 MyBatisì˜ ì¥ë‹¨ì 

#### ì¥ì 

**1. SQLì— ëŒ€í•œ ì™„ì „í•œ ì œì–´** â­
```xml
<!-- ë³µì¡í•œ JOINë„ ììœ ë¡­ê²Œ -->
<select id="selectWithMember">
    SELECT a.*, m.name as member_name
    FROM article a
    INNER JOIN member m ON a.member_id = m.id
    WHERE a.created > #{startDate}
    ORDER BY a.created DESC
</select>
```

**2. ë™ì  SQL ê°•ë ¥** â­
```xml
<select id="search">
    SELECT * FROM member
    <where>
        <if test="name != null">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="minAge != null">
            AND age >= #{minAge}
        </if>
        <if test="maxAge != null">
            AND age <= #{maxAge}
        </if>
    </where>
    <if test="orderBy != null">
        ORDER BY ${orderBy} ${direction}
    </if>
</select>
```

**3. SQL ë¶„ë¦¬ë¡œ ê°€ë…ì„± í–¥ìƒ** â­
```
Java ì½”ë“œ: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ
XML íŒŒì¼: SQLë§Œ

â†’ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ (Separation of Concerns)
```

**4. ì„±ëŠ¥ ìµœì í™” ìš©ì´**
- í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ ê°€ëŠ¥
- ë³µì¡í•œ ì„œë¸Œì¿¼ë¦¬, WITHì ˆ ììœ ë¡­ê²Œ ì‚¬ìš©
- ì¸ë±ìŠ¤ íŒíŠ¸ ë“± DB íŠ¹í™” ê¸°ëŠ¥ í™œìš©

**5. SQLì— ìµìˆ™í•œ íŒ€ì— ì í•©**
- DBAê°€ ì‘ì„±í•œ ìµœì í™”ëœ SQL ê·¸ëŒ€ë¡œ ì‚¬ìš©
- ê¸°ì¡´ SQL ìì‚° ì¬í™œìš© ê°€ëŠ¥

#### ë‹¨ì 

**1. ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì¦ê°€**
```java
// ë©”ì„œë“œë§ˆë‹¤ SQL ì‘ì„± í•„ìš”
@Select("SELECT * FROM member")
List<Member> selectAll();

@Select("SELECT * FROM member WHERE id = #{id}")
Optional<Member> selectById(@Param("id") Long id);
```

**2. ë‹¨ìˆœ CRUDë„ ì§ì ‘ ì‘ì„±**
```xml
<!-- Spring Data JDBCëŠ” ìë™ì¸ë°... -->
<select id="findById">SELECT * FROM member WHERE id = #{id}</select>
<insert id="insert">INSERT INTO member(...) VALUES(...)</insert>
<update id="update">UPDATE member SET ... WHERE id = #{id}</update>
<delete id="delete">DELETE FROM member WHERE id = #{id}</delete>
```

**3. XML íŒŒì¼ ê´€ë¦¬ ë¶€ë‹´**
- ì¸í„°í˜ì´ìŠ¤ì™€ XML íŒŒì¼ ë™ê¸°í™” í•„ìš”
- ë©”ì„œë“œëª… ì˜¤íƒ€ ì‹œ ëŸ°íƒ€ì„ ì—ëŸ¬

**4. íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±**
```xml
<!-- ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ ë°œê²¬ ëª» í•¨ -->
<select id="selectById">
    SELECT * FROM member WHERE id = #{idx}  <!-- idê°€ ì•„ë‹ˆë¼ idx? -->
</select>
```

---

### 3.3.20 í•µì‹¬ ì •ë¦¬

#### MyBatisì˜ 3ê°€ì§€ í•µì‹¬

**1. SQL ì¤‘ì‹¬ ì ‘ê·¼**
```
ê°œë°œì: SQL ì‘ì„±ì— ì§‘ì¤‘
MyBatis: JDBC ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì œê±°
```

**2. XML ë¶„ë¦¬**
```
Java: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
XML: SQL
â†’ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
```

**3. ë™ì  SQL**
```
<if>, <choose>, <foreach> ë“±ìœ¼ë¡œ
ì¡°ê±´ì— ë”°ë¼ SQL ë™ì  ìƒì„±
```



## 3.4 JPA

### 3.4.1 JPA (Java Persistence API)ë€?

**JPA**ëŠ” Java ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ **ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ë§¤í•‘**í•˜ê³  ê´€ë¦¬í•˜ëŠ” **í‘œì¤€ ì¸í„°í˜ì´ìŠ¤**ì…ë‹ˆë‹¤.

#### ORM (Object-Relational Mapping) - í•µì‹¬ ê°œë…

ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë°©ì‹ë“¤ê³¼ JPAì˜ ê·¼ë³¸ì ì¸ ì°¨ì´ëŠ” **ê¸°ì¤€ì´ ë¬´ì—‡ì¸ê°€**ì…ë‹ˆë‹¤.

| ë°©ì‹ | ê¸°ì¤€ | ì ‘ê·¼ ë°©ë²• |
|-----|------|----------|
| **JDBC** | í…Œì´ë¸” ì¤‘ì‹¬ | í…Œì´ë¸” êµ¬ì¡° â†’ SQL ì‘ì„± â†’ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë³€í™˜ |
| **Spring Data JDBC** | í…Œì´ë¸” ì¤‘ì‹¬ | í…Œì´ë¸”ê³¼ ê°ì²´ ë™ê¸°í™” í•„ìˆ˜ |
| **MyBatis** | SQL ì¤‘ì‹¬ | ìµœì í™”ëœ SQL ì‘ì„± â†’ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë§¤í•‘ |
| **JPA** | **ê°ì²´ ì¤‘ì‹¬** | ê°ì²´ ì„¤ê³„ â†’ ë§¤í•‘ ì •ì˜ â†’ SQL ìë™ ìƒì„± |

**ORMì˜ ì² í•™**:
```
ê°œë°œì: ê°ì²´(Object)ë¥¼ ì„¤ê³„í•˜ê³  ê´€ë¦¬
    â†“
JPA: ê°ì²´ì™€ í…Œì´ë¸”ì˜ ê´€ê³„(Relational) ì •ì˜
    â†“
Hibernate: ë§¤í•‘(Mapping) ê¸°ë°˜ SQL ìë™ ìƒì„± ë° ì‹¤í–‰
    â†“
Database: í…Œì´ë¸”ì—ì„œ ë°ì´í„° ì €ì¥/ì¡°íšŒ
```

**í•µì‹¬**: í…Œì´ë¸”ì„ ìƒê°í•˜ì§€ ì•Šê³  **ê°ì²´ë§Œ ìƒê°**í•˜ë©´ ëœë‹¤!

---

#### JPA, Hibernate, Spring Data JPAì˜ ê´€ê³„

**ë¬¸ì œ**: JPAëŠ” ì¸í„°í˜ì´ìŠ¤ì¼ ë¿ êµ¬í˜„ì²´ê°€ ì•„ë‹™ë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**:

| ê³„ì¸µ | ì—­í•  | ì œê³µì |
|-----|------|--------|
| **JPA (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)** | ORMì˜ í‘œì¤€ ëª…ì„¸ ì •ì˜ | Oracle (Java í‘œì¤€) |
| **Hibernate** | JPAì˜ ì‹¤ì œ êµ¬í˜„ì²´ | ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ |
| **Spring Data JPA** | Hibernateë¥¼ Springì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ í†µí•© | Spring |

**êµ¬ì¡°**:
```
ê°œë°œì
  â†“
Spring Data JPA (í¸ì˜ ê³„ì¸µ)
  â†“
Hibernate (êµ¬í˜„ì²´)
  â†“
JPA (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)
  â†“
JDBC Driver
  â†“
Database
```

---

### 3.4.2 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± (build.gradle)

```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

**ì£¼ìš” ì˜ì¡´ì„±**:
- `spring-boot-starter-data-jpa`: Spring Data JPA + Hibernate í†µí•©
- `mysql-connector-j`: MySQL JDBC Driver (JPAëŠ” JDBCë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘)

---

#### ì„¤ì • íŒŒì¼ (application.properties)

```properties
spring.application.name=jpaHibernateSample

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° (MySQL)
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass

# DDL ê´€ë¦¬ ì „ëµ
spring.jpa.hibernate.ddl-auto=create

# SQL ë¡œê¹… í™œì„±í™” (ê°œë°œìš©)
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.highlight_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
```

#### ì„¤ì • íŒŒì¼ ìƒì„¸ ì„¤ëª…

##### `spring.jpa.hibernate.ddl-auto` - DDL ê´€ë¦¬ ì „ëµ

ì´ ì†ì„±ì€ **Hibernate**ì˜ ê¸°ëŠ¥ìœ¼ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì—”í‹°í‹° ì •ì˜ì™€ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ **ì–´ë–»ê²Œ ë™ê¸°í™”**í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.

| ì „ëµ | ë™ì‘ | ìš©ë„ |
|-----|------|------|
| **`create`** | ì‹œì‘ ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ(`DROP`) â†’ ì—”í‹°í‹° ê¸°ë°˜ ìƒˆë¡œ ìƒì„±(`CREATE`) | ê°œë°œ ì´ˆê¸°, í…ŒìŠ¤íŠ¸ í™˜ê²½ |
| **`create-drop`** | `create`ì™€ ë™ì¼í•˜ê²Œ ìƒì„± í›„, ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ ì¢…ë£Œ ì‹œ í…Œì´ë¸” ì‚­ì œ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸ |
| **`update`** | ê¸°ì¡´ í…Œì´ë¸” ìœ ì§€í•˜ë©° ì—”í‹°í‹°ì™€ì˜ ì°¨ì´ì ë§Œ ë°˜ì˜ (ì»¬ëŸ¼ ì¶”ê°€ëŠ” í•¨, ì‚­ì œëŠ” ì•ˆ í•¨) | ê°œë°œ í™˜ê²½ (ë°ì´í„° ìœ ì§€) |
| **`validate`** | ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ ì—”í‹°í‹° ê²€ì¦ë§Œ ìˆ˜í–‰, DDL ì‘ì—… ì—†ìŒ | ìŠ¤í…Œì´ì§•, ìš´ì˜ í™˜ê²½ |
| **`none`** | DDL ì‘ì—… ì™„ì „íˆ ìˆ˜í–‰ ì•ˆ í•¨ | ìš´ì˜ í™˜ê²½ |

**ìš´ì˜ í™˜ê²½ì—ì„œ `validate` ë˜ëŠ” `none` ì‚¬ìš© ì´ìœ **:
```
ìš´ì˜ ì¤‘ì¸ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê³ ê° ë°ì´í„°, ê±°ë˜ ê¸°ë¡ ë“± ë§¤ìš° ì¤‘ìš”í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
ìë™ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
í…Œì´ë¸” êµ¬ì¡°ë¥¼ ê°œë°œìê°€ Migration íˆ´ë¡œ ìˆ˜ë™ ê´€ë¦¬í•©ë‹ˆë‹¤.
```

---

##### SQL ë¡œê¹… ì„¤ì •

```properties
spring.jpa.show-sql=true                          # SQL ì¶œë ¥ í™œì„±í™”
spring.jpa.properties.hibernate.format_sql=true   # SQL ì¤„ë°”ê¿ˆ ë° ë“¤ì—¬ì“°ê¸°
spring.jpa.properties.hibernate.highlight_sql=true # ìƒ‰ìƒ ê°•ì¡° (IDE ì§€ì› ì‹œ)
spring.jpa.properties.hibernate.use_sql_comments=true # ì¿¼ë¦¬ ì£¼ì„ ì¶”ê°€
```

**ëª©ì **: ìƒì„±ëœ SQLì„ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥í•˜ì—¬ **ë””ë²„ê¹… ë° í…ŒìŠ¤íŠ¸ íš¨ìœ¨ì„± í–¥ìƒ**

---

### 3.4.3 ì—”í‹°í‹° í´ë˜ìŠ¤ (Entity) - ê°€ì¥ ì¤‘ìš”!

#### Member ì—”í‹°í‹°

```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(
    name = "vip_table",
    indexes = {
        @Index(name = "idx_name", columnList = "display_name, age"),
        @Index(name = "idx_email", columnList = "primary_contact")
    }
)
@Builder
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Member {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "display_name", length = 2048, nullable = false, unique = true)
    private String name;
    
    @Column(name = "primary_contact")
    private String email;
    
    private Integer age;
    
    @Transient
    private String address;
}
```

---

#### í•µì‹¬ ì–´ë…¸í…Œì´ì…˜ ìƒì„¸ ì„¤ëª…

##### `@Entity` - í…Œì´ë¸” ë§¤í•‘ ì„ ì–¸

```java
@Entity
public class Member { ... }
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì—­í• ** | ì´ Java í´ë˜ìŠ¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” **ì—”í‹°í‹°(Entity)**ì„ì„ JPAì— ì„ ì–¸ |
| **ì˜ë¯¸** | í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ = í…Œì´ë¸”ì˜ í•œ ë ˆì½”ë“œ(í–‰) |
| **ìë™ ì²˜ë¦¬** | Hibernateê°€ ì´ í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í…Œì´ë¸” ìë™ ìƒì„± (DDL ì„¤ì •ì— ë”°ë¼) |

**Spring Data JDBCì™€ì˜ ë¹„êµ**:

| í•­ëª© | Spring Data JDBC | JPA |
|-----|-----------------|-----|
| **ë§¤í•‘ ì„ ì–¸** | `@Table` | `@Entity` |
| **í…Œì´ë¸” ìƒì„±** | ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± ë¯¸ì§€ì› | **DDL ìë™ ìƒì„±** â­ |
| **í…Œì´ë¸”-í´ë˜ìŠ¤ ë™ê¸°í™”** | ìˆ˜ë™ (ë§¤ë²ˆ ì¼ì¹˜ì‹œì¼œì•¼ í•¨) | **ìë™** (ì—”í‹°í‹° ê¸°ì¤€) |
| **ì—°ê´€ê´€ê³„ í‘œí˜„** | ì œí•œì  | **ê°•ë ¥í•œ ì§€ì›** â­ |

---

##### `@Table` - í…Œì´ë¸” ìƒì„¸ ë§¤í•‘

```java
@Table(
    name = "vip_table",
    indexes = {
        @Index(name = "idx_name", columnList = "display_name, age")
    }
)
```

| ì†ì„± | ì—­í•  |
|-----|------|
| **`name`** | ì—”í‹°í‹°ê°€ ë§¤í•‘ë  í…Œì´ë¸”ì˜ ì‹¤ì œ ì´ë¦„ (ìƒëµ ì‹œ í´ë˜ìŠ¤ ì´ë¦„ ì‚¬ìš©) |
| **`indexes`** | í…Œì´ë¸”ì— ìƒì„±í•  ì¸ë±ìŠ¤ ëª©ë¡ |

##### `@Index` - ì¸ë±ìŠ¤ ì •ì˜

```java
@Index(name = "idx_name", columnList = "display_name, age")
```

| ì†ì„± | ê°’ | ì˜ë¯¸ |
|-----|-----|------|
| **`name`** | `"idx_name"` | DBì— ìƒì„±ë  ì¸ë±ìŠ¤ì˜ ì´ë¦„ (ê´€ë¦¬ ëª©ì ) |
| **`columnList`** | `"display_name, age"` | ì¸ë±ìŠ¤ë¥¼ êµ¬ì„±í•  **DB ì»¬ëŸ¼ëª…** (Java í•„ë“œëª… ì•„ë‹˜!) |

**âš ï¸ ì£¼ì˜**: columnListì—ëŠ” **ë°˜ë“œì‹œ `@Column(name="...")ì— ì§€ì •í•œ DB ì»¬ëŸ¼ëª…**ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**ì˜ëª»ëœ ì˜ˆ**:
```java
@Index(name = "idx_name", columnList = "name, age")  // âŒ Java í•„ë“œëª… ì‚¬ìš©
```

**ì˜¬ë°”ë¥¸ ì˜ˆ**:
```java
@Index(name = "idx_name", columnList = "display_name, age")  // âœ… DB ì»¬ëŸ¼ëª… ì‚¬ìš©
```

---

##### `@Id` - ê¸°ë³¸ í‚¤ ì§€ì •

```java
@Id
private Long id;
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì—­í• ** | í•´ë‹¹ í•„ë“œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ **ê¸°ë³¸ í‚¤(Primary Key)**ë¡œ ì§€ì • |
| **ì˜ë¯¸** | ê° ë ˆì½”ë“œë¥¼ ìœ ì¼í•˜ê²Œ ì‹ë³„í•˜ëŠ” í•„ë“œ |
| **í•„ìˆ˜** | ëª¨ë“  `@Entity`ëŠ” ë°˜ë“œì‹œ í•˜ë‚˜ì˜ `@Id`ë¥¼ ê°€ì ¸ì•¼ í•¨ |

---

##### `@GeneratedValue` - ID ìƒì„± ì „ëµ

```java
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
```

**ì—­í• **: ê¸°ë³¸ í‚¤ ê°’ì´ **ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë°©ì‹**ì„ ì§€ì •í•©ë‹ˆë‹¤.

| ì „ëµ | `GenerationType` | ID ìƒì„± ì£¼ì²´ | ë™ì‘ ìˆœì„œ |
|-----|-----------------|-----------|---------|
| **IDENTITY** | `IDENTITY` | ë°ì´í„°ë² ì´ìŠ¤ | 1. INSERT ì‹¤í–‰ 2. DBê°€ ID ìƒì„± 3. IDë¥¼ ê°ì²´ì— ë°˜ì˜ |
| **SEQUENCE** | `SEQUENCE` | ë°ì´í„°ë² ì´ìŠ¤ | 1. ID ë¯¸ë¦¬ ìš”ì²­ 2. IDë¥¼ ê°ì²´ì— ë°˜ì˜ 3. INSERT ì‹¤í–‰ |
| **TABLE** | `TABLE` | JPA/ì• í”Œë¦¬ì¼€ì´ì…˜ | 1. ê´€ë¦¬ í…Œì´ë¸” ì¡°íšŒ 2. ID ìƒì„± 3. INSERT ì‹¤í–‰ |
| **AUTO** | `AUTO` | JPA (DBì— ë§ì¶° ì„ íƒ) | DB ì¢…ë¥˜ì— ë”°ë¼ `IDENTITY` ë˜ëŠ” `SEQUENCE` ìë™ ì„ íƒ |

**ê° ì „ëµì˜ íŠ¹ì§•**:

- **IDENTITY**: MySQL, PostgreSQLì—ì„œ ì£¼ë¡œ ì‚¬ìš©. ê°„ë‹¨í•˜ì§€ë§Œ ID ì¦‰ì‹œ í™•ë³´ ë¶ˆê°€
- **SEQUENCE**: Oracle, PostgreSQLì—ì„œ ì£¼ë¡œ ì‚¬ìš©. ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™” ê°€ëŠ¥
- **AUTO** (ê¶Œì¥): ê°œë°œìê°€ DB ì¢…ë¥˜ë¥¼ ì‹ ê²½ ì“¸ í•„ìš” ì—†ìŒ

**save() í˜¸ì¶œ í›„ ID ìë™ ë°˜ì˜ ì˜ˆì‹œ**:

```java
Member member = Member.builder()
                      .name("í˜œì°½")
                      .email("hyechang@spring.ac.kr")
                      .age(20)
                      .build();

System.out.println(member.getId());  // null (ì•„ì§ ì €ì¥ ì•ˆ ë¨)

memberRepository.save(member);       // INSERT ì‹¤í–‰, ID ìë™ ìƒì„± ë° ë°˜ì˜

System.out.println(member.getId());  // 1 (DBê°€ ìë™ ìƒì„±í•œ ID í¬í•¨)
```

---

##### `@Column` - ì»¬ëŸ¼ ìƒì„¸ ë§¤í•‘

```java
@Column(name = "display_name", length = 2048, nullable = false, unique = true)
private String name;
```

| ì†ì„± | ê°’ | ì—­í•  |
|-----|-----|------|
| **`name`** | `"display_name"` | Java í•„ë“œëª…ê³¼ DB ì»¬ëŸ¼ëª…ì„ ë‹¤ë¥´ê²Œ ì§€ì • (Java: `name` â†’ DB: `display_name`) |
| **`length`** | `2048` | VARCHAR ì»¬ëŸ¼ì˜ ìµœëŒ€ ê¸¸ì´ (ìƒëµ ì‹œ ê¸°ë³¸ê°’ 255) |
| **`nullable`** | `false` | `NOT NULL` ì œì•½ì¡°ê±´ (NULL ê°’ í—ˆìš© ì•ˆ í•¨) |
| **`unique`** | `true` | `UNIQUE` ì œì•½ì¡°ê±´ (ì¤‘ë³µ ê°’ í—ˆìš© ì•ˆ í•¨) |

**ìƒëµ ì‹œ ê¸°ë³¸ ë™ì‘**:
```java
private String email;  // @Column ìƒëµ

// ê¸°ë³¸ ë§¤í•‘:
// - DB ì»¬ëŸ¼ëª…: email (í•„ë“œëª…ê³¼ ë™ì¼)
// - nullable: true (NULL í—ˆìš©)
// - length: 255 (VARCHAR ê¸°ë³¸ê°’)
```

---

##### `@Transient` - ë°ì´í„°ë² ì´ìŠ¤ ë§¤í•‘ ì œì™¸

```java
@Transient
private String address;
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì—­í• ** | í•´ë‹¹ í•„ë“œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ ë§¤í•‘ì—ì„œ ì œì™¸ |
| **ì˜ë¯¸** | DB í…Œì´ë¸”ì— ì»¬ëŸ¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ |
| **ìš©ë„** | ì„ì‹œ ê°’, ê³„ì‚°ëœ ê°’, ì„¸ì…˜ ì •ë³´ ë“± **ë©”ëª¨ë¦¬ì—ë§Œ í•„ìš”í•œ ë°ì´í„°** |

**ë™ì‘**:
```java
member.setAddress("ì„œìš¸ì‹œ ê°•ë‚¨êµ¬");  // ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë¨
memberRepository.save(member);      // addressëŠ” INSERTì— í¬í•¨ë˜ì§€ ì•ŠìŒ

Member loaded = memberRepository.findById(1L).orElse(null);
System.out.println(loaded.getAddress());  // null (DBì—ì„œ ë¡œë“œí•œ ê²ƒì´ë¯€ë¡œ)
```

---

#### ìƒì„±ë˜ëŠ” DDL (SQL)

ìœ„ Member ì—”í‹°í‹°ë¡œë¶€í„° ìë™ ìƒì„±ë˜ëŠ” í…Œì´ë¸”:

```sql
CREATE TABLE vip_table (
    age INTEGER,
    id BIGINT NOT NULL AUTO_INCREMENT,
    display_name VARCHAR(2048) NOT NULL,
    primary_contact VARCHAR(255),
    PRIMARY KEY (id),
    UNIQUE KEY (display_name),
    INDEX idx_name (display_name, age),
    INDEX idx_email (primary_contact)
) ENGINE=InnoDB;
```

---

### 3.4.4 JPA Auditing (ë¦¬ìŠ¤ë„ˆ) - ìë™ ì‹œê°„ ê¸°ë¡

#### ê°œë…

**ë¦¬ìŠ¤ë„ˆ(Listener)**ëŠ” íŠ¹ì • **ì´ë²¤íŠ¸(Event)**ê°€ ë°œìƒí•˜ë©´ ë¯¸ë¦¬ ì •ì˜ëœ **ì•¡ì…˜(Action)**ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

**ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸**:

| ì´ë²¤íŠ¸ | ì‹œì  | ì˜ˆì‹œ |
|-------|------|------|
| **Persist** | ê°ì²´ê°€ ì²˜ìŒ ì €ì¥ë  ë•Œ | `save()` í˜¸ì¶œ |
| **Update** | ê°ì²´ê°€ ë³€ê²½ë  ë•Œ | `save()` ì¬í˜¸ì¶œ |
| **Remove** | ê°ì²´ê°€ ì‚­ì œë  ë•Œ | `delete()` í˜¸ì¶œ |

**JPA Auditing**: `Persist`ì™€ `Update` ì´ë²¤íŠ¸ì— ë°˜ì‘í•˜ì—¬ **ìƒì„± ì‹œê°„, ìˆ˜ì • ì‹œê°„ì„ ìë™ ê¸°ë¡**

---

#### ë‹¨ê³„ 1: Auditing í™œì„±í™” (ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜)

```java
package com.example.jpaHibernateSample;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

@SpringBootApplication
@EnableJpaAuditing
public class JpaHibernateSampleApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(JpaHibernateSampleApplication.class, args);
    }
}
```

**`@EnableJpaAuditing`ì˜ ì—­í• **: ìŠ¤í”„ë§ì—ê²Œ "ì—”í‹°í‹° ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ë¥¼ ê°ì‹œí•˜ê² ë‹¤"ëŠ” ì„ ì–¸

---

#### ë‹¨ê³„ 2: ì—”í‹°í‹°ì— ë¦¬ìŠ¤ë„ˆ ë¶€ì°©

```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;
import java.time.LocalDateTime;

@Entity
@EntityListeners(AuditingEntityListener.class)
public class Article {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String title;
    private String content;
    
    @CreatedDate
    private LocalDateTime created;
    
    @LastModifiedDate
    private LocalDateTime updated;
}
```

| ì–´ë…¸í…Œì´ì…˜ | ì—­í•  |
|-----------|------|
| **`@EntityListeners`** | "ì´ ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ë¥¼ `AuditingEntityListener`ì—ê²Œ ì „ë‹¬í•˜ë¼" |
| **`@CreatedDate`** | Persist ì´ë²¤íŠ¸ ì‹œ **í˜„ì¬ ì‹œê°**ì„ ìë™ ê¸°ë¡ (ì´í›„ ë³€ê²½ ì•ˆ í•¨) |
| **`@LastModifiedDate`** | Persist ì´ë²¤íŠ¸ì™€ Update ì´ë²¤íŠ¸ ì‹œ **í˜„ì¬ ì‹œê°**ì„ ìë™ ê¸°ë¡ (ë§¤ë²ˆ ê°±ì‹ ) |

---

#### Auditing ë™ì‘ ì›ë¦¬

```
1. @EnableJpaAuditing í™œì„±í™”
   â†“
2. @EntityListeners(AuditingEntityListener.class) ê°ì‹œ ì‹œì‘
   â†“
3. articleRepository.save(newArticle) í˜¸ì¶œ (Persist ì´ë²¤íŠ¸)
   â†“
4. AuditingEntityListenerê°€ ì´ë²¤íŠ¸ ê°ì§€
   â†“
5. @CreatedDate í•„ë“œì— í˜„ì¬ ì‹œê° ì£¼ì…
5. @LastModifiedDate í•„ë“œì— í˜„ì¬ ì‹œê° ì£¼ì…
   â†“
6. INSERT SQL ì‹¤í–‰ (ì‹œê°„ ì •ë³´ í¬í•¨)
   â†“
7. ë‚˜ì¤‘ì— article.setTitle("ë³€ê²½") í›„ save() í˜¸ì¶œ (Update ì´ë²¤íŠ¸)
   â†“
8. @LastModifiedDateë§Œ ê°±ì‹ , @CreatedDateëŠ” ìœ ì§€
   â†“
9. UPDATE SQL ì‹¤í–‰
```

**ì˜ˆì‹œ**:

```java
Article article = Article.builder()
                         .title("ì²« ê¸€")
                         .content("ë‚´ìš©")
                         .build();

articleRepository.save(article);
// created: 2025-01-15 10:30:45
// updated: 2025-01-15 10:30:45

// ì¼ì£¼ì¼ í›„...
article.setTitle("ì œëª© ìˆ˜ì •");
articleRepository.save(article);
// created: 2025-01-15 10:30:45 (ë³€ê²½ ì•ˆ ë¨)
// updated: 2025-01-22 14:15:20 (ê°±ì‹ ë¨)
```

---

### 3.4.5 Repository ì¸í„°í˜ì´ìŠ¤

#### MemberRepository

```java
package com.example.jpaHibernateSample.repository;

import com.example.jpaHibernateSample.Member;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    // ê¸°ë³¸ CRUD ë©”ì„œë“œëŠ” JpaRepositoryê°€ ì œê³µ
    // í•„ìš”ì— ë”°ë¼ ì»¤ìŠ¤í…€ ë©”ì„œë“œ ì¶”ê°€
}
```

#### Spring Data JPAê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ë©”ì„œë“œ

| ë©”ì„œë“œ | ë°˜í™˜ íƒ€ì… | ì—­í•  |
|-------|---------|------|
| `save(entity)` | `T` | INSERT ë˜ëŠ” UPDATE |
| `findById(id)` | `Optional<T>` | IDë¡œ ì¡°íšŒ |
| `findAll()` | `List<T>` | ì „ì²´ ì¡°íšŒ |
| `existsById(id)` | `boolean` | ì¡´ì¬ ì—¬ë¶€ í™•ì¸ |
| `count()` | `long` | ì „ì²´ ê°œìˆ˜ |
| `deleteById(id)` | `void` | IDë¡œ ì‚­ì œ |
| `delete(entity)` | `void` | ì—”í‹°í‹° ì‚­ì œ |
| `deleteAll()` | `void` | ì „ì²´ ì‚­ì œ |

**ì½”ë“œ ì‘ì„± ì—†ì´ ëª¨ë‘ ìë™ êµ¬í˜„!**

---

#### MySQL vs H2 - ì½”ë“œ ë³€ê²½ í•„ìš” ì—†ìŒ!

**H2 ì‚¬ìš© ì‹œ**:
```gradle
runtimeOnly 'com.h2database:h2'
```

```properties
# spring.datasource.url ì„¤ì • ë¶ˆí•„ìš” (ìë™ ìƒì„±)
# ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ DB ì‚¬ìš©
spring.jpa.hibernate.ddl-auto=create-drop
```

**MySQL ì‚¬ìš© ì‹œ**:
```gradle
runtimeOnly 'com.mysql:mysql-connector-j'
```

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=myuser
spring.datasource.password=mypass
spring.jpa.hibernate.ddl-auto=create
```

**ì¤‘ìš”**: ì„¤ì • íŒŒì¼ê³¼ ì˜ì¡´ì„±ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤! **ì—”í‹°í‹° ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ!**

---

### 3.4.6 ê¸°ë³¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

```java
package com.example.jpaHibernateSample;

import com.example.jpaHibernateSample.repository.MemberRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

@Component
@RequiredArgsConstructor
@Slf4j
public class JpaApplication implements ApplicationRunner {
    
    private final MemberRepository memberRepository;
    
    @Override
    public void run(ApplicationArguments args) throws Exception {
        memberRepository.save(
            Member.builder()
                  .name("hyechang")
                  .email("hyechang@spring.ac.kr")
                  .age(20)
                  .build()
        );
        
        memberRepository.save(
            Member.builder()
                  .name("woohyun")
                  .email("woohyun@spring.ac.kr")
                  .age(25)
                  .build()
        );
    }
}
```

**ê²°ê³¼** (DBeaverì—ì„œ í™•ì¸):
```
id | display_name | primary_contact          | age
1  | hyechang     | hyechang@spring.ac.kr    | 20
2  | woohyun      | woohyun@spring.ac.kr     | 25
```

**í•µì‹¬**: **SQLì„ í•œ ì¤„ë„ ì‘ì„±í•˜ì§€ ì•Šì•˜ëŠ”ë° ë°ì´í„°ê°€ ì €ì¥ë¨!** ì´ê²ƒì´ JPAì˜ ê°€ì¥ í° ì¥ì ì…ë‹ˆë‹¤.

---

### 3.4.7 ì¿¼ë¦¬ ë©”ì„œë“œ (Query Method)

Spring Data JPAëŠ” **ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„**í•˜ì—¬ ìë™ìœ¼ë¡œ JPQLì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤. (Spring Data JDBCì™€ ê·œì¹™ì´ ë™ì¼í•©ë‹ˆë‹¤)

#### ê¸°ë³¸ ê·œì¹™

| íŒ¨í„´ | ì˜ˆì‹œ | ìƒì„±ë˜ëŠ” JPQL |
|-----|------|-------------|
| `findBy<í•„ë“œ>` | `findByName(String name)` | `select m from Member m where m.name = :name` |
| `findBy<í•„ë“œ>And<í•„ë“œ>` | `findByNameAndAge(String name, int age)` | `where m.name = :name and m.age = :age` |
| `findBy<í•„ë“œ>Or<í•„ë“œ>` | `findByNameOrEmail(String name, String email)` | `where m.name = :name or m.email = :email` |
| `findBy<í•„ë“œ>GreaterThan` | `findByAgeGreaterThan(int age)` | `where m.age > :age` |
| `findBy<í•„ë“œ>LessThan` | `findByAgeLessThan(int age)` | `where m.age < :age` |
| `findBy<í•„ë“œ>Between` | `findByAgeBetween(int min, int max)` | `where m.age between :min and :max` |
| `findBy<í•„ë“œ>Containing` | `findByNameContaining(String part)` | `where m.name like %:part%` |
| `findBy<í•„ë“œ>StartingWith` | `findByNameStartingWith(String prefix)` | `where m.name like :prefix%` |
| `findBy<í•„ë“œ>IsNull` | `findByEmailIsNull()` | `where m.email is null` |
| `findBy<í•„ë“œ>OrderBy<í•„ë“œ>Asc` | `findByAgeGreaterThanOrderByNameAsc(int age)` | `where m.age > :age order by m.name asc` |

#### MemberRepository ì˜ˆì‹œ

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    List<Member> findByName(String name);
    
    List<Member> findByNameAndAge(String name, int age);
    
    List<Member> findByAgeGreaterThan(int age);
    
    List<Member> findByNameContaining(String name);
    
    List<Member> findByAgeBetween(int min, int max);
    
    Member findFirstByOrderByIdDesc();
}
```

---

### 3.4.8 ì •ë ¬ (Sort)

#### ë¬¸ì œ: ë©”ì„œë“œ ì´ë¦„ì— ì •ë ¬ ì¡°ê±´ì„ í•˜ë“œì½”ë”©?

```java
// ì´ëŸ° ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜?
List<Member> findByAgeGreaterThanOrderByNameAsc(int age);
List<Member> findByAgeGreaterThanOrderByNameDesc(int age);
List<Member> findByAgeGreaterThanOrderByAgeAsc(int age);
// ... ëª¨ë“  ì¡°í•©ì„ ë§Œë“¤ì–´ì•¼ í•¨ âŒ
```

#### í•´ê²°: Sort ê°ì²´ë¡œ ë™ì  ì •ë ¬

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    List<Member> findByAgeGreaterThan(int age, Sort sort);
    
    List<Member> findByNameContaining(String name, Sort sort);
}
```

#### Sort ê°ì²´ ìƒì„± ë° ì‚¬ìš©

**ë°©ë²• 1: Sort.Order ë°°ì—´ (ë‹¤ì¤‘ ì •ë ¬ ê¸°ì¤€, ëª…ì‹œì )**

```java
Sort sort = Sort.by(
    Sort.Order.asc("name"),   // 1ì°¨: name ì˜¤ë¦„ì°¨ìˆœ
    Sort.Order.desc("age")    // 2ì°¨: age ë‚´ë¦¼ì°¨ìˆœ
);

List<Member> members = memberRepository.findByAgeGreaterThan(20, sort);
```

**ë°©ë²• 2: Sort.Directionê³¼ properties (ë‹¨ì¼ ë°©í–¥)**

```java
Sort sort = Sort.by(
    Sort.Direction.DESC,  // ëª¨ë“  í•„ë“œë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ
    "age", "name"         // age â†’ name ìˆœì„œë¡œ ì •ë ¬
);

List<Member> members = memberRepository.findByNameContaining("hyechang", sort);
```

**Sort ìƒì„± ìš”ì•½**:
```java
// ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ Sort.by()ë¥¼ ì‚¬ìš©
Sort sort = Sort.by(Sort.Order... orders);

// Sort.Order ìƒì„±
Sort.Order.asc("fieldName");    // ì˜¤ë¦„ì°¨ìˆœ
Sort.Order.desc("fieldName");   // ë‚´ë¦¼ì°¨ìˆœ
```

---

### 3.4.9 í˜ì´ì§€ë„¤ì´ì…˜ (Pageable)

#### ë¬¸ì œ: ì „ì²´ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì¡°íšŒ?

í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ìˆ˜ë°±ë§Œ ê°œì˜ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë³´ì—¬ì¤„ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. **í˜ì´ì§€ ë‹¨ìœ„**ë¡œ ë‚˜ëˆ„ì–´ ì „ë‹¬í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.

#### í•´ê²°: Pageable ê°ì²´

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    Page<Member> findByNameContaining(String name, Pageable pageable);
}
```

#### Pageable ê°ì²´ ìƒì„±

```java
// PageRequest.of(í˜ì´ì§€ë²ˆí˜¸, í˜ì´ì§€í¬ê¸°, ì •ë ¬ì •ë³´)
Pageable pageable = PageRequest.of(0, 20, Sort.by(Sort.Direction.DESC, "id"));

Page<Member> page = memberRepository.findByNameContaining("hyechang", pageable);
```

#### Page ê°ì²´ê°€ ì œê³µí•˜ëŠ” ì •ë³´

```java
page.getContent();          // List<Member> - í˜„ì¬ í˜ì´ì§€ì˜ ì‹¤ì œ ë°ì´í„°
page.getTotalElements();    // long - ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì „ì²´ ë°ì´í„° ê°œìˆ˜
page.getTotalPages();       // int - ì „ì²´ í˜ì´ì§€ ìˆ˜
page.getNumber();           // int - í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)
page.getSize();             // int - í˜ì´ì§€ë‹¹ ë°ì´í„° ê°œìˆ˜
page.hasNext();             // boolean - ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
page.hasPrevious();         // boolean - ì´ì „ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
page.isFirst();             // boolean - ì²« í˜ì´ì§€ì¸ì§€ ì—¬ë¶€
page.isLast();              // boolean - ë§ˆì§€ë§‰ í˜ì´ì§€ì¸ì§€ ì—¬ë¶€
```

**ì‚¬ìš© ì˜ˆì‹œ**:

```java
Pageable pageable = PageRequest.of(0, 10);  // ì²« ë²ˆì§¸ í˜ì´ì§€, 10ê°œ í•­ëª©
Page<Member> page = memberRepository.findAll(pageable);

System.out.println("ì „ì²´ ë°ì´í„°: " + page.getTotalElements());
System.out.println("ì „ì²´ í˜ì´ì§€: " + page.getTotalPages());
System.out.println("í˜„ì¬ í˜ì´ì§€: " + page.getNumber());
System.out.println("ë°ì´í„° ê°œìˆ˜: " + page.getContent().size());

page.getContent().forEach(member -> System.out.println(member));
```

---

### 3.4.10 ë™ì  ì¿¼ë¦¬ (Example)

#### ë¬¸ì œ: ëª¨ë“  ê²€ìƒ‰ ì¡°ê±´ ì¡°í•©ì˜ ë©”ì„œë“œ í•„ìš”?

```java
// ì´ë¦„ë§Œ ê²€ìƒ‰
List<Member> findByName(String name);

// ë‚˜ì´ë§Œ ê²€ìƒ‰
List<Member> findByAge(int age);

// ì´ë¦„ê³¼ ë‚˜ì´
List<Member> findByNameAndAge(String name, int age);

// ì´ë¦„, ë‚˜ì´, ì´ë©”ì¼
List<Member> findByNameAndAgeAndEmail(String name, int age, String email);

// ... ëª¨ë“  ì¡°í•©ì„ ì‘ì„±í•´ì•¼ í•¨ âŒ
```

#### í•´ê²°: Example ê°ì²´ (ë™ì  ì¡°ê±´)

```java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    // Exampleì„ ë°›ëŠ” ê¸°ë³¸ ë©”ì„œë“œëŠ” JpaRepositoryê°€ ì œê³µí•¨
    <S extends Member> List<S> findAll(Example<Member> example);
}
```

#### Example ì‚¬ìš© ë°©ë²•

```java
// 1ë‹¨ê³„: ê²€ìƒ‰ ì¡°ê±´ì´ ë‹´ê¸´ ì—”í‹°í‹° ê°ì²´ ìƒì„± (probe)
Member probe = Member.builder()
                     .name("hyechang")
                     .age(20)
                     .build();

// 2ë‹¨ê³„: ë§¤ì¹­ ë°©ì‹ ì •ì˜
ExampleMatcher matcher = ExampleMatcher.matchingAll();  // AND ì¡°ê±´

// 3ë‹¨ê³„: Example ìƒì„±
Example<Member> example = Example.of(probe, matcher);

// 4ë‹¨ê³„: ì¿¼ë¦¬ ì‹¤í–‰
List<Member> results = memberRepository.findAll(example);
```

#### ExampleMatcher ì˜µì…˜

| ë©”ì„œë“œ | ì¡°ê±´ | ì„¤ëª… |
|-------|------|------|
| `matchingAll()` | AND | probeì˜ ëª¨ë“  í•„ë“œê°€ ì¼ì¹˜í•´ì•¼ í•¨ (ê¸°ë³¸ê°’) |
| `matchingAny()` | OR | probeì˜ í•„ë“œ ì¤‘ í•˜ë‚˜ë¼ë„ ì¼ì¹˜í•˜ë©´ ë¨ |

**ì˜ˆì‹œ**:

```java
// AND ì¡°ê±´: nameì´ "hyechang" AND ageê°€ 20
Member probe = Member.builder().name("hyechang").age(20).build();
ExampleMatcher matcher = ExampleMatcher.matchingAll();
List<Member> results = memberRepository.findAll(Example.of(probe, matcher));

// OR ì¡°ê±´: nameì´ "hyechang" OR ageê°€ 20
ExampleMatcher matcher = ExampleMatcher.matchingAny();
List<Member> results = memberRepository.findAll(Example.of(probe, matcher));
```

#### Exampleì˜ í•œê³„

**ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥**:
- í¬ê¸° ë¹„êµ (`>`, `<`, `>=`, `<=`)
- LIKE íŒ¨í„´ (ê¸°ë³¸ LIKEëŠ” ì§€ì›, ìƒì„¸í•œ íŒ¨í„´ ì„¤ì •ì€ ì œí•œì )

**ë³µì¡í•œ ì¡°ê±´ì´ í•„ìš”í•˜ë©´ JPQL ì‚¬ìš©**

---

### 3.4.11 JPQL (Java Persistence Query Language) - ê°€ì¥ ì¤‘ìš”!

#### JPQLì´ë€?

**JPQL**ì€ SQLê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, **ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì•„ë‹Œ Java ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒ**ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬ ì–¸ì–´ì…ë‹ˆë‹¤.

| í•­ëª© | SQL | JPQL |
|-----|-----|------|
| **ëŒ€ìƒ** | í…Œì´ë¸”, ì»¬ëŸ¼ | ì—”í‹°í‹° í´ë˜ìŠ¤, í•„ë“œ |
| **ì¿¼ë¦¬ ì˜ˆ** | `SELECT * FROM member WHERE name = ?` | `SELECT m FROM Member m WHERE m.name = :name` |
| **DB ì˜ì¡´ì„±** | ë†’ìŒ (DB ë°©ì–¸ì´ ë‹¤ë¥´ë©´ ìˆ˜ì • í•„ìš”) | ë‚®ìŒ (JPQLì€ ë™ì¼, Hibernateê°€ DBë³„ SQLë¡œ ë³€í™˜) |

**í•µì‹¬**: í…Œì´ë¸”ì„ ìƒê°í•˜ì§€ ë§ê³  **ì—”í‹°í‹° ê°ì²´**ë¥¼ ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤!

---

#### JPQL ë¬¸ë²• ê¸°ë³¸ ê·œì¹™

##### 1. ì—”í‹°í‹° ì´ë¦„ê³¼ ë³„ì¹­

```java
// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹
@Query("SELECT m FROM Member m WHERE m.name = :name")
Member findByName(@Param("name") String name);

// âŒ ì˜ëª»ëœ ë°©ì‹ (í…Œì´ë¸” ì´ë¦„ ì‚¬ìš©)
@Query("SELECT * FROM member WHERE name = :name")

// âŒ ì˜ëª»ëœ ë°©ì‹ (ë³„ì¹­ ì—†ìŒ)
@Query("SELECT Member FROM Member WHERE Member.name = :name")
```

**ê·œì¹™**:
- ì—”í‹°í‹° ì´ë¦„ì€ **ëŒ€ì†Œë¬¸ì êµ¬ë¶„** (`Member` â‰  `member`)
- **ë°˜ë“œì‹œ ë³„ì¹­ ì‚¬ìš©** (ì˜ˆ: `Member m`) - ASëŠ” ìƒëµ ê°€ëŠ¥ (`Member as m`)

##### 2. í•„ë“œ ì°¸ì¡°

```java
@Query("SELECT m.name, m.email FROM Member m")  // í•„ë“œ ì‚¬ìš©
@Query("SELECT m FROM Member m")                 // ì—”í‹°í‹° ì „ì²´ ì‚¬ìš©
```

---

#### JPQL ë°˜í™˜ íƒ€ì… ê·œì¹™ (ê°€ì¥ í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„!)

JPQLì˜ SELECT ì ˆì— **ë¬´ì—‡ì„ ì„ íƒí•˜ëŠëƒ**ì— ë”°ë¼ ë°˜í™˜ íƒ€ì…ì´ ê²°ì •ë©ë‹ˆë‹¤.

##### íŒ¨í„´ 1: ì—”í‹°í‹° ì „ì²´ ë°˜í™˜

```java
@Query("SELECT m FROM Member m WHERE m.id = :id")
Member findByIdJpql(@Param("id") Long id);

@Query("SELECT m FROM Member m")
List<Member> findAllJpql();
```

**ë™ì‘**:
```
SELECT m    â†’ Member ì—”í‹°í‹° ì „ì²´ ì„ íƒ
ê²°ê³¼: Member ê°ì²´ ë˜ëŠ” List<Member>
```

---

##### íŒ¨í„´ 2: í•„ë“œ ëª©ë¡ ë°˜í™˜ (Object[] ë°°ì—´)

```java
@Query("SELECT m.name, m.email, m.age FROM Member m")
List<Object[]> findMemberInfo();
```

**ë™ì‘**:
```
SELECT m.name, m.email, m.age
       â†“       â†“        â†“
     [0]     [1]     [2]

ê²°ê³¼: List<Object[]>
ê° ìš”ì†Œ: Object[] = {ì´ë¦„, ì´ë©”ì¼, ë‚˜ì´}

ì‚¬ìš©:
List<Object[]> results = findMemberInfo();
for (Object[] row : results) {
    String name = (String) row[0];
    String email = (String) row[1];
    int age = (int) row[2];
}
```

---

##### íŒ¨í„´ 3: DTO ê°ì²´ë¡œ ì§ì ‘ ë³€í™˜ (NEW ì—°ì‚°ì)

```java
// DTO í´ë˜ìŠ¤ ì •ì˜ (ë°˜ë“œì‹œ ìƒì„±ì í•„ìš”)
public class MemberDto {
    public MemberDto(String name, String email, int age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }
}

// JPQL - NEW ì—°ì‚°ì ì‚¬ìš©
@Query("SELECT new com.example.jpaHibernateSample.MemberDto(m.name, m.email, m.age) FROM Member m")
List<MemberDto> findMemberDtos();
```

**ê·œì¹™**:
- DTO í´ë˜ìŠ¤ëŠ” **ìƒì„±ìì˜ íŒŒë¼ë¯¸í„° ìˆœì„œ**ì™€ **JPQL SELECT í•­ëª© ìˆœì„œ**ê°€ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨
- íŒ¨í‚¤ì§€ëª….í´ë˜ìŠ¤ëª… **ì „ì²´ ê²½ë¡œ** ì‚¬ìš©

**ì‚¬ìš©**:
```java
List<MemberDto> results = findMemberDtos();
for (MemberDto dto : results) {
    System.out.println(dto.getName());
    System.out.println(dto.getEmail());
}
```

---

#### JPQL íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

```java
// `:ì´ë¦„` ë°©ì‹ (ê¶Œì¥)
@Query("SELECT m FROM Member m WHERE m.name = :name AND m.age = :age")
List<Member> findByNameAndAge(@Param("name") String name, @Param("age") int age);

// `?1, ?2` ìœ„ì¹˜ ë°©ì‹ (ë¹„ê¶Œì¥)
@Query("SELECT m FROM Member m WHERE m.name = ?1 AND m.age = ?2")
List<Member> findByNameAndAgePos(String name, int age);
```

**ê¶Œì¥ ì´ìœ **: `:name` ë°©ì‹ì´ ê°€ë…ì„±ì´ ì¢‹ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•©ë‹ˆë‹¤.

---

#### ë³µì¡í•œ JPQL ë¶„ì„ (LEFT JOIN, GROUP BY)

```java
@Query("SELECT m.name, m.email, COUNT(a.id) as articleCount " +
       "FROM Member m " +
       "LEFT JOIN Article a ON a.member = m " +
       "GROUP BY m " +
       "ORDER BY articleCount DESC")
List<Object[]> getMembersWithArticleCount();
```

**ìƒì„¸ ë¶„ì„**:

| ë¶€ë¶„ | ì„¤ëª… |
|-----|------|
| **`LEFT JOIN Article a ON a.member = m`** | Member ì—”í‹°í‹°(m)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Article ì—”í‹°í‹°(a)ì™€ LEFT JOIN. ì¡°ê±´: Articleì˜ member í•„ë“œê°€ í˜„ì¬ Memberë¥¼ ê°€ë¦¬í‚´ |
| **`GROUP BY m`** | Memberì˜ ëª¨ë“  í•„ë“œ(ê¸°ë³¸í‚¤ í¬í•¨)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”. (SQLì˜ `GROUP BY m.id`ì™€ ë™ì¼ ì˜ë¯¸) |
| **`COUNT(a.id)`** | ê° ê·¸ë£¹ì˜ Article ê°œìˆ˜ë¥¼ ì§‘ê³„í•¨ìˆ˜ë¡œ ê³„ì‚° |
| **`ORDER BY articleCount DESC`** | ê²Œì‹œê¸€ ë§ì€ ìˆœì„œëŒ€ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ |

**ë°˜í™˜ ë°ì´í„° êµ¬ì¡°**:
```
Object[0] = "hyechang"      (m.name)
Object[1] = "hyechang@..."  (m.email)
Object[2] = 5               (COUNT(a.id) = ê²Œì‹œê¸€ 5ê°œ)

List<Object[]> = [
    {"hyechang", "hyechang@...", 5},
    {"woohyun", "woohyun@...", 3},
    {"other", "other@...", 1}
]

ì‚¬ìš©:
for (Object[] row : getMembersWithArticleCount()) {
    String name = (String) row[0];
    String email = (String) row[1];
    long count = (long) row[2];
}
```

---

#### SELECT ì ˆì˜ ê·œì¹™ (GROUP BY ì‚¬ìš© ì‹œ)

JPQLë„ SQLê³¼ ë™ì¼í•œ ê·œì¹™ì„ ë”°ë¦…ë‹ˆë‹¤:

**SELECTì— ì˜¬ ìˆ˜ ìˆëŠ” í•­ëª©**:
- GROUP BY ê¸°ì¤€ì´ ë˜ëŠ” í•„ë“œ: `m.name`, `m.email` (ê·¸ë£¹ ê¸°ì¤€ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥)
- ì§‘ê³„í•¨ìˆ˜: `COUNT()`, `SUM()`, `AVG()`, `MAX()`, `MIN()` (í•„ìˆ˜ ì‚¬ìš©)

**SELECTì— ì˜¬ ìˆ˜ ì—†ëŠ” í•­ëª©**:
- GROUP BY ê¸°ì¤€ì´ ì•„ë‹Œ í•„ë“œ (ì˜ˆ: `a.id` - ì§‘ê³„í•¨ìˆ˜ ì—†ì´ ì‚¬ìš© ë¶ˆê°€)

---

### 3.4.12 JPQLì„ í†µí•œ ë°ì´í„° ë³€ê²½ (UPDATE, DELETE)

#### UPDATE

```java
@Modifying
@Transactional
@Query("UPDATE Member m SET m.age = :age WHERE m.id = :id")
int updateMemberAge(@Param("age") int age, @Param("id") Long id);
```

| ì–´ë…¸í…Œì´ì…˜ | ì—­í•  |
|-----------|------|
| **`@Modifying`** | ì´ ì¿¼ë¦¬ê°€ SELECTê°€ ì•„ë‹Œ ë°ì´í„° ë³€ê²½ ì¿¼ë¦¬(UPDATE/DELETE)ì„ì„ ì„ ì–¸ |
| **`@Transactional`** | ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ í•„ìˆ˜ |

**ì†ì„±** (ê°„ë‹¨íˆ ì•Œê¸°):
- `clearAutomatically = true`: ì¿¼ë¦¬ ì‹¤í–‰ í›„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
- `flushAutomatically = true`: ì¿¼ë¦¬ ì‹¤í–‰ ì „ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë™ê¸°í™”

---

#### DELETE

```java
@Modifying
@Transactional
@Query("DELETE FROM Member m WHERE m.age < :age")
int deleteYoungMembers(@Param("age") int age);
```

**ë°˜í™˜ê°’**: ì˜í–¥ë°›ì€ í–‰ì˜ ê°œìˆ˜ (int)

```java
int deleted = deleteYoungMembers(18);
System.out.println("ì‚­ì œëœ íšŒì›: " + deleted + "ëª…");
```

---

### 3.4.13 Native SQL (ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬)

#### í•„ìš”í•œ ê²½ìš°

JPQLë¡œëŠ” í‘œí˜„ ë¶ˆê°€ëŠ¥í•œ ë°ì´í„°ë² ì´ìŠ¤ íŠ¹í™” ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œ:
- MySQLì˜ `RAND()`, `GROUP_CONCAT()`
- Oracleì˜ `ROWNUM`
- ë³µì¡í•œ ìœˆë„ìš° í•¨ìˆ˜
- ì„±ëŠ¥ ìµœì í™”ëœ íŠ¹í™” SQL

#### ì‚¬ìš© ë°©ë²•

```java
@Query(
    value = "SELECT * FROM member ORDER BY RAND() LIMIT :limit",
    nativeQuery = true
)
List<Member> findRandomMembers(@Param("limit") int limit);
```

| ì†ì„± | ê°’ | ì˜ë¯¸ |
|-----|-----|------|
| **`value`** | SQL ë¬¸ìì—´ | í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª… ì‚¬ìš© (ì—”í‹°í‹° ì•„ë‹˜) |
| **`nativeQuery`** | `true` | ì´ ì¿¼ë¦¬ë¥¼ JPQLì´ ì•„ë‹Œ **ë„¤ì´í‹°ë¸Œ SQL**ë¡œ ì²˜ë¦¬ |

---

#### Native SQLê³¼ JPQL ë¹„êµ

| í•­ëª© | JPQL | Native SQL |
|-----|------|-----------|
| **ëŒ€ìƒ** | ì—”í‹°í‹°, í•„ë“œ | í…Œì´ë¸”, ì»¬ëŸ¼ |
| **ì¿¼ë¦¬ ì˜ˆ** | `SELECT m FROM Member m` | `SELECT * FROM member` |
| **DB ì˜ì¡´ì„±** | ë‚®ìŒ | ë†’ìŒ (DB ë°©ì–¸ì— ë”°ë¼ ìˆ˜ì • í•„ìš”) |
| **ê°€ë…ì„±** | ë†’ìŒ | ë‚®ìŒ |
| **ì„±ëŠ¥ ìµœì í™”** | ì œí•œì  | ê°•ë ¥ |
| **íŠ¹í™” ê¸°ëŠ¥** | ë¶ˆê°€ëŠ¥ | ê°€ëŠ¥ |

**ê¶Œì¥ì‚¬í•­**:
- ëŒ€ë¶€ë¶„ì˜ ì¿¼ë¦¬ëŠ” **JPQL ì‚¬ìš©**
- ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê±°ë‚˜ DB íŠ¹í™” ê¸°ëŠ¥ í•„ìš” ì‹œë§Œ **Native SQL ì‚¬ìš©**

---

### 3.4.14 ì™„ì „í•œ Repository ì˜ˆì‹œ

```java
package com.example.jpaHibernateSample.repository;

import com.example.jpaHibernateSample.Member;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;

@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
    
    // 1. ì¿¼ë¦¬ ë©”ì„œë“œ
    List<Member> findByName(String name);
    
    List<Member> findByNameAndAge(String name, int age);
    
    List<Member> findByAgeGreaterThan(int age);
    
    List<Member> findByNameContaining(String namePart);
    
    // 2. ì •ë ¬ ì‚¬ìš©
    List<Member> findByAgeGreaterThan(int age, org.springframework.data.domain.Sort sort);
    
    // 3. í˜ì´ì§€ë„¤ì´ì…˜
    Page<Member> findByNameContaining(String namePart, Pageable pageable);
    
    // 4. JPQL - ì¡°íšŒ
    @Query("SELECT m FROM Member m WHERE m.name = :name")
    Optional<Member> findByNameJpql(@Param("name") String name);
    
    // 5. JPQL - ë³µì¡í•œ ì¿¼ë¦¬
    @Query("SELECT m.name, COUNT(m.id) FROM Member m GROUP BY m.name")
    List<Object[]> countMembersByName();
    
    // 6. JPQL - UPDATE
    @Modifying
    @Transactional
    @Query("UPDATE Member m SET m.age = :age WHERE m.id = :id")
    int updateAge(@Param("age") int age, @Param("id") Long id);
    
    // 7. Native SQL
    @Query(value = "SELECT * FROM vip_table WHERE age > :age", nativeQuery = true)
    List<Member> findOlderMembers(@Param("age") int age);
}
```

---

### 3.4.15 ì¿¼ë¦¬ ë©”ì„œë“œ vs JPQL vs Native SQL ì„ íƒ ê¸°ì¤€

| ìƒí™© | ì¶”ì²œ ë°©ë²• | ì´ìœ  |
|-----|---------|------|
| ë‹¨ìˆœí•œ CRUD (findBy, save, delete) | ì¿¼ë¦¬ ë©”ì„œë“œ | ì½”ë“œ ì‘ì„± ë¶ˆí•„ìš”, ê°€ë…ì„± ì¢‹ìŒ |
| ë‹¨ìˆœí•œ ê²€ìƒ‰ ì¡°ê±´ ì¡°í•© | ì¿¼ë¦¬ ë©”ì„œë“œ | ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¶©ë¶„ |
| ë³µì¡í•œ ì¡°ê±´ (JOIN, GROUP BY, ì§‘ê³„) | JPQL | DB ì˜ì¡´ì„± ë‚®ìŒ, ê°ì²´ ì¤‘ì‹¬ |
| ì„±ëŠ¥ ìµœì í™” í•„ìš” | Native SQL | ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥ |
| DB íŠ¹í™” í•¨ìˆ˜ í•„ìš” | Native SQL | ë¶ˆê°€í”¼í•œ ì„ íƒ |

---

### 3.4.16 ìš”ì•½: JPAì˜ í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… |
|-----|------|
| **@Entity** | ì—”í‹°í‹° í´ë˜ìŠ¤ ì„ ì–¸, DDL ìë™ ìƒì„± |
| **@Table** | í…Œì´ë¸” ë§¤í•‘, ì´ë¦„, ì¸ë±ìŠ¤ ì •ì˜ |
| **@Column** | ì»¬ëŸ¼ ë§¤í•‘, ì œì•½ì¡°ê±´ ì •ì˜ |
| **@Id + @GeneratedValue** | ê¸°ë³¸ í‚¤ ìë™ ìƒì„± |
| **@Transient** | DB ë§¤í•‘ ì œì™¸ |
| **JpaRepository** | ê¸°ë³¸ CRUD ìë™ ì œê³µ |
| **ì¿¼ë¦¬ ë©”ì„œë“œ** | ë©”ì„œë“œ ì´ë¦„ ê¸°ë°˜ ì¿¼ë¦¬ ìë™ ìƒì„± |
| **Sort + Pageable** | ë™ì  ì •ë ¬, í˜ì´ì§€ë„¤ì´ì…˜ |
| **@Query + JPQL** | ë³µì¡í•œ ì¿¼ë¦¬, ê°ì²´ ì¤‘ì‹¬ |
| **Native SQL** | DB íŠ¹í™” SQL, ì„±ëŠ¥ ìµœì í™” |
| **@EnableJpaAuditing** | ìë™ ì‹œê°„ ê¸°ë¡ (ìƒì„±, ìˆ˜ì •) |

---

## 3.4.17 ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ (Persistence Context)

### 3.4.17.1 ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?

**ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸(Persistence Context)**ëŠ” ì—”í‹°í‹° ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ë™í•  ë•Œ ì‚¬ìš©í•˜ëŠ” **ìºì‹œ ë©”ëª¨ë¦¬**ì…ë‹ˆë‹¤.

#### í•µì‹¬ ê°œë…

```
[ì• í”Œë¦¬ì¼€ì´ì…˜]
      â†“
[ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸] â† ì—”í‹°í‹° ê°ì²´ë¥¼ ìºì‹±í•˜ëŠ” ë©”ëª¨ë¦¬ ê³µê°„
      â†“
[ë°ì´í„°ë² ì´ìŠ¤]
```

**ëª©ì **: ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ íšŸìˆ˜ë¥¼ ì¤„ì—¬ì„œ **ì„±ëŠ¥ì„ í–¥ìƒ**ì‹œí‚µë‹ˆë‹¤.

JPAì—ì„œëŠ” ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ë“ , JPQLë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ë“  ìµœì¢…ì ìœ¼ë¡œ **ê°ì²´ë¥¼ SQLë¡œ ë³€í™˜**í•œ í›„ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•©ë‹ˆë‹¤. ì´ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ **ì¤‘ê°„ ê³„ì¸µ**ìœ¼ë¡œ ì‘ë™í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ë°©ì§€í•©ë‹ˆë‹¤.

---

### 3.4.17.2 ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 4ê°€ì§€ ì´ì 

#### 1. 1ì°¨ ìºì‹œ (First Level Cache)

**ë™ì‘ ì›ë¦¬**:
```
ì¡°íšŒ ìš”ì²­
    â†“
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ”ê°€? 
    â”œâ”€ YES: ì¦‰ì‹œ ë°˜í™˜ (DB ì ‘ê·¼ X)
    â””â”€ NO: DB ì¡°íšŒ â†’ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ â†’ ë°˜í™˜
```

**ì˜ˆì‹œ**:
```java
@Transactional
public void example() {
    Member member1 = memberRepository.findById(1L).orElse(null);  // DB ì¡°íšŒ
    Member member2 = memberRepository.findById(1L).orElse(null);  // 1ì°¨ ìºì‹œì—ì„œ ë°˜í™˜ (DB ì ‘ê·¼ X)
    
    System.out.println(member1 == member2);  // true (ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤)
}
```

**ì¥ì **: ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì¼í•œ ì—”í‹°í‹°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì¡°íšŒí•´ë„ **í•œ ë²ˆë§Œ DBì— ì ‘ê·¼**í•©ë‹ˆë‹¤.

---

#### 2. ë³€ê²½ ê°ì§€ (Dirty Checking)

**ë™ì‘ ì›ë¦¬**:
```
1. ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•  ë•Œ "ìŠ¤ëƒ…ìƒ·" ìƒì„±
2. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— í˜„ì¬ ìƒíƒœì™€ ìŠ¤ëƒ…ìƒ· ë¹„êµ
3. ë³€ê²½ ì‚¬í•­ ê°ì§€ ì‹œ ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ ìƒì„±
4. ë³€ê²½ ì‚¬í•­ ì—†ìœ¼ë©´ UPDATE ì¿¼ë¦¬ ìƒì„± ì•ˆ í•¨
```

**ì˜ˆì‹œ**:
```java
@Transactional
public void example() {
    Member member = memberRepository.findById(1L).orElse(null);
    
    // ìŠ¤ëƒ…ìƒ·: age=20
    member.setAge(30);  // í˜„ì¬ ìƒíƒœ: age=30
    
    // save() í˜¸ì¶œ ì—†ì´ë„ ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ ìƒì„±!
    // memberRepository.save(member); â† ë¶ˆí•„ìš”
    
} // íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œ ë³€ê²½ ê°ì§€ â†’ UPDATE ì‹¤í–‰
```

**ë³€ê²½ ì‚¬í•­ì´ ì—†ëŠ” ê²½ìš°**:
```java
@Transactional
public void example() {
    Member member = memberRepository.findById(1L).orElse(null);
    
    // ìŠ¤ëƒ…ìƒ·: age=20
    memberRepository.save(member);  // í˜„ì¬ ìƒíƒœ: age=20
    
} // ìŠ¤ëƒ…ìƒ·ê³¼ ë™ì¼ â†’ UPDATE ì¿¼ë¦¬ ìƒì„± ì•ˆ í•¨ (ì„±ëŠ¥ í–¥ìƒ!)
```

---

#### 3. ì“°ê¸° ì§€ì—° (Transactional Write-Behind)

**ë™ì‘ ì›ë¦¬**:
```
1. save(), delete() í˜¸ì¶œ ì‹œ ì¦‰ì‹œ DBì— ì‹¤í–‰ X
2. SQLì„ "ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œ"ì— ëª¨ì•„ë‘ 
3. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ëª¨ë“  SQLì„ í•œ ë²ˆì— DBë¡œ ì „ì†¡ (Flush)
```

**ì˜ˆì‹œ**:
```java
@Transactional
public void example() {
    Member m1 = Member.builder().name("í˜œì°½").email("hyechang@spring.ac.kr").build();
    Member m2 = Member.builder().name("ìš°í˜„").email("woohyun@spring.ac.kr").build();
    Member m3 = Member.builder().name("ì„œì¤€").email("seojun@spring.ac.kr").build();
    
    memberRepository.save(m1);  // SQL ì €ì¥ì†Œì— INSERT ì˜ˆì•½
    memberRepository.save(m2);  // SQL ì €ì¥ì†Œì— INSERT ì˜ˆì•½
    memberRepository.save(m3);  // SQL ì €ì¥ì†Œì— INSERT ì˜ˆì•½
    
    // ì—¬ê¸°ê¹Œì§€ DB ì ‘ê·¼ 0ë²ˆ!
    
} // íŠ¸ëœì­ì…˜ ì¢…ë£Œ â†’ 3ê°œì˜ INSERTë¥¼ í•œ ë²ˆì— ì‹¤í–‰
```

**ì¥ì **: 
- ë„¤íŠ¸ì›Œí¬ ì™•ë³µ íšŸìˆ˜ ê°ì†Œ
- ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ í–¥ìƒ

---

#### 4. ì—”í‹°í‹° ë™ì¼ì„± ë³´ì¥ (Identity)

**ë™ì‘ ì›ë¦¬**:
```
ê°™ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ì—ì„œ ê°™ì€ IDë¡œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” 
í•­ìƒ ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤(ì£¼ì†Œ)ë¥¼ ë°˜í™˜
```

**ì˜ˆì‹œ**:
```java
@Transactional
public void example() {
    Member m1 = memberRepository.findById(1L).orElse(null);
    Member m2 = memberRepository.findById(1L).orElse(null);
    
    System.out.println(m1 == m2);  // true (ë™ì¼í•œ ê°ì²´)
    System.out.println(m1.equals(m2));  // true
}
```

**@Transactionalì´ ì—†ëŠ” ê²½ìš°**:
```java
public void example() {
    Member m1 = memberRepository.findById(1L).orElse(null);  // íŠ¸ëœì­ì…˜ 1 ì‹œì‘ â†’ ì¢…ë£Œ
    Member m2 = memberRepository.findById(1L).orElse(null);  // íŠ¸ëœì­ì…˜ 2 ì‹œì‘ â†’ ì¢…ë£Œ
    
    System.out.println(m1 == m2);  // false (ë‹¤ë¥¸ ê°ì²´!)
}
```

**í•µì‹¬**: ì—”í‹°í‹° ë™ì¼ì„±ì€ **ê°™ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ (ê°™ì€ íŠ¸ëœì­ì…˜) ë‚´ì—ì„œë§Œ** ë³´ì¥ë©ë‹ˆë‹¤.

---

### 3.4.17.3 ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸°

#### íŠ¸ëœì­ì…˜ ê¸°ë°˜ ë™ì‘

ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” **íŠ¸ëœì­ì…˜(@Transactional) ê¸°ë°˜**ìœ¼ë¡œ ìƒì„±ë˜ê³  ì†Œë©¸ë©ë‹ˆë‹¤.

```
@Transactional ë©”ì„œë“œ ì‹œì‘
    â†“
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„±
    â†“
ë©”ì„œë“œ ë‚´ë¶€ ì‘ì—… (save, find, update...)
    â†“
ë©”ì„œë“œ ì¢…ë£Œ
    â†“
íŠ¸ëœì­ì…˜ ì»¤ë°‹ (Flush â†’ Commit)
    â†“
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ
```

**ì˜ˆì‹œ**:
```java
@Component
@Transactional  // í´ë˜ìŠ¤ ë ˆë²¨ â†’ run() ë©”ì„œë“œ ì „ì²´ê°€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜
public class JpaApplication implements ApplicationRunner {
    
    private final MemberRepository memberRepository;
    
    @Override
    public void run(ApplicationArguments args) throws Exception {
        // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„± (íŠ¸ëœì­ì…˜ ì‹œì‘)
        
        Member hyechang = Member.builder()
                                .name("hyechang")
                                .email("hyechang@spring.ac.kr")
                                .age(20)
                                .build();
        memberRepository.save(hyechang);
        
        Member woohyun = Member.builder()
                               .name("woohyun")
                               .email("woohyun@spring.ac.kr")
                               .age(25)
                               .build();
        memberRepository.save(woohyun);
        
        // 1ì°¨ ìºì‹œ í™œìš©
        hyechang = memberRepository.findById(hyechang.getId()).orElse(null);
        
        // ë³€ê²½ ê°ì§€
        hyechang.setAge(1000);
        
        // ì“°ê¸° ì§€ì—° (INSERT 2ê°œ + UPDATE 1ê°œê°€ SQL ì €ì¥ì†Œì— ëŒ€ê¸° ì¤‘)
        
    } // ë©”ì„œë“œ ì¢…ë£Œ â†’ Flush â†’ Commit â†’ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ
}
```

**ë‚´ë¶€ ë™ì‘**:
```
1. save(hyechang): INSERT SQL ì €ì¥ì†Œì— ì˜ˆì•½
2. save(woohyun): INSERT SQL ì €ì¥ì†Œì— ì˜ˆì•½
3. findById(): 1ì°¨ ìºì‹œì—ì„œ ë°˜í™˜ (DB ì ‘ê·¼ X)
4. setAge(1000): ë³€ê²½ ê°ì§€ â†’ UPDATE SQL ì €ì¥ì†Œì— ì˜ˆì•½
5. ë©”ì„œë“œ ì¢…ë£Œ: Flush (SQL 3ê°œë¥¼ í•œ ë²ˆì— ì‹¤í–‰) â†’ Commit
```

---

### 3.4.17.4 Spring Data JPAì˜ ìë™ ê´€ë¦¬

#### ê°œë°œìê°€ ê´€ë¦¬í•  í•„ìš” ì—†ëŠ” ê²½ìš°

Spring Data JPAë¥¼ ì‚¬ìš©í•˜ë©´ **ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ íŠ¸ëœì­ì…˜ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬**í•©ë‹ˆë‹¤.

| ì‘ì—… | íŠ¸ëœì­ì…˜/ì˜ì†ì„± ê´€ë¦¬ | ë¹„ê³  |
|-----|---------------------|------|
| **ê¸°ë³¸ CRUD** (`save`, `findById`, `delete`) | âœ… ìë™ ì ìš© | `JpaRepository`ì— `@Transactional`ì´ ì´ë¯¸ ì ìš©ë¨ |
| **ì¿¼ë¦¬ ë©”ì„œë“œ** (`findByName`, `findByAge...`) | âœ… ìë™ ì ìš© | Spring Data JPAê°€ íŠ¸ëœì­ì…˜ ìë™ ì„¤ì • |
| **`@Query` SELECT** | âœ… ìë™ ì ìš© | ì¡°íšŒ ì¿¼ë¦¬ëŠ” ìë™ ì²˜ë¦¬ |

**ìë™ ê´€ë¦¬ë˜ëŠ” ì´ìœ **:
```java
// Spring Data JPAê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” êµ¬í˜„ì²´ (ê°œë…ì  í‘œí˜„)
@Transactional  // ê¸°ë³¸ CRUD ë©”ì„œë“œì— ìë™ ì ìš©
public class SimpleJpaRepository<T, ID> implements JpaRepository<T, ID> {
    
    @Override
    public <S extends T> S save(S entity) {
        // íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰
        // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìë™ ê´€ë¦¬
    }
    
    @Override
    public Optional<T> findById(ID id) {
        // íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰
        // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìë™ ê´€ë¦¬
    }
}
```

---

#### ê°œë°œìê°€ ëª…ì‹œí•´ì•¼ í•˜ëŠ” ê²½ìš°

**`@Query`ë¥¼ ì‚¬ìš©í•œ DML (INSERT, UPDATE, DELETE)**ì„ ì‘ì„±í•  ë•ŒëŠ” **ë°˜ë“œì‹œ ìˆ˜ë™ìœ¼ë¡œ ëª…ì‹œ**í•´ì•¼ í•©ë‹ˆë‹¤.

```java
@Modifying  // í•„ìˆ˜! ì´ ì¿¼ë¦¬ê°€ ë°ì´í„° ë³€ê²½ ì‘ì—…ì„ì„ ì„ ì–¸
@Transactional  // í•„ìˆ˜! íŠ¸ëœì­ì…˜ ì‹œì‘
@Query("UPDATE Member m SET m.age = :age WHERE m.id = :id")
int updateMemberAge(@Param("age") int age, @Param("id") Long id);
```

**í•„ìˆ˜ ì–´ë…¸í…Œì´ì…˜**:

| ì–´ë…¸í…Œì´ì…˜ | ì—­í•  | í•„ìˆ˜ ì—¬ë¶€ |
|-----------|------|----------|
| **`@Transactional`** | íŠ¸ëœì­ì…˜ ì‹œì‘ (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„±) | âœ… í•„ìˆ˜ |
| **`@Modifying`** | ì´ ì¿¼ë¦¬ê°€ ë°ì´í„° ë³€ê²½(DML)ì„ì„ ì„ ì–¸ | âœ… í•„ìˆ˜ |

---

### 3.4.17.5 @Modifyingì´ í•„ìš”í•œ ì´ìœ  - 1ì°¨ ìºì‹œ ë¶ˆì¼ì¹˜ ë¬¸ì œ

#### ë¬¸ì œ ìƒí™©: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìš°íšŒ

`@Query`ë¥¼ ì‚¬ìš©í•œ DMLì€ **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ìš°íšŒ**í•˜ê³  DBì— ì§ì ‘ SQLì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

**ì‹œë‚˜ë¦¬ì˜¤**:

```java
@Transactional
public void problemExample() {
    // 1ë‹¨ê³„: ì¡°íšŒ (DB: age=20)
    Member m = memberRepository.findById(1L).get();
    // 1ì°¨ ìºì‹œì— ì €ì¥: {id=1, name="í˜œì°½", age=20}
    
    // 2ë‹¨ê³„: @Query UPDATE ì‹¤í–‰ (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìš°íšŒ!)
    memberRepository.updateMemberAge(1000, 1L);
    // DB: age=1000ìœ¼ë¡œ ë³€ê²½ë¨
    // 1ì°¨ ìºì‹œ: ì—¬ì „íˆ age=20 (ë³€ê²½ ì•ˆ ë¨!)
    
    // 3ë‹¨ê³„: ì¬ì¡°íšŒ
    Member m2 = memberRepository.findById(1L).get();
    // 1ì°¨ ìºì‹œì— ìˆëŠ” age=20 ë°˜í™˜ (DB ì ‘ê·¼ ì•ˆ í•¨!)
    
    System.out.println(m2.getAge());  // 20 ì¶œë ¥ (ì‹¤ì œ DBëŠ” 1000ì¸ë°!)
}
```

**ë¬¸ì œ ë°œìƒ**:
```
DB ìƒíƒœ: age=1000
1ì°¨ ìºì‹œ: age=20

â†’ ì‹¬ê°í•œ ë°ì´í„° ë¶ˆì¼ì¹˜!
```

---

#### í•´ê²°: @Modifyingìœ¼ë¡œ 1ì°¨ ìºì‹œ ì´ˆê¸°í™”

```java
@Modifying  // 1ì°¨ ìºì‹œ ì´ˆê¸°í™” í™œì„±í™”
@Transactional
@Query("UPDATE Member m SET m.age = :age WHERE m.id = :id")
int updateMemberAge(@Param("age") int age, @Param("id") Long id);
```

**@Modifyingì˜ ì—­í• **:

| ì†ì„± | ê¸°ë³¸ê°’ | ì—­í•  |
|-----|--------|------|
| **`clearAutomatically`** | `true` | ì¿¼ë¦¬ ì‹¤í–‰ **ì§í›„** 1ì°¨ ìºì‹œë¥¼ í†µì§¸ë¡œ ë¹„ì›€ |
| **`flushAutomatically`** | `false` | ì¿¼ë¦¬ ì‹¤í–‰ **ì§ì „** ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ DBì— ë™ê¸°í™” |

**ìˆ˜ì •ëœ ì‹œë‚˜ë¦¬ì˜¤**:

```java
@Transactional
public void solutionExample() {
    // 1ë‹¨ê³„: ì¡°íšŒ
    Member m = memberRepository.findById(1L).get();
    // 1ì°¨ ìºì‹œ: {id=1, age=20}
    
    // 2ë‹¨ê³„: @Modifyingì´ ì ìš©ëœ UPDATE ì‹¤í–‰
    memberRepository.updateMemberAge(1000, 1L);
    // DB: age=1000
    // 1ì°¨ ìºì‹œ: ì´ˆê¸°í™”ë¨ (ë¹„ì–´ìˆìŒ)
    
    // 3ë‹¨ê³„: ì¬ì¡°íšŒ
    Member m2 = memberRepository.findById(1L).get();
    // 1ì°¨ ìºì‹œê°€ ë¹„ì–´ìˆìœ¼ë¯€ë¡œ DBì—ì„œ ì¡°íšŒ!
    // DB: age=1000 â†’ 1ì°¨ ìºì‹œì— ì €ì¥ â†’ ë°˜í™˜
    
    System.out.println(m2.getAge());  // 1000 ì¶œë ¥ (ì •í™•í•¨!)
}
```

**í•µì‹¬**: `@Modifying`ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ìš°íšŒí•œ DML ì‘ì—… í›„ **ë©”ëª¨ë¦¬(1ì°¨ ìºì‹œ)ì˜ ì˜¤ë˜ëœ ë°ì´í„°ë¥¼ ê°•ì œë¡œ ì‚­ì œ**í•˜ì—¬, ë‹¤ìŒ ì¡°íšŒ ì‹œ **í•­ìƒ DBì˜ ìµœì‹  ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ë„ë¡ ê°•ì œ**í•©ë‹ˆë‹¤.

---

### 3.4.17.6 @Transactionalì˜ ë²”ìœ„ (Scope)

#### íŠ¸ëœì­ì…˜ ë²”ìœ„ í™•ì¥

`@Transactional`ì€ **ê°€ì¥ ë°”ê¹¥ìª½**ì— ì„ ì–¸ëœ ê²ƒì´ ê¸°ì¤€ì´ ë˜ë©°, ê·¸ ë²”ìœ„ ë™ì•ˆ **í•˜ë‚˜ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸**ê°€ ìœ ì§€ë©ë‹ˆë‹¤.

**ì˜ˆì‹œ**:

```java
@Component
@Transactional  // í´ë˜ìŠ¤ ë ˆë²¨ â†’ ëª¨ë“  ë©”ì„œë“œê°€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜
public class JpaApplication implements ApplicationRunner {
    
    private final MemberRepository memberRepository;
    
    @Override
    public void run(ApplicationArguments args) throws Exception {
        // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„±
        
        Member hyechang = Member.builder()
                                .name("hyechang")
                                .email("hyechang@spring.ac.kr")
                                .age(20)
                                .build();
        memberRepository.save(hyechang);
        
        hyechang = memberRepository.findById(hyechang.getId()).orElse(null);
        // 1ì°¨ ìºì‹œì—ì„œ ë°˜í™˜ (DB ì ‘ê·¼ X)
        
        hyechang.setAge(1000);
        // ë³€ê²½ ê°ì§€ ì¤€ë¹„
        
        memberRepository.save(hyechang);
        // ì´ë¯¸ ì˜ì† ìƒíƒœì´ë¯€ë¡œ ë³€ê²½ ê°ì§€ë¡œ ì²˜ë¦¬
        
        // ëª¨ë“  ì‘ì—…ì´ ê°™ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë¨!
        
    } // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ (Flush â†’ Commit)
}
```

**ë™ì‘ ê³¼ì •**:

```
@Transactional ì‹œì‘
    â†“
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„±
    â†“
save(hyechang): INSERT SQL ì €ì¥ì†Œì— ì˜ˆì•½
    â†“
findById(): 1ì°¨ ìºì‹œì—ì„œ ë°˜í™˜ (DB X)
    â†“
setAge(1000): ë³€ê²½ ê°ì§€ â†’ UPDATE SQL ì €ì¥ì†Œì— ì˜ˆì•½
    â†“
save(hyechang): ì´ë¯¸ ì˜ì† ìƒíƒœ â†’ ë³€ê²½ ê°ì§€ë¡œ ì²˜ë¦¬ (ì¤‘ë³µ X)
    â†“
ë©”ì„œë“œ ì¢…ë£Œ
    â†“
Flush: INSERT 1ê°œ + UPDATE 1ê°œ ì‹¤í–‰
    â†“
Commit
    â†“
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ
```

---

#### ì¤‘ì²©ëœ íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„

```java
@Service
public class MemberService {
    
    @Transactional  // ë°”ê¹¥ìª½ íŠ¸ëœì­ì…˜
    public void outerMethod() {
        Member m = memberRepository.findById(1L).get();
        
        innerMethod();  // ì•ˆìª½ íŠ¸ëœì­ì…˜
        
        m.setAge(100);
        
    } // ì—¬ê¸°ì„œ Commit â†’ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ
    
    @Transactional  // ê¸°ë³¸ì ìœ¼ë¡œ ë°”ê¹¥ìª½ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬
    public void innerMethod() {
        // outerMethod()ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³µìœ 
    }
}
```

**í•µì‹¬**: ê¸°ë³¸ì ìœ¼ë¡œ ì¤‘ì²©ëœ `@Transactional`ì€ **ê°€ì¥ ë°”ê¹¥ìª½ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬**í•˜ë©°, í•˜ë‚˜ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

---

### 3.4.17.7 í•µì‹¬ ì •ë¦¬

#### Spring Data JPA ì‚¬ìš© ì‹œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬

| ìƒí™© | ê°œë°œì ì‘ì—… | Spring Data JPA |
|-----|------------|----------------|
| **ê¸°ë³¸ CRUD** | ì•„ë¬´ê²ƒë„ ì•ˆ í•´ë„ ë¨ | âœ… ìë™ìœ¼ë¡œ `@Transactional` ì ìš© |
| **ì¿¼ë¦¬ ë©”ì„œë“œ** | ì•„ë¬´ê²ƒë„ ì•ˆ í•´ë„ ë¨ | âœ… ìë™ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ê´€ë¦¬ |
| **`@Query` SELECT** | ì•„ë¬´ê²ƒë„ ì•ˆ í•´ë„ ë¨ | âœ… ìë™ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ê´€ë¦¬ |
| **`@Query` DML** | âš ï¸ `@Transactional` + `@Modifying` í•„ìˆ˜ | âŒ ìˆ˜ë™ìœ¼ë¡œ ëª…ì‹œ í•„ìš” |
| **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì—¬ëŸ¬ ì‘ì—…)** | âš ï¸ `@Transactional` ê¶Œì¥ | ğŸŸ¡ Service ê³„ì¸µì—ì„œ ëª…ì‹œ |

---

#### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 4ê°€ì§€ í•µì‹¬ ì´ì 

| ì´ì  | ì„¤ëª… | ì¥ì  |
|-----|------|------|
| **1ì°¨ ìºì‹œ** | ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°™ì€ ì—”í‹°í‹° ì¡°íšŒ ì‹œ DB ì ‘ê·¼ X | ì„±ëŠ¥ í–¥ìƒ |
| **ë³€ê²½ ê°ì§€** | `setter`ë§Œ í˜¸ì¶œí•´ë„ ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ ìƒì„± | ì½”ë“œ ê°„ì†Œí™” |
| **ì“°ê¸° ì§€ì—°** | SQLì„ ëª¨ì•„ë‘ì—ˆë‹¤ê°€ ì»¤ë°‹ ì‹œì ì— í•œ ë²ˆì— ì‹¤í–‰ | ì„±ëŠ¥ í–¥ìƒ |
| **ì—”í‹°í‹° ë™ì¼ì„±** | ê°™ì€ ID ì¡°íšŒ ì‹œ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜ | ì•ˆì •ì„± |

---

## 3.4.18 ì—°ê´€ê´€ê³„ ë§¤í•‘ (Relationship Mapping)

### 3.4.18.1 Spring Data JDBC vs JPA

**Spring Data JDBCì˜ ê°€ì¥ í° ë‹¨ì **: ì—”í‹°í‹° ê°„ì˜ **ì—°ê´€ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ìŒ**

**JPAì˜ í•µì‹¬ ê¸°ëŠ¥**: ì—”í‹°í‹° ê°„ì˜ **ì—°ê´€ê´€ê³„ë¥¼ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ í‘œí˜„ ê°€ëŠ¥** â­

| ê¸°ëŠ¥ | Spring Data JDBC | JPA |
|-----|-----------------|-----|
| **í…Œì´ë¸” ë§¤í•‘** | âœ… ì§€ì› | âœ… ì§€ì› |
| **ì—°ê´€ê´€ê³„ ë§¤í•‘** | âŒ ë¯¸ì§€ì› | âœ… ì§€ì› â­ |
| **ì™¸ë˜ í‚¤ ìë™ ê´€ë¦¬** | âŒ ìˆ˜ë™ | âœ… ìë™ |

---

### 3.4.18.2 JPA ì—°ê´€ê´€ê³„ ì¢…ë¥˜

JPAëŠ” 4ê°€ì§€ ì—°ê´€ê´€ê³„ ë§¤í•‘ì„ ì§€ì›í•©ë‹ˆë‹¤.

| ì–´ë…¸í…Œì´ì…˜ | ê´€ê³„ | ì˜ˆì‹œ |
|-----------|------|------|
| **`@OneToOne`** | ì¼ëŒ€ì¼ (1:1) | íšŒì› â†” íšŒì›ì¹´ë“œ |
| **`@OneToMany`** | ì¼ëŒ€ë‹¤ (1:N) | íšŒì› â†” ê²Œì‹œê¸€ |
| **`@ManyToOne`** | ë‹¤ëŒ€ì¼ (N:1) | ê²Œì‹œê¸€ â†” íšŒì› |
| **`@ManyToMany`** | ë‹¤ëŒ€ë‹¤ (N:M) | í•™ìƒ â†” ìˆ˜ì—… |

---

### 3.4.18.3 ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ (Owner)

#### ê°œë…

**ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**: ì™¸ë˜ í‚¤(Foreign Key)ë¥¼ **ì‹¤ì œë¡œ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°**

**ê·œì¹™**: **ì™¸ë˜ í‚¤ê°€ ìˆëŠ” í…Œì´ë¸”ì— ë§¤í•‘ëœ ì—”í‹°í‹°ê°€ ì£¼ì¸**

```
Member í…Œì´ë¸” (1)          Article í…Œì´ë¸” (N)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
id (PK)                   id (PK)
name                      title
email                     description
                          member_id (FK) â† ì™¸ë˜ í‚¤!
```

**ì£¼ì¸ ê²°ì •**:
- `Article` í…Œì´ë¸”ì— `member_id` ì™¸ë˜ í‚¤ê°€ ìˆìŒ
- **`Article` ì—”í‹°í‹°ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸** âœ…

---

#### ì£¼ì¸ì˜ ì—­í• 

| í•­ëª© | ì£¼ì¸ (Owner) | ì£¼ì¸ ì•„ë‹˜ (Not Owner) |
|-----|-------------|---------------------|
| **ì™¸ë˜ í‚¤ ê´€ë¦¬** | âœ… ê°€ëŠ¥ (ë“±ë¡/ìˆ˜ì •/ì‚­ì œ) | âŒ ë¶ˆê°€ëŠ¥ (ì½ê¸°ë§Œ ê°€ëŠ¥) |
| **ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜** | `@ManyToOne` | `@OneToMany` |
| **`mappedBy` ì†ì„±** | âŒ ì‚¬ìš© ì•ˆ í•¨ | âœ… í•„ìˆ˜ ì‚¬ìš© |

---

### 3.4.18.4 ì˜ˆì‹œ: Member â†” Article (1:N ê´€ê³„)

#### ì—”í‹°í‹° ì •ì˜

**Article (Nìª½ - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸)**:

```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Article {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String title;
    private String description;
    
    @ManyToOne  // ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ (ì™¸ë˜ í‚¤ ê´€ë¦¬)
    private Member member;
}
```

**Member (1ìª½ - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ ì•„ë‹˜)**:

```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import lombok.*;
import com.fasterxml.jackson.annotation.JsonIgnore;
import java.util.List;

@Entity
@Builder
@Data
@AllArgsConstructor
@NoArgsConstructor
@Table(
    name = "vip_table",
    indexes = {
        @Index(name = "idx_name", columnList = "display_name, age"),
        @Index(name = "idx_email", columnList = "primary_contact")
    }
)
public class Member {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "display_name", length = 2048, nullable = false, unique = true)
    private String name;
    
    @Column(name = "primary_contact")
    private String email;
    
    private Integer age;
    
    @Transient
    private String address;
    
    @OneToMany(mappedBy = "member")  // ì½ê¸° ì „ìš© (ì£¼ì¸ ì•„ë‹˜)
    @ToString.Exclude  // ë¬´í•œ ë£¨í”„ ë°©ì§€ (toString)
    @JsonIgnore  // ë¬´í•œ ë£¨í”„ ë°©ì§€ (JSON ì§ë ¬í™”)
    private List<Article> articles;
}
```

---

#### í•µì‹¬ ìš”ì†Œ ì„¤ëª…

##### 1. @ManyToOne (ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸)

```java
@ManyToOne
private Member member;
```

**ì˜ë¯¸**:
- "ì—¬ëŸ¬ ê°œ(`Many`)ì˜ Articleì€ í•˜ë‚˜(`One`)ì˜ Memberì— ì†í•œë‹¤"
- `Article` í…Œì´ë¸”ì— `member_id` ì™¸ë˜ í‚¤ ìƒì„±
- **ì´ í•„ë“œê°€ ì™¸ë˜ í‚¤ë¥¼ ì‹¤ì œë¡œ ê´€ë¦¬**

**ìƒì„±ë˜ëŠ” DDL**:
```sql
CREATE TABLE article (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255),
    description VARCHAR(255),
    member_id BIGINT,  -- ì™¸ë˜ í‚¤
    FOREIGN KEY (member_id) REFERENCES vip_table(id)
);
```

---

##### 2. @OneToMany(mappedBy = "member")

```java
@OneToMany(mappedBy = "member")
private List<Article> articles;
```

**ì˜ë¯¸**:
- "í•˜ë‚˜(`One`)ì˜ MemberëŠ” ì—¬ëŸ¬ ê°œ(`Many`)ì˜ Articleì„ ê°€ì§„ë‹¤"
- **`mappedBy = "member"`**: "ë‚˜ëŠ” ì£¼ì¸ì´ ì•„ë‹ˆë©°, `Article` ì—”í‹°í‹°ì˜ `member` í•„ë“œê°€ ì£¼ì¸ì…ë‹ˆë‹¤"
- **ì½ê¸° ì „ìš© (Read Only)**: ì´ í•„ë“œë¡œëŠ” ì™¸ë˜ í‚¤ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ìŒ

**`mappedBy`ì˜ ì—­í• **:

| ì†ì„±ê°’ | ì˜ë¯¸ |
|-------|------|
| `"member"` | `Article` ì—”í‹°í‹°ì˜ **`member`** í•„ë“œê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ |

```java
// Article ì—”í‹°í‹° ë‚´ë¶€
@ManyToOne
private Member member;  // â† mappedByê°€ ê°€ë¦¬í‚¤ëŠ” í•„ë“œ
```

---

##### 3. @ToString.Exclude (ë¬´í•œ ë£¨í”„ ë°©ì§€ - Lombok)

```java
@ToString.Exclude
private List<Article> articles;
```

**ë¬¸ì œ ìƒí™©**:
```java
Article article = articleRepository.findById(1L).get();
log.info(article.toString());  // StackOverflowError ë°œìƒ!
```

**ë¬´í•œ ë£¨í”„**:
```
1. Article.toString() í˜¸ì¶œ
2. member í•„ë“œì˜ toString() í˜¸ì¶œ
3. Member.toString() í˜¸ì¶œ
4. articles í•„ë“œì˜


toString() í˜¸ì¶œ
5. List<Article>ì˜ ê° Article.toString() í˜¸ì¶œ
6. ë‹¤ì‹œ 1ë²ˆìœ¼ë¡œ â†’ ë¬´í•œ ë°˜ë³µ â†’ StackOverflowError
```

**í•´ê²°**:
```java
@ToString.Exclude  // toString() ë©”ì„œë“œì—ì„œ ì´ í•„ë“œ ì œì™¸
private List<Article> articles;
```

**ê²°ê³¼**:
```java
// Member.toString() ì‹¤í–‰ ì‹œ
Member(id=1, name=hyechang, email=hyechang@spring.ac.kr, age=20)
// articles í•„ë“œëŠ” ì¶œë ¥ë˜ì§€ ì•ŠìŒ â†’ ë¬´í•œ ë£¨í”„ ë°©ì§€
```

---

##### 4. @JsonIgnore (ë¬´í•œ ë£¨í”„ ë°©ì§€ - Jackson)

```java
@JsonIgnore
private List<Article> articles;
```

**ë¬¸ì œ ìƒí™©**:
```java
@RestController
public class MemberController {
    
    @GetMapping("/members/{id}")
    public Member getMember(@PathVariable Long id) {
        return memberRepository.findById(id).get();
        // Member ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜ ì‹œë„
    }
}
```

**ë¬´í•œ ë£¨í”„**:
```
1. Member ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜
2. articles í•„ë“œ ì§ë ¬í™” ì‹œë„
3. List<Article>ì˜ ê° Article ì§ë ¬í™”
4. Articleì˜ member í•„ë“œ ì§ë ¬í™”
5. ë‹¤ì‹œ Member ì§ë ¬í™” â†’ ë¬´í•œ ë°˜ë³µ â†’ ì„œë²„ ì˜¤ë¥˜
```

**í•´ê²°**:
```java
@JsonIgnore  // JSON ì§ë ¬í™” ì‹œ ì´ í•„ë“œ ì œì™¸
private List<Article> articles;
```

**ê²°ê³¼ JSON**:
```json
{
  "id": 1,
  "name": "hyechang",
  "email": "hyechang@spring.ac.kr",
  "age": 20
}
```
- `articles` í•„ë“œëŠ” JSONì— í¬í•¨ë˜ì§€ ì•ŠìŒ â†’ ë¬´í•œ ë£¨í”„ ë°©ì§€

---

#### @ToString.Exclude vs @JsonIgnore ë¹„êµ

| ì–´ë…¸í…Œì´ì…˜ | ë¼ì´ë¸ŒëŸ¬ë¦¬ | ë°©ì§€ ëŒ€ìƒ | ë°œìƒ ì‹œì  |
|-----------|----------|---------|----------|
| **`@ToString.Exclude`** | Lombok | `toString()` ë¬´í•œ ë£¨í”„ | ë¡œê¹…, ë””ë²„ê¹… ì‹œ |
| **`@JsonIgnore`** | Jackson | JSON ì§ë ¬í™” ë¬´í•œ ë£¨í”„ | API ì‘ë‹µ ì‹œ |

**ê²°ë¡ **: ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—ì„œëŠ” **ë‘˜ ë‹¤ í•„ìˆ˜**ë¡œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤!

---

### 3.4.18.5 ì—°ê´€ê´€ê³„ ì‚¬ìš© ì˜ˆì‹œ

#### Repository ì •ì˜

**ArticleRepository.java**:
```java
package com.example.jpaHibernateSample.repository;

import com.example.jpaHibernateSample.Article;
import com.example.jpaHibernateSample.Member;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public interface ArticleRepository extends JpaRepository<Article, Long> {
    
    List<Article> findByMember(Member member);
}
```

**MemberRepository.java**:
```java
package com.example.jpaHibernateSample.repository;

import com.example.jpaHibernateSample.Member;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
}
```

---

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì˜ˆì‹œ

**JpaApplication.java**:
```java
package com.example.jpaHibernateSample;

import com.example.jpaHibernateSample.repository.ArticleRepository;
import com.example.jpaHibernateSample.repository.MemberRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;
import java.util.List;

@RequiredArgsConstructor
@Slf4j
@Component
public class JpaApplication implements ApplicationRunner {

    private final MemberRepository memberRepository;
    private final ArticleRepository articleRepository;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        
        // 1. Member ìƒì„±
        Member hyechang = Member.builder()
                                .name("hyechang")
                                .email("hyechang@spring.ac.kr")
                                .age(20)
                                .build();
        memberRepository.save(hyechang);

        Member woohyun = Member.builder()
                               .name("woohyun")
                               .email("woohyun@spring.ac.kr")
                               .age(20)
                               .build();
        memberRepository.save(woohyun);

        // 2. Article ìƒì„± (ì—°ê´€ê´€ê³„ ì„¤ì •)
        Article article1 = Article.builder()
                                  .title("ë°©í•™ ì²«ë‚ ì´ë‹¤.")
                                  .description("ì˜¤ëŠ˜ì€ ì—´ì‹¬íˆ ë°©í•™ ìˆ™ì œë¥¼ í•´ì•¼ê² ë‹¤.")
                                  .member(hyechang)  // ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì™¸ë˜ í‚¤ ì„¤ì •
                                  .build();
        articleRepository.save(article1);

        Article article2 = Article.builder()
                                  .title("ê°œí•™ì€ ì–¸ì œì¸ê°€ìš”?")
                                  .description("ê°œí•™ì´ ì–¸ì œì¸ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤!!")
                                  .member(woohyun)
                                  .build();
        articleRepository.save(article2);

        Article article3 = Article.builder()
                                  .title("í—¬ìŠ¤ë‹¤ë‹ˆì‹¤ë¶„!")
                                  .description("í—¬ìŠ¤ ê°™ì´ í•˜ì‹¤ ë¶„ êµ¬í•©ë‹ˆë‹¤.")
                                  .member(hyechang)
                                  .build();
        articleRepository.save(article3);

        // 3. ì „ì²´ ê²Œì‹œê¸€ ì¡°íšŒ
        List<Article> lists = articleRepository.findAll();
        for (Article article : lists) {
            log.info(article.toString());
        }

        // 4. íŠ¹ì • íšŒì›ì˜ ê²Œì‹œê¸€ ì¡°íšŒ
        lists = articleRepository.findByMember(hyechang);
        for (Article article : lists) {
            log.info(article.toString());
        }
    }
}
```

---

#### ì‹¤í–‰ ê²°ê³¼

**ìƒì„±ëœ ë°ì´í„°**:

**vip_table (Member)**:
```
id | display_name | primary_contact          | age
1  | hyechang     | hyechang@spring.ac.kr    | 20
2  | woohyun      | woohyun@spring.ac.kr     | 20
```

**article (Article)**:
```
id | title               | description                      | member_id
1  | ë°©í•™ ì²«ë‚ ì´ë‹¤.       | ì˜¤ëŠ˜ì€ ì—´ì‹¬íˆ ë°©í•™ ìˆ™ì œë¥¼...      | 1
2  | ê°œí•™ì€ ì–¸ì œì¸ê°€ìš”?   | ê°œí•™ì´ ì–¸ì œì¸ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤!!      | 2
3  | í—¬ìŠ¤ë‹¤ë‹ˆì‹¤ë¶„!        | í—¬ìŠ¤ ê°™ì´ í•˜ì‹¤ ë¶„ êµ¬í•©ë‹ˆë‹¤.       | 1
```

**ë¡œê·¸ ì¶œë ¥**:
```
Article(id=1, title=ë°©í•™ ì²«ë‚ ì´ë‹¤., description=ì˜¤ëŠ˜ì€ ì—´ì‹¬íˆ ë°©í•™ ìˆ™ì œë¥¼..., member=Member(id=1, name=hyechang, email=hyechang@spring.ac.kr, age=20))
Article(id=2, title=ê°œí•™ì€ ì–¸ì œì¸ê°€ìš”?, description=ê°œí•™ì´ ì–¸ì œì¸ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤!!, member=Member(id=2, name=woohyun, email=woohyun@spring.ac.kr, age=20))
Article(id=3, title=í—¬ìŠ¤ë‹¤ë‹ˆì‹¤ë¶„!, description=í—¬ìŠ¤ ê°™ì´ í•˜ì‹¤ ë¶„ êµ¬í•©ë‹ˆë‹¤., member=Member(id=1, name=hyechang, email=hyechang@spring.ac.kr, age=20))

Article(id=1, title=ë°©í•™ ì²«ë‚ ì´ë‹¤., description=ì˜¤ëŠ˜ì€ ì—´ì‹¬íˆ ë°©í•™ ìˆ™ì œë¥¼..., member=Member(id=1, name=hyechang, email=hyechang@spring.ac.kr, age=20))
Article(id=3, title=í—¬ìŠ¤ë‹¤ë‹ˆì‹¤ë¶„!, description=í—¬ìŠ¤ ê°™ì´ í•˜ì‹¤ ë¶„ êµ¬í•©ë‹ˆë‹¤., member=Member(id=1, name=hyechang, email=hyechang@spring.ac.kr, age=20))
```

---

#### í•µì‹¬ ë™ì‘ ë¶„ì„

##### 1. ì—°ê´€ê´€ê³„ ì„¤ì • (ì£¼ì¸ì´ ì™¸ë˜ í‚¤ ê´€ë¦¬)

```java
Article article1 = Article.builder()
                          .member(hyechang)  // ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì„¤ì •
                          .build();
articleRepository.save(article1);
```

**ìƒì„±ë˜ëŠ” SQL**:
```sql
INSERT INTO article (title, description, member_id) 
VALUES ('ë°©í•™ ì²«ë‚ ì´ë‹¤.', 'ì˜¤ëŠ˜ì€ ì—´ì‹¬íˆ...', 1);
```

**í•µì‹¬**: `Article`ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë¯€ë¡œ, `.member(hyechang)`ìœ¼ë¡œ ì„¤ì •í•œ ê°’ì´ **ì™¸ë˜ í‚¤ `member_id`ì— ìë™ìœ¼ë¡œ ì €ì¥**ë©ë‹ˆë‹¤.

---

##### 2. ì—°ê´€ê´€ê³„ë¥¼ í†µí•œ ì¡°íšŒ

```java
List<Article> lists = articleRepository.findByMember(hyechang);
```

**ìƒì„±ë˜ëŠ” SQL**:
```sql
SELECT * FROM article WHERE member_id = 1;
```

**ê²°ê³¼**: `hyechang` íšŒì›ì´ ì‘ì„±í•œ ê²Œì‹œê¸€ë§Œ ì¡°íšŒë©ë‹ˆë‹¤.

---

##### 3. ì—­ë°©í–¥ ì¡°íšŒ (ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì—ì„œ ì¡°íšŒ)

```java
Member member = memberRepository.findById(1L).get();
List<Article> articles = member.getArticles();  // ì—­ë°©í–¥ íƒìƒ‰
```

**ìƒì„±ë˜ëŠ” SQL**:
```sql
SELECT * FROM article WHERE member_id = 1;
```

**í•µì‹¬**: `@OneToMany(mappedBy = "member")`ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì—, JPAê°€ ìë™ìœ¼ë¡œ ì—­ë°©í–¥ ì¡°íšŒë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

---

### 3.4.18.6 ë¡œë”© ì „ëµ (Fetch Type)

#### ê¸°ë³¸ ë¡œë”© ì „ëµ ê·œì¹™

**ì™¸ìš°ëŠ” ë²•**: **"Manyë¡œ ëë‚˜ë©´ ì§€ì—°(Lazy), Oneìœ¼ë¡œ ëë‚˜ë©´ ì¦‰ì‹œ(Eager)"**

| ì–´ë…¸í…Œì´ì…˜ | ê¸°ë³¸ ì „ëµ | ì™¸ìš°ëŠ” ë²• |
|-----------|---------|----------|
| **`@OneToMany`** | **LAZY** (ì§€ì—°) | `Many`ë¡œ ëë‚¨ â†’ Lazy |
| **`@ManyToMany`** | **LAZY** (ì§€ì—°) | `Many`ë¡œ ëë‚¨ â†’ Lazy |
| **`@ManyToOne`** | **EAGER** (ì¦‰ì‹œ) | `One`ìœ¼ë¡œ ëë‚¨ â†’ Eager |
| **`@OneToOne`** | **EAGER** (ì¦‰ì‹œ) | `One`ìœ¼ë¡œ ëë‚¨ â†’ Eager |

---

#### ì§€ì—° ë¡œë”© (Lazy Loading)

```java
@OneToMany(mappedBy = "member", fetch = FetchType.LAZY)  // ê¸°ë³¸ê°’
private List<Article> articles;
```

**ë™ì‘**:
```
1. Member ì¡°íšŒ ì‹œ: Member í…Œì´ë¸”ë§Œ ì¡°íšŒ (Article ì¡°íšŒ X)
2. member.getArticles() í˜¸ì¶œ ì‹œ: ê·¸ë•Œ Article í…Œì´ë¸” ì¡°íšŒ
```

**ì˜ˆì‹œ**:
```java
Member member = memberRepository.findById(1L).get();
// SQL: SELECT * FROM vip_table WHERE id = 1

List<Article> articles = member.getArticles();  // ì´ ì‹œì ì— ì¡°íšŒ!
// SQL: SELECT * FROM article WHERE member_id = 1
```

---

#### ì¦‰ì‹œ ë¡œë”© (Eager Loading)

```java
@ManyToOne(fetch = FetchType.EAGER)  // ê¸°ë³¸ê°’
private Member member;
```

**ë™ì‘**:
```
Article ì¡°íšŒ ì‹œ: Article + Memberë¥¼ í•œ ë²ˆì— JOINí•˜ì—¬ ì¡°íšŒ
```

**ì˜ˆì‹œ**:
```java
Article article = articleRepository.findById(1L).get();
// SQL: SELECT a.*, m.* FROM article a 
//      LEFT JOIN vip_table m ON a.member_id = m.id 
//      WHERE a.id = 1
```

---

#### ë¡œë”© ì „ëµ ë³€ê²½

```java
// ì§€ì—° ë¡œë”©ìœ¼ë¡œ ë³€ê²½ (ê¶Œì¥)
@ManyToOne(fetch = FetchType.LAZY)
private Member member;

// ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ë³€ê²½ (ë¹„ê¶Œì¥)
@OneToMany(mappedBy = "member", fetch = FetchType.EAGER)  // âŒ N+1 ë¬¸ì œ ë°œìƒ!
private List<Article> articles;
```

---

#### N+1 ë¬¸ì œ âš ï¸

**@OneToManyë¥¼ EAGERë¡œ ì„¤ì •í•˜ë©´ ì•ˆ ë˜ëŠ” ì´ìœ **:

```java
// ì˜ëª»ëœ ì˜ˆì‹œ
@OneToMany(mappedBy = "member", fetch = FetchType.EAGER)
private List<Article> articles;

// ì‹¤í–‰
List<Member> members = memberRepository.findAll();
```

**ë°œìƒí•˜ëŠ” SQL**:
```sql
-- 1ë²ˆ: Member ì „ì²´ ì¡°íšŒ
SELECT * FROM vip_table;  -- ê²°ê³¼: 10ëª…

-- 2~11ë²ˆ: ê° Memberë§ˆë‹¤ Article ì¡°íšŒ
SELECT * FROM article WHERE member_id = 1;
SELECT * FROM article WHERE member_id = 2;
SELECT * FROM article WHERE member_id = 3;
...
SELECT * FROM article WHERE member_id = 10;
```

**ê²°ê³¼**: **1 + N = 11ë²ˆì˜ ì¿¼ë¦¬ ì‹¤í–‰** (ì„±ëŠ¥ ì €í•˜!)

**í•´ê²°**: `@OneToMany`ëŠ” **LAZY ìœ ì§€** + í•„ìš” ì‹œ **Fetch Join** ì‚¬ìš©

---

### 3.4.18.7 ì—°ê´€ê´€ê³„ ë§¤í•‘ í•µì‹¬ ì •ë¦¬

#### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ ê·œì¹™

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **ì£¼ì¸ ê²°ì •** | ì™¸ë˜ í‚¤ê°€ ìˆëŠ” í…Œì´ë¸”ì— ë§¤í•‘ëœ ì—”í‹°í‹° |
| **ì£¼ì¸ì˜ ì—­í• ** | ì™¸ë˜ í‚¤ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥ |
| **ì£¼ì¸ì˜ ì–´ë…¸í…Œì´ì…˜** | `@ManyToOne`, `@OneToOne` (FK ìª½) |
| **ì£¼ì¸ ì•„ë‹˜** | `@OneToMany`, `@ManyToMany` + `mappedBy` |

---

#### ë¬´í•œ ë£¨í”„ ë°©ì§€ í•„ìˆ˜ ì–´ë…¸í…Œì´ì…˜

| ì–´ë…¸í…Œì´ì…˜ | ë¼ì´ë¸ŒëŸ¬ë¦¬ | ìš©ë„ | ìœ„ì¹˜ |
|-----------|----------|------|------|
| **`@ToString.Exclude`** | Lombok | `toString()` ë¬´í•œ ë£¨í”„ ë°©ì§€ | ì»¬ë ‰ì…˜ í•„ë“œ |
| **`@JsonIgnore`** | Jackson | JSON ì§ë ¬í™” ë¬´í•œ ë£¨í”„ ë°©ì§€ | ì»¬ë ‰ì…˜ í•„ë“œ |

**ì‚¬ìš© ìœ„ì¹˜**:
```java
@OneToMany(mappedBy = "member")
@ToString.Exclude  // í•„ìˆ˜!
@JsonIgnore  // í•„ìˆ˜!
private List<Article> articles;
```

---

#### ë¡œë”© ì „ëµ ê¶Œì¥ì‚¬í•­

| ì–´ë…¸í…Œì´ì…˜ | ê¸°ë³¸ ì „ëµ | ê¶Œì¥ ì „ëµ | ì´ìœ  |
|-----------|---------|---------|------|
| **`@OneToMany`** | LAZY | **LAZY ìœ ì§€** âœ… | N+1 ë¬¸ì œ ë°©ì§€ |
| **`@ManyToMany`** | LAZY | **LAZY ìœ ì§€** âœ… | N+1 ë¬¸ì œ ë°©ì§€ |
| **`@ManyToOne`** | EAGER | LAZY ë˜ëŠ” EAGER | ìƒí™©ì— ë”°ë¼ ì„ íƒ |
| **`@OneToOne`** | EAGER | LAZY ë˜ëŠ” EAGER | ìƒí™©ì— ë”°ë¼ ì„ íƒ |

**í•µì‹¬**: **`Many`ë¡œ ëë‚˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì€ í•­ìƒ LAZY ìœ ì§€!**

---

### 3.4.18.8 ìµœì¢… ì˜ˆì‹œ ì½”ë“œ (ì™„ì „í•œ í˜•íƒœ)

**Member.java** (ì™„ì „í•œ í˜•íƒœ):
```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import lombok.*;
import com.fasterxml.jackson.annotation.JsonIgnore;
import java.util.List;

@Entity
@Builder
@Data
@AllArgsConstructor
@NoArgsConstructor
@Table(
    name = "vip_table",
    indexes = {
        @Index(name = "idx_name", columnList = "display_name, age"),
        @Index(name = "idx_email", columnList = "primary_contact")
    }
)
public class Member {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "display_name", length = 2048, nullable = false, unique = true)
    private String name;
    
    @Column(name = "primary_contact")
    private String email;
    
    private Integer age;
    
    @Transient
    private String address;
    
    @OneToMany(mappedBy = "member", fetch = FetchType.LAZY)
    @ToString.Exclude
    @JsonIgnore
    private List<Article> articles;
}
```

**Article.java** (ì™„ì „í•œ í˜•íƒœ):
```java
package com.example.jpaHibernateSample;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Article {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String title;
    private String description;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private Member member;
}
```

---

## 3.4.19 í•µì‹¬ ìš”ì•½

### JPAì˜ 3ëŒ€ í•µì‹¬ ê°œë…

| ê°œë… | í•µì‹¬ ë‚´ìš© |
|-----|----------|
| **1. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸** | ì—”í‹°í‹°ë¥¼ ìºì‹±í•˜ì—¬ DB ì ‘ê·¼ ìµœì†Œí™” (1ì°¨ ìºì‹œ, ë³€ê²½ ê°ì§€, ì“°ê¸° ì§€ì—°, ë™ì¼ì„± ë³´ì¥) |
| **2. ì—°ê´€ê´€ê³„ ë§¤í•‘** | ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ì—”í‹°í‹° ê°„ ê´€ê³„ í‘œí˜„ (`@OneToMany`, `@ManyToOne` ë“±) |
| **3. JPQL** | ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ ì‘ì„± (í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê¸°ë°˜) |

---

### Spring Data JPA ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­

| ìƒí™© | í•„ìˆ˜ ì–´ë…¸í…Œì´ì…˜ | ì´ìœ  |
|-----|----------------|------|
| **`@Query` DML** | `@Transactional` + `@Modifying` | ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìš°íšŒ ì‹œ 1ì°¨ ìºì‹œ ë¶ˆì¼ì¹˜ ë°©ì§€ |
| **ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„** | `@ToString.Exclude` + `@JsonIgnore` | ë¬´í•œ ë£¨í”„ ë°©ì§€ |
| **`@OneToMany` ì‚¬ìš© ì‹œ** | `fetch = FetchType.LAZY` ìœ ì§€ | N+1 ë¬¸ì œ ë°©ì§€ |

---

## 3.4.20 QueryDSL - íƒ€ì… ì•ˆì „í•œ ë™ì  ì¿¼ë¦¬

### 3.4.20.1 QueryDSLì´ë€?

**QueryDSL**ì€ **ì¿¼ë¦¬ë¥¼ ìë°” ì½”ë“œë¡œ ì‘ì„±**í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

#### Spring Data JPAì˜ í•œê³„

ì§€ê¸ˆê¹Œì§€ Spring Data JPAì—ì„œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤:

| ë°©ë²• | ì¥ì  | ë‹¨ì  |
|-----|------|------|
| **ì¿¼ë¦¬ ë©”ì„œë“œ** | ê°„ë‹¨í•œ CRUD ìë™í™” | ë³µì¡í•œ ì¡°ê±´ â†’ ë©”ì„œë“œëª… ê¸¸ì–´ì§, ëª¨ë“  ì¡°í•© ì •ì˜ í•„ìš” |
| **`@Query` (JPQL)** | ë³µì¡í•œ ì¿¼ë¦¬ ì‘ì„± ê°€ëŠ¥ | **ì»´íŒŒì¼ ì‹œì  ì˜¤ë¥˜ ê²€ì¶œ ë¶ˆê°€**, ë™ì  ì¿¼ë¦¬ ì‘ì„± ì–´ë ¤ì›€ |

#### JPQLì˜ ë¬¸ì œì 

```java
// âŒ ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ì¡ì„ ìˆ˜ ì—†ìŒ
@Query("SELECT m FROM Member m WHERE m.name = :name")
List<Member> findByName(@Param("name") String name);
```

**ë¬¸ì œ ìƒí™©**:
```
1. Member ì—”í‹°í‹°ì— name í•„ë“œê°€ ì—†ë‹¤ë©´?
   â†’ ì‹¤í–‰ ì‹œì ì—ë§Œ ì˜¤ë¥˜ ë°œê²¬ (ëŸ°íƒ€ì„ ì—ëŸ¬)

2. í•„ë“œëª… ì˜¤íƒ€ (name â†’ nema)
   â†’ ì»´íŒŒì¼ëŸ¬ê°€ ì¡ì•„ì£¼ì§€ ëª»í•¨

3. ë™ì  ì¿¼ë¦¬ ì‘ì„± ì‹œ ë¬¸ìì—´ ì¡°í•© ë³µì¡
   â†’ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
```

---

#### QueryDSLì˜ í•´ê²°ì±…

**QueryDSL**ì€ ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ **ë©”ì„œë“œ ì²´ì´ë‹ ë°©ì‹**ìœ¼ë¡œ í•´ê²°í•©ë‹ˆë‹¤.

```java
// âœ… ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ ê²€ì¶œ ê°€ëŠ¥
List<Member> members = jpaQueryFactory
    .selectFrom(member)
    .where(member.name.eq("hyechang"))  // name í•„ë“œ ì—†ìœ¼ë©´ ì»´íŒŒì¼ ì—ëŸ¬!
    .fetch();
```

**ì¥ì **:
- âœ… **íƒ€ì… ì•ˆì „ì„± (Type Safety)**: ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ ê²€ì¶œ
- âœ… **ë™ì  ì¿¼ë¦¬ ì‘ì„± ìš©ì´**: ì¡°ê±´ì— ë”°ë¼ ë©”ì„œë“œ ì²´ì´ë‹
- âœ… **IDE ì§€ì›**: ìë™ì™„ì„±, ë¦¬íŒ©í† ë§ ê°€ëŠ¥
- âœ… **ìœ ì§€ë³´ìˆ˜ì„±**: í•„ë“œëª… ë³€ê²½ ì‹œ ìë™ ë°˜ì˜

---

### 3.4.20.2 QueryDSL vs ë‹¤ë¥¸ ë°©ì‹ ë¹„êµ

| í•­ëª© | ì¿¼ë¦¬ ë©”ì„œë“œ | JPQL (`@Query`) | QueryDSL |
|-----|-----------|----------------|----------|
| **ì‘ì„± ë°©ì‹** | ë©”ì„œë“œ ì´ë¦„ ê·œì¹™ | ë¬¸ìì—´ ì¿¼ë¦¬ | **ìë°” ì½”ë“œ** â­ |
| **ì»´íŒŒì¼ ì‹œ ê²€ì¦** | âŒ ë¶ˆê°€ëŠ¥ | âŒ ë¶ˆê°€ëŠ¥ | âœ… **ê°€ëŠ¥** â­ |
| **ë™ì  ì¿¼ë¦¬** | âŒ ë§¤ìš° ì–´ë ¤ì›€ | ğŸŸ¡ ê°€ëŠ¥í•˜ë‚˜ ë³µì¡ | âœ… **ë§¤ìš° ì‰¬ì›€** â­ |
| **ë³µì¡í•œ ì¡°ê±´** | âŒ ë©”ì„œë“œëª… ê¸¸ì–´ì§ | âœ… ê°€ëŠ¥ | âœ… **ê°€ëŠ¥** â­ |
| **IDE ì§€ì›** | ğŸŸ¡ ì œí•œì  | âŒ ì—†ìŒ | âœ… **ì™„ë²½ ì§€ì›** â­ |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ | ì¤‘ê°„ | ì¤‘ê°„ |

---

### 3.4.20.3 QueryDSLì˜ ìœ„ì¹˜ì™€ ì—­í• 

#### QueryDSLê³¼ JPAì˜ ê´€ê³„

**ì¤‘ìš”**: QueryDSLì€ JPAë¥¼ **ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë³´ì™„**í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

```
[ê°œë°œì]
    â†“ (íƒ€ì… ì•ˆì „í•œ ìë°” ì½”ë“œë¡œ ì¿¼ë¦¬ ì‘ì„±)
[QueryDSL]
    â†“ (JPQLë¡œ ë³€í™˜)
[Spring Data JPA]
    â†“ (SQLë¡œ ë³€í™˜)
[Hibernate (JPA êµ¬í˜„ì²´)]
    â†“ (SQL ì‹¤í–‰)
[JDBC Driver]
    â†“
[ë°ì´í„°ë² ì´ìŠ¤]
```

**í•µì‹¬**: QueryDSLì€ **JPAì˜ ì¥ì (ê°ì²´ ì§€í–¥ ë§¤í•‘, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)ì„ ìœ ì§€**í•˜ë©´ì„œ, **JPQLì˜ ë‹¨ì (ë¬¸ìì—´ ì¿¼ë¦¬)ì„ ë³´ì™„**í•©ë‹ˆë‹¤.

---

### 3.4.20.4 í”„ë¡œì íŠ¸ ì„¤ì •

#### ì˜ì¡´ì„± ì¶”ê°€ (build.gradle)

```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    
    // QueryDSL ì˜ì¡´ì„± (ìˆ˜ë™ ì¶”ê°€ í•„ìˆ˜!)
    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor 'com.querydsl:querydsl-apt:5.0.0:jakarta'
    annotationProcessor 'jakarta.annotation:jakarta.annotation-api'
    annotationProcessor 'jakarta.persistence:jakarta.persistence-api'
    
    runtimeOnly 'com.h2database:h2'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}
```

#### ì˜ì¡´ì„± ì„¤ëª…

| ì˜ì¡´ì„± | ì—­í•  | í•„ìˆ˜ ì—¬ë¶€ |
|-------|------|----------|
| **`querydsl-jpa:jakarta`** | QueryDSLì„ JPAì™€ í†µí•©í•˜ëŠ” í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ | âœ… í•„ìˆ˜ |
| **`querydsl-apt:jakarta`** | **Q-í´ë˜ìŠ¤ ìë™ ìƒì„±** (Annotation Processor) | âœ… í•„ìˆ˜ (ê°€ì¥ ì¤‘ìš”!) |
| **`jakarta.annotation-api`** | Q-í´ë˜ìŠ¤ ìƒì„± ì‹œ `@Generated` ì–´ë…¸í…Œì´ì…˜ ì²˜ë¦¬ | âœ… í•„ìˆ˜ |
| **`jakarta.persistence-api`** | JPA í‘œì¤€ ì–´ë…¸í…Œì´ì…˜ ì²˜ë¦¬ | âœ… í•„ìˆ˜ |

> âš ï¸ **ì¤‘ìš”**: QueryDSLì€ Spring Initializrì—ì„œ ì¶”ê°€í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ **ë°˜ë“œì‹œ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€**í•´ì•¼ í•©ë‹ˆë‹¤!

---

#### ì„¤ì • íŒŒì¼ (application.properties)

```properties
spring.application.name=queryDslSample

# JPA ë””ë²„ê¹… í™œì„±í™”
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.highlight_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
```

**í•µì‹¬**: QueryDSLì€ JPAë¥¼ **ë³´ì™„í•˜ëŠ” í”„ë ˆì„ì›Œí¬**ì´ë¯€ë¡œ, JPA ì„¤ì •ì´ ê·¸ëŒ€ë¡œ ì ìš©ë©ë‹ˆë‹¤.

---

### 3.4.20.5 Q-í´ë˜ìŠ¤ (Query Class) - ê°€ì¥ ì¤‘ìš”!

#### Q-í´ë˜ìŠ¤ë€?

**Q-í´ë˜ìŠ¤**ëŠ” QueryDSLì´ **ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±**í•˜ëŠ” **ì¿¼ë¦¬ ì „ìš© í´ë˜ìŠ¤**ì…ë‹ˆë‹¤.

#### ì—”í‹°í‹° í´ë˜ìŠ¤ ì‘ì„±

**Product.java**:
```java
package com.example.queryDslSample;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class Product {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String title;
    private String description;
}
```

---

#### ë¹Œë“œ í›„ ìë™ ìƒì„±ë˜ëŠ” Q-í´ë˜ìŠ¤

**í”„ë¡œì íŠ¸ ë¹Œë“œ**:
```
Gradle â†’ build ë˜ëŠ” IntelliJ â†’ Build Project
```

**ìƒì„± ìœ„ì¹˜**:
```
build/generated/sources/annotationProcessor/java/main/
â””â”€ com/example/queryDslSample/
   â””â”€ QProduct.java  â† ìë™ ìƒì„±!
```

**QProduct.java** (ìë™ ìƒì„±ëœ ì½”ë“œ):
```java
package com.example.queryDslSample;

import static com.querydsl.core.types.PathMetadataFactory.*;
import com.querydsl.core.types.dsl.*;
import com.querydsl.core.types.PathMetadata;
import javax.annotation.processing.Generated;
import com.querydsl.core.types.Path;

/**
 * QProduct is a Querydsl query type for Product
 */
@Generated("com.querydsl.codegen.DefaultEntitySerializer")
public class QProduct extends EntityPathBase<Product> {

    private static final long serialVersionUID = -859603247L;

    public static final QProduct product = new QProduct("product");  // â† ì •ì  í•„ë“œ!

    public final StringPath description = createString("description");

    public final NumberPath<Long> id = createNumber("id", Long.class);

    public final StringPath title = createString("title");

    public QProduct(String variable) {
        super(Product.class, forVariable(variable));
    }

    public QProduct(Path<? extends Product> path) {
        super(path.getType(), path.getMetadata());
    }

    public QProduct(PathMetadata metadata) {
        super(Product.class, metadata);
    }
}
```

---

#### Q-í´ë˜ìŠ¤ì˜ ì—­í• ê³¼ êµ¬ì¡°

##### 1. ì •ì  í•„ë“œ (Static Field)

```java
public static final QProduct product = new QProduct("product");
```

**ì—­í• **: ì¿¼ë¦¬ ì‘ì„± ì‹œ ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤**

**ì‚¬ìš©**:
```java
// QProduct.productë¡œ ì ‘ê·¼ ê°€ëŠ¥!
QProduct product = QProduct.product;

List<Product> results = jpaQueryFactory
    .selectFrom(product)  // â† QProduct.product ì‚¬ìš©
    .where(product.title.eq("TV"))
    .fetch();
```

---

##### 2. íƒ€ì… ì•ˆì „í•œ í•„ë“œ (Type-Safe Fields)

```java
public final StringPath title = createString("title");
public final NumberPath<Long> id = createNumber("id", Long.class);
```

**ì—­í• **: ì—”í‹°í‹°ì˜ ê° í•„ë“œë¥¼ **íƒ€ì… ì•ˆì „í•˜ê²Œ** í‘œí˜„

| ì—”í‹°í‹° í•„ë“œ | Q-í´ë˜ìŠ¤ í•„ë“œ | íƒ€ì… |
|-----------|-------------|------|
| `String title` | `StringPath title` | ë¬¸ìì—´ í•„ë“œ |
| `Long id` | `NumberPath<Long> id` | ìˆ«ì í•„ë“œ |
| `String description` | `StringPath description` | ë¬¸ìì—´ í•„ë“œ |

**ì¥ì **:
```java
// âœ… íƒ€ì… ì•ˆì „: titleì€ StringPathì´ë¯€ë¡œ ë¬¸ìì—´ ë©”ì„œë“œë§Œ ì‚¬ìš© ê°€ëŠ¥
product.title.eq("TV")          // ê°€ëŠ¥
product.title.contains("TV")    // ê°€ëŠ¥
product.title.gt(10)            // âŒ ì»´íŒŒì¼ ì—ëŸ¬! (ë¬¸ìì—´ì— í¬ê¸° ë¹„êµ ë¶ˆê°€)

// âœ… IDE ìë™ì™„ì„± ì§€ì›
product.title.  // â† ì´ ì‹œì ì— IDEê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ ëª©ë¡ í‘œì‹œ
```

---

#### Q-í´ë˜ìŠ¤ê°€ í•„ìš”í•œ ì´ìœ 

| ë¬¸ì œ | JPQL | QueryDSL (Q-í´ë˜ìŠ¤) |
|-----|------|---------------------|
| **í•„ë“œëª… ì˜¤íƒ€** | `"SELECT m FROM Member m WHERE m.nema = ?"` (ì˜¤íƒ€ ê°ì§€ ë¶ˆê°€) | `member.nema` (ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ!) |
| **íƒ€ì… ë¶ˆì¼ì¹˜** | `"WHERE m.age = 'abc'"` (ì‹¤í–‰ ì‹œì  ì—ëŸ¬) | `member.age.eq("abc")` (ì»´íŒŒì¼ ì—ëŸ¬!) |
| **í•„ë“œ ì‚­ì œ** | ì—”í‹°í‹°ì—ì„œ í•„ë“œ ì‚­ì œ ì‹œ ë¬¸ìì—´ ì¿¼ë¦¬ëŠ” ê·¸ëŒ€ë¡œ (ëŸ°íƒ€ì„ ì—ëŸ¬) | ì»´íŒŒì¼ ì‹œì ì— ëª¨ë“  ì°¸ì¡° ì§€ì ì—ì„œ ì—ëŸ¬ ë°œìƒ |
| **ë¦¬íŒ©í† ë§** | í•„ë“œëª… ë³€ê²½ ì‹œ ìˆ˜ë™ìœ¼ë¡œ ëª¨ë“  ì¿¼ë¦¬ ìˆ˜ì • | IDEê°€ ìë™ìœ¼ë¡œ ëª¨ë“  ì°¸ì¡° ë³€ê²½ |

---

#### Q-í´ë˜ìŠ¤ ìƒì„± íë¦„

```
1. @Entity í´ë˜ìŠ¤ ì‘ì„± (Product.java)
   â†“
2. Gradle/Maven ë¹Œë“œ
   â†“
3. Annotation Processor ì‹¤í–‰ (querydsl-apt)
   â†“
4. @Entity ë¶„ì„
   â†“
5. Q-í´ë˜ìŠ¤ ìë™ ìƒì„± (QProduct.java)
   â†“
6. build/generated/sources/ ê²½ë¡œì— ì €ì¥
   â†“
7. ê°œë°œìê°€ QProduct.productë¡œ ì ‘ê·¼ ê°€ëŠ¥
```

---

### 3.4.20.6 QueryDSL ì„¤ì • í´ë˜ìŠ¤

#### QueryDslConfig í´ë˜ìŠ¤

**QueryDslConfig.java**:
```java
package com.example.queryDslSample.config;

import com.querydsl.jpa.impl.JPAQueryFactory;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class QueryDslConfig {
    
    @PersistenceContext
    private EntityManager em;

    @Bean
    public JPAQueryFactory jpaQueryFactory() {
        return new JPAQueryFactory(em);
    }
}
```

---

#### ì„¤ì • í´ë˜ìŠ¤ì˜ ì—­í• 

**ëª©ì **: QueryDSLì´ JPAì˜ **EntityManager**ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì—°ê²°

```
[QueryDSL (ì¿¼ë¦¬ ì‘ì„±)]
    â†“
[JPAQueryFactory (ì¿¼ë¦¬ ì‹¤í–‰)]
    â†“
[EntityManager (DB ì ‘ê·¼ + ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬)]
    â†“
[ë°ì´í„°ë² ì´ìŠ¤]
```

---

#### êµ¬ì„± ìš”ì†Œ ì„¤ëª…

##### 1. @Configuration

```java
@Configuration
public class QueryDslConfig {
```

**ì—­í• **: ì´ í´ë˜ìŠ¤ê°€ **Spring ì„¤ì • í´ë˜ìŠ¤**ì„ì„ ì„ ì–¸

**ì˜ë¯¸**: Springì´ ì´ í´ë˜ìŠ¤ë¥¼ ì½ì–´ì„œ ë‚´ë¶€ì˜ `@Bean` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³  ë¹ˆì„ ë“±ë¡

---

##### 2. EntityManager

```java
@PersistenceContext
private EntityManager em;
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **EntityManager** | JPAì˜ í•µì‹¬ ì¸í„°í˜ì´ìŠ¤. **DB ì ‘ê·¼ ë° ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬**ì˜ ìµœì¢… ì±…ì„ì |
| **`@PersistenceContext`** | EntityManagerë¥¼ ì£¼ì…ë°›ëŠ” **í‘œì¤€ ë°©ë²•** (íŠ¸ëœì­ì…˜ ì•ˆì „) |

**ì™œ `@Autowired`ê°€ ì•„ë‹Œ `@PersistenceContext`?**

| ì–´ë…¸í…Œì´ì…˜ | ìš©ë„ | ë¬¸ì œì  |
|-----------|------|--------|
| **`@Autowired`** | ì¼ë°˜ ë¹ˆ ì£¼ì… | EntityManagerëŠ” íŠ¸ëœì­ì…˜ ë‹¨ìœ„ë¡œ ìƒì„±/ì†Œë©¸ë˜ë¯€ë¡œ ë¶€ì í•© |
| **`@PersistenceContext`** | EntityManager ì „ìš© ì£¼ì… | **íŠ¸ëœì­ì…˜ ì•ˆì „í•œ í”„ë¡ì‹œ ê°ì²´** ì£¼ì… |

**EntityManagerì˜ ì—­í• **:
- QueryDSLì´ ìƒì„±í•œ ì¿¼ë¦¬ë¥¼ **ì‹¤ì œ DBì— ì‹¤í–‰**
- **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸**ë¥¼ í†µí•´ ì—”í‹°í‹° ê´€ë¦¬ (1ì°¨ ìºì‹œ, ë³€ê²½ ê°ì§€ ë“±)
- **íŠ¸ëœì­ì…˜ ê´€ë¦¬**

---

##### 3. JPAQueryFactory ë¹ˆ ìƒì„±

```java
@Bean
public JPAQueryFactory jpaQueryFactory() {
    return new JPAQueryFactory(em);
}
```

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **JPAQueryFactory** | QueryDSL ì¿¼ë¦¬ë¥¼ **ì‹¤í–‰**í•˜ëŠ” ì—”ì§„ |
| **`@Bean`** | ì´ ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ë¥¼ **Spring ì»¨í…Œì´ë„ˆì— ë¹ˆìœ¼ë¡œ ë“±ë¡** |

**JPAQueryFactoryì˜ ì—­í• **:
```
1. ê°œë°œìê°€ ì‘ì„±í•œ QueryDSL ì¿¼ë¦¬ë¥¼ JPQLë¡œ ë³€í™˜
2. EntityManagerë¥¼ í†µí•´ JPQLì„ DBì— ì‹¤í–‰
3. ê²°ê³¼ë¥¼ Java ê°ì²´ë¡œ ë§¤í•‘í•˜ì—¬ ë°˜í™˜
```

**ì™œ `@Bean`ìœ¼ë¡œ ë“±ë¡í•´ì•¼ í•˜ëŠ”ê°€?**

| í•­ëª© | ì„¤ëª… |
|-----|------|
| **JPAQueryFactory** | QueryDSL ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í´ë˜ìŠ¤ (ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬) |
| **ë¬¸ì œ** | Springì´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ë¹ˆìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ì—†ìŒ |
| **í•´ê²°** | ê°œë°œìê°€ ì§ì ‘ `new JPAQueryFactory(em)` ìƒì„± í›„ `@Bean`ìœ¼ë¡œ ë“±ë¡ |

---

#### ì‹¤í–‰ íë¦„

```
1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
   â†“
2. @Configuration í´ë˜ìŠ¤ ìŠ¤ìº”
   â†“
3. @PersistenceContextë¡œ EntityManager ì£¼ì…
   â†“
4. @Bean ë©”ì„œë“œ ì‹¤í–‰
   â†“
5. new JPAQueryFactory(em) ìƒì„±
   â†“
6. Spring ì»¨í…Œì´ë„ˆì— JPAQueryFactory ë¹ˆ ë“±ë¡
   â†“
7. ê°œë°œìê°€ JPAQueryFactoryë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš© ê°€ëŠ¥
```

---

#### í•˜ë‚˜ì˜ JPAQueryFactoryë¡œ ëª¨ë“  Q-í´ë˜ìŠ¤ ì‚¬ìš© ê°€ëŠ¥

**ì¤‘ìš”**: í•˜ë‚˜ì˜ `JPAQueryFactory` ë¹ˆìœ¼ë¡œ **ëª¨ë“  ì—”í‹°í‹°(Q-í´ë˜ìŠ¤)ì˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
// í•˜ë‚˜ì˜ jpaQueryFactoryë¡œ ì—¬ëŸ¬ ì—”í‹°í‹° ì¿¼ë¦¬ ê°€ëŠ¥
QMember member = QMember.member;
QArticle article = QArticle.article;
QProduct product = QProduct.product;

// Member ì¡°íšŒ
List<Member> members = jpaQueryFactory
    .selectFrom(member)
    .where(member.name.eq("hyechang"))
    .fetch();

// Article ì¡°íšŒ
List<Article> articles = jpaQueryFactory
    .selectFrom(article)
    .where(article.title.like("ë°©í•™%"))
    .fetch();

// Product ì¡°íšŒ
List<Product> products = jpaQueryFactory
    .selectFrom(product)
    .where(product.description.contains("ì…ë‹ˆë‹¤"))
    .fetch();
```

**í•µì‹¬**: JPAQueryFactoryëŠ” **ì¿¼ë¦¬ ì‹¤í–‰ ì—”ì§„**ì¼ ë¿, ì–´ë–¤ ì—”í‹°í‹°ë¥¼ ë‹¤ë£¨ëŠ”ì§€ëŠ” Q-í´ë˜ìŠ¤ê°€ ê²°ì •í•©ë‹ˆë‹¤.

---

### 3.4.20.7 ì‚¬ìš©ì ì •ì˜ Repository êµ¬ì¡°

#### ë¬¸ì œ: Spring Data JPAë§Œìœ¼ë¡œëŠ” ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ ì–´ë ¤ì›€

**Spring Data JPAì˜ í•œê³„**:
```java
// ëª¨ë“  ì¡°í•©ì„ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì•¼ í•¨
List<Product> findByTitleContaining(String title);
List<Product> findByDescriptionContaining(String description);
List<Product> findByTitleContainingOrDescriptionContaining(String title, String description);
// ... ì¡°í•© í­ë°œ!
```

**í•´ê²°**: QueryDSLì„ ì‚¬ìš©í•œ **ì‚¬ìš©ì ì •ì˜ Repository** ìƒì„±

---

#### ë‹¨ê³„ 1: ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ì •ì˜

**ProductQueryDslRepository.java**:
```java
package com.example.queryDslSample;

import java.util.List;

public interface ProductQueryDslRepository {
    
    enum SearchType {
        TITLE,          // ì œëª© ê²€ìƒ‰
        DESCRIPTION,    // ì„¤ëª… ê²€ìƒ‰
        BOTH            // ì œëª© ë˜ëŠ” ì„¤ëª… ê²€ìƒ‰
    }

    List<Product> queryByKeyword(String keyword, SearchType searchType, long offset, long limit);
}
```

**ì£¼ì˜**: ì´ ì¸í„°í˜ì´ìŠ¤ëŠ” **`@Repository`ë¥¼ ë¶™ì´ì§€ ì•ŠìŠµë‹ˆë‹¤!**

**ì´ìœ **: êµ¬í˜„ì²´(`Impl`)ì— `@Repository`ë¥¼ ë¶™ì—¬ì„œ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ê²ƒì´ê¸° ë•Œë¬¸

---

#### ë‹¨ê³„ 2: êµ¬í˜„ í´ë˜ìŠ¤ ì‘ì„± (ê°€ì¥ ì¤‘ìš”!)

**ProductQueryDslRepositoryImpl.java**:
```java
package com.example.queryDslSample;

import com.querydsl.jpa.impl.JPAQuery;
import com.querydsl.jpa.impl.JPAQueryFactory;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository  // â† êµ¬í˜„ì²´ì— @Repository ë¶™ì„!
@RequiredArgsConstructor
public class ProductQueryDslRepositoryImpl implements ProductQueryDslRepository {
    
    private final JPAQueryFactory jpaQueryFactory;  // ì£¼ì…ë°›ìŒ

    @Override
    public List<Product> queryByKeyword(String keyword, SearchType searchType, long offset, long limit) {
        
        // 1. Q-í´ë˜ìŠ¤ ì¤€ë¹„
        QProduct product = QProduct.product;
        
        // 2. ì¿¼ë¦¬ ì‹œì‘
        JPAQuery<Product> query = jpaQueryFactory.selectFrom(product);
        
        // 3. ë™ì  ì¡°ê±´ ì¶”ê°€
        switch (searchType) {
            case TITLE:
                query = query.where(product.title.contains(keyword));
                break;
                
            case DESCRIPTION:
                query = query.where(product.description.contains(keyword));
                break;
                
            case BOTH:
                query = query.where(
                    product.title.contains(keyword)
                        .or(product.description.contains(keyword))
                );
                break;
        }
        
        // 4. ì •ë ¬, í˜ì´ì§•, ì‹¤í–‰
        return query
            .orderBy(product.id.desc())
            .offset(offset)
            .limit(limit)
            .fetch();
    }
}
```

---

#### êµ¬í˜„ í´ë˜ìŠ¤ í•µì‹¬ ìš”ì†Œ

##### 1. í´ë˜ìŠ¤ëª… ê·œì¹™ (ë§¤ìš° ì¤‘ìš”!)

```
ì¸í„°í˜ì´ìŠ¤ëª… + Impl
```

| ì¸í„°í˜ì´ìŠ¤ | êµ¬í˜„ í´ë˜ìŠ¤ | ë¹„ê³  |
|-----------|------------|------|
| `ProductQueryDslRepository` | `ProductQueryDslRepositoryImpl` | âœ… Springì´ ìë™ ì¸ì‹ |
| `ProductQueryDslRepository` | `ProductQueryDslRepositoryImplCustom` | âŒ ì¸ì‹ ì•ˆ ë¨ |

**í•µì‹¬**: ë°˜ë“œì‹œ `Impl`ë¡œ ëë‚˜ì•¼ Spring Data JPAê°€ ìë™ìœ¼ë¡œ ì°¾ì•„ì„œ ì—°ê²°í•©ë‹ˆë‹¤!

---

##### 2. @Repository ì–´ë…¸í…Œì´ì…˜

```java
@Repository
public class ProductQueryDslRepositoryImpl
```

**ì—­í• **: ì´ êµ¬í˜„ì²´ë¥¼ **Spring ë¹ˆìœ¼ë¡œ ë“±ë¡**

**ì¤‘ìš”**: ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ **êµ¬í˜„ì²´ì—** `@Repository`ë¥¼ ë¶™ì…ë‹ˆë‹¤!

---

##### 3. JPAQueryFactory ì£¼ì…

```java
private final JPAQueryFactory jpaQueryFactory;
```

**ì˜ì¡´ì„± ì£¼ì…**:
```
QueryDslConfigì—ì„œ @Beanìœ¼ë¡œ ë“±ë¡í•œ JPAQueryFactoryë¥¼ ì£¼ì…ë°›ìŒ
    â†“
ì´ ê°ì²´ë¥¼ í†µí•´ QueryDSL ì¿¼ë¦¬ ì‹¤í–‰
```

---

##### 4. Q-í´ë˜ìŠ¤ ì‚¬ìš©

```java
QProduct product = QProduct.product;
```

**QProduct.product**: ë¹Œë“œ ì‹œ ìë™ ìƒì„±ëœ ì •ì  í•„ë“œ

**ì‚¬ìš©**:
```java
jpaQueryFactory
    .selectFrom(product)          // SELECT * FROM product
    .where(product.title.eq("TV")) // WHERE title = 'TV'
    .fetch();                      // ì‹¤í–‰ ë° ê²°ê³¼ ë°˜í™˜
```

---

##### 5. ë™ì  ì¿¼ë¦¬ ì‘ì„±

```java
JPAQuery<Product> query = jpaQueryFactory.selectFrom(product);

switch (searchType) {
    case TITLE:
        query = query.where(product.title.contains(keyword));
        break;
}
```

**í•µì‹¬**: `JPAQuery` ê°ì²´ë¥¼ **ë³€ìˆ˜ì— ì €ì¥**í•˜ê³ , ì¡°ê±´ì— ë”°ë¼ **ì²´ì´ë‹ì„ ì´ì–´ê°€ëŠ” ë°©ì‹**

**JPQLê³¼ ë¹„êµ**:

| ë°©ì‹ | ì½”ë“œ |
|-----|------|
| **JPQL** | `"SELECT p FROM Product p WHERE " + (ì¡°ê±´ ? "p.title LIKE ..." : "")` (ë¬¸ìì—´ ì¡°í•© ë³µì¡) |
| **QueryDSL** | `query.where(ì¡°ê±´ ? product.title.contains(...) : null)` (ë©”ì„œë“œ ì²´ì´ë‹) |

---

#### QueryDSL ì£¼ìš” ë©”ì„œë“œ

##### ì¡°íšŒ ë©”ì„œë“œ

| ë©”ì„œë“œ | ì„¤ëª… | ë°˜í™˜ íƒ€ì… |
|-------|------|----------|
| **`selectFrom(entity)`** | SELECT * FROM í…Œì´ë¸” | `JPAQuery<T>` |
| **`select(í•„ë“œ1, í•„ë“œ2...)`** | íŠ¹ì • í•„ë“œë§Œ ì¡°íšŒ | `JPAQuery<Tuple>` ë˜ëŠ” `JPAQuery<DTO>` |

**ì˜ˆì‹œ**:
```java
// ì „ì²´ ì¡°íšŒ
jpaQueryFactory.selectFrom(product)  // Product ì—”í‹°í‹° ì „ì²´

// íŠ¹ì • í•„ë“œë§Œ
jpaQueryFactory.select(product.title, product.description)  // ì œëª©, ì„¤ëª…ë§Œ
```

---

##### ì¡°ê±´ ë©”ì„œë“œ (WHERE)

| ë©”ì„œë“œ | ì˜ë¯¸ | SQL |
|-------|------|-----|
| **`.eq(ê°’)`** | ê°™ë‹¤ | `= ê°’` |
| **`.ne(ê°’)`** | ê°™ì§€ ì•Šë‹¤ | `!= ê°’` |
| **`.contains(ê°’)`** | í¬í•¨ | `LIKE '%ê°’%'` |
| **`.startsWith(ê°’)`** | ~ë¡œ ì‹œì‘ | `LIKE 'ê°’%'` |
| **`.endsWith(ê°’)`** | ~ë¡œ ëë‚¨ | `LIKE '%ê°’'` |
| **`.gt(ê°’)`** | í¬ë‹¤ | `> ê°’` |
| **`.goe(ê°’)`** | í¬ê±°ë‚˜ ê°™ë‹¤ | `>= ê°’` |
| **`.lt(ê°’)`** | ì‘ë‹¤ | `< ê°’` |
| **`.loe(ê°’)`** | ì‘ê±°ë‚˜ ê°™ë‹¤ | `<= ê°’` |
| **`.between(ìµœì†Œ, ìµœëŒ€)`** | ë²”ìœ„ | `BETWEEN ìµœì†Œ AND ìµœëŒ€` |
| **`.isNull()`** | NULL | `IS NULL` |
| **`.isNotNull()`** | NOT NULL | `IS NOT NULL` |

**ì˜ˆì‹œ**:
```java
product.title.eq("TV")                     // title = 'TV'
product.title.contains("ì»´í“¨í„°")            // title LIKE '%ì»´í“¨í„°%'
product.id.gt(10)                          // id > 10
product.id.between(1, 100)                 // id BETWEEN 1 AND 100
```

---

##### ì¡°ê±´ ê²°í•© (AND, OR)

```java
// AND (ëª¨ë‘ ë§Œì¡±)
.where(product.title.contains("TV"), product.id.gt(10))
// WHERE title LIKE '%TV%' AND id > 10

// OR (í•˜ë‚˜ë¼ë„ ë§Œì¡±)
.where(product.title.contains("TV").or(product.description.contains("TV")))
// WHERE title LIKE '%TV%' OR description LIKE '%TV%'
```

**í•µì‹¬**: `where()` ì•ˆì— ì½¤ë§ˆ(`,`)ë¡œ ë‚˜ì—´í•˜ë©´ **AND**, `.or()`ë¡œ ì—°ê²°í•˜ë©´ **OR**

---

##### ì •ë ¬, í˜ì´ì§•, ì‹¤í–‰

| ë©”ì„œë“œ | ì—­í•  | ì˜ˆì‹œ |
|-------|------|------|
| **`.orderBy(í•„ë“œ.asc/desc())`** | ì •ë ¬ | `.orderBy(product.id.desc())` |
| **`.offset(ìˆ«ì)`** | ê±´ë„ˆë›¸ ê°œìˆ˜ | `.offset(10)` (11ë²ˆì§¸ë¶€í„°) |
| **`.limit(ìˆ«ì)`** | ê°€ì ¸ì˜¬ ê°œìˆ˜ | `.limit(5)` (5ê°œë§Œ) |
| **`.fetch()`** | ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ | `List<Product>` |
| **`.fetchOne()`** | ë‹¨ê±´ ë°˜í™˜ | `Product` ë˜ëŠ” `null` |
| **`.fetchFirst()`** | ì²« ë²ˆì§¸ë§Œ | `Product` ë˜ëŠ” `null` |
| **`.fetchCount()`** | ê°œìˆ˜
```java
**`.fetchCount()`** | ê°œìˆ˜ë§Œ | `long` (Deprecated, count() ì‚¬ìš© ê¶Œì¥) |

**ì˜ˆì‹œ**:
```java
List<Product> results = jpaQueryFactory
    .selectFrom(product)
    .where(product.title.contains("ì»´í“¨í„°"))
    .orderBy(product.id.desc())  // ID ë‚´ë¦¼ì°¨ìˆœ
    .offset(0)                   // ì²« í˜ì´ì§€
    .limit(10)                   // 10ê°œë§Œ
    .fetch();                    // ì‹¤í–‰
```

---

### 3.4.20.8 í†µí•© Repository íŒ¨í„´ (ê°€ì¥ ì¤‘ìš”!)

#### ë¬¸ì œ: QueryDSL Repositoryë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€?

**ì˜ëª»ëœ ë°©ë²•**:
```java
// âŒ ë‘ ê°œì˜ Repositoryë¥¼ ë”°ë¡œ ì£¼ì…?
@RequiredArgsConstructor
public class ProductService {
    private final ProductRepository productRepository;  // JPAìš©
    private final ProductQueryDslRepositoryImpl queryDslRepo;  // QueryDSLìš©
}
```

**ë¬¸ì œì **: ê´€ë¦¬ í¬ì¸íŠ¸ê°€ 2ê°œë¡œ ëŠ˜ì–´ë‚¨, ì¼ê´€ì„± ì—†ìŒ

---

#### í•´ê²°: í†µí•© Repository ì¸í„°í˜ì´ìŠ¤

**ProductRepository.java**:
```java
package com.example.queryDslSample;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public interface ProductRepository extends JpaRepository<Product, Long>, ProductQueryDslRepository {
    
    // Spring Data JPA ì¿¼ë¦¬ ë©”ì„œë“œ
    List<Product> findByTitleContaining(String title);
}
```

**êµ¬ì¡°**:
```
ProductRepository (ì¸í„°í˜ì´ìŠ¤)
â”œâ”€ extends JpaRepository<Product, Long>        (Spring Data JPA ê¸°ëŠ¥)
â””â”€ extends ProductQueryDslRepository           (QueryDSL ê¸°ëŠ¥)
```

---

#### Springì˜ í†µí•© ë©”ì»¤ë‹ˆì¦˜ (í•µì‹¬ ì›ë¦¬!)

**ë¬¸ì œ**: `ProductQueryDslRepository`ëŠ” ì¸í„°í˜ì´ìŠ¤ì¸ë°, Springì´ ì–´ë–»ê²Œ êµ¬í˜„ì²´ë¥¼ ì°¾ëŠ”ê°€?

**í•´ê²°**: Spring Data JPAì˜ **ìë™ íƒìƒ‰ ë° ìœ„ì„ íŒ¨í„´**

```
1. Springì´ ProductRepository ì¸í„°í˜ì´ìŠ¤ ë°œê²¬
   â†“
2. JpaRepository ë¶€ë¶„: Springì´ ìë™ìœ¼ë¡œ êµ¬í˜„ ì½”ë“œ ìƒì„±
   â†“
3. ProductQueryDslRepository ë¶€ë¶„: 
   "ProductQueryDslRepository + Impl" ì´ë¦„ì˜ í´ë˜ìŠ¤ë¥¼ ì°¾ìŒ
   â†“
4. ProductQueryDslRepositoryImpl ë°œê²¬ (@Repository ë¹ˆ)
   â†“
5. ìµœì¢… í”„ë¡ì‹œ ê°ì²´ ìƒì„±:
   - JpaRepository ë©”ì„œë“œ: Springì´ ìë™ ì²˜ë¦¬
   - ProductQueryDslRepository ë©”ì„œë“œ: Impl ê°ì²´ì— ìœ„ì„
```

---

#### ìµœì¢… í”„ë¡ì‹œ ê°ì²´ êµ¬ì¡° (ê°œë…ì  í‘œí˜„)

```java
// Springì´ ëŸ°íƒ€ì„ì— ìƒì„±í•˜ëŠ” ê°€ìƒì˜ í”„ë¡ì‹œ í´ë˜ìŠ¤
public class ProductRepositoryProxy implements ProductRepository {

    // 1. JPA ê¸°ë³¸ ê¸°ëŠ¥ ì²˜ë¦¬ (Springì´ ìë™ ìƒì„±)
    private final JpaRepositoryDelegate jpaDelegate;
    
    // 2. QueryDSL ì‚¬ìš©ì ì •ì˜ ê¸°ëŠ¥ ì²˜ë¦¬ (ê°œë°œìê°€ ì‘ì„±)
    private final ProductQueryDslRepositoryImpl customImpl;  // â† ì£¼ì…ë°›ìŒ!

    // --- JpaRepository ë©”ì„œë“œ ---
    @Override
    public Product save(Product entity) {
        return jpaDelegate.executeSave(entity);  // Springì´ ìë™ ì²˜ë¦¬
    }

    @Override
    public List<Product> findAll() {
        return jpaDelegate.executeFindAll();  // Springì´ ìë™ ì²˜ë¦¬
    }

    // --- ì¿¼ë¦¬ ë©”ì„œë“œ ---
    @Override
    public List<Product> findByTitleContaining(String title) {
        return jpaDelegate.executeQuery(...);  // Springì´ ìë™ ìƒì„±
    }

    // --- ProductQueryDslRepository ë©”ì„œë“œ ---
    @Override
    public List<Product> queryByKeyword(String keyword, SearchType searchType, long offset, long limit) {
        return customImpl.queryByKeyword(keyword, searchType, offset, limit);  // â† ìœ„ì„!
    }
}
```

**í•µì‹¬**: 
- `JpaRepository` ë©”ì„œë“œ: Springì´ **ì§ì ‘ êµ¬í˜„**
- `ProductQueryDslRepository` ë©”ì„œë“œ: **Impl ê°ì²´ì— ìœ„ì„**

---

#### í†µí•© Repository ë¹„êµí‘œ

| ê¸°ëŠ¥ | ì½”ë“œ ì¶œì²˜ | ë‚´ë¶€ ì²˜ë¦¬ | êµ¬í˜„ì²´ í•„ìš” |
|-----|----------|---------|-----------|
| **JpaRepository ê¸°ë³¸ CRUD** (`save`, `findById`) | Spring Data JPA (ìë™) | Springì´ ì§ì ‘ ëŸ°íƒ€ì„ ì½”ë“œ ìƒì„± | âŒ ë¶ˆí•„ìš” |
| **ì¿¼ë¦¬ ë©”ì„œë“œ** (`findByTitleContaining`) | Spring Data JPA (ìë™) | ë©”ì„œë“œ ì´ë¦„ ë¶„ì„ í›„ ìë™ ìƒì„± | âŒ ë¶ˆí•„ìš” |
| **QueryDSL ì‚¬ìš©ì ì •ì˜** (`queryByKeyword`) | ê°œë°œì (ìˆ˜ë™) | `ProductQueryDslRepositoryImpl`ì— ìœ„ì„ | âœ… í•„ìˆ˜ |

---

### 3.4.20.9 ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì˜ˆì‹œ

**QueryDslApplication.java**:
```java
package com.example.queryDslSample;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;
import java.util.List;

@Component
@RequiredArgsConstructor
@Slf4j
public class QueryDslApplication implements ApplicationRunner {
    
    private final ProductRepository repository;  // â† í†µí•© Repository ì£¼ì…

    @Override
    public void run(ApplicationArguments args) throws Exception {
        
        // 1. ë°ì´í„° ìƒì„±
        Product product1 = Product.builder()
                                  .title("tv")
                                  .description("ìµœì‹  í‹°ë¹„ì…ë‹ˆë‹¤.")
                                  .build();
        
        Product product2 = Product.builder()
                                  .title("ì»´í“¨í„°")
                                  .description("ê²Œì„ìš© ì»´í“¨í„°ì…ë‹ˆë‹¤.")
                                  .build();
        
        Product product3 = Product.builder()
                                  .title("ëƒ‰ì¥ê³ ")
                                  .description("LGëƒ‰ì¥ê³ ì…ë‹ˆë‹¤.")
                                  .build();

        // ========================================
        // 2. JpaRepository ê¸°ë³¸ CRUD ì‚¬ìš©
        // ========================================
        repository.save(product1);
        repository.save(product2);
        repository.save(product3);
        log.info("=== JpaRepository save() ì™„ë£Œ ===");

        // ========================================
        // 3. Spring Data JPA ì¿¼ë¦¬ ë©”ì„œë“œ ì‚¬ìš©
        // ========================================
        List<Product> lists = repository.findByTitleContaining("ì¥ê³ ");
        log.info("=== findByTitleContaining('ì¥ê³ ') ê²°ê³¼ ===");
        for (Product product : lists) {
            log.info(product.toString());
        }

        // ========================================
        // 4. QueryDSL ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ ì‚¬ìš©
        // ========================================
        lists = repository.queryByKeyword(
            "ì…ë‹ˆë‹¤", 
            ProductQueryDslRepository.SearchType.DESCRIPTION, 
            0, 
            2
        );
        log.info("=== queryByKeyword('ì…ë‹ˆë‹¤', DESCRIPTION, 0, 2) ê²°ê³¼ ===");
        for (Product product : lists) {
            log.info(product.toString());
        }
    }
}
```

---

#### ì‹¤í–‰ ê²°ê³¼ ë¶„ì„

**ìƒì„±ëœ ë°ì´í„°**:
```
id | title    | description
1  | tv       | ìµœì‹  í‹°ë¹„ì…ë‹ˆë‹¤.
2  | ì»´í“¨í„°   | ê²Œì„ìš© ì»´í“¨í„°ì…ë‹ˆë‹¤.
3  | ëƒ‰ì¥ê³    | LGëƒ‰ì¥ê³ ì…ë‹ˆë‹¤.
```

**ì¿¼ë¦¬ ì‹¤í–‰ ê²°ê³¼**:

##### 1. JpaRepository ì‚¬ìš©
```java
repository.save(product1);
```
**ìƒì„±ëœ SQL**:
```sql
INSERT INTO product (title, description) VALUES ('tv', 'ìµœì‹  í‹°ë¹„ì…ë‹ˆë‹¤.');
```

##### 2. ì¿¼ë¦¬ ë©”ì„œë“œ ì‚¬ìš©
```java
repository.findByTitleContaining("ì¥ê³ ");
```
**ìƒì„±ëœ SQL**:
```sql
SELECT * FROM product WHERE title LIKE '%ì¥ê³ %';
```
**ê²°ê³¼**: `Product(id=3, title=ëƒ‰ì¥ê³ , description=LGëƒ‰ì¥ê³ ì…ë‹ˆë‹¤.)`

##### 3. QueryDSL ì‚¬ìš©
```java
repository.queryByKeyword("ì…ë‹ˆë‹¤", SearchType.DESCRIPTION, 0, 2);
```
**ìƒì„±ëœ SQL**:
```sql
SELECT * FROM product 
WHERE description LIKE '%ì…ë‹ˆë‹¤%' 
ORDER BY id DESC 
LIMIT 2 OFFSET 0;
```
**ê²°ê³¼**:
```
Product(id=3, title=ëƒ‰ì¥ê³ , description=LGëƒ‰ì¥ê³ ì…ë‹ˆë‹¤.)
Product(id=2, title=ì»´í“¨í„°, description=ê²Œì„ìš© ì»´í“¨í„°ì…ë‹ˆë‹¤.)
```

---

### 3.4.20.10 í†µí•© ì‚¬ìš© íŒ¨í„´ ì •ë¦¬

#### í•˜ë‚˜ì˜ Repositoryë¡œ 3ê°€ì§€ ë°©ì‹ ì‚¬ìš©

```java
private final ProductRepository repository;

// 1ï¸âƒ£ JpaRepository ê¸°ë³¸ CRUD
repository.save(product);
repository.findById(1L);
repository.findAll();
repository.delete(product);

// 2ï¸âƒ£ Spring Data JPA ì¿¼ë¦¬ ë©”ì„œë“œ
repository.findByTitleContaining("TV");

// 3ï¸âƒ£ QueryDSL ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ
repository.queryByKeyword("ê²€ìƒ‰ì–´", SearchType.BOTH, 0, 10);
```

**ì¥ì **:
- âœ… **ë‹¨ì¼ ì§„ì…ì **: í•˜ë‚˜ì˜ Repositoryë§Œ ì£¼ì…ë°›ìœ¼ë©´ ë¨
- âœ… **ì¼ê´€ì„±**: ëª¨ë“  ë°ì´í„° ì ‘ê·¼ì´ í•œ ê³³ì—ì„œ ê´€ë¦¬ë¨
- âœ… **ìœ ì§€ë³´ìˆ˜ ìš©ì´**: ì½”ë“œ ë³€ê²½ ì‹œ í•˜ë‚˜ì˜ ì¸í„°í˜ì´ìŠ¤ë§Œ í™•ì¸

---

### 3.4.20.11 QueryDSL ì‹¤í–‰ íë¦„ (ì „ì²´)

```
1. ê°œë°œìê°€ ProductRepository ì£¼ì…ë°›ìŒ
   â†“
2. repository.queryByKeyword(...) í˜¸ì¶œ
   â†“
3. Springì´ ProductRepositoryProxy (í”„ë¡ì‹œ ê°ì²´) ì‹¤í–‰
   â†“
4. í”„ë¡ì‹œê°€ ProductQueryDslRepositoryImpl.queryByKeyword() í˜¸ì¶œ (ìœ„ì„)
   â†“
5. JPAQueryFactoryê°€ QueryDSL ì½”ë“œë¥¼ JPQLë¡œ ë³€í™˜
   â†“
6. EntityManagerê°€ JPQLì„ SQLë¡œ ë³€í™˜
   â†“
7. JDBC Driverë¥¼ í†µí•´ DBì— SQL ì‹¤í–‰
   â†“
8. ê²°ê³¼ë¥¼ Product ì—”í‹°í‹°ë¡œ ë§¤í•‘
   â†“
9. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ (1ì°¨ ìºì‹œ)
   â†“
10. ê°œë°œìì—ê²Œ List<Product> ë°˜í™˜
```

---

### 3.4.20.12 QueryDSL vs ë‹¤ë¥¸ ë°©ì‹ ìµœì¢… ë¹„êµ

#### ì½”ë“œ ë¹„êµ

**ì¿¼ë¦¬ ë©”ì„œë“œ**:
```java
// ëª¨ë“  ì¡°í•©ì„ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì•¼ í•¨
List<Product> findByTitleContaining(String title);
List<Product> findByDescriptionContaining(String description);
List<Product> findByTitleContainingOrDescriptionContaining(String t, String d);
```

**JPQL**:
```java
@Query("SELECT p FROM Product p WHERE " +
       "(:title IS NULL OR p.title LIKE %:title%) AND " +
       "(:description IS NULL OR p.description LIKE %:description%)")
List<Product> search(@Param("title") String title, @Param("description") String desc);
```

**QueryDSL**:
```java
JPAQuery<Product> query = jpaQueryFactory.selectFrom(product);

if (title != null) {
    query = query.where(product.title.contains(title));
}
if (description != null) {
    query = query.where(product.description.contains(description));
}

return query.fetch();
```

---

#### ì¥ë‹¨ì  ë¹„êµ

| í•­ëª© | ì¿¼ë¦¬ ë©”ì„œë“œ | JPQL | QueryDSL |
|-----|-----------|------|----------|
| **ê°„ë‹¨í•œ CRUD** | âœ… ìµœì  | ğŸŸ¡ ê°€ëŠ¥ | ğŸŸ¡ ê°€ëŠ¥ |
| **ë³µì¡í•œ ì¡°ê±´** | âŒ ë©”ì„œë“œëª… ê¸¸ì–´ì§ | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ |
| **ë™ì  ì¿¼ë¦¬** | âŒ ë§¤ìš° ì–´ë ¤ì›€ | ğŸŸ¡ ê°€ëŠ¥í•˜ë‚˜ ë³µì¡ | âœ… **ë§¤ìš° ì‰¬ì›€** â­ |
| **ì»´íŒŒì¼ ì‹œ ê²€ì¦** | âŒ ë¶ˆê°€ëŠ¥ | âŒ ë¶ˆê°€ëŠ¥ | âœ… **ê°€ëŠ¥** â­ |
| **íƒ€ì… ì•ˆì „ì„±** | âŒ ì—†ìŒ | âŒ ì—†ìŒ | âœ… **ì™„ë²½ ì§€ì›** â­ |
| **ë¦¬íŒ©í† ë§** | ğŸŸ¡ IDE ì§€ì› ì œí•œì  | âŒ ìˆ˜ë™ | âœ… **ìë™** â­ |
| **í•™ìŠµ ê³¡ì„ ** | ë‚®ìŒ | ì¤‘ê°„ | ì¤‘ê°„ |
| **ì½”ë“œ ì–‘** | ì ìŒ | ì¤‘ê°„ | ì¤‘ê°„ |

---

### 3.4.20.13 QueryDSL ì‚¬ìš© ê¶Œì¥ ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | ê¶Œì¥ ë°©ë²• | ì´ìœ  |
|-----|---------|------|
| **ë‹¨ìˆœ CRUD** | ì¿¼ë¦¬ ë©”ì„œë“œ ë˜ëŠ” JpaRepository | ê°„ë‹¨í•˜ê³  ì§ê´€ì  |
| **ë‹¨ìˆœ ê²€ìƒ‰** | ì¿¼ë¦¬ ë©”ì„œë“œ | ìë™ ìƒì„±ìœ¼ë¡œ ì¶©ë¶„ |
| **ë³µì¡í•œ ì¡°ê±´ (ê³ ì •)** | JPQL (`@Query`) | SQL ì œì–´ ê°€ëŠ¥ |
| **ë™ì  ê²€ìƒ‰ ì¡°ê±´** | **QueryDSL** â­ | ì¡°ê±´ ì¡°í•© ììœ ë¡œì›€ |
| **ë³µì¡í•œ JOIN + ë™ì  ì¡°ê±´** | **QueryDSL** â­ | íƒ€ì… ì•ˆì „ + ê°€ë…ì„± |
| **í†µê³„/ì§‘ê³„ ì¿¼ë¦¬** | **QueryDSL** | íƒ€ì… ì•ˆì „ + ë¦¬íŒ©í† ë§ ì§€ì› |
| **ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸** | **QueryDSL** â­ | ìœ ì§€ë³´ìˆ˜ì„± ê·¹ëŒ€í™” |

---

### 3.4.20.14 í•µì‹¬ ì •ë¦¬

#### QueryDSLì˜ 3ëŒ€ í•µì‹¬

| ê°œë… | í•µì‹¬ ë‚´ìš© |
|-----|----------|
| **1. Q-í´ë˜ìŠ¤** | ì—”í‹°í‹°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±ë˜ëŠ” ì¿¼ë¦¬ ì „ìš© í´ë˜ìŠ¤ (íƒ€ì… ì•ˆì „ì„± ë³´ì¥) |
| **2. JPAQueryFactory** | QueryDSL ì¿¼ë¦¬ë¥¼ JPQLë¡œ ë³€í™˜í•˜ê³  EntityManagerë¥¼ í†µí•´ ì‹¤í–‰í•˜ëŠ” ì—”ì§„ |
| **3. í†µí•© Repository** | JpaRepository + QueryDSL ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ì—¬ ë‹¨ì¼ ì§„ì…ì  ì œê³µ |

---

#### QueryDSL ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

| í•­ëª© | í•„ìˆ˜ ì‘ì—… | í™•ì¸ |
|-----|----------|------|
| **ì˜ì¡´ì„±** | `querydsl-jpa`, `querydsl-apt` ì¶”ê°€ | âœ… |
| **Q-í´ë˜ìŠ¤ ìƒì„±** | ë¹Œë“œ í›„ `build/generated/` í™•ì¸ | âœ… |
| **ì„¤ì • í´ë˜ìŠ¤** | `JPAQueryFactory` ë¹ˆ ë“±ë¡ | âœ… |
| **ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤** | ë©”ì„œë“œ ì •ì˜ | âœ… |
| **êµ¬í˜„ í´ë˜ìŠ¤** | `ì¸í„°í˜ì´ìŠ¤ëª… + Impl` ì‘ì„± | âœ… |
| **`@Repository`** | êµ¬í˜„ í´ë˜ìŠ¤ì— ë¶™ì„ | âœ… |
| **í†µí•© Repository** | `JpaRepository` + ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ìƒì† | âœ… |

---

#### QueryDSL vs JPA ê´€ê³„ ìš”ì•½

```
QueryDSLì€ JPAë¥¼ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë³´ì™„í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

[QueryDSL]
    â†“ (íƒ€ì… ì•ˆì „í•œ ì¿¼ë¦¬ ì‘ì„±)
[JPQL]
    â†“ (ê°ì²´ ì§€í–¥ ì¿¼ë¦¬)
[JPA/Hibernate]
    â†“ (SQL ìë™ ìƒì„± + ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)
[JDBC Driver]
    â†“
[ë°ì´í„°ë² ì´ìŠ¤]
```

**í•µì‹¬**: 
- QueryDSLì€ **JPQLì˜ ë¬¸ìì—´ ì¿¼ë¦¬**ë¥¼ **íƒ€ì… ì•ˆì „í•œ ìë°” ì½”ë“œ**ë¡œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
- JPAì˜ ëª¨ë“  ì¥ì (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸, íŠ¸ëœì­ì…˜, ìë™ ë§¤í•‘)ì€ **ê·¸ëŒ€ë¡œ ìœ ì§€**ë©ë‹ˆë‹¤.

---

#### ìµœì¢… ì½”ë“œ íë¦„

```java
// 1. Q-í´ë˜ìŠ¤ ì¤€ë¹„ (ë¹Œë“œ ì‹œ ìë™ ìƒì„±)
QProduct product = QProduct.product;

// 2. JPAQueryFactoryë¡œ ì¿¼ë¦¬ ì‹œì‘
JPAQuery<Product> query = jpaQueryFactory.selectFrom(product);

// 3. ë™ì  ì¡°ê±´ ì¶”ê°€ (íƒ€ì… ì•ˆì „!)
if (keyword != null) {
    query = query.where(product.title.contains(keyword));
}

// 4. ì‹¤í–‰ (JPA/Hibernateê°€ SQLë¡œ ë³€í™˜ í›„ ì‹¤í–‰)
List<Product> results = query.fetch();
```

**ëª¨ë“  ê³¼ì •ì—ì„œ**:
- âœ… ì»´íŒŒì¼ëŸ¬ê°€ íƒ€ì… ì²´í¬
- âœ… IDEê°€ ìë™ì™„ì„± ì§€ì›
- âœ… ë¦¬íŒ©í† ë§ ì‹œ ìë™ ë°˜ì˜
- âœ… JPAì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìœ ì§€

---




